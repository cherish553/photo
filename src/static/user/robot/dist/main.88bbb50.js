webpackJsonp([1],{"+9n3":function(t,e){},"/Jog":function(t,e){},"/KGx":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("Gu7T"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={name:"CooperationSelect",props:["releaseType","cooperationType","hardWideDetailType","isCoop"],data:function(){return{cooperationList:[],secondList:[],optionList:[],cooperation_type:"",hard_wide_detail_type:"",hard_wide_detail_type_val:"",cooperation_obj:"",hard_wide_detail_type_obj:"",release_type:"",isClickChange:!1}},created:function(){this.release_type=this.releaseType,this.getCooperationList()},watch:{cooperationType:function(t){t||(this.cooperation_type="")},cooperation_type:function(t){console.log("---hasCooperation_1---"),this.isClickChange?(this.hard_wide_detail_type="",this.hard_wide_detail_type_val="",this.$emit("hasCooperation",t,this.hard_wide_detail_type)):this.$emit("hasCooperation",t,this.hard_wide_detail_type)},hard_wide_detail_type:function(t){console.log("---hasCooperation_2---"),this.$emit("hasCooperation",this.cooperation_type,t)},hard_wide_detail_type_val:function(t){t||this.$emit("hasCooperation",this.cooperation_type,"")}},methods:{selectDataObj:function(t){this.hard_wide_detail_type=t&&t.id?t.id:0},filteredDataObj:function(){var t=this;return this.optionList=this.secondList.filter(function(e){return e.val.toString().toLowerCase().indexOf(t.hard_wide_detail_type_val.toLowerCase())>=0}),this.optionList},onSelectCooperationType:function(t){this.isClickChange=!0,this.secondList=t.level,this.hard_wide_detail_type=""},getCooperationList:function(){var t=this;return this.ajax({url:"/contract_amount_detail_cooperation/get_cooperation_lists"}).then(function(e){if(0===e.error_code){t.cooperationList=e.data;var a={cooperation_type:null,val:"",id:""};if(t.cooperationList.unshift(a),t.isCoop){var n=[{cooperation_type:3,val:"纯硬广",id:18,level:t.cooperationList[1].level},{cooperation_type:4,val:"纯软性",id:19,level:t.cooperationList[2].level},{cooperation_type:5,val:"硬广+软性",id:20,level:[].concat((0,i.default)(t.cooperationList[1].level),(0,i.default)(t.cooperationList[2].level))}];t.cooperationList=[].concat((0,i.default)(t.cooperationList),n)}t.cooperationType&&t.filterType()}})},filterType:function(){var t=this;this.cooperation_obj=this.cooperationList.filter(function(e){return e.cooperation_type===t.cooperationType}),this.cooperation_type=this.cooperation_obj[0],this.secondList=this.cooperation_type.level,this.hard_wide_detail_type=this.hardWideDetailType,"number"==typeof this.hard_wide_detail_type&&this.filterSecondType()},filterSecondType:function(){var t=this;this.hard_wide_detail_type_obj=this.secondList.filter(function(e){return e.id===t.hard_wide_detail_type}),this.hard_wide_detail_type_obj&&this.hard_wide_detail_type_obj.length>0&&(this.hard_wide_detail_type_val=this.hard_wide_detail_type_obj[0].val)}}}},"/e0X":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"汇率管理"}},[t.hasPermission("crm_new.finance.huilv.improt")?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("汇率导入")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"z-space-between"},[a("b-field",{staticClass:"z-upload",attrs:{horizontal:"",expanded:"",label:"请选择汇率文件"}},[a("b-upload",{ref:"rateFiles",attrs:{required:""},model:{value:t.rateFiles,callback:function(e){t.rateFiles=e},expression:"rateFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传文件")])],1)]),t._v(" "),t.rateFiles&&t.rateFiles.length?a("div",[a("span",{staticClass:"file-name"},[t._v(t._s(t.rateFiles[0].name))])]):t._e()],1)],1),t._v(" "),a("p",[t._v("\n                说明：\n                "),a("br"),t._v("\n                1.文件支持xls和xlsx两种格式，其它格式不支持\n                "),a("br"),t._v("\n                2.文件必须使用规定模板填写，谢谢合作。"),a("a",{attrs:{download:"",href:"https://crm-bgm.smzdm.com/file_template/汇率导入模板.xlsx"}},[t._v("点击这里下载模板文件")])]),t._v(" "),a("br"),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.importFile}},[t._v("导入")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.rateFiles=[]}}},[t._v("重置")]),t._v(" "),a("p",{domProps:{innerHTML:t._s(t.serverHtmlString)}})])]):t._e(),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("汇率管理")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"z-table-select z-space-between"},[a("b-field",{attrs:{label:"选择年份",horizontal:""}},[a("b-select",{model:{value:t.selectedYear,callback:function(e){t.selectedYear=e},expression:"selectedYear"}},t._l(t.yearList,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])}))],1)],1),t._v(" "),t.currRateData&&t.currRateData.length?a("b-table",{attrs:{data:t.currRateData,bordered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"币种"}},[t._v("\n                        "+t._s(e.row.currency)+"\n                    ")]),t._v(" "),t._l(new Array(12).join(",").split(","),function(n,i){return a("b-table-column",{key:i,attrs:{label:i+1+"月"}},[t.isEdit&&i===t.currMonthIndex?a("b-field",[a("b-input",{ref:e.row.currencyCode+"_"+t.currMonthIndex,refInFor:!0,attrs:{required:""},model:{value:e.row["month_"+i],callback:function(a){t.$set(e.row,"month_"+i,a)},expression:"props.row[`month_${index}`]"}})],1):[a("span",{class:{current:i===t.currMonthIndex}},[t._v(t._s(e.row["month_"+i]||"-"))])]],2)})]}}])}):t._e(),t._v(" "),t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.saveRates}},[t._v("保存")]):a("auth",{attrs:{permission:"crm_new.finance.huilv.bianji"}},[t.selectedYear===t.currYear?a("button",{staticClass:"button is-primary",on:{click:function(e){t.isEdit=!0}}},[t._v("编辑")]):t._e()])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-space-between"},[a("h2",[t._v("记录履历")]),t._v(" "),a("b",[t._v("总数: "+t._s(t.totalLogs))])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("ul",{staticClass:"logs-list"},t._l(t.logs,function(e){return a("li",[t._v(t._s(e))])})),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalLogs,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                    跳转到\n                    "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                    页\n                    "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])])])},staticRenderFns:[]}},"/gM6":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"回款认领关联合同"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"合同名称"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.contractsName,expression:"contractsName"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.contractsName},on:{input:function(e){e.target.composing||(t.contractsName=e.target.value)}}})]),t._v(" "),a("b-field",{attrs:{label:"签约公司"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.signingCompanyName,expression:"signingCompanyName"}],staticClass:"input",attrs:{type:"text",autocomplete:"off",disabled:t.shangWu},domProps:{value:t.signingCompanyName},on:{input:function(e){e.target.composing||(t.signingCompanyName=e.target.value)}}})]),t._v(" "),a("b-field",{attrs:{label:"合同编号"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.contractNumber,expression:"contractNumber"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.contractNumber},on:{input:function(e){e.target.composing||(t.contractNumber=e.target.value)}}})])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.backUrl}},[t._v("返回")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title table-head-message"},[a("span",[t._v("交易流水号："+t._s(t.transactionNumber))]),t._v(" "),a("span",[t._v("回款时间："+t._s(t.cashCollectionDate))]),t._v(" "),a("span",[t._v("回款金额："+t._s(t.currencyAmount))]),t._v(" "),a("span",[t._v("币种："+t._s(t.currencies["type_"+t.currency]))]),t._v(" "),a("span",[t._v("可认领金额："+t._s(t.canBeAmount))])]),t._v(" "),a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.data,loading:t.isLoading,striped:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"contract_number",label:"合同号"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"signing_company_name",label:"签约公司"}},[t._v("\n                    "+t._s(e.row.signing_company_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_currency_type_id",label:"合同币种"}},[t._v("\n                    "+t._s(e.row.contract_currency_type_id)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_currency_amount",label:"合同币种金额"}},[t._v("\n                    "+t._s(e.row.contract_currency_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"receivable_balance",label:"可认领金额"}},[t._v("\n                    "+t._s(e.row.receivable_balance)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"claim_amount",width:"120",label:"认领金额"}},[a("b-input",{attrs:{disabled:0==e.row.can_claim},model:{value:e.row.claim_amount,callback:function(a){t.$set(e.row,"claim_amount",a)},expression:"props.row.claim_amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"币种"}},[t._v("\n                    "+t._s(t.currencies["type_"+t.currency])+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"抵扣应收"}},[a("b-select",{attrs:{disabled:t.cashType},model:{value:e.row.defaultDeductible,callback:function(a){t.$set(e.row,"defaultDeductible",a)},expression:"props.row.defaultDeductible"}},t._l(e.row.deductible,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[a("b-input",{model:{value:e.row.remark,callback:function(a){t.$set(e.row,"remark",a)},expression:"props.row.remark"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[e.row.can_claim?a("a",{staticClass:"button is-link",on:{click:function(a){t.claimHandle(e.row)}}},[t._v("认领")]):t._e()])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>1,expression:"total > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},"/peU":function(t,e,a){a("svzf");var n=a("VU/8")(a("jXhV"),a("fzpa"),"data-v-65e44a8e",null);t.exports=n.exports},"/vDq":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("AwEB"),i=a("O4Lo"),s=function(t){return t&&t.__esModule?t:{default:t}}(i),r=["框架号","框架名称","合同号","甲方签约公司","乙方签约公司","品牌","是否自主客户","行业","商务负责人"];e.default={data:function(){return{TYPE_LIST:r,isFetching_3:!1,levelData:[],rebate_brand_id:"",brands:[],brandName:"",brandId:"",signingCompanys:[],signingCompanyId:"",signingCompany:"",party_b_id:"",clientLists:[],clientId:"",clientName:"",contractNumber:"",contractNumberList:[],userName:"",userId:"",userList:[],is_auto:0,showType:3,start_date:new Date((0,n.preMonth)()),end_date:new Date((0,n.nextMonth)()),rebateList:[],table_label:[],total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,totalRebate:0}},watch:{currPage:function(t){this.onQueryClick()}},computed:{filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.brandName.toLowerCase())>=0})},filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})},filterClientLists:function(){var t=this;return this.clientLists.filter(function(e){return e.client_name.toString().toLowerCase().indexOf(t.clientName.toLowerCase())>=0})},filteredUser:function(){var t=this;return this.userList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})}},mounted:function(){this.getLevel(),this.getBrands(),this.getClientLists(),this.getSigningCompanys(),this.getDirector(),this.onQueryClick()},methods:{getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list"}).then(function(e){t.brands=e.data})},getClientLists:function(){var t=this;return this.ajax({url:"/rebate_detail/get_client_list"}).then(function(e){0===e.error_code&&(t.clientLists=e.data.list)})},getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{no_limit:1}}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},getDirector:function(){var t=this;return this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:{department_id:629,is_contract_list:0}}).then(function(e){0===e.error_code&&e.data&&e.data.rows?t.userList=e.data.rows:t.userList=[]})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.rebate_second_brand_id="")},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brandName=t.title)},onSelectedCompany:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},onClientSelected:function(t){t&&(this.clientName=t.client_name,this.clientId=t.client_id)},onUserSelected:function(t){console.log(t),t&&(this.userId=t.id)},searchContractList:(0,s.default)(function(){this.isFetching_3=!0,this.getContractList()},500),getContractList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},getParams:function(){return{user_id:this.userName?this.userId:"",brand_id:this.brandName?this.brandId:"",party_a:this.signingCompany?this.signingCompanyId:"",party_b:this.party_b_id,contract_number:this.contractNumber,is_auto:this.is_auto,start_time:(0,n.changeMonth)(this.start_date),end_time:(0,n.changeMonth)(this.end_date),contract_brand_id:this.rebate_brand_id,client_id:this.clientName?this.clientId:"",page:this.currPage,size:this.perPage,level:Number(this.showType)+1}},onQueryClick:function(){var t=this,e=this.getParams();return this.ajax({url:"/rebate_detail/index",params:e}).then(function(e){0===e.error_code?t.processData(e):(t.rebateList=[],t.totalPage=1)})},processData:function(t){var e=[],a={},n=[],i=void 0,s=void 0;if(t.data.counts>0){for(var o=0;o<t.data.lists.length;o++)a=t.data.lists[o].data,a[r[this.showType]]=t.data.lists[o].title,e.push(a);for(i in e[0])"合计"===i?n.unshift({name:i}):n.push({name:i});var c=n.pop();n.unshift(c),s=e.length}s=t.data.counts,this.totalRebate=s,this.totalPage=Math.ceil(s/this.perPage),0===this.totalPage&&(this.totalPage=1),1!==this.currPage&&this.currPage!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+this.currPage):1===this.currPage&&this.$router.push(this.$router.currentRoute.path),this.rebateList=e,this.table_label=n},resetParams:function(){this.isFetching_3=!1,this.rebate_brand_id="",this.brandName="",this.brandId="",this.signingCompanyId="",this.signingCompany="",this.party_b_id="",this.clientId="",this.clientName="",this.contractName="",this.contractNumber="",this.userName="",this.userId="",this.is_auto=0,this.start_date=new Date((0,n.preMonth)()),this.end_date=new Date((0,n.nextMonth)()),this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},exportAll:function(t){var e=this;console.log(t);var a=t?"/rebate_detail/export_detail":"/rebate_detail/export",n=this.getParams();this.ajax({url:a,params:n}).then(function(t){e.exportLive({file_name:t.data.file_name,file_path:t.data.file_path})})}}}},"08t6":function(t,e,a){a("vEai");var n=a("VU/8")(a("bllG"),a("clhW"),"data-v-f5e9ca0c",null);t.exports=n.exports},"0BAq":function(t,e,a){a("aNNx"),a("IQDX"),a("MY1v");var n=a("VU/8")(a("lCE6"),a("iePj"),"data-v-16f2c2d1",null);t.exports=n.exports},"0SGM":function(t,e,a){var n=a("VU/8")(a("W4Kq"),a("nISF"),null,null);t.exports=n.exports},"0TdI":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("//Fk"),o=n(r),c=a("LZT1"),l=n(c),d={1:"未拆分",2:"未提交",3:"审核中",4:"审核通过",5:"驳回待修改",6:"再驳回待修改"},u=["默认","是","否"];e.default={name:"AchievementView",props:{isSplitURL:{type:Boolean,default:!1},id:{type:String,default:null},isEdit:{type:Boolean,default:!1}},data:function(){return{IS_FIRST:u,error:!1,errorMsg:"",length:0,charge_userName:"",charge_userId:null,codeList:[],contract:{apply_user_name:"",contract_type_id:null,contract_type_name:"",contract_number:"",contract_name:"",contract_charge_name:"",contract_brand_name:"",contract_second_brand_name:"",department_name:"",parent_department_name:"",client_name:"",signing_company_name:"",signing_company_type_id:null,party_b_name:"",start_date:new Date,startDate:new Date,end_date:new Date,endDate:new Date,account_period:new Date,client_relationship_name:null,ad_schedules:[]},detail:[],DEPARTMENT:"",DEPARTMENTPART:[],SPLIT_STATUS_ID:d,showLogModal:!1,logData:[],logColumns:[{field:"updated_user",label:"审核人"},{field:"approve_status",label:"审核状态"},{field:"updated_date",label:"审核时间"},{field:"reason",label:"驳回原因"}],rejectShow:!1,rejectReason:"",flag:null,rejectDate:null,rejectList:[],cooperationList:[],SOFTWAYS:[]}},created:function(){var t=this;this.getAllDepartment().then(function(){t.getSplit()}),this.getCodeList(),this.checkContract(),this.getPartDepartment()},methods:{checkContract:function(){var t=this;return this.ajax({url:"/contract_applied/get_contract_by_id",loading:this.$loading.open(),params:{contract_id:this.id}}).then(function(e){t.contract=e.data,t.charge_userName=t.contract.achieve_pm_name||t.$root.crmUser.name,t.charge_userId=t.contract.achieve_pm_id||t.$root.crmUser.id})},getSplit:function(){var t=this;return this.ajax({url:"/contract_split/get_contract_split",loading:this.$loading.open(),params:{contract_id:this.id,is_approve:this.isSplitURL?1:0}}).then(function(e){var a=e.data;a.length?t.getDetail(a,"get"):t.$toast.open({duration:3e3,message:"系统正在进行业绩拆分，请稍后再试！",position:"is-top",type:"is-warning"})})},getDetail:function(t,e,a){var n=this;t.forEach(function(t){var i={date:null,list:[]};i.isFree=!0,i.date=t.date,i.status=t.split_status_id,i.is_project=t.is_project,i.logs=t.approve_log,i.reject=t.reject,i.isSubmit=t.is_submit,i.total_amount=t.total.total_amount_total,i.total_split=t.total.total_split_amount_total,i.hard_amount=t.total.ad_amount_total,i.soft_amount=t.total.detail_amount_total,t.list.forEach(function(t){var e={isLast:!1,isAdd:t.isAdd,department:t.business_id,department_name:"",hard_id:t.ad.id,hard_amount:t.ad.ad_amount,hard_split:t.ad.ad_split_amount,hard_type:t.ad.cooperation_type,hard_list:t.ad.lists||[],hard_length:t.ad.lists?t.ad.lists.length:0,soft_id:t.detail.id,soft_amount:t.detail.detail_amount,soft_split:t.detail.detail_split_amount,soft_type:t.detail.cooperation_type,soft_list:t.detail.lists||[],soft_length:t.detail.lists?t.detail.lists.length:0,total_amount:t.total_amount,total_split:t.total_split_amount};n.isEdit&&e.soft_list.forEach(function(t){t.options=[],n.onSelectDepartment(e,"",e.department)}),n.DEPARTMENT.filter(function(t){t.id===e.department&&(e.department_name=t.name)}),i.list.push(e)});var s={isLast:!0,isAdd:!1,department:"合计",department_name:"合计",hard_id:0,hard_amount:t.total.ad_amount_total,hard_split:t.total.ad_split_amount_total,hard_type:1,soft_id:0,soft_amount:t.total.detail_amount_total,soft_split:t.total.detail_split_amount_total,soft_type:2,total_amount:t.total.total_amount_total,total_split:t.total.total_split_amount_total};i.list.push(s),"get"===e?n.detail.push(i):n.detail[a]=i})},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.charge_userName,role_code:"role-crm-xiangmujingli",use_swzc:0}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},filteredDataObj:function(t,e,a){var n=this;if(a.optionsList)return t.options=a.optionsList.filter(function(e){return e.cooperation_name.toString().toLowerCase().indexOf(t.contract_detail_cooperation_val.toLowerCase())>=0}),this.$forceUpdate(),t.options;this.onSelectDepartment(a,"get",e).then(function(){return t.options=a.optionsList.filter(function(e){return e.cooperation_name.toString().toLowerCase().indexOf(t.contract_detail_cooperation_val.toLowerCase())>=0}),n.$forceUpdate(),t.options})},getAllDepartment:function(){var t=this;return this.ajax({url:"/business/index"}).then(function(e){var a=(0,l.default)(e.data);t.DEPARTMENT=a})},getPartDepartment:function(){var t=this;return this.ajax({url:"/business/index",params:{parent_id:19,level:4}}).then(function(e){var a=(0,l.default)(e.data);t.DEPARTMENTPART=a})},onSelectDepartment:function(t,e,a){var n=this;return console.log("---type----",e),new o.default(function(i,s){n.ajax({method:"post",url:"/cooperation_business/get_info_by_business_id",data:{business_id:a}}).then(function(a){0===a.error_code?("get"===e&&t.soft_list.forEach(function(t){t.options=[],n.$set(t,"contract_detail_cooperation_val",""),n.$set(t,"contract_detail_cooperation_id","")}),t.optionsList=a.data,n.$forceUpdate(),i(a.data)):s(a.error_msg)})})},onChargeNameSelected:function(t){console.log(t),t&&(this.charge_userId=t.id)},showLogs:function(t){this.showLogModal=!0,this.logData=t},onBlurSplit:function(t,e,a,n,i){var s=/^[+-]?\d+(\.\d*)?$/,r="hard"===t?e.ad_split:e.detail_split,o="hard"===t?"硬广":"软性";if(s.test(r)){if("soft"===t)i.soft_split=0,i.soft_list.forEach(function(t){i.soft_split+=Number(t.detail_split||0)}),i.soft_split=Number(i.soft_split);else{console.log("硬广业绩拆分");var c=0;i.hard_list.forEach(function(t){c+=Number(t.ad_split||0)}),c>=i.hard_split&&(i.hard_split=Number(c))}a.isFree||(i.hard_split=Number(i.total_amount)-Number(i.soft_split)),i.total_split=Number(i.soft_split)+Number(i.hard_split),this.changeTotal(a)}else this.$dialog.alert(a.date+"的第"+(n+1)+"条"+o+"业绩只能输入数字"),"hard"===t?e.ad_split=0:e.detail_split=0},changeTotal:function(t){for(var e=t.list,a=0,n=0,i=0,s=0;s<e.length-1;s++)a+=Number(e[s].hard_split),n+=Number(e[s].soft_split),i+=Number(e[s].total_split);e[e.length-1].hard_split=a,e[e.length-1].soft_split=n,e[e.length-1].total_split=i,t.total_split=i},onBlurHard:function(t,e,a){if(/^[+-]?\d+(\.\d*)?$/.test(t.hard_split)){19!==this.contract.contract_brand_id&&14===t.department&&(t.hard_list[0].ad_split=t.hard_split);var n=0;t.hard_list.forEach(function(t){n+=Number(t.ad_split||0)}),n>t.hard_split&&(this.$dialog.alert(e.date+"的硬广业绩合计不能小于各事业部硬广业绩之和"),t.hard_split=Number(n)),t.total_split=(Number(t.hard_split)+Number(t.soft_split)).toFixed(2)}else this.$dialog.alert(e.date+"的第"+(a+1)+"条硬广业绩只能输入数字"),t.hard_split=0;this.changeTotal(e)},splitFree:function(t){t.isFree=!0,this.$forceUpdate()},resetSplit:function(t,e){var a=this;return this.ajax({url:"/contract_split/reset_split",params:{contract_id:this.id,split_date:t.date}}).then(function(t){a.getDetail(t.data,"reset",e),a.$forceUpdate()})},addSplit:function(t){var e={isLast:!1,isAdd:!0,department:null,hard_id:0,hard_amount:0,hard_split:0,hard_type:1,hard_length:0,hard_list:[],soft_id:0,soft_amount:0,soft_split:0,soft_type:2,soft_list:[{is_project:2,isAdd:!0,id:0,detail_split:0,detail_amounts:0,contract_detail_cooperation_id:0,contract_detail_cooperation_val:""}],soft_length:1,total_amount:0,total_split:0};t.list.splice(-1,0,e),console.log(t.list)},submit:function(t,e){console.log("flag",e),e?Number(t.total_amount).toFixed(2)===Number(t.total_split).toFixed(2)?this.submitFn(t,e):this.$dialog.alert("业绩合计和发布额合计不相同，不能提交"):this.submitFn(t,e)},submitFn:function(t,e){var a=this,n=[],i=!1,r="",o=0;if(t.list.forEach(function(s){if(!s.isLast){var c={isAdd:s.isAdd?1:0,id:s.hard_id,contract_id:a.id,business_id:s.department,cooperation_type:1,amount:s.hard_split,split_date:t.date,split_status_id:e?3:2};n.push(c),s.soft_list.forEach(function(c){var l={isAdd:s.isAdd?1:0,id:c.id,contract_id:a.id,business_id:s.department,cooperation_type:2,contract_detail_cooperation_id:c.contract_detail_cooperation_id,amount:c.detail_split,is_project:c.is_project,split_date:t.date,split_status_id:e?3:2};c.is_lock||c.contract_detail_cooperation_id||a.error||(i=!0,r="软性合作方式为必填选项，请全部填写，再提交",o+=1),console.log("error",c.contract_detail_cooperation_val,o),n.push(l)}),s.hard_list.forEach(function(c){var l={isAdd:s.isAdd?1:0,id:c.id,contract_id:a.id,business_id:s.department,cooperation_type:1,trade_business_id:c.trade_business_id,amount:c.ad_split,split_date:t.date,split_status_id:19!==a.contract.contract_brand_id?4:e?3:2,is_ad_split:19!==a.contract.contract_brand_id?1:2};c.trade_business_id||a.error||(i=!0,r="硬广业绩所属事业部为必填选项，请全部填写，再提交",o+=1),console.log("error",c.contract_detail_cooperation_val,o),n.push(l)})}}),i&&o)return void this.$dialog.alert(r);console.log(n);var c={data:(0,s.default)({splits:n,isFree:t.isFree,achieve_pm_id:this.charge_userId})};return this.ajax({url:"/contract_split/update_split",method:"post",data:c}).then(function(t){0===t.error_code&&(a.$toast.open({duration:3e3,message:"操作成功",position:"is-top",type:"is-success"}),window.location.reload())})},delSplit:function(t,e,a,n){var i=this,s=[],r=[];if(e.soft_list.forEach(function(t){t.id&&s.push(t.id)}),e.hard_list.forEach(function(t){t.id&&r.push(t.id)}),console.log(e,a),0!==e.hard_id||0!==e.soft_id)return this.ajax({url:"/contract_split/deleted_split",method:"post",data:{ids:s.join(","),ad_ids:r.join(","),hard_id:e.hard_id,type:0}}).then(function(e){i.$toast.open({duration:3e3,message:"删除成功",position:"is-top",type:"is-success"}),i.detail[t].list.splice(a,1)});this.detail[t].list.splice(a,1)},clickSplit:function(t,e){console.log(t),5===t?(this.rejectShow=!0,this.flag=t,this.rejectDate=e.date,this.rejectList=e.list):6===t?(this.flag=t,this.rejectDate=e.date,this.rejectList=e.list,this.reject()):(this.flag=t,this.rejectReason="",this.rejectDate=e.date,this.rejectList=e.list,this.reject())},reject:function(){var t=this,e=[];return this.rejectList.forEach(function(t){return t.isLast||(e.push(t.hard_id),e.push(t.soft_id),t.soft_list.forEach(function(t){t.id&&e.push(t.id)}),t.hard_list.forEach(function(t){t.id&&e.push(t.id)})),e}),this.ajax({method:"post",url:"/contract_split/approve_split",data:{ids:e.join(","),split_status_id:this.flag,contract_id:this.id,reason:this.rejectReason,split_date:this.rejectDate}}).then(function(e){t.rejectShow=!1,t.rejectDate=null,t.rejectList=[],t.rejectReason="",t.flag=null,0===e.error_code&&(t.$toast.open({duration:3e3,message:"操作成功",position:"is-top",type:"is-success"}),t.isSplitURL?t.$router.push("/pending_achievement"):window.location.reload())})},toReject:function(){this.rejectShow=!1,this.rejectReason=""},addHardList:function(t){var e={isAdd:!0,id:0,ad_split:0,trade_business_id:0};t.hard_list.push(e),t.hard_length+=1},addSoftList:function(t){var e={isAdd:!0,id:0,detail_split:0,detail_amounts:0,is_project:2,contract_detail_cooperation_id:0,contract_detail_cooperation_val:""};t.soft_list.push(e),t.soft_length+=1},delList:function(t,e,a,n,i,s){var r=this;console.log(e,a,n,i,s);var o=3;if(o=0===Number(i.hard_amount)?2:0===Number(i.soft_amount)?1:3,console.log("type",o),n.id){var c=[];return c.push(n.id),this.ajax({url:"/contract_split/deleted_split",method:"post",data:{ids:c.join(","),hard_id:e.hard_id,type:o}}).then(function(t){r.$toast.open({duration:3e3,message:"删除成功",position:"is-top",type:"is-success"}),window.location.reload()})}"soft"===t?(e.soft_list.splice(a,1),e.soft_length-=1):(e.hard_list.splice(a,1),e.hard_length-=1),this.onBlurSplit(t,n,i,s,e)}}}},"0nZW":function(t,e,a){var n=a("VU/8")(a("Wci/"),a("H+Rs"),null,null);t.exports=n.exports},"0xJ/":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"事业部管理"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.$refs.menuList.hideAll()}}},[t._v("收起所有")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.$refs.menuList.showAll()}}},[t._v("展开所有")]),t._v(" "),a("menu-list",{ref:"menuList",attrs:{data:t.organization,isDepart:!1,showAdd:!1}})],1)])])},staticRenderFns:[]}},"1/F9":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"营收数据分析"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门"}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.department_id,callback:function(e){t.department_id=e},expression:"department_id"}},t._l(t.departments,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人"}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.user_name,callback:function(e){t.user_name=e},expression:"user_name"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companies,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方单位"}},[a("b-select",{model:{value:t.party_b_name,callback:function(e){t.party_b_name=e},expression:"party_b_name"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("cooperation-select",{attrs:{releaseType:1,cooperationType:t.cooperation_type,hardWideDetailType:t.hard_wide_detail_type},on:{hasCooperation:t.getCooperation}}),t._v(" "),a("b-field",{attrs:{label:"行业"}},[a("div",{staticClass:"z-level"},[a("b-select",{staticClass:"select-inline",on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{staticClass:"select-inline",model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):t._e()],1)]),t._v(" "),a("select-date",{attrs:{clickReset:t.clickReset,el:t.el,clickBtn:t.clickBtn},on:{selectDate:t.getDate}}),t._v(" "),a("b-field",{attrs:{label:"集团名称"}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户类型"}},[a("b-select",{model:{value:t.client_type_id,callback:function(e){t.client_type_id=e},expression:"client_type_id"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"事业部"}},[a("b-select",{model:{value:t.business_id,callback:function(e){t.business_id=e},expression:"business_id"}},t._l(t.BUSINESS,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"媒体-版位"}},[a("div",{staticClass:"z-media"},[t._l(t.mediaSelectList,function(e,n){return a("div",{key:n,staticStyle:{display:"inline-block",height:"28px","line-height":"28px","margin-bottom":"4px","box-sizing":"border-box","margin-left":"10px"}},[a("span",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.mediaName))]),t._v("    \n                            "),a("span",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.positionName))]),t._v(" "),a("a",{staticClass:"button is-primary",staticStyle:{"margin-left":"2px"},on:{click:function(e){t.onDelPosition(n)}}},[t._v("删除")])])}),t._v(" "),a("div",{staticStyle:{display:"inline-block"}},[a("b-autocomplete",{staticClass:"z-inline-input",attrs:{data:t.filteredMediaDataArray,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"a_name"},on:{select:t.onMediaSelected},model:{value:t.search_media_name,callback:function(e){t.search_media_name=e},expression:"search_media_name"}}),t._v(" "),a("b-autocomplete",{staticClass:"z-inline-input",staticStyle:{width:"300px"},attrs:{data:t.filteredPositionDataArray,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"z_name",require:""},on:{select:t.onPositionSelected},model:{value:t.search_position_name,callback:function(e){t.search_position_name=e},expression:"search_position_name"}}),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.onAddPosition}},[t._v("添加")])],1)],2)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportAll}},[t._v("导出")])])],1)]),t._v(" "),a("div",{key:t.perPage,staticClass:"z-block z-listbox z-listbox-releases"},[a("div",{staticClass:"z-block-title z-table-head"},[a("div",{staticClass:"block"},[a("b-radio",{attrs:{"native-value":"1"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("趋势图")]),t._v(" "),a("b-radio",{attrs:{"native-value":"2"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("分布图")]),t._v(" "),a("b-radio",{attrs:{"native-value":"3"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("详情列表")])],1)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.show,expression:"show == 1"}],staticClass:"z-block-content z-block-echarts"},[a("div",{staticClass:"z-echarts-title"},[t._v("发布额趋势图")]),t._v(" "),a("b-field",{staticClass:"z-field z-echarts-box"},[a("div",{staticClass:"z-block",staticStyle:{width:"100%",height:"400px"},attrs:{id:"line"}})]),t._v(" "),a("div",{staticClass:"textLeft"},[t._v("数据统计时间截止至"+t._s(t.zDateFormatter(new Date((new Date).getTime()-864e5),"/")))])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2==t.show,expression:"show == 2"}],staticClass:"z-block-content z-block-echarts"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"展示方式",horizontal:""}},[a("b-select",{on:{input:t.onSelectedChart},model:{value:t.showChart,callback:function(e){t.showChart=e},expression:"showChart"}},[t._l(t.PIELIST,function(e,n){return a("option",{key:n,domProps:{value:n}},[t._v(t._s(e))])}),t._v(" "),t._l(t.BARLIST,function(e,n){return a("option",{key:n,domProps:{value:n}},[t._v(t._s(e))])})],2)],1)],1),t._v(" "),a("div",{staticClass:"z-echarts-title"},[a("div",{staticClass:"flex-top-title"},[3===Number(t.showChart)?a("div",{staticClass:"flex-top-abs"},[a("b-radio",{attrs:{"native-value":"1"},model:{value:t.departmentLevel,callback:function(e){t.departmentLevel=e},expression:"departmentLevel"}},[t._v("部门")]),t._v(" "),a("b-radio",{attrs:{"native-value":"2"},model:{value:t.departmentLevel,callback:function(e){t.departmentLevel=e},expression:"departmentLevel"}},[t._v("小组")])],1):t._e(),t._v(" "),a("div",[t._v(" "+t._s(t.title))])]),t._v(" "),t.barShow?a("div",{staticClass:"iconBox"},[a("diV",{staticClass:"page"},[a("span",{staticClass:"prev",class:t.tPage>1&&t.cPage>1?"is-primary":"is-gray",on:{click:function(e){t.clickPage("prev")}}}),t._v(" "),a("span",{staticClass:"next",class:t.tPage>1&&t.cPage<t.tPage?"is-primary":"is-gray",on:{click:function(e){t.clickPage("next")}}})]),t._v(" "),a("diV",{staticClass:"percent normal"},[a("b-tooltip",{attrs:{type:"is-light",label:"%：占比",position:"is-bottom"}},[a("label",{class:t.percent?"is-primary":"is-gray",on:{click:function(e){t.percent=!t.percent}}},[t._v("%")])]),t._v(" "),a("b-tooltip",{attrs:{type:"is-light",label:"#：金额",position:"is-bottom"}},[a("label",{class:t.percent?"is-gray":"is-primary",on:{click:function(e){t.percent=!t.percent}}},[t._v("#")])])],1)],1):t._e()]),t._v(" "),a("b-field",{staticClass:"z-field z-echarts-box"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.pieShow,expression:"pieShow"}],staticClass:"z-block",staticStyle:{width:"800px",height:"400px",margin:"0 auto"},attrs:{id:"pie"}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.barShow,expression:"barShow"}],staticClass:"z-block",staticStyle:{width:"100%",height:"400px"},attrs:{id:"bar"}})]),t._v(" "),a("div",{staticClass:"textLeft"},[t._v("数据统计时间截止至"+t._s(t.zDateFormatter(new Date((new Date).getTime()-864e5),"/")))])],1),t._v(" "),3==t.show?a("div",{staticClass:"z-block-content z-block-echarts"},[a("b-field",{staticClass:"z-field z-show",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"展示方式",horizontal:""}},t._l(t.showClick,function(e){return a("b-select",{key:e,on:{input:t.onSelectedShow},model:{value:t.showType[e],callback:function(a){t.$set(t.showType,e,a)},expression:"showType[i]"}},t._l(t.RELEASE,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))}))],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{directives:[{name:"show",rawName:"v-show",value:t.showClick%3!=0,expression:"showClick%3 !== 0"}],staticClass:"button is-primary",on:{click:t.addSelect}},[t._v("添加")]),t._v(" "),a("a",{directives:[{name:"show",rawName:"v-show",value:t.showClick%3!=1,expression:"showClick%3 !== 1"}],staticClass:"button is-link",on:{click:t.delSelect}},[t._v("删除")])]),t._v(" "),a("div",{staticClass:"percent",staticStyle:{float:"right"}},[a("b-tooltip",{attrs:{type:"is-light",label:"%：占比",position:"is-bottom"}},[a("label",{class:t.picShow?"is-gray":"is-primary",on:{click:function(e){t.picShow=!t.picShow}}},[t._v("%")])]),t._v(" "),a("b-tooltip",{attrs:{type:"is-light",label:"#：金额",position:"is-bottom"}},[a("label",{class:t.picShow?"is-primary":"is-gray",on:{click:function(e){t.picShow=!t.picShow}}},[t._v("#")])])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!(3!==Number(t.showType[1])||0!==Number(t.showType[2])&&3!==Number(t.showType[2])||0!==Number(t.showType[3])&&3!==Number(t.showType[3])),expression:"!(Number(showType[1]) === 3 && (Number(showType[2]) === 0 || Number(showType[2]) === 3) && (Number(showType[3]) === 0 || Number(showType[3]) === 3))"}],staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalRelease},[t._v("行数："+t._s(t.totalRelease))])]),t._v(" "),t.totalRelease?a("b-table",{key:Math.random(),staticClass:"z-table-clients z-scaling-list z-scaling-releases",attrs:{data:t.release,"default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder],detailed:!(3!==Number(t.showType[1])||0!==Number(t.showType[2])&&3!==Number(t.showType[2])||0!==Number(t.showType[3])&&3!==Number(t.showType[3])),"has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{sortable:"合计"===n.name,label:n.name,field:"field_"+n.name}},[t._v("\n                        "+t._s(e.row[n.name])+"\n                    ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,detailed:"",bordered:"","has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                "+t._s(e.row[n.name])+"\n                            ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,detailed:"",bordered:"","has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                        "+t._s(e.row[n.name])+"\n                                    ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,bordered:"","has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                                "+t._s(e.row[n.name])+"\n                                            ")])})}}])})]}}])})]}}])})]}}])},[a("template",{slot:"footer"},[a("div",[a("div",{staticClass:"textLeftTable"},[t._v("数据统计时间截止至"+t._s(t.zDateFormatter(new Date((new Date).getTime()-864e5),"/")))]),t._v(" "),t.isPaginated?a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalRelease,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1):t._e()])])],2):t._e()],1):t._e()])])},staticRenderFns:[]}},"1Mt6":function(t,e,a){a("XNUm");var n=a("VU/8")(a("0TdI"),a("DEsu"),"data-v-3f296cc2",null);t.exports=n.exports},"1Qx+":function(t,e){},"1Y4E":function(t,e,a){a("6+g0"),a("M4QK");var n=a("VU/8")(a("xtsl"),a("nZL+"),"data-v-4c3ea07c",null);t.exports=n.exports},"1q+D":function(t,e){},"1rcG":function(t,e,a){var n=a("VU/8")(a("BTbF"),a("mvNO"),null,null);t.exports=n.exports},"2Aho":function(t,e,a){a("rqCR"),a("Y20y");var n=a("VU/8")(a("MNrR"),a("uGor"),"data-v-7c84e46e",null);t.exports=n.exports},"2DHO":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"商务待办事项"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("客户跟踪日志提醒")]),t._v(" "),t.visited_client_backlog_show?a("div",{staticClass:"z-block-title"},[a("div",{staticClass:"z-block-title z-table-head",staticStyle:{"margin-bottom":"10px"}},[a("b",[t._v("总数："+t._s(t.visited_client_backlog_total))])]),t._v(" "),t.visited_client_backlog_total>0?t._l(t.visited_client_backlog_list,function(e,n){return a("div",{staticStyle:{"margin-bottom":"5px"}},[a("span",[t._v(t._s(e.backlog))]),t._v(" "),a("div",{staticClass:"z-field-text clickLink",on:{click:function(a){t.deleteList(n,e.postil_id,e.type,e.client_id)}}},[t._v("点击查看详情")])])}):t._e(),t._v(" "),t.visited_client_backlog_total>0&&t.visited_client_backlog_totalPage>1?[a("div",{staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.visited_client_backlog_total,current:t.visited_client_backlog_currPage,"per-page":t.visited_client_backlog_perPage},on:{"update:current":function(e){t.visited_client_backlog_currPage=e},change:t.visitedPageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.visited_client_backlog_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.visited_client_backlog_currPage=Number(t.visited_client_backlog_jumpPage)}},model:{value:t.visited_client_backlog_jumpPage,callback:function(e){t.visited_client_backlog_jumpPage=e},expression:"visited_client_backlog_jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.visited_client_backlog_currPage=Number(t.visited_client_backlog_jumpPage)}}},[t._v("GO")])],1)],1)]:t._e()],2):t._e()])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("客户待办提醒")]),t._v(" "),!0===t.client_level_show?a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.client_level_total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.client_level_list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"client_id",label:"序号"}},[t._v("\n                            "+t._s(e.row.client_id)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"number",label:"客户编号"}},[t._v("\n                            "+t._s(e.row.number)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"client_name",label:"客户名称"}},[t._v("\n                            "+t._s(e.row.client_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"desc",label:"提醒内容"}},[t._v("\n                            "+t._s(e.row.desc)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"down_grade_time_new",label:"操作时间"}},[t._v("\n                            "+t._s(e.row.down_grade_time_new)+"\n                        ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.client_level_totalPage>1,expression:"client_level_totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.client_level_total,current:t.client_level_currPage,"per-page":t.client_level_perPage},on:{"update:current":function(e){t.client_level_currPage=e},change:t.clientLevelPageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.client_level_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.client_level_currPage=Number(t.client_level_jumpPage)}},model:{value:t.client_level_jumpPage,callback:function(e){t.client_level_jumpPage=e},expression:"client_level_jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.client_level_currPage=Number(t.client_level_jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1):t._e()])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("应收款到期提醒")]),t._v(" "),!0===t.expire_backlog_show?a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.expire_backlog_total))]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.expireExport}},[t._v("到期导出")])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.expire_backlog_list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"id",label:"序号"}},[t._v("\n                            "+t._s(e.row.id)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[a("router-link",{attrs:{to:"/contracts/"+e.row.id}},[t._v(t._s(e.row.contract_name))])],1),t._v(" "),a("b-table-column",{attrs:{field:"contract_number",label:"合同编号"}},[a("router-link",{attrs:{to:"/contracts/"+e.row.id}},[t._v(t._s(e.row.contract_number))])],1),t._v(" "),a("b-table-column",{attrs:{field:"company_name",label:"签约公司"}},[t._v("\n                            "+t._s(e.row.company_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"amount",label:"合同金额"}},[t._v("\n                            "+t._s(e.row.amount)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"receivable_balance",label:"应收账款金额"}},[t._v("\n                            "+t._s(e.row.receivable_balance)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"end_date",label:"合同有效期"}},[t._v("\n                            "+t._s(e.row.end_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"account_period",label:"合同账期"}},[t._v("\n                            "+t._s(e.row.account_period)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[t._v("\n                            "+t._s(e.row.remark)+"\n                        ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.expire_backlog_totalPage>1,expression:"expire_backlog_totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.expire_backlog_total,current:t.expire_backlog_currPage,"per-page":t.expire_backlog_perPage},on:{"update:current":function(e){t.expire_backlog_currPage=e},change:t.expirePageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.expire_backlog_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.expire_backlog_currPage=Number(t.expire_backlog_jumpPage)}},model:{value:t.expire_backlog_jumpPage,callback:function(e){t.expire_backlog_jumpPage=e},expression:"expire_backlog_jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.expire_backlog_currPage=Number(t.expire_backlog_jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1):t._e()])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("应收款超期提醒")]),t._v(" "),!0===t.overdue_backlog_show?a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.overdue_backlog_total))]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.overdueExport}},[t._v("超期导出")])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.overdue_backlog_list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"id",label:"序号"}},[t._v("\n                            "+t._s(e.row.id)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[a("router-link",{attrs:{to:"/contracts/"+e.row.id}},[t._v(t._s(e.row.contract_name))])],1),t._v(" "),a("b-table-column",{attrs:{field:"contract_number",label:"合同编号"}},[a("router-link",{attrs:{to:"/contracts/"+e.row.id}},[t._v(t._s(e.row.contract_number))])],1),t._v(" "),a("b-table-column",{attrs:{field:"company_name",label:"签约公司"}},[t._v("\n                            "+t._s(e.row.company_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"amount",label:"合同金额"}},[t._v("\n                            "+t._s(e.row.amount)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"receivable_balance",label:"应收账款金额"}},[t._v("\n                            "+t._s(e.row.receivable_balance)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"end_date",label:"合同有效期"}},[t._v("\n                            "+t._s(e.row.end_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"account_period",label:"合同账期"}},[t._v("\n                            "+t._s(e.row.account_period)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[t._v("\n                            "+t._s(e.row.remark)+"\n                        ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.overdue_backlog_totalPage>1,expression:"overdue_backlog_totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.overdue_backlog_total,current:t.overdue_backlog_currPage,"per-page":t.overdue_backlog_perPage},on:{"update:current":function(e){t.overdue_backlog_currPage=e},change:t.overduePageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.overdue_backlog_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.overdue_backlog_currPage=Number(t.overdue_backlog_jumpPage)}},model:{value:t.overdue_backlog_jumpPage,callback:function(e){t.overdue_backlog_jumpPage=e},expression:"overdue_backlog_jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.overdue_backlog_currPage=Number(t.overdue_backlog_jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1):t._e()])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("合同未回提醒")]),t._v(" "),!0===t.not_backlog_show?a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.not_backlog_total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.not_backlog_list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"contract_number",label:"合同编号"}},[t._v("\n                            "+t._s(e.row.contract_number)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[a("router-link",{attrs:{to:"/contracts/"+e.row.id}},[t._v(t._s(e.row.contract_name))])],1),t._v(" "),a("b-table-column",{attrs:{field:"name",label:"合同负责人"}},[t._v("\n                            "+t._s(e.row.name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"client_name",label:"客户名称"}},[t._v("\n                            "+t._s(e.row.client_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"company_name",label:"签约公司"}},[t._v("\n                            "+t._s(e.row.company_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"amount",label:"合同金额"}},[t._v("\n                            "+t._s(e.row.amount)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同有效期"}},[t._v("\n                            "+t._s(e.row.start_date)+" -  "+t._s(e.row.end_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"recycle_date",label:"回合同期限"}},[t._v("\n                            "+t._s(e.row.recycle_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"recycle_date_name",label:"超期状态"}},["超期未回"===e.row.recycle_date_name?[a("span",{staticClass:"c_red"},[t._v(t._s(e.row.recycle_date_name))])]:[t._v("\n                                "+t._s(e.row.recycle_date_name)+"\n                            ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("router-link",{staticClass:"button is-link",attrs:{to:"/contracts/"+e.row.id}},[t._v("查看")])],1)]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.not_backlog_totalPage>1,expression:"not_backlog_totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.not_backlog_total,current:t.not_backlog_currPage,"per-page":t.not_backlog_perPage},on:{"update:current":function(e){t.not_backlog_currPage=e},change:t.notbackPageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.not_backlog_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.not_backlog_currPage=Number(t.not_backlog_jumpPage)}},model:{value:t.not_backlog_jumpPage,callback:function(e){t.not_backlog_jumpPage=e},expression:"not_backlog_jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.not_backlog_currPage=Number(t.not_backlog_jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1):t._e()])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("客户待办事项"),!1===t.client_backlog_show?a("span",{staticStyle:{color:"red"}},[t._v(" (您无权限查看此项)")]):t._e()]),t._v(" "),!0===t.client_backlog_show?a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.client_backlog_total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.client_backlog_list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"number",label:"编号"}},[t._v("\n                            "+t._s(e.row.number)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"client_name",label:"客户名称"}},[t._v("\n                            "+t._s(e.row.client_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"brand",label:"品牌名称"}},[t._v("\n                            "+t._s(e.row.brand)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"product_line_name",label:"产品线"}},[t._v("\n                            "+t._s(e.row.product_line_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"address",label:"地址"}},[t._v("\n                            "+t._s(e.row.address)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"principal_user",label:"我方负责人"}},[t._v("\n                            "+t._s(e.row.principal_user)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"entered_date",label:"登记时间"}},[t._v("\n                            "+t._s(e.row.entered_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"approve_status",label:"审核状态"}},[t._v("\n                            "+t._s(e.row.approve_status)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"reason",label:"驳回原因"}},[t._v("\n                            "+t._s(e.row.reason)+"\n                        ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.client_backlog_totalPage>1,expression:"client_backlog_totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.client_backlog_total,current:t.client_backlog_currPage,"per-page":t.client_backlog_perPage},on:{"update:current":function(e){t.client_backlog_currPage=e},change:t.clientPageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.client_backlog_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.client_backlog_currPage=Number(t.client_backlog_jumpPage)}},model:{value:t.client_backlog_jumpPage,callback:function(e){t.client_backlog_jumpPage=e},expression:"client_backlog_jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.client_backlog_currPage=Number(t.client_backlog_jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1):t._e()])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"table_title"},[t._v("签约公司待办事项"),!1===t.sign_company_backlog_show?a("span",{staticStyle:{color:"red"}},[t._v(" (您无权限查看此项)")]):t._e()]),t._v(" "),!0===t.sign_company_backlog_show?a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.sign_company_backlog_total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.sign_company_backlog_list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"number",label:"编号"}},[t._v("\n                            "+t._s(e.row.number)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"company_name",label:"签约公司名称"}},[t._v("\n                            "+t._s(e.row.company_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"province_name",label:"签约公司所在省份"}},[t._v("\n                            "+t._s(e.row.province_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"frdb",label:"法人代表"}},[t._v("\n                            "+t._s(e.row.frdb)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"reg_address",label:"注册地址"}},[t._v("\n                            "+t._s(e.row.reg_address)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"annual_inspection_due_date",label:"年检到期日期"}},[t._v("\n                            "+t._s(e.row.annual_inspection_due_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"entered_date",label:"录入日期"}},[t._v("\n                            "+t._s(e.row.entered_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"approve_status",label:"审核状态"}},[t._v("\n                            "+t._s(e.row.approve_status)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"reason",label:"驳回原因"}},[t._v("\n                            "+t._s(e.row.reason)+"\n                        ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.sign_company_backlog_totalPage>1,expression:"sign_company_backlog_totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.sign_company_backlog_total,current:t.sign_company_backlog_currPage,"per-page":t.sign_company_backlog_perPage},on:{"update:current":function(e){t.sign_company_backlog_currPage=e},change:t.signCompanyPageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.sign_company_backlog_totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.sign_company_backlog_currPage=Number(t.sign_company_backlog_jumpPage)}},model:{value:t.sign_company_backlog_jumpPage,callback:function(e){t.sign_company_backlog_jumpPage=e},expression:"sign_company_backlog_jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.sign_company_backlog_currPage=Number(t.sign_company_backlog_jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1):t._e()])])])},staticRenderFns:[]}},"2Iok":function(t,e){},"2Q8F":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合作方式"}},[a("div",{staticClass:"cooperation-view"},[a("div",{staticClass:"title"},[t._v("一级合作方式【"+t._s(t.cooperation)+"】下的二级合作方式编辑")]),t._v(" "),a("b-field",{staticClass:"search-input",attrs:{label:"合作方式（二级）名称",horizontal:""}},[a("b-autocomplete",{attrs:{placeholder:"输入要查询的二级合作方式名称","keep-first":!1,"open-on-focus":!0,data:t.filteredDataObj,field:"val"},on:{select:t.onCooperationSelected},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.checkSecondCoop}},[t._v("查询")])],1),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addCooperation}},[t._v("新增二级合作方式")]),t._v(" "),t.level.length?a("b-table",{staticStyle:{width:"750px"},attrs:{data:t.level,bordered:t.isBorder},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"合作方式",width:"260"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"name_"+e.index,attrs:{expanded:"",type:"text"},model:{value:e.row.val,callback:function(a){t.$set(e.row,"val",a)},expression:"props.row.val"}})],1):a("b-field",[t._v(t._s(e.row.val))])],1),t._v(" "),a("b-table-column",{attrs:{label:"事业部",width:"300",visible:17===Number(t.id)}},[a("b-field",{ref:"business_"+e.index,attrs:{type:e.row.businessFieldType,message:e.row.businessFieldMsg}},[e.row.isEdit?a("ul",t._l(t.BUSINESS,function(n,i){return a("li",{key:i},[a("b-checkbox",{attrs:{"native-value":n.id},on:{input:function(a){t.onBusinessChange(e.row,n)}},model:{value:e.row.selBusiness,callback:function(a){t.$set(e.row,"selBusiness",a)},expression:"props.row.selBusiness"}},[t._v(t._s(n.name))])],1)})):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.selBusinessNames))])])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"260"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveCooperation(e.row,e.index)}}},[t._v("保存")]):t._e(),t._v(" "),e.row.isEdit?a("button",{staticClass:"button is-link",on:{click:function(a){t.checkStatus(e.row,1,e.index)}}},[t._v("取消")]):a("button",{staticClass:"button is-primary",on:{click:function(a){t.checkStatus(e.row,0)}}},[t._v("编辑")]),t._v(" "),e.row.is_deleted?a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteCooperation(e.row,e.index)}}},[t._v("删除")]):t._e()]),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showCooperationLog(e.row.id)}}},[t._v("查看")])])]}}])}):t._e()],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[t.logData.length?a("b-table",{attrs:{data:t.logData},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"操作人",width:"60"}},[a("b-field",[t._v(t._s(e.row.updated_user))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作信息",width:"260"}},[a("b-field",[t._v(t._s(e.row.description.desc))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作时间",width:"160"}},[a("b-field",[t._v(t._s(e.row.create_time))])],1)]}}])}):t._e()],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},"2u47":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div")},staticRenderFns:[]}},"2zB+":function(t,e,a){a("mHlE"),a("1q+D");var n=a("VU/8")(a("MWDS"),a("yqmW"),"data-v-d296a1a2",null);t.exports=n.exports},"2zWw":function(t,e){},"3faH":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("//Fk"),o=n(r),c=a("O4Lo"),l=n(c),d=a("T0q9"),u=n(d),_=a("LZT1"),p=n(_),m=["人民币","美元","日元","欧元","英镑","韩国元","加拿大元","澳元"],h={type_0:"国内",type_1:"海外",type_2:"汽车",type_3:"欧美",type_4:"淘系",type_5:"新业务-国际拓展部"},f=["未提交","待审核","审核通过","驳回待修改","再驳回待修改"],v=["默认","是","否"],b=["user_id","client_id","signing_company_id","join_contract_id"],g={url3:"补充协议",url2:"合同附件",url:"合同文本",url4:"结案报告"};e.default={props:["id","isEdit","isAdd","fromContract","isChange","changeList","user_code"],data:function(){return{IS_FIRST:v,urlID:this.$route.query.id,flagParty:!0,flagUser:!0,flagClient:!0,flagSingle:!0,flagJoin:!0,contractUserId:"",contractUsers:[],fetchingUsers:!1,contractChargeName:"",clients:[],contractClientName:"",newClientId:"",newClientName:"",departments:[],contractDepartment:"",fetchingPartyAs:!1,bizTypes:"",accountPeriod:null,partyAs:[],partyAName:"",yearContracts:[],yearContractName:"",singleContracts:[],singleContractsName:"",contractDateStart:new Date,contractDateEnd:new Date,dividDateStart:new Date,dividDateEnd:new Date,hardAdsCheckedRows:[],contractPaymentDate:new Date,contractStatus:[],allContracts:[],inputContractName:"",fecthingContracts:!1,APPROVE_STATUS:f,defaultCurrencyRate:1,thestatus_id:null,ifSave:!0,confirm_date:null,all_confirm_date:null,rejectReason:"",ifReject:!1,errshow:!1,isSplit:1,contract:{apply_user_id:null,is_split:1,ad_schedules_days:0,contract_name:"",contract_number:"",contract_type_id:"",contract_type_name:"",client_type:"",free_type:1,client_id:"",client_name:"",client_type_id:"",client_type_name:"",user_id:"",contract_charge_name:"",party_b_name:"",signing_company_id:"",signing_company_name:"",signing_company_type_id:"",signing_company_type_name:"",biz_type_id:"",biz_type_name:"",contract_brand_id:"",contract_brand_name:"",contract_second_brand_id:"",contract_second_brand_name:"",print_and_seal:"",free_join_contract_id:"",free_join_contract_number:"",free_join_contract_name:"",join_contract_id:"",join_contract_number:"",join_contract_name:"",start_date:"",end_date:"",account_period:"",entered_user_id:"",entered_user_name:"",approve_status_id:0,applied_approved_status:0,approve_status_name:"",contract_currency_type_id:0,contract_contract_currency_type_name:"",contract_currency_amount:"",amount:"",file_url:"",file_url2:"",total_amount:"",total_cash_collection_amount:"",hkdkfd_total_amount:"",ygfd_rate:"",ygfd_amount:"",qrfd_rate:"",qrfd_amount:"",emstimate_date:"",receivable_balance:"",entered_date:"",contract_cost:"",contract_cost1:"",contract_cost2:"",rebate:"",signing_date:"",invoice_amount:"",invoice_count:"",department_name:"",parent_department_name:"",contract_signing:"",payment_date:"",amount_upper:"",swzc_approved:1,ad_schedules:[],details:[],splits:[],amounts:{},cash_collections:[],remarks:[],contract_status:[],is_currency_update:1,is_hard_update:1,entire_single_discount:"0.00",status_id:null,achieve_pm_name:"",achieve_pm_id:"",addsplits:[]},codeList:[],levelData:[],level:null,CURRENCIES:m,SOFTWAYS:[],COOPWAYS:[],hardWideDetailType:"",selected:[],DEPARTMENT:"",urlFiles:[],url2Files:[],url3Files:[],url4Files:[],states:{url:{status:"",msg:"",loading:!1,accept:[".doc",".docx",".pdf"]},url2:{status:"",msg:"",loading:!1},url3:{status:"",msg:"",loading:!1},url4:{status:"",msg:"",loading:!1,accept:[".pptx",".ppt",".zip",".rar"]}},status:{join_contract_id:""},reviseData:[],reivseLogs:[],reviseLogActive:!1,logColumns:[{field:"creation_time",label:"操作时间"},{field:"editor_name",label:"操作人"},{field:"price",label:"修正金额"}],BUY_TYPES:{1:"购买",2:"赠送"},dataReady:!1,isRe:!!this.$route.query.isRe||!1,typeArray:["","甲方","乙方","合同负责人","合同延期","币种变更"],cooperationList:[],waibumeijie:!1,roleList:[]}},mixins:[u.default],watch:{contractStatus:function(t){t.indexOf("7")>-1&&this.getContracts()},"contract.contract_brand_id":function(t,e){console.log("-----------1---------",t,e),""===e&&this.urlID&&this.onSelectLevel(t)},singleContractsName:function(t,e){""===e&&this.urlID&&this.getSingleContracts()},contractChargeName:function(t,e){""===e&&this.urlID&&this.getUsers()},yearContractName:function(t,e){""===e&&this.urlID&&this.getYearContracts()},"contract.hard_wide_detail_type":function(t){var e=this;console.log(t),this.COOPWAYS.filter(function(a){if(a.id===t)return e.hardWideDetailType=a.val,a})}},computed:{filteredClients:function(){var t=this;return this.clients.filter(function(e){return e.client_name.toString().toLowerCase().indexOf(t.contractClientName.toLowerCase())>=0})},productLines:function(){var t=[];return(this.bizTypes||"").split(",").forEach(function(e){t.push({id:e,name:h["type_"+e]})}),t}},created:function(){var t=this;this.getCodeList(),this.getCooperationList();for(var e=[],a=this.$root.user.roleCodes.split(", "),n=0,i=a;n<i.length;n++)i[n].indexOf("role-crm")>-1&&e.push(i[n]);1===e.length&&"role-crm-waibumeijie"===e[0]?this.waibumeijie=!0:this.waibumeijie=!1,this.id?(this.getAllDepartment().then(function(){t.getContract().then(function(e){t.updateDefaultCurrencyRate()})}),this.getRevise()):this.dataReady=!0,this.urlID&&this.getContractPart(),this.getLevel(),this.getRoleCode()},methods:{init_end_date:function(t){console.log(t);var e=(new Date).getFullYear(),a=(new Date).getMonth()+1,n=new Date(e+"-"+a+"-01");return t>n?t:n},filteredJoin:function(){var t=this;return this.yearContracts.filter(function(e){return Number(e.id)===Number(t.contract.join_contract_id)})},filteredParty:function(){var t=this;return this.partyAs.filter(function(e){return Number(e.id)===Number(t.contract.signing_company_id)})},filteredClientsUrl:function(){var t=this;return this.clients.filter(function(e){return Number(e.id)===Number(t.newClientId)})},filteredUsers:function(){var t=this;return this.contractUsers.filter(function(e){return Number(e.id)===Number(t.contract.user_id)})},filteredSingle:function(){var t=this;return this.singleContracts.filter(function(e){return Number(e.id)===Number(t.contract.free_join_contract_id)})},filteredDataObj:function(t){return t.options=t.optionsList.filter(function(e){return e.cooperation_name.toString().toLowerCase().indexOf(t.contract_detail_cooperation_val.toLowerCase())>=0}),this.$forceUpdate(),t.options},getAllDepartment:function(){var t=this;return this.ajax({url:"/business/index"}).then(function(e){var a=(0,p.default)(e.data);t.DEPARTMENT=a})},onSelectDepartment:function(t,e){var a=this;return console.log("---type----",e),new o.default(function(n,i){a.ajax({method:"post",url:"/cooperation_business/get_info_by_business_id",data:{business_id:t.business_id}}).then(function(s){0===s.error_code?("get"===e&&(a.$set(t,"contract_detail_cooperation_val",""),a.$set(t,"contract_detail_cooperation_id","")),t.optionsList=s.data,a.$forceUpdate(),n(s.data)):i(s.error_msg)})})},getRoleCode:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{role_code:"role-crm-mejierenyuan",is_rebuild:1}}).then(function(e){0===e.error_code&&(t.roleList=e.data.rows||[],t.roleList.unshift({id:"",name:""}))})},getLevel:function(){var t=this;this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data})},onSelectLevel:function(t){console.log("--------------",t),t&&(this.level=this.levelData[t-1],this.level&&0===this.level.level.length&&(this.contract.contract_second_brand_id=t+"_0"))},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:"",role_code:"role-crm-xiangmujingli",use_swzc:0}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},getContractPart:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/contract_applied/get_contract_by_id",params:{contract_id:this.urlID}}).then(function(e){if(0===e.error_code){var a=e.data;t.contract.contract_type_id=a.contract_type_id,t.contract.contract_name=a.contract_name,t.contract.contract_brand_id=a.contract_brand_id,t.contract.contract_second_brand_id=a.contract_second_brand_id,t.contract.user_id=a.user_id,t.contractChargeName=a.contract_charge_name||"",t.contractClientName=a.client_name,t.newClientId=a.client_id,t.newClientName=a.client_name,t.contract.client_type=a.client_type,t.contract.parent_department_name=a.parent_department_name,t.contract.department_name=a.department_name,t.partyAName=a.signing_company_name||"",t.contract.signing_company_id=a.signing_company_id,t.contract.signing_company_name=a.signing_company_name,t.contract.signing_company_type_id=a.signing_company_type_id,t.yearContractName=a.join_contract_name,t.contract.join_contract_id=a.join_contract_id,t.contract.party_b_name=a.party_b_name,t.contractDateStart=new Date(a.start_date),t.contractDateEnd=new Date(a.end_date),t.accountPeriod=a.account_period?new Date(a.account_period):null,t.contract.contract_signing=a.contract_signing,t.singleContractsName=a.free_join_contract_name,t.contract.free_join_contract_id=a.free_join_contract_id,t.dataReady=!0,t.$forceUpdate()}})},getContract:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/contract_applied/get_contract_by_id",params:{contract_id:this.id}}).then(function(e){if(0===e.error_code){var a=e.data;if(console.log("serverData",a),t.contractChargeName=a.contract_charge_name||"",t.contractClientName=a.client_name,t.partyAName=a.signing_company_name||"",t.yearContractName=a.join_contract_name,t.singleContractsName=a.free_join_contract_name,t.contractDateStart=new Date(a.start_date),t.contractDateEnd=new Date(a.end_date),t.accountPeriod=a.account_period?new Date(a.account_period):null,t.contractUserId=a.user_id,t.isSplit=a.is_split,t.getClients(),a.details.forEach(function(e){e.business_id=Number(e.business_id),0===e.business_id?e.business_name="---":t.DEPARTMENT.filter(function(t){t.id===e.business_id&&(e.business_name=t.name)}),e.contract_detail_cooperation_id=Number(e.contract_detail_cooperation_id),e.contract_detail_cooperation_val=e.contract_detail_cooperation_name,e.options=[],console.log("-------hello------"),t.isEdit&&t.onSelectDepartment(e).then(function(){e.optionsList.filter(function(t){if(e.contract_detail_cooperation_id===t.id)return e.contract_detail_cooperation_val=t.cooperation_name,t})}),e.dateStart=new Date(e.start_date),e.dateEnd=new Date(e.end_date),e.dateMin=null,e.dateMax=null,e.currencyRequired=0!==Number(a.contract_currency_type_id),e.rmbRequired=0===Number(a.contract_currency_type_id)}),a.ad_schedules.forEach(function(t){t.confirmDate=t.confirm_date?new Date(t.confirm_date):null}),a.splits.forEach(function(t){t.dateStart=new Date(t.start_date),t.dateEnd=new Date(t.end_date),t.currencyRequired=0!==Number(a.contract_currency_type_id),t.rmbRequired=0===Number(a.contract_currency_type_id)}),a.cash_collections.forEach(function(t){t.cashCollectionDate=new Date(t.cash_collection_date),t.confirmDate=new Date(t.confirm_date)}),a.addsplits.lists){a.addsplits.lists.forEach(function(e){e.isLast=!1,e.length=e.lists?e.lists.length:0,t.DEPARTMENT.filter(function(t){t.id===e.business_id&&(e.business_name=t.name)}),e.lists.forEach(function(t){t.contract_detail_cooperation_val=t.contract_detail_cooperation_val})});var n={isLast:!0,length:0,business_id:0,business_name:"合计",split_count:a.addsplits.count.split_count_sum,amount_count:a.addsplits.count.amount_count_sum,ad_amount:a.addsplits.count.ad_amounts_count,detail_amount:a.addsplits.count.detail_amounts_count,ad_split:a.addsplits.count.ad_split_count,detail_split:a.addsplits.count.detail_split_count};a.addsplits.lists.push(n)}t.thestatus_id=e.data.status_id,t.contract=a,t.dataReady=!0,t.$forceUpdate(),t.$nextTick(function(){t.updateHardBuyType(a.contract_type_id)}),t.contractStatus.indexOf("7")>-1&&(t.status.join_contract_id=a.join_contract_id,t.inputContractName=a.join_contract_name),t.contractStatus.indexOf("5")>-1&&(t.contractPaymentDate=a.payment_date?new Date(a.payment_date):new Date)}return t.onSelectLevel(t.contract.contract_brand_id||""),e})},getUsers:(0,l.default)(function(){var t=this;this.contractUsers=[],this.fetchingUsers=!0,this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{name:this.contractChargeName.trim(),role_code:"role-crm-shangwu"}}).then(function(e){if(t.fetchingUsers=!1,0===e.error_code&&(t.contractUsers=e.data.rows||[],t.urlID&&t.flagUser)){t.flagUser=!1;var a=t.filteredUsers();console.log("a",a),t.onUserSelect(a[0])}})},500),getSigningCompanies:(0,l.default)(function(){var t=this;this.partyAs=[],this.fetchingPartyAs=!0,this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.partyAName.trim(),approve_status_id:2}}).then(function(e){if(t.fetchingPartyAs=!1,0===e.error_code&&(t.partyAs=e.data.lists||[],t.urlID&&t.flagParty)){t.flagParty=!1;var a=t.filteredParty();console.log("c",a),t.onSigningCompanySelect(a[0])}})},500),onSigningCompanySelect:function(t){t&&(this.contract.signing_company_id=t.id,this.contract.signing_company_name=t.company_name)},onUserSelect:function(t){t&&(this.contract.user_id=t.id,this.contract.contract_charge_name=t.name,this.contractUserId=t.id,this.contractChargeName=t.name,this.contractClientName="",this.contract.client_id="",this.contract.biz_type_id="",this.contract.department_id="",this.contract.department_name="",this.contract.parent_department_name="",this.contract.client_type_name=t.client_type,this.getClients())},getClients:function(){var t=this;return this.ajax({url:"/contract_applied/get_user_by_id",params:{user_id:this.contractUserId}}).then(function(e){if(0===e.error_code){if(t.clients=e.data.clients,t.departments=e.data.departments,t.bizTypes=e.data.user.biz_type,t.departments.length){var a=t.departments[0];t.contract.department_id=a.department_id,t.contract.department_name=a.department_name,t.contract.parent_department_name=a.parent_department_name}if(t.urlID&&t.flagClient){t.flagClient=!1;var n=t.filteredClientsUrl();console.log("b",n),t.contractClientName=t.newClientName,t.onClientSelect(n[0])}}})},onClientSelect:function(t){t&&(this.contract.client_id=t.id,this.contract.client_name=t.client_name,this.contract.client_type=t.client_type)},getSingleContracts:function(){var t=this;return this.singleContractsName,this.ajax({url:"/contract_applied/get_contract_lists",params:{applied_approved_status:2,contract_type_id:0,contract_name:this.singleContractsName,no_limit:1}}).then(function(e){if(0===e.error_code&&(t.singleContracts=e.data.lists,t.urlID&&t.flagSingle)){t.flagSingle=!1;var a=t.filteredSingle();console.log("d",a),t.onSingleContractSelect(a[0])}})},onSingleContractSelect:function(t){t&&(this.contract.free_join_contract_id=t.id)},getYearContracts:function(){var t=this;return""===this.yearContractName&&(this.contract.join_contract_id=0,this.contract.join_contract_number="",this.contract.join_contract_name=""),this.ajax({url:"/contract/getBoxContractLists",params:{search:this.yearContractName}}).then(function(e){if(0===e.error_code&&(t.yearContracts=e.data,t.urlID&&t.flagJoin)){t.flagJoin=!1;var a=t.filteredJoin();console.log("e",a),t.onYearContractSelect(a[0])}})},onYearContractSelect:function(t){t&&(this.contract.join_contract_id=t.id,this.contract.join_contract_number=t.contract_number,this.contract.join_contract_name=t.contract_name)},contractDataValidate:function(t){var e=this,a=[];if(t.forEach(function(t){var n=e.$refs[t];if(n&&n.checkHtml5Validity)if(/_(start|end)_date_/.test(t))n.value||a.push({type:"datepicker",component:n});else if(/^file_url/.test(t))e.contract[t]||(n.checkHtml5Validity(),a.push(n));else if(n.checkHtml5Validity()){if(b.indexOf(t)>-1&&!e.contract[t])a.push(n),n.newValue="",e.$nextTick(function(){n.checkHtml5Validity()});else if(/^contract_detail_cooperation_id/.test(t)){var i=t.replace(/[^0-9]/gi,""),s=e.contract.details[i];s.contract_detail_cooperation_id||a.push({type:"cooperation",component:n}),e.$forceUpdate()}}else a.push(n)}),a.length){var n=a[0];return"datepicker"===n.type?n.component.$el.querySelector('input[type="text"]').focus():"cooperation"===n.type?n.component.$el.querySelector("input").focus():n.focus(),!1}return!0},saveContract:function(t){var e=this;this.ifSave=t;var a=["contract_name","contract_type_id","contract_brand_id","user_id","client_id","biz_type_id"],n=t?a.concat(["signing_company_id","signing_company_type_id","party_b_name"]):a,i=this.contract,r=i.ad_schedules,o=i.details,c=i.splits,l=i.cash_collections,d=i.remarks;if(r.length){var u=["hard_clicks","hard_buy_type","hard_publish_price","hard_total_price","hard_discount","hard_real_price"];n.push("hard_wide_detail_type"),n.push("contract_currency_type_id"),n.push("entire_single_discount"),r.forEach(function(t,e){console.log(t,e),u.forEach(function(t){n.push(t+"_"+e)})})}if(o.length){console.log("ruanxing");var _=["soft_start_date","soft_end_date","soft_currency_amount","soft_rmb_amount","business_id","contract_detail_cooperation_id"];if(n.push("contract_currency_type_id"),o.forEach(function(t,e){_.forEach(function(t){n.push(t+"_"+e)})}),(!this.fromContract&&t||this.fromContract)&&2!==Number(this.isSplit))return this.$toast.open({duration:3e3,message:"合同拥有软性条目，请变更为手动拆分再提交",position:"is-top",type:"is-warning"}),!1}if((!this.fromContract&&t||this.fromContract&&2===Number(this.contract.applied_approved_status))&&19===Number(this.contract.contract_brand_id)&&2!==Number(this.isSplit))return this.$toast.open({duration:3e3,message:"合同品类为综合电商，请变更为手动拆分再提交",position:"is-top",type:"is-warning"}),!1;if(c.length){var p=["splits_contract_detail_cooperation_id","splits_currency_amount","splits_rmb_amount"];n.push("contract_currency_type_id"),c.forEach(function(t,e){p.forEach(function(t){n.push(t+"_"+e)})})}if(this.contractDataValidate(n)){if(i.swzc_approved){if(t&&!this.contractDataValidate(["file_url"])&&!this.contractDataValidate(["file_url2"]))return void this.$dialog.alert("合同文本和合同附件请至少上传一个");if(l.length){var m=["payments_currency_id","payments_current_amount","payments_cash_type","payments_is_deduct_money"],h=[];if(l.forEach(function(t,e){m.forEach(function(t){h.push(t+"_"+e)})}),!this.contractDataValidate(h))return}if(d.length){var f=["remark_content"],v=[];if(d.forEach(function(t,e){f.forEach(function(t){v.push(t+"_"+e)})}),!this.contractDataValidate(v))return}}var b=[],g=[],y=[],C=[],k=[];r.forEach(function(t){b.push({id:t.id,contract_id:t.contract_id,clicks:t.clicks,days:t.days,buy_type:Number(t.buy_type),currency_type_id:t.currency_type_id,publish_price:t.publish_price,total_price:t.total_price,discount:t.discount,real_price:t.real_price,start_date:t.start_date,end_date:t.end_date})}),o.forEach(function(t){g.push({id:t.id||0,contract_detail_cooperation_id:t.contract_detail_cooperation_id,business_id:t.business_id,contract_id:e.id,currency_type_id:i.contract_currency_type_id,currency_amount:t.currency_amount,start_date:e.zDateFormatter(t.dateStart),end_date:e.zDateFormatter(t.dateEnd),rmb_amount:t.rmb_amount,currency_rate:t.currency_rate})}),c.forEach(function(t){y.push({id:t.id||0,contract_id:e.id,currency_type_id:i.contract_currency_type_id,currency_amount:t.currency_amount,start_date:e.zDateFormatter(t.dateStart),end_date:e.zDateFormatter(t.dateEnd),rmb_amount:t.rmb_amount,contract_detail_cooperation_id:t.contract_detail_cooperation_id,rate:t.rate})}),l.forEach(function(t){C.push({id:t.id||0,contract_id:e.id,amount:t.amount,current_amount:t.current_amount,currency_id:t.currency_id,cash_collection_date:e.zDateFormatter(t.cashCollectionDate),confirm_date:e.zDateFormatter(t.confirmDate),cash_type:t.cash_type,computing_date:t.computing_date,rebate_amount:t.rebate_amount,is_deduct_money:t.is_deduct_money})}),d.forEach(function(t){k.push({id:t.id||0,remark:t.remark})});var w="";w=i.contract_second_brand_id?i.contract_second_brand_id:i.contract_brand_id?i.contract_brand_id+"_0":"";var x=this.id,P={apply_user_id:i.apply_user_id,is_split:this.isSplit||1,contract_name:i.contract_name,contract_type_id:i.contract_type_id,contract_brand_id:w||"",user_id:i.user_id,client_id:i.client_id,biz_type_id:i.biz_type_id,signing_company_id:i.signing_company_id,signing_company_type_id:i.signing_company_type_id,join_contract_id:i.join_contract_id,free_join_contract_id:i.free_join_contract_id,free_type:i.free_type,party_b_name:i.party_b_name,start_date:this.zDateFormatter(this.contractDateStart),end_date:this.zDateFormatter(this.contractDateEnd),account_period:this.accountPeriod?this.zDateFormatter(this.accountPeriod):"",hard_wide_detail_type:i.hard_wide_detail_type,contract_currency_type_id:i.contract_currency_type_id,approve_status_id:t?this.fromContract?2:1:0,ad_schedules:b,details:g,splits:y,cash_collections:C,remarks:k,entire_single_discount:i.entire_single_discount};this.contract.swzc_approved&&(P.texts={file_url:i.file_url,file_url2:i.file_url2,file_url3:i.file_url3,file_url4:i.file_url4,status_id:i.status_id},P.costs={ygfd_rate:i.ygfd_rate,ygfd_date_time:i.ygfd_date_time,qrfd_rate:i.qrfd_rate,qrfd_date_time:i.qrfd_date_time,contract_cost:i.contract_cost,contract_cost1:i.contract_cost1,contract_cost2:i.contract_cost2});var z="/contract_applied/add_contract";return x&&(z="/contract_applied/update_contract",P.contract_id=this.id,P={data:(0,s.default)(P)}),this.ajax({loading:this.$loading.open(),method:"post",url:z,data:P,successTip:!0}).then(function(a){if(0===a.error_code){var n=e.fromContract?"contracts":"pre_contracts";t?e.$router.push("/"+n):e.isEdit&&!e.id?(e.$router.push("/"+n+"/"+a.data.insert_id+"/edit"),window.location.reload()):window.location.reload()}})}},onContractTypeSelect:function(t){this.updateHardBuyType(t)},updateHardBuyType:function(t){2===Number(t)?this.contract.ad_schedules.forEach(function(t){t.buy_type=2}):0===Number(t)&&this.contract.ad_schedules.forEach(function(t){0===Number(t.buy_type)&&(t.buy_type=1)})},onBuyTypeChange:function(t){2===Number(t.buy_type)?(t.discount=100,t.publish_price=0,t.total_price=0,t.real_price=0):1===Number(t.buy_type)&&(0===Number(this.contract.signing_company_type_id)?t.discount=40:1===Number(this.contract.signing_company_type_id)&&(t.discount=50))},setHardDiscount:function(){var t=this;this.contract.ad_schedules.forEach(function(e){Number(e.discount)>0||2===Number(e.buy_type)||1===Number(e.buy_type)&&(0===Number(t.contract.signing_company_type_id)?e.discount=40:1===Number(t.contract.signing_company_type_id)&&(e.discount=50))})},onHardCoopWaySelect:function(t){0!==Number(t)&&this.contract.ad_schedules.forEach(function(t){t.total_price=Number(t.publish_price)*Number(t.days)})},onSignCompayTypeSelect:function(t){0===Number(this.contract.contract_type_id)&&this.contract.ad_schedules.forEach(function(e){2!==Number(e.buy_type)&&(0===Number(t)?e.discount=40:1===Number(t)&&(e.discount=50))})},onPublishPriceChange:function(t){this.updateTotalPrice(t),-1===[9,10].indexOf(Number(this.contract.hard_wide_detail_type))&&this.updateClicks(t)},updateTotalPrice:function(t){if(2!==Number(this.contract.hard_wide_detail_type)){var e=Number(t.days)*Number(t.publish_price);t.total_price=e?e.toFixed(6):"0.000000"}},onTotalPriceChange:function(t){this.updateRealPrice(t),-1===[9,10].indexOf(Number(this.contract.hard_wide_detail_type))&&this.updateClicks(t)},onBlurTotalPrice:function(t){if([9,10].indexOf(Number(this.contract.hard_wide_detail_type))>-1){var e=9===Number(this.contract.hard_wide_detail_type)?"CPM数":"CPA数";t.clicks?t.publish_price=(t.total_price/t.clicks).toFixed(2):this.$dialog.alert("请填写当前条数据的"+e)}},updateClicks:function(t){var e=Number(t.total_price)/(Number(t.publish_price)*(1-Number(t.discount)/100));t.clicks=e?e===1/0?0:parseInt(e):0},updateRealPrice:function(t){var e=Number(t.total_price)*(1-Number(t.discount)/100);t.real_price=e?e.toFixed(2):"0.00"},onDiscountChange:function(t){this.updateRealPrice(t),-1===[9,10].indexOf(Number(this.contract.hard_wide_detail_type))&&this.updateClicks(t)},updateDiscount:function(t){if(2===Number(t.buy_type)){var e=Number(t.total_price),a=0;isNaN(Number(t.real_price))?t.real_price=0:t.real_price=Number(t.real_price),a=0===e?0:100*(1-Number(t.real_price)/e),a.toString().indexOf(".")>0&&a.length-a.toString().indexOf(".")>3?(console.log(a.length-a.toString().indexOf(".")),t.discount=a?a.toFixed(2):"0.00"):t.discount=a.toFixed(2),console.log("discount:",t.discount)}else{var n=Number(t.total_price),i=(n-Number(t.real_price))/n*100;i.toString().indexOf(".")>0&&i.length-i.toString().indexOf(".")>3?(console.log(i.length-i.toString().indexOf(".")),t.discount=i?i.toFixed(2):"0.00"):t.discount=i}},confirmHardAd:function(t,e){var a=this;if(2===Number(e)&&!this.all_confirm_date)return void this.$dialog.alert("请选择批量确认时间");var n=[],i=[];if(t.length){var s="";if(t.forEach(function(t){1===Number(e)?(t.confirmDate=t.confirmDate?t.confirmDate:new Date,a.confirm_date=a.zDateFormatter(t.confirmDate),s=t.confirmDate):(t.confirmDate=a.all_confirm_date?a.all_confirm_date:new Date,a.confirm_date=a.zDateFormatter(a.all_confirm_date),s=a.all_confirm_date),i.push(t),n.push(t.id)}),0===n.length)return void this.$dialog.alert("选中的条目已全部确认过");var r=this.checkDate(new Date,s);return!0!==r?void this.$dialog.alert(r):(console.log(r),this.ajax({url:"/contract_applied/confirm_ad_schedule",params:{ad_schedule_ids:n.join(","),confirm_date:this.confirm_date},successTip:!0}).then(function(t){0===t.error_code&&(i.forEach(function(t){t.is_confirm=1}),a.hardAdsCheckedRows=[],a.all_confirm_date=null)}))}},checkDate:function(t,e){var a=t.getDate(),n=t.getMonth()+1,i=t.getFullYear();return e.getFullYear()>i||(a>3?e.getMonth()+1>=n||"请选择当月1号及以后日期":e.getMonth()+1>=n-1||"请选择上月1号及以后日期")},confirmHardDel:function(t){var e=this,a=[],n=this.contract.ad_schedules,i=n.length;t.forEach(function(t){a.push(t.id)}),this.$dialog.confirm({message:"确定删除选中的硬广吗？",onConfirm:function(){return e.ajax({url:"/contract_applied/delete_ad_schedule_batch",data:{ids:a},method:"post",successTip:!0}).then(function(t){if(0===t.error_code){for(e.getContract();i--;)a.indexOf(n[i].id)>-1&&n.splice(i,1);e.hardAdsCheckedRows=[]}})}})},deleteHardAd:function(t,e){var a=this;this.$dialog.confirm({message:"确定删除该硬广吗？",onConfirm:function(){return a.ajax({url:"/contract_applied/delete_ad_schedule",params:{id:t.id},successTip:!0}).then(function(t){0===t.error_code&&(a.getContract(),a.contract.ad_schedules.splice(e,1))})}})},addSoftAd:function(){this.contract.details.push({business_id:null,contract_detail_cooperation_id:null,dateStart:null,dateEnd:null,dateMax:null,dateMin:null,currencyRequired:0!==Number(this.contract.contract_currency_type_id),rmbRequired:0===Number(this.contract.contract_currency_type_id),start_date:"",end_date:"",currency_amount:0,rmb_amount:0,currency_type_id:this.contract.contract_currency_type_id,currency_rate:this.defaultCurrencyRate,contract_id:this.id,is_update:1,is_add:1})},deleteSoftAd:function(t,e){var a=this;t.id?this.$dialog.confirm({message:"确定删除吗？",onConfirm:function(){return a.ajax({url:"/contract_amount_detail/delete_contract_amount_detail",params:{detail_id:t.id},successTip:!0}).then(function(t){0===t.error_code&&a.contract.details.splice(e,1)})}}):this.contract.details.splice(e,1)},addDivid:function(){var t=new Date;this.contract.splits.push({dateStart:t,dateEnd:t,currencyRequired:0!==Number(this.contract.contract_currency_type_id),rmbRequired:0===Number(this.contract.contract_currency_type_id),start_date:this.zDateFormatter(t),end_date:this.zDateFormatter(t),currency_amount:0,rmb_amount:0,contract_detail_cooperation_id:"",contract_detail_cooperation_name:"",currency_type_id:this.contract.contract_currency_type_id,rate:this.defaultCurrencyRate,contract_id:this.id})},deleteDivid:function(t,e){var a=this;t.id?this.$dialog.confirm({message:"确定删除吗？",onConfirm:function(){return a.ajax({url:"/contract_amount_split/delete_contract_amount_details_split",params:{split_id:t.id},successTip:!0}).then(function(t){0===t.error_code&&a.contract.splits.splice(e,1)})}}):this.contract.splits.splice(e,1)},onCurrencyTypeChange:function(t,e,a){var n=void 0;0===Number(this.contract.contract_currency_type_id)?(n=this.$refs[a+"_currency_amount_"+e],t.rmbRequired=!0,t.currencyRequired=!1):(n=this.$refs[a+"_rmb_amount_"+e],t.rmbRequired=!1,t.currencyRequired=!0),n&&n.checkHtml5Validity&&this.$nextTick(function(){n.checkHtml5Validity()}),this.updateRMBInRow(t)},updateRMBInRow:function(t){var e=this.zDateFormatter(t.dateStart||new Date);this.currencyToRMB(t.currency_amount,this.contract.contract_currency_type_id,e).then(function(e){t.rmb_amount=e.rmb_amount,t.currency_rate=e.rate,t.rate=e.rate})},toReject:function(){this.ifReject?this.ifReject=!1:this.ifReject=!0,this.rejectReason=""},rejectContract:function(){var t=this;this.contractDataValidate(["rejectReason_ref"])&&this.ajax({loading:this.$loading.open(),url:"/contract_approval_options/reject",method:"post",successTip:!0,data:{approve_type:this.approveType,contract_id:this.id,reason:this.rejectReason}}).then(function(e){0===e.error_code&&(1===t.contract.approve_status_id?t.contract.approve_status_id=3:1===t.contract.applied_approved_status&&(t.contract.applied_approved_status=3),t.fromContract?t.$router.push("/pending_contracts"):t.$router.push("/pending_pre_contracts"),t.ifReject=!1)})},passContract:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/contract_approval_options/pass",method:"post",successTip:!0,data:{approve_type:this.approveType,contract_id:this.id}}).then(function(e){0===e.error_code&&(t.contract.swzc_approved=!0,t.contract.swzc_approved_time=t.zDateFormatter(new Date),1===t.contract.approve_status_id?t.contract.approve_status_id=2:1===t.contract.applied_approved_status&&(t.contract.applied_approved_status=2),t.fromContract?t.$router.push("/pending_contracts"):t.$router.push("/contracts/"+t.id+"/edit"))})},fileUpload:function(t){var e=this,a=this.$data[t+"Files"];if(0!==a.length){var n=a,i=g[t],s=n.name.match(/\.([^.]+)$/)[1],r=this.states[t].accept;if(r&&-1===r.indexOf("."+s))return void this.$dialog.alert("文件后缀必须为"+r.join(", "));if("url3"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("url"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("url2"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("url4"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");this.states[t].status="",this.states[t].msg="",this.states[t].loading=!0,this.ajax({url:"/tools/file_upload",method:"post",data:{file_type:s,file_name:n}}).then(function(a){e.$toast.open({duration:5e3,message:"上传【"+i+"】附件成功",position:"is-top",type:"is-success"}),e.states[t].loading=!1,console.log(a),e.contract["file_"+t]=a.data.file_name})}},deletePayment:function(t,e){var a=this;t.id?this.$dialog.confirm({message:"确定删除吗？",onConfirm:function(){return a.ajax({url:"/contract_cash_collection/delete_contract_cash_collection",params:{cash_collection_id:t.id},successTip:!0}).then(function(t){0===t.error_code&&a.contract.cash_collections.splice(e,1)})}}):this.contract.cash_collections.splice(e,1)},addPayment:function(){var t=new Date;this.contract.cash_collections.push({contract_id:this.id,amount:0,current_amount:0,currency_id:"",cash_collection_date:this.zDateFormatter(t),cashCollectionDate:t,confirm_date:"",confirmDate:t,cash_type:"",computing_date:"",rebate_amount:0,is_deduct_money:""})},updatePaymentRMB:function(t){this.currencyToRMB(t.current_amount,t.currency_id,t.cash_collection_date).then(function(e){t.amount=e.rmb_amount})},updatePaymentRebateAmount:function(t){var e=Number(this.contract.qrfd_rate)/100,a=Number(this.contract.ygfd_rate)/100;e?t.rebate_amount=(t.amount*e).toFixed(6):a&&(t.rebate_amount=(t.amount*a).toFixed(6))},currencyToRMB:function(t,e,a){return this.ajax({url:"/contract_amount_detail/get_rate_amount",method:"post",data:{currency_amount:t,currency_type_id:e,start_date:a}}).then(function(t){if(0===t.error_code)return t.data})},addRemark:function(){this.contract.remarks.push({entered_date:this.zDateFormatter(new Date),username:this.$root.crmUser.name,remark:""})},deleteRemark:function(t,e){var a=this;t.id?this.$dialog.confirm({message:"确定删除吗？",onConfirm:function(){return a.ajax({url:"/contract_remark/delete_contract_remark",params:{remark_id:t.id},successTip:!0}).then(function(t){0===t.error_code&&a.contract.remarks.splice(e,1)})}}):this.contract.remarks.splice(e,1)},renewContract:function(){var t=this.contract;if(this.contractStatus.indexOf("7")>-1&&!this.status.join_contract_id)return this.$refs.status_join_contract_id.checkHtml5Validity(),void this.$refs.status_join_contract_id.focus();var e={contract_id:this.id,contract_cost1:t.contract_cost1,contract_cost2:t.contract_cost2,rebate:t.rebate,file_url:t.file_url,file_url2:t.file_url2,file_url3:t.file_url3,file_url4:t.file_url4,remark:t.remark,join_contract_id:this.status.join_contract_id,payment_date:this.zDateFormatter(this.contractPaymentDate)};return this.contractStatus.indexOf("-1")>=0&&this.contractStatus.splice(this.contractStatus.indexOf(-1),1),null!==this.contract.status_id&&Number(this.contract.status_id)<3?this.contractStatus.length>1?e.contract_status=String(this.contract.status_id)+","+this.contractStatus.join(","):1===this.contractStatus.length?e.contract_status=String(this.contract.status_id)+","+String(this.contractStatus):e.contract_status=String(this.contract.status_id):this.contractStatus.length>1?e.contract_status=this.contractStatus.join(","):1===this.contractStatus.length?e.contract_status=String(this.contractStatus):e.contract_status="",e.contract_status=this.thestatus_id,this.ajax({url:"/contract/renew_contract",method:"post",successTip:!0,data:{data:(0,s.default)(e)}})},getContracts:function(){var t=this;if(0!==this.inputContractName.trim().length)return this.fecthingContracts=!0,this.ajax({url:"/contract/getContractLists",params:{contract_name:this.inputContractName}}).then(function(e){t.fecthingContracts=!1,0===e.error_code&&(t.allContracts=e.data.lists)})},onContractSelect:function(t){t&&(this.status.join_contract_id=t.id)},onSoftAdStartDateChange:function(t){this.updateRMBInRow(t)},updateSoftAdDate:function(t,e){if(e){if(!t.dateStart)return!0;var a=new Date(t.dateStart);a.setDate(1),a.setMonth(t.dateStart.getMonth()+1),a=new Date(a.getTime()-864e5),t.dateMax=a}else{if(!t.dateEnd)return!0;var n=new Date(t.dateEnd);n.setDate(1),n.setMonth(t.dateEnd.getMonth()),t.dateMin=n}},onCurrencySelected:function(t){var e=this;this.updateDefaultCurrencyRate(),0===t?(this.contract.details.forEach(function(t){t.currency_amount=0}),this.contract.splits.forEach(function(t){t.currency_amount=0})):(this.contract.details.forEach(function(t){e.updateRMBInRow(t)}),this.contract.splits.forEach(function(t){e.updateRMBInRow(t)}))},updateDefaultCurrencyRate:function(){var t=this;this.currencyToRMB(1,this.contract.contract_currency_type_id,this.zDateFormatter(new Date)).then(function(e){t.defaultCurrencyRate=e.rate})},deleteRevise:function(t,e){var a=this;this.$dialog.confirm({message:"确定删除该修订值吗？",onConfirm:function(){if(t.id)return a.ajax({url:"/ad_schedule_revise/delete_revise",method:"post",data:{revise_id:t.id}}).then(function(t){0===t.error_code&&a.reviseData.splice(e,1)});a.reviseData.splice(e,1)}})},addRevise:function(){var t=new Date;this.reviseData.push({isEdit:!0,reviseDate:t,revise_date:t,price:0,is_update:1,isDelete:!0})},getRevise:function(){var t=this;return this.ajax({url:"/ad_schedule_revise/get_revise_lists",loading:this.$loading.open(),params:{contract_id:this.id}}).then(function(e){if(0===e.error_code&&e.data.lists&&e.data.lists.length){e.data.lists.forEach(function(e){return e.isEdit=!1,e.reviseDate=new Date(e.revise_date),e.isDelete=t.checkReviseDate(new Date,e.reviseDate),t.reviseData.push(e),e})}})},checkReviseDate:function(t,e){var a=t.getMonth()+1,n=t.getFullYear();return e.getFullYear()>n||e.getMonth()+1>=a},saveRevise:function(t,e){var a=this;if(!this.$refs.revisePrice.checkHtml5Validity())return void this.$refs.revisePrice.focus();if(!this.checkReviseDate(new Date,new Date(t.reviseDate)))return this.$dialog.alert("请选择当月及当月后的日期。"),!1;var n="/ad_schedule_revise/add_revise",i={price:t.price,revise_date:this.zDateFormatter(new Date(t.reviseDate))};return t.id?(n="/ad_schedule_revise/update_revise",i.revise_id=t.id):i.contract_id=this.id,this.ajax({url:n,method:"post",successTip:!0,loading:this.$loading.open(),data:i}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.id||(t.id=e.data.insert_id),t.revise_date=a.zDateFormatter(t.reviseDate))})},showReviseLog:function(t){var e=this;return this.reivseLogs=[],this.reviseLogActive=!0,this.ajax({loading:this.$loading.open(),url:"/ad_schedule_revise/get_revise_log",method:"post",data:{revise_id:t.id}}).then(function(t){0===t.error_code&&(e.reivseLogs=t.data)})},clearDate:function(t){t.dateStart=null,t.dateEnd=null,t.dateMin=null,t.dateMax=null},selectStatus:function(){this.contract.status_id=this.thestatus_id},onQrRateChange:function(t){var e=this;this.contract.qrfd_date_time=this.zDateFormatter(new Date),this.contract.cash_collections.forEach(function(t){e.updatePaymentRebateAmount(t)})},onYgRateChange:function(t){var e=this;this.contract.ygfd_date_time=this.zDateFormatter(new Date),this.contract.cash_collections.forEach(function(t){e.updatePaymentRebateAmount(t)})},routePush:function(t){this.$router.push("/contracts/"+t),window.location.reload()},getCooperationList:function(){var t=this;return this.ajax({url:"/contract_amount_detail_cooperation/get_cooperation_lists"}).then(function(e){0===e.error_code&&(console.log("合作方式"),t.cooperationList=e.data,t.cooperationList.filter(function(e){1===e.cooperation_type?t.COOPWAYS=e.level:2===e.cooperation_type&&(t.SOFTWAYS=e.level)}))})},hardAdsDisabledRows:function(t){return t.is_changeDate}}}},"3o4n":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),s=n(i),r=a("7bRm"),o=n(r),c=function t(e,a){var n=a||0,i=!0,r=!1,o=void 0;try{for(var c,l=(0,s.default)(e);!(i=(c=l.next()).done);i=!0){var d=c.value;d.isEdit=!1,d.expanded=!1,d.level=n++,d.child?d.child=t(d.child,n):d.child=[]}}catch(t){r=!0,o=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw o}}return e};e.default={data:function(){return{organization:[]}},created:function(){this.getOrganization()},components:{MenuList:o.default},methods:{getOrganization:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/business/index"}).then(function(e){if(0===e.error_code){var a=c(e.data);console.log(a),t.organization=a}})}}}},"3p8q":function(t,e,a){a("urYB");var n=a("VU/8")(a("QR/r"),a("ECzC"),null,null);t.exports=n.exports},"3pWD":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("O4Lo"),s=n(i),r=a("LZT1"),o=n(r),c="/contract_cash_collection_pool_detail/pass";e.default={data:function(){return{departmentId:null,departments:[],defaultResponsible:"",responsibleArray:[],partyAs:[],partyA:"",signingCompanys:[],signingCompany:"",signingCompanySelected:null,fetchingPartyAs:!1,data:[],defaultStatus:null,isStatus:[{name:"",id:4},{name:"待确认",id:1},{name:"已驳回",id:2},{name:"已确认",id:3}],number:"",isFetching_2:!1,isFetching_3:!1,contractsNumber:"",contractNumberList:[],contractsName:"",contractNames:[],total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,checkedRows:[],forSearch:!0}},watch:{departmentId:function(t){t&&this.getResponsibleArray(t)},currPage:function(t){this.questFn(t)}},computed:{filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})}},created:function(){this.getDepartments(),this.getSigningCompanys(),this.questFn();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},methods:{getDepartments:function(){var t=this;return this.ajax({url:"/department/index"}).then(function(e){var a=(0,o.default)(e.data);t.departments=a})},getResponsibleArray:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id",method:"post",data:{department_id:t}}).then(function(t){0===t.error_code&&t.data&&t.data.rows?(e.responsibleArray=t.data.rows,e.responsibleArray.unshift({id:"",name:""})):e.responsibleArray=[]})},getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{no_limit:1}}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},onSelectedCompany:function(t){t&&(this.signingCompanySelected=t.id,this.signingCompany=t.company_name)},searchContractList:(0,s.default)(function(){this.isFetching_3=!0,this.getContractList()},500),getContractList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},searchContract:(0,s.default)(function(){this.isFetching_2=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractsName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},handleOption:function(t){return null!==t&&""!==t&&"undefined"!==t},questFn:function(t){var e=this;Number(t)||(t=1);var a={loading:this.$loading.open(),url:"/contract_cash_collection_pool_detail/contract_cash_collection_pool_approve_list",params:{page:t,pagesize:this.perPage,status_id:this.defaultStatus}},n=this.handleOption;4!==this.defaultStatus?a.params.status_id=this.defaultStatus:a.params.status_id=null,this.number&&(a.params.transaction_number=this.number),this.contractsNumber&&(a.params.contract_number=this.contractsNumber),this.contractsName&&(a.params.contract_name=this.contractsName),this.departmentId&&(a.params.department_id=this.departmentId),this.defaultResponsible&&(a.params.contract_user_id=this.defaultResponsible),n(this.signingCompany)&&(a.params.company_name=this.signingCompany),this.ajax(a).then(function(t){if(0===t.error_code){var a=t.data.lists;e.total=t.data.counts.count||0,e.totalPage=Math.ceil(t.data.counts.count/e.perPage),0===e.totalPage&&(e.totalPage=1);for(var n=0;n<a.length;n++){switch(a[n].use_amount=e.toDecimalTwo(a[n].use_amount),a[n].currency_id){case 0:a[n].currency_id="人民币";break;case 1:a[n].currency_id="美元";break;case 2:a[n].currency_id="日元";break;case 3:a[n].currency_id="欧元";break;case 4:a[n].currency_id="英镑";break;case 5:a[n].currency_id="韩元";break;case 6:a[n].currency_id="加拿大元";break;case 7:a[n].currency_id="澳元"}1===a[n].is_deduct_money?a[n].is_deduct_money="是":a[n].is_deduct_money="否"}e.data=a}})},onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},toDecimalTwo:function(t){var e=parseFloat(t);if(isNaN(e))return!1;e=Math.round(100*t)/100;var a=e.toString(),n=a.indexOf(".");for(n<0&&(n=a.length,a+=".");a.length<=n+2;)a+="0";return a},pageHandle:function(t){this.currPage=t},determine:function(t){var e=this;this.$dialog.confirm({message:"您确定要把此条信息通过审核吗？",onConfirm:function(){e.ajax({loading:e.$loading.open(),method:"post",url:c,data:{id:t.id},successTip:!0}).then(function(e){t.detail_status_text="已确认"})}})},reject:function(t){var e=this;this.$dialog.confirm({message:"您确定要驳回此条信息吗？",onConfirm:function(){e.ajax({loading:e.$loading.open(),method:"post",url:"/contract_cash_collection_pool_detail/reject",data:{id:t.id},successTip:!0}).then(function(e){t.detail_status_text="已驳回"})}})},allHandle:function(){for(var t=this,e=[],a=0;a<this.checkedRows.length;a++)!function(a){for(var n=0;n<t.data.length;n++)a!==t.data[n].id||!t.hasPermission("crm_new.finance.shenhe.queren")||1!==t.data[n].detail_status_id&&2!==t.data[n].detail_status_id||e.push(a)}(this.checkedRows[a].id);this.$dialog.confirm({message:"您确定要进行批量审核吗？",onConfirm:function(){t.ajax({loading:t.$loading.open(),method:"post",url:c,data:{id:e.join(",")},successTip:!0}).then(function(a){for(var n=0;n<t.cacheArray.length;n++)for(var i=0;i<t.data.length;i++)e[n]===t.data[i].id&&(t.data[i].detail_status_text="已确认")})}})}}}},"4xX0":function(t,e,a){a("b1KQ"),a("j6H9");var n=a("VU/8")(a("xeBw"),a("gKdn"),"data-v-40049d96",null);t.exports=n.exports},"55sc":function(t,e,a){a("Xbi+"),a("Yp9P");var n=a("VU/8")(a("f6+o"),a("1/F9"),"data-v-24a7a5f5",null);t.exports=n.exports},"5FYy":function(t,e,a){a("t+9J");var n=a("VU/8")(a("SgY0"),a("ZggN"),"data-v-447efb38",null);t.exports=n.exports},"5all":function(t,e){},"5tWb":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("O4Lo"),i=function(t){return t&&t.__esModule?t:{default:t}}(n),s=["人民币","美元","日元","欧元","英镑","韩国元","加拿大元","澳元"],r=["user_id","company","file_url"],o=["currencyId","file_url"],c={spyj:"审批邮件"};e.default={props:["id","isEdit"],data:function(){return{fetchingUsers:!1,contractUsers:[],isCharge:Number(this.$route.query.isCharge)||0,isCurrency:Number(this.$route.query.isCurrency?this.$route.query.isCurrency:0)||0,contract_currency_type_id:this.$route.query.contract_currency_type_id,contract_currency_type_name:this.$route.query.contract_currency_type_name,new_contract_currency_type_name:null,currency_id:null,old_charge_name:this.$route.query.charge_name||"",new_charge_name:"",userId:this.$route.query.userId||"",isFetching2:!1,contract_type_id:this.$route.query.contract_type_id||0,contract_type_name:"",contract_id:this.$route.query.id,contract_company_id:this.$route.query.contract_company_id||1,is_reset:0,change_type_name:"",contract_number:this.id,one_id:parseInt(this.$route.query.one_id)||null,one_des:this.$route.query.one_des||"",two_id:null,two_des:this.$route.query.two_des||"",old_id:null,old_description:null,new_id:null,new_description:null,old_part_b:null,new_part_b:null,spyjFiles:[],file_url:"",msg:"",status:"",companyList:[],change_id:parseInt(this.$route.query.change_id)||0,oneList:["","北京值得买科技股份有限公司","北京值得买科技股份有限公司上海分公司","北京值得买科技股份有限公司青岛分公司","青岛无忧直购网络科技有限公司","青岛星罗创想网络科技有限公司","青岛优讯创想信息技术有限公司"],CURRENCIES:s}},mounted:function(){this.isEdit?this.isCharge?3===Number(this.contract_company_id)?(this.old_description=this.old_charge_name,this.old_id=this.userId):(this.old_description=new Date(this.$route.query.startDate),this.old_part_b=new Date(this.$route.query.endDate),this.new_description=null):this.old_description=this.one_des:this.getChange()},methods:{getUsers:(0,i.default)(function(){var t=this;this.contractUsers=[],this.fetchingUsers=!0,this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{name:this.new_charge_name.trim(),role_code:"role-crm-shangwu"}}).then(function(e){t.fetchingUsers=!1,0===e.error_code&&(t.contractUsers=e.data.rows||[])})},500),onUserSelect:function(t){t&&(this.new_description=t.name,this.new_id=t.id)},getChange:function(){var t=this;return this.ajax({url:"/contract_change/get_contract_change_by_id",params:{change_id:this.change_id}}).then(function(e){t.contract_company_id=e.data.change_type,t.change_type_name=e.data.change_type_name,t.old_description=4===e.data.change_type?new Date(e.data.old_description):e.data.old_description,t.new_description=4===e.data.change_type?new Date(e.data.new_description):e.data.new_description,t.old_part_b=4===e.data.change_type?new Date(e.data.old_part_b):e.data.old_part_b,t.new_part_b=4===e.data.change_type?new Date(e.data.new_part_b):e.data.new_part_b,t.file_url=e.data.approved_file,t.contract_type_name=e.data.contract_type_name,t.is_reset=e.data.is_reset||0,console.log(e.old_description),t.contract_currency_type_name=e.data.old_description,t.new_contract_currency_type_name=e.data.new_description})},changeCompany:function(){1===Number(this.contract_company_id)?(this.old_id=this.one_id,this.old_description=this.one_des):(this.old_description=this.two_des,this.companyList=this.oneList)},getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{approve_status_id:2,like_company_name:this.new_description}}).then(function(e){t.companyList=e.data.lists,t.isFetching2=!1})},onCompanySelected:function(t){t&&(this.new_id=t.id)},searchCompany:(0,i.default)(function(){this.isFetching2=!0,this.getCompanies()},500),fileUpload:function(t){var e=this,a=this.$data[t+"Files"];if(0!==a.length){var n=a,i=c[t];if(n.size>52428800)return this.status="is-danger",this.msg="上传【"+i+"】附件大小不能超过50M",void this.$dialog.alert(this.msg);this.status="",this.msg="",this.ajax({url:"/tools/file_upload",method:"post",data:{file_type:n.name.match(/\.([^.]+)$/)[1],file_name:n}}).then(function(t){e.$toast.open({duration:5e3,message:"上传【"+i+"】附件成功",position:"is-top",type:"is-success"}),e.file_url=t.data.file_name})}},contractDataValidate:function(t){var e=this,a=[];return t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(n.checkHtml5Validity()||a.push(n))}),!a.length||(a[0].focus(),!1)},saveCurrency:function(t){var e=this,a=o;if(this.contractDataValidate(a)){var n={},i=this.$loading.open();n={contract_id:this.contract_id,change_type:this.contract_company_id,old_id:this.contract_currency_type_id,old_description:this.contract_currency_type_name,new_id:this.currency_id,new_description:this.CURRENCIES[this.currency_id],approved_file:this.file_url,is_save:t,is_reset:this.is_reset},this.ajax({method:"post",loading:this.$loading.open(),url:"/contract_change/add_contract_change",data:n,successTip:!0}).then(function(t){i.close(),0===t.error_code?e.$router.push("/contracts/"+e.contract_id+"?isRe=true"):e.$dialog.alert(t.error_msg)})}},saveContract:function(t){var e=this,a=r;if(this.contractDataValidate(a)){if(!(this.new_description&&this.new_part_b||4!==Number(this.contract_company_id))){var n=[];return["startDate","endDate"].forEach(function(t){var a=e.$refs[t];n.push(a)}),!n.length||(n[0].focus(),!1)}var i={},s=this.$loading.open();i={contract_id:this.contract_id,change_type:this.contract_company_id,old_id:this.old_id,old_description:4===Number(this.contract_company_id)?this.zDateFormatter(this.old_description):this.old_description,new_id:this.new_id,new_description:4===Number(this.contract_company_id)?this.zDateFormatter(this.new_description):this.new_description,old_part_b:4===Number(this.contract_company_id)?this.zDateFormatter(this.old_part_b):this.old_part_b,new_part_b:4===Number(this.contract_company_id)?this.zDateFormatter(this.new_part_b):this.new_part_b,approved_file:this.file_url,is_save:t,is_reset:this.is_reset},this.ajax({method:"post",loading:this.$loading.open(),url:"/contract_change/add_contract_change",data:i,successTip:!0}).then(function(t){s.close(),0===t.error_code?e.$router.push("/contracts/"+e.contract_id+"?isRe=true"):e.$dialog.alert(t.error_msg)})}}}}},"6+g0":function(t,e){},"661+":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("fZjL"),s=n(i),r=a("LZT1"),o=n(r),c={0:"单笔",1:"CPS",2:"赠版",3:"年框",4:"CPS对账单",5:"平台服务费",6:"CPS预估",7:"CPS实际发生额",8:"资源置换",9:"阿里微任务"};e.default={props:{page:{type:Number,default:null}},data:function(){return{getapproval:!1,contractTypeId:0,caiwuList:[],shangwuList:[],fawuList:[],Approval:{},formattedData:{},CONTRACT_TYPES:c,department:"",departmentParts:[],departmentList:{},depart_length:0,addLine:0,departments:[],department_id:""}},computed:{approveStatusName:function(){return c[this.contractTypeId]},currentData:function(){if(this.addLine=0,this.departmentList[this.contractTypeId]){var t=(0,s.default)(this.departmentList[this.contractTypeId]);this.departmentParts=this.departmentList[this.contractTypeId],this.department=t,this.depart_length=t.length}return this.formattedData[this.contractTypeId]||[]}},watch:{contractTypeId:function(t){}},mounted:function(){this.getApproval(),this.getCodeList({is_delete:0,role_code:this.ROLE.shangwushenhe}),this.getCodeList({is_delete:0,role_code:this.ROLE.caiwushenhe}),this.getCodeList({is_delete:0,role_code:this.ROLE.fawushenhe}),this.getDepartment()},methods:{formatServerData:function(t){var e={},a={};for(var n in t){var i=n.split("_")[2],s=n.split("_")[1],r=n.split("_")[3];a[i]=a[i]||[],a[i][s]=r,e[i]=e[i]||[],e[i][s]=t[n]}return this.departmentList=a,console.log(this.department,111),console.log(this.departmentList,222),e},getApproval:function(){var t=this;this.ajax({method:"get",url:"/contract_approval_rule/get_list",params:{}}).then(function(e){t.formattedData=t.formatServerData(e.data),t.getapproval=!0})},checkDelete:function(t,e){var a=this;this.$dialog.confirm({message:"确定删除审核流程吗？",cancelText:"取消",confirmText:"确认",onConfirm:function(){return a.deleteApproval(t,e)}})},deleteApproval:function(t,e){var a={biz_type_id:e,contract_type_id:this.contractTypeId};return this.ajax({successTip:!0,loading:this.$loading.open(),method:"post",url:"/contract_approval_rule/delete",data:a}).then(function(t){console.log(t),0===t.error_code&&window.location.reload()})},updateApproval:function(t,e,a){console.log(t,e);var n={};n="-1"===this.departmentList[this.contractTypeId][e]?{biz_type_id:this.department_id}:{target_biz_type_id:a.biz_type_id||e,biz_type_id:e},n.contract_type_id=this.contractTypeId,n.law_user_id=t[0].law_user_id,n.finance_user_id=t[0].finance_user_id;for(var i in t)n["business_start_amount_level"+(Number(i)+1)]=t[i].start_amount,n["business_end_amount_level"+(Number(i)+1)]=t[i].end_amount,n["business_user_id_level"+(Number(i)+1)]=t[i].user_id;var s="-1"===this.departmentList[this.contractTypeId][e]?"/contract_approval_rule/insert":"/contract_approval_rule/update";return console.log(n),this.ajax({successTip:!0,loading:this.$loading.open(),method:"post",url:s,data:n}).then(function(t){console.log(t),0===t.error_code&&window.location.reload()})},getCodeList:function(t){var e=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:t}).then(function(a){t.role_code===e.ROLE.shangwushenhe?e.shangwuList=a.data.rows:t.role_code===e.ROLE.caiwushenhe?e.caiwuList=a.data.rows:t.role_code===e.ROLE.fawushenhe&&(e.fawuList=a.data.rows)})},addLineFn:function(){this.addLine=this.addLine+1,console.log(this.addLine);var t=[{biz_type_id:0,contract_type_id:0,end_amount:"0.00",finance_user_id:0,id:0,law_user_id:0,role_id:1,start_amount:"0.00",user_id:0},{biz_type_id:0,contract_type_id:0,end_amount:"0.00",finance_user_id:0,id:0,law_user_id:0,role_id:1,start_amount:"0.00",user_id:0},{biz_type_id:0,contract_type_id:0,end_amount:"0.00",finance_user_id:0,id:0,law_user_id:0,role_id:1,start_amount:"0.00",user_id:0},{biz_type_id:0,contract_type_id:0,end_amount:"0.00",finance_user_id:0,id:0,law_user_id:0,role_id:1,start_amount:"0.00",user_id:0}];this.currentData.length>0?this.departmentList[this.contractTypeId][this.currentData.length]="-1":(this.departmentList[this.contractTypeId]=[],this.departmentList[this.contractTypeId][0]="-1");var e=(0,s.default)(this.departmentList[this.contractTypeId]);this.department=e,this.depart_length=e.length,this.$forceUpdate(),this.currentData.push(t)},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/get_children_by_pid"}).then(function(e){if(0===e.error_code){var a=(0,o.default)(e.data);t.departments=a;var n={id:"",name:""};t.departments.unshift(n)}})}}}},"6c6T":function(t,e,a){a("72VN");var n=a("VU/8")(a("8GhA"),a("cPuc"),null,null);t.exports=n.exports},"6csG":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-field",{attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"时间分类依据",horizontal:t.isCheck}},[a("b-select",{model:{value:t.search_time_by,callback:function(e){t.search_time_by=e},expression:"search_time_by"}},[a("option",{attrs:{value:"year"}},[t._v("按年查询")]),t._v(" "),t.isCheck?a("option",{attrs:{value:"quarter"}},[t._v("按季度查询")]):t._e(),t._v(" "),a("option",{attrs:{value:"month"}},[t._v("按月查询")]),t._v(" "),t.isCheck?t._e():a("option",{attrs:{value:"day"}},[t._v("按日查询")])])],1),t._v(" "),a("b-field",{attrs:{label:t.title||"合同明细起止时间",horizontal:t.isCheck}},["day"===t.search_time_by?a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.end_time,placeholder:"开始时间"},model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.start_time=new Date}}},[a("b-icon",{attrs:{icon:"calendar-today"}}),t._v(" "),a("span",[t._v("Today")])],1),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(e){t.start_time=null}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("Clear")])],1)]),t._v("\n            -\n            "),a("b-datepicker",{attrs:{"min-date":t.start_time,placeholder:"结束时间"},model:{value:t.end_time,callback:function(e){t.end_time=e},expression:"end_time"}},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.end_time=new Date}}},[a("b-icon",{attrs:{icon:"calendar-today"}}),t._v(" "),a("span",[t._v("Today")])],1),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(e){t.end_time=null}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("Clear")])],1)])],1):"month"===t.search_time_by?a("div",{staticClass:"z-datepickers"},[a("b-select",{staticClass:"datepicker",model:{value:t.start_year,callback:function(e){t.start_year=e},expression:"start_year"}},t._l(20,function(e){return a("option",{domProps:{value:e+t.defaultYear}},[t._v(t._s(e+t.defaultYear))])})),t._v("\n            年\n            "),t.start_year?a("b-select",{staticClass:"datepicker",model:{value:t.start_month,callback:function(e){t.start_month=e},expression:"start_month"}},t._l(12,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])})):t._e(),t._v("月\n            -\n            "),a("b-select",{staticClass:"datepicker",model:{value:t.end_year,callback:function(e){t.end_year=e},expression:"end_year"}},t._l(20,function(e){return a("option",{domProps:{value:e+t.defaultYear}},[t._v(t._s(e+t.defaultYear))])})),t._v("\n            年\n            "),t.end_year?a("b-select",{staticClass:"datepicker",model:{value:t.end_month,callback:function(e){t.end_month=e},expression:"end_month"}},t._l(12,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])})):t._e(),t._v("月\n        ")],1):"year"===t.search_time_by?a("div",{staticClass:"z-datepickers"},[a("b-select",{staticClass:"datepicker",model:{value:t.start_time,callback:function(e){t.start_time=e},expression:"start_time"}},t._l(15,function(e){return a("option",{domProps:{value:e+t.defaultYear}},[t._v(t._s(e+t.defaultYear))])})),t._v("\n            年\n            -\n            "),a("b-select",{staticClass:"datepicker",model:{value:t.end_time,callback:function(e){t.end_time=e},expression:"end_time"}},t._l(15,function(e){return a("option",{domProps:{value:e+t.defaultYear}},[t._v(t._s(e+t.defaultYear))])})),t._v("\n            年\n        ")],1):a("div",{staticClass:"z-datepickers"},[a("b-select",{staticClass:"datepicker",model:{value:t.start_year,callback:function(e){t.start_year=e},expression:"start_year"}},t._l(15,function(e){return a("option",{domProps:{value:e+t.defaultYear}},[t._v(t._s(e+t.defaultYear))])})),t._v("\n            年\n            "),t.start_year?a("b-select",{staticClass:"datepicker",model:{value:t.start_quarter,callback:function(e){t.start_quarter=e},expression:"start_quarter"}},t._l(4,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])})):t._e(),t._v("季度\n            -\n            "),a("b-select",{staticClass:"datepicker",model:{value:t.end_year,callback:function(e){t.end_year=e},expression:"end_year"}},t._l(15,function(e){return a("option",{domProps:{value:e+t.defaultYear}},[t._v(t._s(e+t.defaultYear))])})),t._v("\n            年\n            "),t.end_year?a("b-select",{staticClass:"datepicker",model:{value:t.end_quarter,callback:function(e){t.end_quarter=e},expression:"end_quarter"}},t._l(4,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])})):t._e(),t._v("季度\n        ")],1)])],1)},staticRenderFns:[]}},"72VN":function(t,e){},"7SBc":function(t,e){},"7bRm":function(t,e,a){a("S9Dq");var n=a("VU/8")(a("m+Od"),a("WK/Q"),null,null);t.exports=n.exports},"7hJO":function(t,e){},"7teg":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=n(i),r=a("lHA8"),o=n(r),c=a("Gu7T"),l=n(c),d=a("fZjL"),u=n(d),_=a("mvHQ"),p=n(_),m=a("Dd8w"),h=n(m),f=a("RRo+"),v=n(f),b=a("Xxa5"),g=n(b),y=a("exGp"),C=n(y),k=a("AwEB"),w=a("kZBa"),x=a("jELS"),P=["","进行中","已完成","暂停"].map(function(t,e){return{id:e,name:t}});e.default={data:function(){return{showModal:!1,cooperationObj:{},id:"",RUNSTATUS:P,mapping:{user_id:"",manager_id:"",client_id:""},saveDateRange:{start_date:null,end_date:null},form:{user_id:"",manager_id:"",name:"",client_id:"",platform_id:[],order_date:null,start_date:null,end_date:null,run_status:"",remark:"",problem:""},detailList:[],total_amount:0,business_id:"",platfromList:[],client_type:"",clientList:[],clientName:"",codeList:[],charge_userName:"",contractDirector:[],businessList:[],delete_ids:[],contract_number:"",contract_id:"",isAssociate:!1,contractList:[],selectable:[]}},computed:{CLIENT_TYPES_OBJECT:function(){return(0,x.toggleArrToObj)(this.CLIENT_TYPES,"id","name")},orderListFilter:function(){var t=this.mapping.cooperation_id;return this.orderList.filter(function(e){return!!e.val.match(t)})},filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.mapping.user_id.toLowerCase())>=0})},filterPlatform:function(){var t=this,e=this.platfromList.filter(function(e){return t.form.platform_id.indexOf(e.id)>=0}),a=[];return e.map(function(t){a.push(t.value)}),e.length>3?a.slice(0,3).join("，")+"等":a.join("，")}},created:function(){var t=this.$route.query.id;t&&(this.id=t,this.getProjectOrder()),this.getClientList(),this.postCodeList(),this.postDirectorList(),this.getPlatfromList(),this.getOrderList(),this.getContractLists(),this.getBusinessLastLeve()},methods:{getContractDetailMonth:function(){var t=this;return(0,C.default)(g.default.mark(function e(){var a;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.contract_id){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,(0,w.getContractDetailMonth)({id:a});case 5:t.selectable=e.sent;case 6:case"end":return e.stop()}},e,t)}))()},checkPlatform:function(){this.showModal=!0},getDeleteProjectOrder:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isAssociate){e.next=2;break}return e.abrupt("return",t.$toast.error("请先取消关联关系再删除工单"));case 2:t.$dialog.confirm({message:"是否删除该该工单？",cancelText:"否",confirmText:"是",onConfirm:function(){var e=(0,C.default)(g.default.mark(function e(){var a;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getDeleteProjectOrder)({id:t.id});case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.$router.push("/workOrder");case 6:case"end":return e.stop()}},e,t)}));return function(){return e.apply(this,arguments)}}()});case 3:case"end":return e.stop()}},e,t)}))()},changeEdit:function(){this.detailList.forEach(function(t){return t.edit=!0})},checkSaveProjectOrder:function(){var t=this;this.contract_id&&this.isAssociate?this.$dialog.confirm({message:"更新会重置合同业绩信息和审核状态，是否继续？",cancelText:"否",confirmText:"是",onConfirm:function(){return t.postSaveProjectOrder()}}):this.postSaveProjectOrder()},postSaveProjectOrder:function(){var t=this;return(0,C.default)(g.default.mark(function e(){var a,n,i,s,r,o,c,l,d,u,_,m,f,b,y,C,x;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.detailList,n=[],i=[],s=t.$toast.error,r=0,o=a.length;case 5:if(!(r<o)){e.next=24;break}if(c=a[r].editData,l=c.business_id,d=c.cooperation_id,u=c.count,_=c.amount,m=c.run_date,f=c.confirm_month,b=c.id,!t.isAssociate||!t.contract_id||c.confirm_month){e.next=10;break}return e.abrupt("return",s("您仍有未填写的发布额，请完成后再保存"));case 10:if(l&&d&&(u||0===u)&&_&&m){e.next=12;break}return e.abrupt("return",s("您仍有未填写的下单内容，请完成后再保存"));case 12:if((0,v.default)(parseFloat(u))&&!(parseFloat(u)<0)){e.next=14;break}return e.abrupt("return",s("数量填写有误，请填写不为零的整数"));case 14:if(_||0===_){e.next=16;break}return e.abrupt("return",s("金额填写有误，请填写大于零的数字"));case 16:if(y=+new Date(m),!(t.saveDateRange.start_date>y||t.saveDateRange.end_date<y)){e.next=19;break}return e.abrupt("return",s("执行时间需在起止时间内"));case 19:C={business_id:l,cooperation_id:d,count:u,amount:_,run_date:(0,k.changeMonth)(m,!0),confirm_month:(0,k.changeMonth)(f)},b?i.push((0,h.default)({},C,{id:b})):n.push(C);case 21:r++,e.next=5;break;case 24:return e.next=26,(0,w.postSaveProjectOrder)({create_detail_list:n.length?(0,p.default)(n):"",update_detail_list:i.length?(0,p.default)(i):"",delete_ids:t.delete_ids.join(","),project_order_id:t.id});case 26:if(x=e.sent){e.next=29;break}return e.abrupt("return");case 29:t.$toast.success("保存成功"),t.delete_ids=[],t.getProjectOrder();case 32:case"end":return e.stop()}},e,t)}))()},postAssociateContract:function(){var t=this;return(0,C.default)(g.default.mark(function e(){var a;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.contract_id){e.next=2;break}return e.abrupt("return",t.$toast.error("请选择合同"));case 2:return e.next=4,(0,w.postAssociateContract)({contract_id:t.contract_id,project_order_id:t.id});case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return");case 7:t.isAssociate=!0,t.getContractDetailMonth(),t.$toast.success("您已成功关联合同，并自动保存。");case 10:case"end":return e.stop()}},e,t)}))()},postUnAssociateContract:function(){var t=this;return(0,C.default)(g.default.mark(function e(){var a;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.postUnAssociateContract)({contract_id:t.contract_id,project_order_id:t.id});case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.isAssociate=!1,t.contract_id=0,t.contract_number="",t.detailList.forEach(function(t){return t.editData.confirm_month=null}),t.$toast.success("取消关联成功");case 10:case"end":return e.stop()}},e,t)}))()},checkUnAssociateContract:function(){var t=this;this.$dialog.confirm({message:"取消关联会重置合同业绩信息和审核状态，是否继续？",cancelText:"否",confirmText:"是",onConfirm:function(){return t.postUnAssociateContract()}})},selectContract:function(t){t&&(this.contract_id=t.id,this.isAssociate=!1)},getContractLists:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getContractLists)({contract_number:t.contract_number});case 2:t.contractList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},deleteData:function(t,e){var a=this;return(0,C.default)(g.default.mark(function n(){return g.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.id&&a.delete_ids.push(t.id),a.detailList.splice(e,1);case 2:case"end":return n.stop()}},n,a)}))()},changeBusiness:function(t){(0,u.default)(this.cooperationObj).includes(t.toString())||this.postInfoByBusinessId(t)},getBusinessLastLeve:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getBusinessLastLeve)();case 2:t.businessList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},addDetailData:function(){var t={amount:"0",business_id:"",business_name:"",confirm_month:null,cooperation_id:"",cooperation_name:"",count:0,run_date:null};this.detailList.push((0,h.default)({},t,{edit:!1,editData:t}))},postInfoByBusinessId:function(t){var e=this;return(0,C.default)(g.default.mark(function a(){return g.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,w.postInfoByBusinessId)({business_id:t});case 2:e.cooperationObj[t]=a.sent,e.$forceUpdate();case 4:case"end":return a.stop()}},a,e)}))()},getOrderList:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getOrderList)();case 2:t.orderList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},getProjectOrder:function(){var t=this;return(0,C.default)(g.default.mark(function e(){var a,n,i;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getProjectOrder)({id:t.id});case 2:return a=e.sent,t.form.client_id=a.client_id,t.mapping.client_id=a.client_name,t.client_type=a.client_type,t.form.platform_id=a.platform_id.toString().split(","),t.form.order_date=new Date(a.order_date),t.form.start_date=new Date(a.start_date),t.form.end_date=new Date(a.end_date),t.saveDateRange.start_date=+new Date(a.start_date),t.saveDateRange.end_date=+new Date(a.end_date),t.form.manager_id=a.manager_id,t.mapping.manager_id=a.manager_name,t.form.name=a.name,t.form.problem=a.problem,t.form.remark=a.remark,t.form.user_id=a.user_id,t.mapping.user_id=a.user_name,t.form.run_status=a.run_status,t.total_amount=a.total_amount,t.contract_number=a.contract_number,t.contract_id=a.contract_id,t.isAssociate=!!a.contract_id||!1,t.detailList=a.detail,n=a.detail.map(function(t){return t.editData.business_id}),i=[].concat((0,l.default)(new o.default(n))),t.getContractDetailMonth(),e.next=30,s.default.all(i.map(function(e){return t.postInfoByBusinessId(e)}));case 30:case"end":return e.stop()}},e,t)}))()},saveData:function(){var t=this;return(0,C.default)(g.default.mark(function e(){var a,n,i,s,r,o,c;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.form,n=t.$toast.error,a.user_id){e.next=4;break}return e.abrupt("return",n("请选择商务名称"));case 4:if(a.manager_id){e.next=6;break}return e.abrupt("return",n("请选择项目经理"));case 6:if(a.name){e.next=8;break}return e.abrupt("return",n("请填写项目名称"));case 8:if(a.client_id){e.next=10;break}return e.abrupt("return",n("请选择客户名称"));case 10:if(a.order_date){e.next=12;break}return e.abrupt("return",n("请选择下单时间"));case 12:if(a.start_date&&a.end_date){e.next=14;break}return e.abrupt("return",n("请选择起止时间"));case 14:if(a.run_status){e.next=16;break}return e.abrupt("return",n("请选择执行状态"));case 16:if(i=(0,k.changeMonth)(a.order_date,!0),s=(0,k.changeMonth)(a.start_date,!0),r=(0,k.changeMonth)(a.end_date,!0),a.platform_id=a.platform_id.join(","),o=(0,h.default)({},a,{order_date:i,start_date:s,end_date:r}),t.id){e.next=28;break}return e.next=24,(0,w.postAddProjectOrder)(o);case 24:return c=e.sent,c&&t.$router.push("/workOrder/detail?id="+c.status),window.location.reload(),e.abrupt("return");case 28:return e.next=30,(0,w.postUpdateProjectOrder)((0,h.default)({},o,{id:t.id}));case 30:t.delete_ids=[],t.$toast.success("保存成功"),t.getProjectOrder();case 33:case"end":return e.stop()}},e,t)}))()},changeMonth:k.changeMonth,autoSelect:function(t,e,a,n){t&&(this.form[e]=t,this.mapping[e]=a,"client_id"===e&&(this.client_type=n.client_type))},getPlatfromList:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getPlatfromList)();case 2:t.platfromList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},getClientList:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.getClientList)({keyword:t.mapping.client_id});case 2:t.clientList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},postCodeList:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.postCodeList)({name:t.mapping.manager_id});case 2:t.codeList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},postDirectorList:function(){var t=this;return(0,C.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.postDirectorList)();case 2:t.contractDirector=e.sent;case 3:case"end":return e.stop()}},e,t)}))()}}}},"7yFa":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"工单管理"}},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"商务名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filteredUser,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:function(e){return t.changeData(e,"user_id")},select:function(e){return t.autoSelect(e&&e.id,"user_id",e&&e.name)}},model:{value:t.mapping.user_id,callback:function(e){t.$set(t.mapping,"user_id",e)},expression:"mapping.user_id"}})],1),t._v(" "),a("b-field",{attrs:{label:"项目经理：",horizontal:""}},[a("b-autocomplete",{ref:"contractCharge",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:function(e){return t.changeData(e,"manager_id","postCodeList")},fouce:t.postCodeList,select:function(e){return t.autoSelect(e&&e.id,"manager_id",e&&e.name)}},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.mapping.charge_userName,callback:function(e){t.$set(t.mapping,"charge_userName",e)},expression:"mapping.charge_userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:function(e){return t.changeData(e,"client_id","getClientList")},focus:t.getClientList,select:function(e){return t.autoSelect(e&&e.id,"client_id",e&&e.name)}},model:{value:t.mapping.client_id,callback:function(e){t.$set(t.mapping,"client_id",e)},expression:"mapping.client_id"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户类型",horizontal:""}},[a("b-select",{model:{value:t.form.client_type,callback:function(e){t.$set(t.form,"client_type",e)},expression:"form.client_type"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"落地平台",horizontal:""}},[a("b-select",{model:{value:t.form.platform_id,callback:function(e){t.$set(t.form,"platform_id",e)},expression:"form.platform_id"}},t._l(t.platfromList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.value))])}))],1),t._v(" "),a("b-field",{attrs:{label:"执行事业部",horizontal:""}},[a("b-select",{model:{value:t.form.business_id,callback:function(e){t.$set(t.form,"business_id",e)},expression:"form.business_id"}},t._l(t.businessList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"项目名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.projectListData,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:function(e){return t.changeData(e,"name","postProjectListData")},focus:t.postProjectListData,select:function(e){return t.autoSelect(e&&e.name,"name",e&&e.name)}},model:{value:t.mapping.name,callback:function(e){t.$set(t.mapping,"name",e)},expression:"mapping.name"}})],1),t._v(" "),a("b-field",{attrs:{label:"下单内容",horizontal:""}},[a("div",{staticClass:"z-cooperation"},[a("b-autocomplete",{staticClass:"select-inline",attrs:{"keep-first":!1,"open-on-focus":!0,data:t.orderListFilter,field:"val"},on:{input:function(e){return t.changeData(e,"cooperation_id")},select:function(e){return t.autoSelect(e&&e.id,"cooperation_id",e&&e.val)}},model:{value:t.mapping.cooperation_id,callback:function(e){t.$set(t.mapping,"cooperation_id",e)},expression:"mapping.cooperation_id"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"执行状态",horizontal:""}},[a("b-select",{model:{value:t.form.run_status,callback:function(e){t.$set(t.form,"run_status",e)},expression:"form.run_status"}},t._l(t.STATUS,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.value))])}))],1),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"下单时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers w100 space"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.form.end_order_date},model:{value:t.form.start_order_date,callback:function(e){t.$set(t.form,"start_order_date",e)},expression:"form.start_order_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.form.start_order_date},model:{value:t.form.end_order_date,callback:function(e){t.$set(t.form,"end_order_date",e)},expression:"form.end_order_date"}})],1)]),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"起止时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers w100 space"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.form.end_date},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.form.start_date},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"内容执行时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers w100 space"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.form.end_run_date},model:{value:t.form.start_run_date,callback:function(e){t.$set(t.form,"start_run_date",e)},expression:"form.start_run_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.form.start_run_date},model:{value:t.form.end_run_date,callback:function(e){t.$set(t.form,"end_run_date",e)},expression:"form.end_run_date"}})],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[t.hasPermission("crm_new.yeji.gongdan.list")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.postProjectList(!0)}}},[t._v("查询")]):t._e(),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),t.hasPermission("crm_new.yeji.gongdan.export")?a("a",{staticClass:"button is-primary",on:{click:t.exportAll}},[t._v("导出")]):t._e(),t._v(" "),t.hasPermission("crm_new.yeji.gongdan.add")?a("a",{staticClass:"button is-primary right",on:{click:function(e){t.$router.push("/workOrder/detail")}}},[t._v("新增工单")]):t._e()])],1),t._v(" "),a("div",{staticClass:"amount z-block-content mt20"},[a("div",{staticClass:"mr10"},[t._v("合计工单金额："+t._s(t.amount.total_amount))]),t._v(" "),a("div",{staticClass:"mr10"},[t._v("工单数量："+t._s(t.pagination.total))]),t._v(" "),a("div",{staticClass:"mr10"},[t._v("合计执行金额："+t._s(t.amount.run_amount))]),t._v(" "),a("div",[t._v("执行数量："+t._s(t.amount.run_count))])]),t._v(" "),a("div",{staticClass:"z-block-content "},[a("b-table",{attrs:{data:t.projectList},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"商务名称",width:"50",field:"frame_number"}},[t._v("\n                        "+t._s(e.row.uname)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"项目经理",field:"frame_name"}},[t._v("\n                        "+t._s(e.row.mname)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"frame_leader"}},[t._v("\n                        "+t._s(e.row.client_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{width:"140",label:"落地平台"}},[t._v("\n                        "+t._s(e.row.platform_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"行业"}},[t._v("\n                        "+t._s(e.row.contract_brand_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"项目名称",width:"100"}},[t._v("\n                        "+t._s(e.row.name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"下单时间"}},[t._v("\n                        "+t._s(e.row.order_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"项目起止时间"}},[t._v("\n                        "+t._s(e.row.start_date)+"-"+t._s(e.row.end_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{width:"80",label:"执行总金额"}},[t._v("\n                        "+t._s(e.row.total_amount)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"下单内容"}},[a("div",{ref:e.row.id},[a("div",{class:[e.row.flag?"min-height":""]},t._l(e.row.detail,function(e,n){return a("div",{key:e.id},[t._v("\n                                \n                                    "+t._s(n+1+"、"+e.cooperation_name+"*"+e.count+": "+e.detail_amount)+"\n                                ")])})),t._v(" "),!0===e.row.flag?a("div",{staticClass:"extends",on:{click:function(a){t.toggle(e.row)}}},[t._v("展开")]):t._e(),t._v(" "),e.row.hide&&!1===e.row.flag?a("div",{staticClass:"extends",on:{click:function(a){t.hide(e.row)}}},[t._v("收起")]):t._e()])]),t._v(" "),a("b-table-column",{attrs:{label:"执行状态",width:"70"}},[t._v("\n                        "+t._s(t.STATUSFORM[e.row.run_status])+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"关联合同"}},[t._v("\n                        "+t._s(e.row.join_contract_number)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[t.hasPermission("crm_new.yeji.gongdan.update")?a("a",{staticClass:"button",on:{click:function(a){t.editData(e.row.id)}}},[t._v("编辑")]):t._e()])]}}])},[t.pagination.total>1*t.pagination.page_size?a("template",{slot:"footer"},[a("div",{staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.pagination.total,current:t.pagination.page,"per-page":t.pagination.page_size},on:{change:t.changePage,"update:current":function(e){t.$set(t.pagination,"page",e)}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:Math.ceil(t.pagination.total/t.pagination.page_size)},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.jumpToPage(e)}},model:{value:t.pagination.jumpPage,callback:function(e){t.$set(t.pagination,"jumpPage",e)},expression:"pagination.jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:t.jumpToPage}},[t._v("\n                                GO\n                            ")])],1)],1)]):t._e()],2)],1)])},staticRenderFns:[]}},"8AOX":function(t,e){},"8GhA":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("O4Lo"),s=n(i),r=a("LZT1"),o=n(r);e.default={props:{page:{type:Number,default:null}},data:function(){return{defaultSortDirection:"asc",contractName:"",departmentId:"",userId:"",userName:"",clientLists:[],clientName:"",clientListSelected:null,signingCompanys:[],signingCompany:"",signingCompanySelected:null,startDate:null,endDate:null,contract_brand_id:"",levelData:[],level:null,contract_second_brand_id:"",departments:[],contractDirector:[],clients:[],contractNames:[],isFetching:!1,userReadonly:!1,totalContracts:0,contracts:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"id",sortOrder:"asc",contractTypeId:null,contractTypeList:[{name:"",id:-1},{name:"单笔",id:0},{name:"赠版",id:2},{name:"资源置换",id:8}],applyPeopleList:[],applyPeopleId:"",applyPeopleSelected:null,forSearch:!0}},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})},filteredContract:function(){var t=this;return this.contractNames.filter(function(e){return e.contract_name.toString().toLowerCase().indexOf(t.contractName.toLowerCase())>=0})},filterClientLists:function(){var t=this;return this.clientLists.filter(function(e){return e.client_name.toString().toLowerCase().indexOf(t.clientName.toLowerCase())>=0})},filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})},filterapplyPeople:function(){var t=this;return this.applyPeopleList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.applyPeopleId.toLowerCase())>=0})}},watch:{currPage:function(t){this.getContract()},page:function(t){this.currPage=t||1},departmentId:function(t){this.getDirector({department_id:t})}},mounted:function(){this.getDepartment(),this.getSigningCompanys(),this.getClientLists(),this.getApplyPeopleList(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getContract();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()},this.getLevel()},methods:{getLevel:function(){var t=this;this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")},onUserSelected:function(t){t&&(this.userId=t.id)},onSelectClient:function(t){t&&(this.clientListSelected=t.client_id,this.clientName=t.client_name)},onSelectCompany:function(t){t&&(this.signingCompany=t.company_name,this.signingCompanySelected=t.id)},getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{no_limit:1}}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},getClientLists:function(){var t=this;return this.ajax({url:"/client/get_client_list",params:{client_level_id_neq:2}}).then(function(e){0===e.error_code&&(t.clientLists=e.data.list)})},getApplyPeopleList:function(){var t=this;return this.ajax({url:"/user/index",method:"post",data:{is_delete:0}}).then(function(e){0===e.error_code&&(t.applyPeopleList=e.data.rows)})},getContract:function(){var t=this;this.loading=!0;var e="";e=this.contract_second_brand_id?this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";var a={contract_name:this.contractName,department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,company_name:this.signingCompany,contract_brand_id:e,contract_type_id:this.contractTypeId,start_date:this.startDate?this.zDateFormatter(this.startDate):null,end_date:this.endDate?this.zDateFormatter(this.endDate):null,apply_user_id:this.applyPeopleId&&this.applyPeopleSelected?this.applyPeopleSelected:null,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage};this.ajax({url:"/backlog/get_contract_applied_lists_backlog",params:a}).then(function(e){t.totalContracts=e.data.total,t.totalPage=Math.ceil(e.data.total/t.perPage),0===t.totalPage&&(t.totalPage=1),t.contracts=e.data.lists,1!==t.currPage&&t.currPage!==t.page?t.$router.push(t.$router.currentRoute.path+"?page="+t.currPage):1===t.currPage&&t.$router.push(t.$router.currentRoute.path),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,o.default)(e.data);t.departments=a})},getDirector:function(t){var e=this;return this.ajax({url:"/user/index",params:t}).then(function(t){e.contractDirector=t.data.rows})},searchContract:(0,s.default)(function(){this.isFetching=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/backlog/get_contract_applied_lists_backlog",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching=!1})},resetParams:function(){this.defaultSortDirection="asc",this.departmentId="",this.userId=null,this.userName="",this.clientId=null,this.contractNumber="",this.contractName="",this.startDate=null,this.endDate=null,this.contract_cost_start="",this.contract_cost_end="",this.contract_brand_id="",this.clientName="",this.signingCompany="",this.contractTypeId="",this.applyPeopleId="",this.level=null,this.contract_brand_id="",this.contract_second_brand_id=""},onQueryClick:function(){1===this.currPage?this.getContract():this.currPage=1},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getContract()}}}},"8Qx0":function(t,e,a){var n=a("VU/8")(a("elnl"),a("kPCt"),null,null);t.exports=n.exports},"9+m0":function(t,e,a){a("Ytv6");var n=a("VU/8")(a("cY7y"),a("P/hE"),"data-v-ffa290aa",null);t.exports=n.exports},"92DV":function(t,e,a){var n=a("VU/8")(a("97HG"),a("bysM"),null,null);t.exports=n.exports},"97HG":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"PageContainer",props:{pageTitle:{type:String,default:""}},mounted:function(){document.title=this.pageTitle}}},"9d6h":function(t,e){},"9lAo":function(t,e,a){var n=a("VU/8")(a("r8+A"),a("BZxu"),null,null);t.exports=n.exports},A70A:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"返点查询"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{horizontal:"",label:"品牌"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title"},on:{select:t.onBrandSelected},model:{value:t.brandName,callback:function(e){t.brandName=e},expression:"brandName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterClientLists,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"client_name"},on:{select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"行业",horizontal:""}},[a("b-select",{model:{value:t.rebate_brand_id,callback:function(e){t.rebate_brand_id=e},expression:"rebate_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                            "+t._s(e.val)+"\n                        ")])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},on:{focus:t.searchContractList,input:t.searchContractList},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"商务",horizontal:""}},[a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onSelectedCompany},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.party_b_id,callback:function(e){t.party_b_id=e},expression:"party_b_id"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"是否自主客户"}},[a("b-select",{model:{value:t.is_auto,callback:function(e){t.is_auto=e},expression:"is_auto"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("非自主客户")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("自主客户")])])],1),t._v(" "),a("b-field",{attrs:{label:"返点所在月份",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{type:"month","max-date":t.end_date},model:{value:t.start_date,callback:function(e){t.start_date=e},expression:"start_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{type:"month","min-date":t.start_date},model:{value:t.end_date,callback:function(e){t.end_date=e},expression:"end_date"}})],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportAll(0)}}},[t._v("导出")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportAll(1)}}},[t._v("导出返点明细")])])],1),t._v(" "),a("div",{staticClass:"z-block-content z-listbox"},[a("b-field",{staticClass:"z-field z-show",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"展示方式",horizontal:""}},[a("b-select",{on:{input:t.onQueryClick},model:{value:t.showType,callback:function(e){t.showType=e},expression:"showType"}},t._l(t.TYPE_LIST,function(e,n){return a("option",{key:n,domProps:{value:n}},[t._v(t._s(e))])}))],1)],1),t._v(" "),t.totalRebate?a("b-table",{key:Math.random(),staticClass:"z-table-clients z-scaling-list",attrs:{data:t.rebateList},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name,field:"field_"+n.name}},[t._v("\n                    "+t._s(e.row[n.name])+"\n                    ")])})}}])},[t.totalPage>1?a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalRebate,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)]):t._e()],2):t._e()],1)])])},staticRenderFns:[]}},AKws:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("lHA8"),s=n(i),r=a("c/Tr"),o=n(r),c=a("LZT1"),l=n(c),d={},u={},_=["好价事业部（旧）","社区事业部（旧）","商品库（旧）","市场部（旧）","视频中心（旧）","首页+搜索（旧）","用户增长部（旧）","上海事业部（旧）","国际拓展部（旧）","营销事业部（旧）","星罗","消费数据库","站内媒体","全域媒体","市场中心","出海","商业化中心"];e.default={props:["page"],data:function(){return{LEVEL:_,business_id:null,DEPARTMENT:"",allChecked:!1,usersData:[],departmentName:[],departments:[],perPage:20,currPage:1,totalUsers:0,jumpPage:1,loginName:"",loginNameId:null,loginNameList:[],name:"",nameId:null,nameList:[],departmentId:null,isGroupLeader:null}},computed:{totalPage:function(){return Math.ceil(this.totalUsers/this.perPage)}},watch:{currPage:function(t){1!==t&&t!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+t):1===t&&this.$router.push(this.$router.currentRoute.path),this.getUsers()},page:function(t){this.currPage=t||1}},created:function(){this.getDepartments(),this.getAllDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getUsers()},methods:{getAllDepartment:function(){var t=this;return this.ajax({url:"/business/index"}).then(function(e){var a=(0,l.default)(e.data);t.DEPARTMENT=a,t.DEPARTMENT.forEach(function(t){u[t.id]=t.name})})},getDepartments:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/department/index"}).then(function(e){0===e.error_code&&(t.departments=(0,l.default)(e.data),t.departments.forEach(function(t){d[t.id]=t.name}))})},getUsers:function(){var t=this,e={page:this.currPage,limit:this.perPage,with_department:1,is_delete:0};this.loginName&&(e.username=this.loginName),this.name&&(e.name=this.name),this.departmentId&&(e.department_id=this.departmentId),null!==this.isGroupLeader&&(e.is_headman=this.isGroupLeader),this.ajax({loading:this.$loading.open(),url:"/user/index",method:"post",data:e}).then(function(e){0===e.error_code&&(t.usersData=t.formatUserData(e.data.rows),t.totalUsers=e.data.total)})},formatUserData:function(t){return t.map(function(t){return t.isEdit=!1,t.allChecked=!1,t.department_list=t.department_list||[],t.selDepartments=t.department_list.map(function(t){return t.department_id}),t.selDepartmentNames=t.department_list.map(function(t){return t.department_name}).join(", "),t.selBusiness=t.user_business_list.map(function(t){return t.id}),t.business_ids=t.selBusiness.join(","),t.selBusinessNames=t.user_business_list.map(function(t){return t.value}),t.bizFieldType="",t.bizFieldMsg="",t.departmentFieldType="",t.departmentFieldMsg="",t})},userDataValidate:function(t,e){var a=this,n=[],i=this.usersData[e];return t.forEach(function(t){var s=a.$refs[t+"_"+e];"biz_type"===t?0===i.bizType.length?(i.bizFieldType="is-danger",i.bizFieldMsg="请至少选择一项",n.push(s)):(i.bizFieldType="",i.bizFieldMsg=""):"department_ids"===t?0===i.selDepartments.length?(i.departmentFieldType="is-danger",i.departmentFieldMsg="请至少选择一项",n.push(s)):(i.departmentFieldType="",i.departmentFieldMsg=""):s.checkHtml5Validity&&(s.checkHtml5Validity()||n.push(s))}),!n.length||(n[0].focus&&n[0].focus(),!1)},saveUser:function(t,e){console.log(t);var a=["name","department_ids","level_b_max"];if(this.userDataValidate(a,e)){var n={user_id:t.id,name:t.name,department_ids:t.selDepartments,business_ids:t.business_ids,is_headman:t.is_headman,level_b_max:t.level_b_max};return this.ajax({url:"/user/update",method:"post",loading:this.$loading.open(),successTip:!0,data:n}).then(function(e){0===e.error_code&&(t.isEdit=!1)})}},checkUser:function(t){var e=this;return this.ajax({url:"/user/is_clear",method:"post",data:{user_id:t.id,is_delete:0}}).then(function(a){0===a.data.clear_status?e.$dialog.confirm({message:"确定要删除该用户吗?",cancelText:"取消",confirmText:"确认",onConfirm:function(){return e.deleteUser(t)}}):e.$dialog.alert("请先解除该用户关联的客户或合同")})},deleteUser:function(t){return this.ajax({url:"/user/destroy_user",method:"post",data:{user_id:t.id,is_delete:0}}).then(function(t){window.location.reload()})},onDepartmentChange:function(t){t.department_ids=t.selDepartments,t.selDepartmentNames=t.selDepartments.map(function(t){return d[t].replace(/^-+/,"")}).join(", ")},onBusinessChange:function(t,e){var a=this.traverseTree2(e),n=a.map(function(t){return t.id});-1===t.selBusiness.indexOf(e.id)?t.selBusiness=t.selBusiness.filter(function(t){return!n.includes(t)}):t.selBusiness=(0,o.default)(new s.default(t.selBusiness.concat(n))),t.business_ids=t.selBusiness,t.selBusinessNames=t.selBusiness.map(function(t){return u[t].replace(/^-+/,"")}),console.log(t.selBusinessNames),console.log(t.business_ids),this.$forceUpdate()},traverseTree2:function(t){if(t){var e=[];e.push(t);for(var a=void 0,n=[],i=0;e.length>0;)if(a=e.pop(),i>0&&n.push(a),a.child&&a.child.length>0){var s=a.child.length-1;for(s=a.child.length-1;s>=0;s--)i++,e.push(a.child[s])}return n}},onLoginNameSelect:function(t){t&&(this.loginNameId=t.id)},onNameSelect:function(t){t&&(this.nameId=t.id)},getLoginName:function(){var t=this;this.ajax({url:"/user/index",method:"post",data:{page:-1,with_department:1,is_delete:0,username:this.loginName}}).then(function(e){if(!e.data)return void(t.loginNameList=[]);t.loginNameList=[],e.data&&e.data.rows&&e.data.rows.forEach(function(e){t.loginNameList.push({id:e.id,loginName:e.username})})})},getName:function(){var t=this;this.ajax({url:"/user/index",method:"post",data:{page:-1,with_department:1,is_delete:0,name:this.name}}).then(function(e){if(e.data.length&&!e.data.rows.length)return void(t.nameList=[]);t.nameList=[],e.data.rows.forEach(function(e){t.nameList.push({id:e.id,name:e.name})})})},onQueryClick:function(){var t=this,e={page:1,limit:this.perPage,with_department:1,is_delete:0};this.loginName&&(e.username=this.loginName),this.name&&(e.name=this.name),this.departmentId&&(e.department_id=this.departmentId),null!==this.isGroupLeader&&(e.is_headman=this.isGroupLeader),this.business_id&&(e.business_id=this.business_id),this.ajax({loading:this.$loading.open(),url:"/user/index",method:"post",data:e}).then(function(e){0===e.error_code?e.data&&e.data.rows?(t.usersData=t.formatUserData(e.data.rows),t.totalUsers=e.data.total):(t.usersData=[],t.totalUsers=0):console.log(e.error_msg)})}}}},ALH4:function(t,e,a){a("1Qx+");var n=a("VU/8")(a("bYuL"),a("rMhv"),"data-v-2d4dc9d0",null);t.exports=n.exports},AUzt:function(t,e,a){a("I3gy");var n=a("VU/8")(a("vTBl"),a("rlxa"),"data-v-9e4bd444",null);t.exports=n.exports},AXyB:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("O4Lo"),i=function(t){return t&&t.__esModule?t:{default:t}}(n),s=["new_description","spyjFiles","new_id"],r={spyj:"审批邮件"};e.default={props:["ids","isEdit"],data:function(){return{status_id:-1,totalContracts:0,contracts:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"entered_date",sortOrder:"desc",defaultSortDirection:"asc",fetchingUsers:!1,contractUsers:[],new_charge_name:"",isFetching2:!1,contract_type_name:"",contract_company_id:3,change_type_name:"",new_id:null,new_description:"",spyjFiles:[],file_url:"",msg:"",status:"",companyList:[],oneList:["","北京值得买科技股份有限公司","北京值得买科技股份有限公司上海分公司","北京值得买科技股份有限公司青岛分公司","青岛无忧直购网络科技有限公司","青岛星罗创想网络科技有限公司","青岛优讯创想信息技术有限公司"]}},watch:{contract_company_id:function(t){t&&(this.new_description="",2===Number(t)?this.companyList=this.oneList:1===Number(t)&&this.getCompanies())},currPage:function(){this.getChange()},page:function(t){this.currPage=t||1}},mounted:function(){this.getChange()},methods:{getUsers:(0,i.default)(function(){var t=this;this.contractUsers=[],this.fetchingUsers=!0,this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{name:this.new_description.trim(),role_code:"role-crm-shangwu"}}).then(function(e){t.fetchingUsers=!1,0===e.error_code&&(t.contractUsers=e.data.rows||[])})},500),onUserSelect:function(t){t&&(this.new_description=t.name,this.new_id=t.id)},getChange:function(){var t=this,e={contract_ids:this.ids,page:this.currPage,page_size:this.perPage};return this.ajax({url:"/contract/getContractLists",params:e}).then(function(e){t.totalContracts=e.data.total,t.totalPage=Math.ceil(e.data.total/t.perPage),0===t.totalPage&&(t.totalPage=1),t.contracts=e.data.lists})},getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{approve_status_id:2,like_company_name:this.new_description}}).then(function(e){t.companyList=e.data.lists,t.isFetching2=!1})},onCompanySelected:function(t){t&&(this.new_id=t.id)},searchCompany:(0,i.default)(function(){this.isFetching2=!0,this.getCompanies()},500),fileUpload:function(t){var e=this,a=this.$data[t+"Files"];if(0!==a.length){var n=a,i=r[t];if(n.size>52428800)return this.status="is-danger",this.msg="文件【"+i+"】附件大小不能超过50M",void this.$dialog.alert(this.msg);this.status="",this.msg="",this.ajax({url:"/tools/file_upload",method:"post",data:{file_type:n.name.match(/\.([^.]+)$/)[1],file_name:n}}).then(function(t){e.file_url=t.data.file_name})}},contractDataValidate:function(t){var e=this,a=[];return t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(n.checkHtml5Validity()||a.push(n))}),!a.length||(a[0].focus(),!1)},saveContract:function(t){var e=this,a=s;if(this.contractDataValidate(a)){var n={},i=this.$loading.open();n={contract_ids:this.ids,change_type:this.contract_company_id,new_id:this.new_id,new_description:this.new_description,approved_file:this.file_url,is_save:t},this.ajax({method:"post",loading:this.$loading.open(),url:"/contract_change/add_contract_change_batch",data:n,successTip:!0,errorClose:!0}).then(function(t){if(i.close(),0===t.error_code)e.$router.push("/contracts/");else{var a=e;e.$dialog.alert({message:t.error_msg,onConfirm:function(){a.$router.push("/contracts/")}})}})}}}}},BTbF:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["invocePhone","invoceRegAddress","invoceTaxNumber","invoceBank","invoceBankNumber"];e.default={props:["companyId"],data:function(){return{invoce:[],totalPage:0,totalInvoce:0,currPage:1,perPage:20,jumpPage:1,invoceLoading:!1}},created:function(){this.companyId&&this.getInvoce()},watch:{currPage:function(t){this.getInvoce()}},methods:{getInvoce:function(){var t=this;return this.invoceLoading=!0,this.ajax({url:"/signing_company_invoice/get_list",params:{sign_company_id:this.companyId,page:this.currPage}}).then(function(e){t.invoceLoading=!1,t.invoce=t.formatContactData(e.data.lists||[]),t.totalInvoce=e.data.counts,t.totalPage=Math.ceil(t.totalInvoce/t.perPage),document.documentElement.scrollTop=0,document.body.scrollTop=0})},formatContactData:function(t){return t.map(function(t){return t.isEdit=!1,t.fieldType="",t.fieldMessage="",t})},addInvoce:function(){this.invoce.push({isEdit:!0,tel:"",sign_company_id:this.companyId,nsrsbh:"",bank:"",bank_number:"",reg_address:"",approved_status_id:0,approved_status_text:"未提交",fieldType:"",fieldMessage:""})},saveInvoce:function(t,e){if(this.invoceDataValidate(t)){var a=this.invoce[t],n={tel:a.tel,sign_company_id:this.companyId,nsrsbh:a.nsrsbh,bank:a.bank,bank_number:a.bank_number,reg_address:a.reg_address,btn_save:e?"2":"1"};return a.id&&(n.id=a.id),this.ajax({method:"post",url:"/signing_company_invoice/save",successTip:!0,loading:this.$loading.open(),data:n}).then(function(t){0===t.error_code&&(a.isEdit=!1,a.id||(a.id=t.data),e&&(a.approved_status_id=1,a.approved_status_text="待审核"))})}},invoceDataValidate:function(t){var e=this,a=[];return n.forEach(function(n){var i=e.$refs[n+"_"+t];i.checkHtml5Validity&&(i.checkHtml5Validity()||a.push(i))}),!a.length||(a[0].focus(),!1)},deleteInvoce:function(t){var e=this,a=this.invoce[t];a.id?this.$dialog.confirm({message:"确定要删除吗？",onConfirm:function(){return e.ajax({url:"/signing_company_invoice/delete",successTip:!0,loading:e.$loading.open(),method:"post",data:{id:a.id}}).then(function(a){0===a.error_code&&e.invoce.splice(t,1)})}}):this.invoce.splice(t,1)},passInvoice:function(t){return this.ajax({method:"post",url:"/signing_company_invoice/approve",loading:this.$loading.open(),successTip:!0,data:{id:t.id}}).then(function(e){0===e.error_code&&(t.approved_status_id=2,t.approved_status_text="审核通过")})},rejectInvoice:function(t){return this.ajax({method:"post",url:"/signing_company_invoice/not_approve",loading:this.$loading.open(),successTip:!0,data:{id:t.id}}).then(function(e){0===e.error_code&&(t.approved_status_id=3,t.approved_status_text="驳回待修改")})},reclaimInvoice:function(t){return this.ajax({method:"post",url:"/signing_company_invoice/after_approve_refuse",loading:this.$loading.open(),successTip:!0,data:{id:t.id}}).then(function(e){0===e.error_code&&(t.approved_status_id=3,t.approved_status_text="再驳回待修改")})}}}},BY7w:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("lHA8"),s=n(i),r=a("c/Tr"),o=n(r),c=a("LZT1"),l=n(c),d={};e.default={name:"CooperationView",props:["id"],data:function(){return{cooperation:null,cooperationList:[],isBorder:!0,selected:[],level:[],name:"",BUSINESS:[],showLogModal:!1,logData:[]}},computed:{filteredDataObj:function(){var t=this;return this.level.filter(function(e){return e.val.toString().toLowerCase().indexOf(t.name.toLowerCase())>=0})}},created:function(){this.getCooperationList(),this.getAllDepartment()},methods:{getAllDepartment:function(){var t=this;return this.ajax({url:"/business/index"}).then(function(e){var a=(0,l.default)(e.data);t.BUSINESS=a,t.BUSINESS.forEach(function(t){d[t.id]=t.name})})},onBusinessChange:function(t,e){var a=this.traverseTree2(e),n=a.map(function(t){return t.id+""});-1===t.selBusiness.indexOf(e.id)?t.selBusiness=t.selBusiness.filter(function(t){return!n.includes(t)}):t.selBusiness=(0,o.default)(new s.default(t.selBusiness.concat(n))),t.business_ids=t.selBusiness,t.selBusinessNames=t.selBusiness.map(function(t){return d[t].replace(/^-+/,"")}).join(", "),console.log(t.selBusiness),this.$forceUpdate()},traverseTree2:function(t){if(t){var e=[];e.push(t);for(var a=void 0,n=[],i=0;e.length>0;)if(a=e.pop(),i>0&&n.push(a),a.child&&a.child.length>0){var s=a.child.length-1;for(s=a.child.length-1;s>=0;s--)i++,e.push(a.child[s])}return n}},checkSecondCoop:function(){this.selected.length&&this.selected[0]?this.level=this.selected:this.level=this.cooperationList[0].level},onCooperationSelected:function(t){this.selected=[],this.selected.push(t)},checkStatus:function(t,e,a){e?(this.one!==t.val&&(t.val=this.one),t.id?t.isEdit=!1:this.cooperationList[0].level.splice(a,1),t.businessFieldType="",t.businessFieldMsg=""):(this.one=t.val,t.isEdit=!0),17===Number(this.id)&&(t.selBusiness=t.business_list.map(function(t){return t.id.toString()}),t.business_ids=t.selBusiness.join(","),t.selBusinessNames=t.business_list.map(function(t){return t.value}).join("，")),this.$forceUpdate()},addCooperation:function(){this.level.unshift({isEdit:!0,val:"",is_deleted:1,cooperation_type:0,selBusiness:[],business_ids:[],business_list:[],id:0})},deleteCooperation:function(t,e){var a=this,n=this;if(t.id)return n.ajax({url:"/contract_amount_detail_cooperation/delete_cooperation",data:{id:t.id},method:"post"}).then(function(t){0===t.error_code&&(console.log(111),a.$toast.open({duration:3e3,message:"删除成功",position:"is-top",type:"is-success"}),n.cooperationList[0].level.splice(e,1))});n.cooperationList[0].level.splice(e,1)},saveCooperation:function(t,e){var a=this;if(17===Number(this.id)){var n=["business","name"];if(!this.userDataValidate(n,e))return}var i="",s={};return t.id?(i="/contract_amount_detail_cooperation/update_cooperation",s={id:t.id,cooperation_name:t.val,business_ids:17===Number(this.id)?t.business_ids:""}):(i="/contract_amount_detail_cooperation/add_cooperation",s={parent_id:this.cooperationList[0].id,cooperation_name:t.val,cooperation_type:this.cooperationList[0].cooperation_type,business_ids:17===Number(this.id)?t.business_ids:""}),this.ajax({url:i,method:"post",data:s}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.id=e.data.id,t.cooperation_type=e.data.cooperation_type,17===Number(a.id)&&(t.business_list=e.data.business_list,t.selBusiness=t.business_list.map(function(t){return t.id.toString()}),t.business_ids=t.selBusiness.join(","),t.selBusinessNames=t.business_list.map(function(t){return t.value}).join("，")),a.$forceUpdate(),a.$toast.open({duration:3e3,message:"保存成功",position:"is-top",type:"is-success"}))})},userDataValidate:function(t,e){var a=this,n=[],i=this.level[e];return t.forEach(function(t){var s=a.$refs[t+"_"+e];"business"===t?0===i.selBusiness.length?(i.businessFieldType="is-danger",i.businessFieldMsg="请至少选择一个事业部归属",n.push(s),a.$toast.open({duration:3e3,message:i.businessFieldMsg,position:"is-top",type:"is-danger"})):(i.businessFieldType="",i.businessFieldMsg=""):s.checkHtml5Validity&&(s.checkHtml5Validity()||n.push(s))}),!n.length||(n[0].focus&&n[0].focus(),!1)},getCooperationList:function(){var t=this;return this.ajax({url:"/contract_amount_detail_cooperation/get_cooperation_lists",params:{id:this.id}}).then(function(e){0===e.error_code&&(t.cooperationList=e.data,t.cooperation=t.cooperationList[0].val,t.cooperationList.map(function(t){return t.isEdit=!1,t}),t.cooperationList[0].level&&t.cooperationList[0].level.length>0&&(t.level=t.cooperationList[0].level,t.level.map(function(t){return t.isEdit=!1,t.business_list=t.business_list||[],t.selBusiness=t.business_list.map(function(t){return t.id.toString()}),t.business_ids=t.selBusiness.join(","),t.selBusinessNames=t.business_list.map(function(t){return t.value}).join("，"),t.businessFieldType="",t.businessFieldMsg="",t})))})},showCooperationLog:function(t){var e=this;return this.showLogModal=!0,this.logData=[],this.ajax({url:"/contract_amount_detail_cooperation/get_cooperation_log",params:{id:t}}).then(function(t){0===t.error_code&&(console.log(t.data),e.logData=e.formatLogData(t.data))})},formatLogData:function(t){return t.map(function(t){return t.description=JSON.parse(t.description),t})}}}},BZxu:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"部门管理"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.$refs.menuList.hideAll()}}},[t._v("收起所有")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.$refs.menuList.showAll()}}},[t._v("展开所有")]),t._v(" "),a("menu-list",{ref:"menuList",attrs:{data:t.departments,isDepart:!0,showAdd:!1}})],1)])])},staticRenderFns:[]}},BaVC:function(t,e,a){a("rVDs");var n=a("VU/8")(a("aHuk"),a("/e0X"),"data-v-63b2351b",null);t.exports=n.exports},CHKI:function(t,e){},CNe9:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"操作日志"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"日志类型",horizontal:""}},[a("b-select",{model:{value:t.log_type,callback:function(e){t.log_type=e},expression:"log_type"}},t._l(t.LOG_TYPES,function(e,n){return a("option",{domProps:{value:Number(n)}},[t._v(t._s(e))])}))],1),t._v(" "),a("b-field",{attrs:{label:"操作类型",horizontal:""}},[a("b-select",{model:{value:t.action,callback:function(e){t.action=e},expression:"action"}},t._l(t.ACTION_TYPES,function(e,n){return a("option",{domProps:{value:Number(n)}},[t._v(t._s(e))])}))],1),t._v(" "),a("b-field",{attrs:{label:"功能模块",horizontal:""}},[a("b-select",{model:{value:t.section_in,callback:function(e){t.section_in=e},expression:"section_in"}},t._l(t.SECTION_TYPES,function(e,n){return a("option",{key:n,domProps:{value:Number(e.id)}},[t._v(t._s(e.value))])}))],1),t._v(" "),a("b-field",{attrs:{label:"操作状态",horizontal:""}},[a("b-select",{model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.STATUS_TYPES,function(e,n){return a("option",{domProps:{value:Number(n)}},[t._v(t._s(e))])}))],1),t._v(" "),a("b-field",{attrs:{label:"操作时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.handle_time_end},model:{value:t.handle_time_start,callback:function(e){t.handle_time_start=e},expression:"handle_time_start"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.handle_time_start},model:{value:t.handle_time_end,callback:function(e){t.handle_time_end=e},expression:"handle_time_end"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"模糊搜索类型",horizontal:""}},[a("b-select",{on:{input:t.resetData},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.SEARCH_TYPES,function(e,n){return a("option",{domProps:{value:Number(n)}},[t._v(t._s(e))])})),t._v(" "),1===Number(t.type)?a("b-autocomplete",{attrs:{data:t.users,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"name"},on:{input:t.searchUsers,select:t.onUsersSelected,focus:t.searchUsers},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):2===Number(t.type)?a("b-input",{model:{value:t.module,callback:function(e){t.module=e},expression:"module"}}):3===Number(t.type)?a("b-input",{model:{value:t.description,callback:function(e){t.description=e},expression:"description"}}):t._e()],1),t._v(" "),a("b-field",{attrs:{label:"客户ID",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同ID",horizontal:""}},[a("b-input",{attrs:{type:"number"},model:{value:t.contract_id,callback:function(e){t.contract_id=e},expression:"contract_id"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.getLogs}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("b",[t._v("总数: "+t._s(t.totalLogs))])]),t._v(" "),a("div",{staticClass:"z-block-content"},[t.logs&&t.logs.length?a("b-table",{attrs:{data:t.logs},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"唯一值",width:"80"}},[t._v("\n                        "+t._s(e.row.unique_key)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作时间",width:"100"}},[t._v("\n                        "+t._s(e.row.create_time)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"用户ID",width:"80"}},[t._v("\n                        "+t._s(e.row.editor_id)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"用户",width:"80"}},[t._v("\n                        "+t._s(e.row.editor_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"类型",width:"80"}},[t._v("\n                        "+t._s(t.LOG_TYPES[e.row.log_type])+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作类型",width:"100"}},[t._v("\n                        "+t._s(t.ACTION_TYPES[e.row.action])+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"模块代码",width:"160"}},[t._v("\n                        "+t._s(e.row.module)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"功能模块",width:"100"}},[t._v("\n                        "+t._s(t.SECTION_TYPES[""+(e.row.section+1)].value)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"本次状态",width:"100"}},[t._v("\n                        "+t._s(t.STATUS_TYPES[e.row.status])+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"IP",width:"120"}},[t._v("\n                        "+t._s(e.row.ip)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作内容"}},[a("pre",[t._v(t._s(JSON.stringify(e.row.description,null,4)))])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalLogs,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2):t._e()],1)])])},staticRenderFns:[]}},CWIr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("LZT1"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={props:{page:{type:Number,default:null}},data:function(){return{departments:[],departmentId:null,brands:[],brandName:"",brandId:null,productLines:[],productLineId:null,clientList:[],clientId:"",clientName:"",accessSJZX:null,accessXLSM:null,clientLevelId:null,enteredDateStart:null,enteredDateEnd:null,userId:"",userName:"",totalClients:0,clients:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,userReadonly:!1,departmentUsers:[],currUserName:"",forSearch:!0}},computed:{filteredUser:function(){var t=this;return this.departmentUsers.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})},filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.brandName.toLowerCase())>=0})}},watch:{brandId:function(t){t&&this.getProductLines(t)},currPage:function(t){this.getClients()},departmentId:function(t){t&&(this.userId=null,this.userName="",this.getUsersByDepartment(t))},page:function(t){this.currPage=t||1}},mounted:function(){this.initUserData(),this.getDepartments(),this.getBrands(),this.getClientsList(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getClients();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},methods:{initUserData:function(){var t=this.$parent;t.user&&t.crmUser&&(this.isRole(this.ROLE.zuzhang)?this.getUsersByRole(this.ROLE.zuzhang):this.isRole(this.ROLE.shangwu)&&(this.userReadonly=!0,this.currUserName=t.crmUser.name))},onQueryClick:function(){1===this.currPage?this.getClients():this.currPage=1},getClientsList:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id)},getDepartments:function(){var t=this;return this.ajax({url:"/department/index"}).then(function(e){var a=(0,i.default)(e.data);t.departments=a})},getClients:function(){var t=this;return this.loading=!0,this.ajax({url:"/backlog/get_client_backlog",params:{department_id:this.departmentId,user_id:this.userId,brand_name:this.brandName,product_line_id:this.productLineId,client_name:this.clientName,is_sjzx:this.accessSJZX,is_xlsm:this.accessXLSM,client_level_id:this.clientLevelId,entered_date_start:this.enteredDateStart&&this.zDateFormatter(this.enteredDateStart),entered_date_end:this.enteredDateEnd&&this.zDateFormatter(this.enteredDateEnd),page:this.currPage,page_size:this.perPage}}).then(function(e){t.totalClients=e.data.total,t.totalPage=e.data.total_page,t.clients=e.data.list,1!==t.currPage&&t.currPage!==t.page?t.$router.push(t.$router.currentRoute.path+"?page="+t.currPage):1===t.currPage&&t.$router.push(t.$router.currentRoute.path),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list"}).then(function(e){t.brands=e.data})},getProductLines:function(t){var e=this;return this.ajax({url:"/brand/get_product_line_by_brand_id",params:{brand_id:t}}).then(function(t){e.productLines=t.data;var a={id:"",val:""};e.productLines.unshift(a)})},getUsersByDepartment:function(t){var e=this;return this.ajax({method:"post",url:"/user/get_list_by_department_id",data:{department_id:t}}).then(function(t){e.departmentUsers=t.data.rows||[]})},getUsersByRole:function(t){var e=this;return this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{role_code:t}}).then(function(t){e.departmentUsers=t.data.rows||[]})},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brandName=t.title)},onUserSelected:function(t){t&&(this.userId=t.id)},resetParams:function(){this.departmentId=null,this.userId="",this.userName="",this.brands=[],this.brandName="",this.brandId=null,this.productLines=[],this.productLineId=null,this.clientName="",this.clientId=null,this.accessSJZX=null,this.accessXLSM=null,this.clientLevelId=null,this.enteredDateStart=null,this.enteredDateEnd=null}}}},CbQb:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"品牌管理"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content branch-search-box"},[a("div",{staticClass:"field z-field is-grouped is-grouped-multiline"},[a("b-field",{attrs:{horizontal:"",label:"品牌名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title"},on:{select:t.onBrandSelected},model:{value:t.searchName,callback:function(e){t.searchName=e},expression:"searchName"}})],1),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")])],1)])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content branch-search-box"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"new-brand",attrs:{horizontal:"",label:"新增品牌"}},[a("div",{staticClass:"z-field-text z-red-text z-bold-text"},[t._v("请按照顺序规范填写中文品牌名+英文品牌名，仅有中文或者仅有英文的对应填写即可。")])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"brand-div",attrs:{horizontal:"",label:"中文名称",type:t.showCH?"is-danger":"",message:t.showCH?"只能输入汉字＆数字＆符号":""}},[a("b-input",{ref:"titleCH",attrs:{placeholder:"只能输入汉字＆数字＆符号"},on:{blur:function(e){t.checkReg("CH")}},model:{value:t.titleCH,callback:function(e){t.titleCH=e},expression:"titleCH"}})],1),t._v(" "),a("b-field",{staticClass:"brand-div",attrs:{horizontal:"",label:"英文名称",type:t.showEN?"is-danger":"",message:t.showEN?"只能输入字母＆数字＆符号":""}},[a("b-input",{ref:"titleEN",attrs:{placeholder:"只能输入字母＆数字＆符号）"},on:{blur:function(e){t.checkReg("EN")}},model:{value:t.titleEN,callback:function(e){t.titleEN=e},expression:"titleEN"}})],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"brand-div",attrs:{horizontal:"",label:"所属集团"}},[a("div",{staticClass:"block"},[a("b-radio",{attrs:{name:"name","native-value":"1"},model:{value:t.company,callback:function(e){t.company=e},expression:"company"}},[t._v("\n                            有\n                        ")]),t._v(" "),a("b-radio",{attrs:{name:"name","native-value":"0"},model:{value:t.company,callback:function(e){t.company=e},expression:"company"}},[t._v("\n                            暂无\n                        ")])],1)]),t._v(" "),1===Number(t.company)?a("b-field",{staticClass:"brand-div",attrs:{horizontal:"",label:"集团名称"}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name",required:""},on:{select:t.onCompanySelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1):t._e()],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"branch-search-textarea",attrs:{horizontal:"",label:"品牌介绍"}},[a("b-input",{ref:"searchInput",staticClass:"search-input",attrs:{placeholder:"请填写品牌概念和业务领域，不超过100个字。",maxlength:"100",type:"textarea",required:""},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addHandle}},[t._v("添加")])],1)])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.data,loading:t.isLoading,striped:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{width:"300",field:"title",label:"品牌名称"}},["over"===e.row.status?a("span",[t._v(t._s(e.row.title))]):t._e(),t._v(" "),"over"!==e.row.status?[a("b-field",{staticClass:"inlineInput",attrs:{type:e.row.showCH?"is-danger":""}},[a("b-input",{ref:"titleCH_"+e.row.id,on:{blur:function(a){t.checkReg("CH",e.row)}},model:{value:e.row.titleCH,callback:function(a){t.$set(e.row,"titleCH",a)},expression:"props.row.titleCH"}})],1),t._v("\n                         -\n                        "),a("b-field",{staticClass:"inlineInput",attrs:{type:e.row.showEN?"is-danger":""}},[a("b-input",{ref:"titleEN_"+e.row.id,on:{blur:function(a){t.checkReg("EN",e.row)}},model:{value:e.row.titleEN,callback:function(a){t.$set(e.row,"titleEN",a)},expression:"props.row.titleEN"}})],1)]:t._e()],2),t._v(" "),a("b-table-column",{attrs:{width:"200",field:"group_name",label:"所属集团"}},["over"===e.row.status?a("span",[t._v(t._s(e.row.group_name))]):t._e(),t._v(" "),"over"!==e.row.status?a("b-input",{model:{value:e.row.group_name,callback:function(a){t.$set(e.row,"group_name",a)},expression:"props.row.group_name"}}):t._e()],1),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{width:"300",field:"description",label:"品牌介绍"}},["over"===e.row.status?[a("div",{ref:"description_"+e.row.id,staticClass:"resultbox",attrs:{id:"description_"+e.row.id}},[t._v(t._s(e.row.description))]),t._v(" "),e.row.zk?a("div",{staticClass:"clickBtn",attrs:{id:"btn_description_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"description")}}},[t._v("展开")]):t._e()]:t._e(),t._v(" "),"over"!==e.row.status?a("b-input",{model:{value:e.row.description,callback:function(a){t.$set(e.row,"description",a)},expression:"props.row.description"}}):t._e()],2),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{width:"300",field:"company",label:"签约公司"}},[[a("div",{ref:"sign_company_"+e.row.id,staticClass:"resultbox",attrs:{id:"sign_company_"+e.row.id}},[t._v(t._s(e.row.signing_company))]),t._v(" "),e.row.pk?a("div",{staticClass:"clickBtn",attrs:{id:"btn_sign_company_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"sign_company")}}},[t._v("展开")]):t._e()]],2),t._v(" "),a("b-table-column",{attrs:{width:"200",field:"productArray",label:"产品线"}},[t._v("\n                    "+t._s(e.row.productArray)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{width:"180",label:"操作"}},["over"===e.row.status?a("button",{staticClass:"button is-link",on:{click:function(a){t.editHandle(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),"over"!==e.row.status?a("button",{staticClass:"button is-link",on:{click:function(a){t.saveHandle(e.row)}}},[t._v("保存")]):t._e(),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteHandle(e.row,e.index)}}},[t._v("删除")])]),t._v(" "),a("b-table-column",{attrs:{width:"100",label:"产品线管理"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showProducts(e.row)}}},[t._v("编辑产品线")])]),t._v(" "),a("b-table-column",{attrs:{width:"80",label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e.row.id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showProductsModal},on:{"update:active":function(e){t.showProductsModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("管理品牌客户")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"add_products_box"},[a("div",{staticClass:"field z-field is-grouped is-grouped-multiline"},[a("h2",{staticClass:"add_new_client"},[t._v("新增品牌客户")]),t._v(" "),[a("b-field",{staticClass:"add_check_box",attrs:{grouped:""}},[a("b-field",{attrs:{expanded:"",label:"客户类型"}},[a("b-select",{attrs:{required:""},model:{value:t.client_type,callback:function(e){t.client_type=e},expression:"client_type"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{expanded:"",label:"产品线类型"}},[a("b-select",{attrs:{required:""},model:{value:t.brand_product_type,callback:function(e){t.brand_product_type=e},expression:"brand_product_type"}},t._l(t.levelData,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.val))])}))],1),t._v(" "),a("b-field",{attrs:{expanded:"",label:"产品线名称"}},[a("b-input",{attrs:{required:""},model:{value:t.product_line_name,callback:function(e){t.product_line_name=e},expression:"product_line_name"}})],1)],1)],t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addNewClient}},[t._v("添加")])],2)]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.ProductsData},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"productArray",label:"客户类型"}},["over"===e.row.status?a("span",[t._v(t._s(t.CLIENT_TYPES[e.row.client_type_id].name))]):t._e(),t._v(" "),"over"!==e.row.status?a("b-select",{model:{value:e.row.client_type_id,callback:function(a){t.$set(e.row,"client_type_id",a)},expression:"props.row.client_type_id"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])})):t._e()],1),t._v(" "),a("b-table-column",{attrs:{field:"productArray",label:"产品线类型"}},[a("b-select",{attrs:{disabled:"over"===e.row.status},model:{value:e.row.brand_product_type,callback:function(a){t.$set(e.row,"brand_product_type",a)},expression:"props.row.brand_product_type"}},t._l(t.levelData,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.val))])}))],1),t._v(" "),a("b-table-column",{attrs:{field:"productArray",label:"产品线名称"}},["over"===e.row.status?a("span",[t._v(t._s(e.row.product_line_name))]):t._e(),t._v(" "),"over"!==e.row.status?a("b-input",{model:{value:e.row.product_line_name,callback:function(a){t.$set(e.row,"product_line_name",a)},expression:"props.row.product_line_name"}}):t._e()],1),t._v(" "),a("b-table-column",{attrs:{width:"210",label:"操作"}},["over"===e.row.status?[e.row.has_client?a("a",{staticClass:"button is-link",attrs:{href:"#/clients/"+e.row.client_id}},[t._v("查看客户")]):a("a",{staticClass:"button is-link",attrs:{href:"#/clients/add?brand="+encodeURIComponent(t.cacheName)+"&brand_id="+t.cacheId+"&client_type="+e.row.client_type_id+"&brand_product_type="+encodeURIComponent(e.row.brand_product_type_name)+"&product_line_name="+encodeURIComponent(e.row.product_line_name)+"&product_line_id="+e.row.product_line_id}},[t._v("创建客户")])]:t._e(),t._v(" "),"over"!==e.row.status?[e.row.has_client?a("button",{staticClass:"button is-gray"},[t._v("查看客户")]):a("button",{staticClass:"button is-gray"},[t._v("创建客户")])]:t._e(),t._v(" "),"over"===e.row.status?a("button",{staticClass:"button is-link",on:{click:function(a){t.editProductsHandle(e.row)}}},[t._v("编辑")]):t._e(),t._v(" "),"over"!==e.row.status?a("button",{staticClass:"button is-link",on:{click:function(a){t.saveProductsHandle(e.row)}}},[t._v("保存")]):t._e(),t._v(" "),a("button",{staticClass:"button is-link",on:{click:function(a){t.deleteProductsHandle(e.row,e.index)}}},[t._v("删除")])],2)]}}])})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])]),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])]),t._v(" "),a("b-modal",{attrs:{active:t.showAllModal},on:{"update:active":function(e){t.showAllModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("品牌已存在")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.AllData,columns:t.allColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},D5cE:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={name:"DegreesAdd",data:function(){return{one:0,clientLists:[],clientListId:"",clientListSelected:null,isBorder:!0,degreesList:[],showLogModal:!1,logData:[],defaultSortDirection:"asc",sortField:"manual_bonus",sortOrder:"desc",total:0,loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1}},computed:{filterClientLists:function(){var t=this;return this.clientLists.filter(function(e){return e.client_name.toString().toLowerCase().indexOf(t.clientListId.toLowerCase())>=0})}},watch:{currPage:function(t){this.checkDegrees()},page:function(t){this.currPage=t||1}},created:function(){this.getClientLists(),this.checkDegrees()},methods:{getClientLists:function(){var t=this;return this.ajax({url:"/client_manual_bonus/get_manual_bonus_lists",params:{client_id:this.clientListSelected,page:1,page_size:20,order_by:this.sortField,order:this.sortOrder,no_limit:1}}).then(function(e){0===e.error_code&&(t.clientLists=e.data.lists)})},onClientSelected:function(t){this.clientListSelected=t.id},checkDegrees:function(){var t=this;return this.ajax({url:"/client_manual_bonus/get_manual_bonus_lists",params:{client_id:this.clientListSelected,page:this.currPage,page_size:this.perPage,order_by:this.sortField,order:this.sortOrder,no_limit:0}}).then(function(e){0===e.error_code&&(t.total=e.data.total,t.totalPage=Math.ceil(e.data.total/t.perPage),0===t.totalPage&&(t.totalPage=1),t.degreesList=e.data.lists)})},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.checkDegrees()},resetName:function(){this.clientListId="",this.clientListSelected=null},checkStatus:function(t,e){e?(this.one!==t.manual_bonus&&(t.manual_bonus=this.one),t.isEdit=!1):(this.one=t.manual_bonus,t.isEdit=!0),this.$forceUpdate()},saveDegrees:function(t){var e=this;return this.ajax({url:"/client_manual_bonus/update_manual_bonus",method:"post",data:{client_id:t.id,manual_bonus:t.manual_bonus}}).then(function(a){0===a.error_code&&(e.$toast.open({duration:3e3,message:"操作成功",position:"is-top",type:"is-success"}),t.isEdit=!1,e.$forceUpdate())})},showLog:function(t){var e=this;return this.showLogModal=!0,this.logData=[],this.ajax({url:"/contract/get_contract_approve_log",params:{contract_id:t,type:6}}).then(function(t){0===t.error_code&&(console.log(t.data),e.logData=t.data)})}}}},DEsu:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-scaling"},[a("page-container",{attrs:{pageTitle:"业绩拆分详情"}},[a("b-field",{staticClass:"columns z-contracts-top",attrs:{grouped:""}},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同类型"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_type_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同编号"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_number))])]),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同基础信息")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同名称"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同品类"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_brand_name)+"-"+t._s(t.contract.contract_second_brand_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同负责人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_charge_name))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户名称"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"所属部门"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.parent_department_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"业务组"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.department_name))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.signing_company_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司类型"}},[a("b-select",{ref:"signingCompanyTypeId",attrs:{disabled:"",required:""},model:{value:t.contract.signing_company_type_id,callback:function(e){t.$set(t.contract,"signing_company_type_id",e)},expression:"contract.signing_company_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("直客")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("代理")])])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联年框"}},[a("div",{staticClass:"z-field-text clickLink"},[t._v(t._s(t.contract.join_contract_number))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"乙方签约公司"}},[a("b-select",{ref:"partyBName",attrs:{disabled:"",required:""},model:{value:t.contract.party_b_name,callback:function(e){t.$set(t.contract,"party_b_name",e)},expression:"contract.party_b_name"}},[a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"起止日期"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.start_date)+" - "+t._s(t.contract.end_date))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户账期"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.account_period))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同申请人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.apply_user_name||t.$root.crmUser&&t.$root.crmUser.name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同签订人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_signing))])]),t._v(" "),t.contract.client_relationship_name&&[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户关系"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_relationship_name))])]):t._e(),t._v(" "),a("b-field",{staticClass:"column",attrs:{label:"首次签约",horizontal:"",expanded:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.IS_FIRST[t.contract.is_first_contract]))])])],1)])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("b-field",{attrs:{label:"项目经理：",horizontal:""}},[t.isEdit?a("b-autocomplete",{ref:"contractCharge",staticClass:"search-input",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name",required:""},on:{input:t.getCodeList,select:t.onChargeNameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.charge_userName,callback:function(e){t.charge_userName=e},expression:"charge_userName"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.achieve_pm_name))]),t._v(" "),t.contract.ad_schedules.length&&19===t.contract.contract_brand_id?a("div",{staticClass:"z-field-text z-red-text"},[t._v("该合同需要按比例进行行业拆分")]):t._e(),t._v(" "),a("div",{staticClass:"column"}),t._v(" "),a("div",{staticClass:"column"})],1)],1),t._v(" "),t._l(t.detail,function(e,n){return a("div",{key:n,staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v(t._s(e.date)+"业绩拆分明细")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.list,bordered:!0,detailed:"","has-detailed-visible":function(t){return!(!0===t.isLast)}},scopedSlots:t._u([{key:"default",fn:function(i){return[a("b-table-column",{attrs:{label:"事业部",field:"department"}},[a("b-field",[!t.isEdit||!i.row.isAdd||[3,4].indexOf(e.status)>-1?a("div",{staticClass:"z-field-text"},[t._v(t._s(i.row.department_name.replace(/^-+/,"")))]):a("b-select",{ref:"business_id_"+i.index,refInFor:!0,attrs:{required:""},on:{input:function(e){t.onSelectDepartment(i.row,"get",i.row.department)}},model:{value:i.row.department,callback:function(e){t.$set(i.row,"department",e)},expression:"props.row.department"}},t._l(t.DEPARTMENT,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"硬广发布额",field:"hard_amount"}},[t._v("\n                            "+t._s(Number(i.row.hard_amount).toFixed(2))+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"硬广业绩",field:"hard_split"}},[!t.isEdit||[3,4].indexOf(e.status)>-1||i.row.isLast?[t._v(t._s(Number(i.row.hard_split).toFixed(2)))]:a("b-field",[a("b-input",{attrs:{required:""},on:{blur:function(a){t.onBlurHard(i.row,e,i.index)}},model:{value:i.row.hard_split,callback:function(e){t.$set(i.row,"hard_split",e)},expression:"props.row.hard_split"}})],1)],2),t._v(" "),a("b-table-column",{attrs:{label:"软性发布额",field:"soft_amount"}},[[t._v(t._s(Number(i.row.soft_amount).toFixed(2)))]],2),t._v(" "),a("b-table-column",{attrs:{label:"软性业绩",field:"soft_split"}},[t._v("\n                            "+t._s(Number(i.row.soft_split).toFixed(2))+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"发布额合计",field:"total_amount"}},[t._v("\n                            "+t._s(Number(i.row.total_amount).toFixed(2))+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"业绩合计",field:"total_split"}},[t._v("\n                            "+t._s(Number(i.row.total_split).toFixed(2))+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作",visible:t.isEdit&&!([3,4].indexOf(e.status)>-1)}},[0===i.row.soft_length?a("button",{staticClass:"is-primary button",on:{click:function(e){t.addSoftList(i.row)}}},[t._v("新增软性合作")]):t._e(),t._v(" "),14===i.row.department&&0===i.row.hard_length&&19===t.contract.contract_brand_id?a("button",{staticClass:"is-primary button",on:{click:function(e){t.addHardList(i.row)}}},[t._v("行业拆分")]):t._e(),t._v(" "),!t.isEdit||[3,4].indexOf(e.status)>-1||i.row.isLast||!i.row.isAdd||2!==i.row.is_project?t._e():a("button",{staticClass:"is-primary button",on:{click:function(a){t.delSplit(n,i.row,i.index,e)}}},[t._v("删除")])])]}},{key:"detail",fn:function(n){return[14===n.row.department?[!t.isEdit||[3,4].indexOf(e.status)>-1&&n.row.hard_list.length&&19===t.contract.contract_brand_id||19!==t.contract.contract_brand_id?a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:n.row.hard_list,bordered:!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"硬广业绩所属事业部"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.trade_business_val.replace(/^-+/,"")))])]),t._v(" "),a("b-table-column",{attrs:{label:"硬广业绩"}},[[t._v(t._s(Number(e.row.ad_split||0).toFixed(2)))]],2)]}}])}):a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:n.row.hard_list,bordered:!0},scopedSlots:t._u([{key:"default",fn:function(i){return[a("b-table-column",{attrs:{label:"硬广业绩所属事业部"}},[a("b-select",{ref:"business_id_"+n.index,refInFor:!0,attrs:{required:""},model:{value:i.row.trade_business_id,callback:function(e){t.$set(i.row,"trade_business_id",e)},expression:"dprops.row.trade_business_id"}},t._l(t.DEPARTMENTPART,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-table-column",{attrs:{label:"硬广业绩"}},[a("b-field",[a("b-input",{attrs:{required:""},on:{blur:function(a){t.onBlurSplit("hard",i.row,e,n.index,n.row)}},model:{value:i.row.ad_split,callback:function(e){t.$set(i.row,"ad_split",e)},expression:"dprops.row.ad_split"}})],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"操作",visible:t.isEdit&&!([3,4].indexOf(e.status)>-1)&&19===t.contract.contract_brand_id}},[i.index===n.row.hard_list.length-1?a("button",{staticClass:"is-primary button",on:{click:function(e){t.addHardList(n.row)}}},[t._v("新增行业")]):t._e(),t._v(" "),t.isEdit&&!([3,4].indexOf(e.status)>-1)&&!n.row.isLast&&n.row.hard_list.length>0?a("button",{staticClass:"is-primary button",on:{click:function(a){t.delList("hard",n.row,i.index,i.row,e,n.index)}}},[t._v("删除")]):t._e()])]}}])})]:t._e(),t._v(" "),n.row.soft_list.length?a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:n.row.soft_list,bordered:!0},scopedSlots:t._u([{key:"default",fn:function(i){return[a("b-table-column",{attrs:{label:"软性业绩明细（按合作方式拆分）"}},[!t.isEdit||i.row.is_lock||[3,4].indexOf(e.status)>-1||2!==i.row.is_project?[t._v(t._s(i.row.contract_detail_cooperation_val))]:a("b-autocomplete",{attrs:{"keep-first":!1,"open-on-focus":!0,data:i.row.options,field:"cooperation_name"},on:{focus:function(e){t.filteredDataObj(i.row,n.row.department,n.row)},input:function(e){t.filteredDataObj(i.row,n.row.department,n.row)},select:function(t){i.row.contract_detail_cooperation_id=t&&t.id?t.id:0}},model:{value:i.row.contract_detail_cooperation_val,callback:function(e){t.$set(i.row,"contract_detail_cooperation_val",e)},expression:"dprops.row.contract_detail_cooperation_val"}})],2),t._v(" "),a("b-table-column",{attrs:{label:"软性发布额"}},[t._v(t._s(Number(i.row.detail_amounts||0).toFixed(2)))]),t._v(" "),a("b-table-column",{attrs:{label:"软性业绩"}},[!t.isEdit||[3,4].indexOf(e.status)>-1||n.row.isLast||2!==i.row.is_project?[t._v(t._s(Number(i.row.detail_split||0).toFixed(2)))]:a("b-field",[a("b-input",{attrs:{required:""},on:{blur:function(a){t.onBlurSplit("soft",i.row,e,n.index,n.row)}},model:{value:i.row.detail_split,callback:function(e){t.$set(i.row,"detail_split",e)},expression:"dprops.row.detail_split"}})],1)],2),t._v(" "),a("b-table-column",{attrs:{label:"操作",visible:t.isEdit&&!([3,4].indexOf(e.status)>-1)}},[2===i.row.is_project?[i.index===n.row.soft_list.length-1?a("button",{staticClass:"is-primary button",on:{click:function(e){t.addSoftList(n.row)}}},[t._v("新增软性合作")]):t._e(),t._v(" "),!t.isEdit||[3,4].indexOf(e.status)>-1||n.row.isLast||!(n.row.soft_list.length>0)||!i.row.isAdd&&i.row.is_lock?t._e():a("button",{staticClass:"is-primary button",on:{click:function(a){t.delList("soft",n.row,i.index,i.row,e,n.index)}}},[t._v("删除")])]:[a("div",{staticClass:"z-field-text z-red-text"},[t._v("请前往项目工单进行修改并更新")])]],2)]}}])}):t._e()]}}])})],1),t._v(" "),a("div",{staticClass:"z-block-title z-table-footer"},[t.isEdit?a("div",{staticClass:"f_l"},[-1===[3,4].indexOf(e.status)?[-1===[3,4].indexOf(e.status)&&2===e.is_project?a("a",{staticClass:"button is-primary",on:{click:function(a){t.addSplit(e)}}},[t._v("+新增事业部")]):t._e(),t._v(" "),-1===[3,4].indexOf(e.status)?a("a",{staticClass:"button is-primary",on:{click:function(a){t.submit(e,!1)}}},[t._v("保存")]):t._e(),t._v(" "),e.isSubmit?a("a",{staticClass:"button is-primary",on:{click:function(a){t.submit(e,!0)}}},[t._v("提交")]):a("a",{staticClass:"button is-gray"},[t._v("提交")])]:t._e(),t._v(" "),4===e.status?a("a",{staticClass:"button is-gray"},[t._v("已过审")]):t._e(),t._v(" "),3===e.status?a("a",{staticClass:"button is-gray"},[t._v("审核中")]):t._e(),t._v(" "),[3,4].indexOf(e.status)>-1?a("a",{staticClass:"button is-primary",on:{click:function(a){t.clickSplit(6,e)}}},[t._v("再驳回")]):t._e(),t._v(" "),e.reject?a("b",{staticClass:"is-red",staticStyle:{"line-height":"28px"}},[t._v(t._s(e.reject))]):t._e()],2):a("div",{staticClass:"f_l is-red"},[t.isSplitURL?[a("a",{staticClass:"button is-primary",on:{click:function(a){t.clickSplit(4,e)}}},[t._v("通过")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(a){t.clickSplit(5,e)}}},[t._v("驳回")])]:[2===t.contract.is_split?a("b",[t._v("进度："+t._s(t.SPLIT_STATUS_ID[e.status]))]):t._e(),t._v(" "),1===t.contract.is_split?a("b",[t._v("进度：无需审批")]):t._e()]],2),t._v(" "),a("div",{staticClass:"f_r"},[t.isEdit&&!t.isSplitURL&&-1===[3,4].indexOf(e.status)?a("button",{staticClass:"button is-link",on:{click:function(a){t.resetSplit(e,n)}}},[t._v("重置")]):t._e(),t._v(" "),t.isSplitURL?t._e():a("button",{staticClass:"button is-link",on:{click:function(a){t.showLogs(e.logs)}}},[t._v("操作日志")])])])])}),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])]),t._v(" "),t.isSplitURL?a("b-modal",{attrs:{active:t.rejectShow},on:{"update:active":function(e){t.rejectShow=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("驳回原因")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"z-block"},[a("b-input",{ref:"rejectReason_ref",attrs:{required:"",type:"textarea"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}})],1),t._v(" "),a("div",{staticClass:"z-block"},[a("a",{staticClass:"button is-primary",on:{click:function(e){t.reject()}}},[t._v("确认驳回")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("取消")])])]),t._v(" "),a("section",{staticClass:"modal-card-foot"})])]):t._e()],2)],1)},staticRenderFns:[]}},DhVk:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-field",{attrs:{label:"合作方式",horizontal:!t.releaseType}},[a("div",{staticClass:"z-cooperation"},[a("b-select",{staticClass:"select-inline",on:{input:t.onSelectCooperationType},model:{value:t.cooperation_type,callback:function(e){t.cooperation_type=e},expression:"cooperation_type"}},t._l(t.cooperationList,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e.val))])})),t._v(" "),t.cooperation_type&&5!==Number(t.cooperation_type.cooperation_type)?a("b-autocomplete",{staticClass:"select-inline",attrs:{"keep-first":!1,"open-on-focus":!0,data:t.optionList,field:"val"},on:{focus:t.filteredDataObj,input:t.filteredDataObj,select:t.selectDataObj},model:{value:t.hard_wide_detail_type_val,callback:function(e){t.hard_wide_detail_type_val=e},expression:"hard_wide_detail_type_val"}}):t._e()],1)])},staticRenderFns:[]}},DzXd:function(t,e,a){a("gGIh"),a("offo");var n=a("VU/8")(a("tDUV"),a("y8EQ"),"data-v-8a6276d2",null);t.exports=n.exports},ECzC:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合同模板管理"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"模板名称"}},[a("b-autocomplete",{attrs:{data:t.Titles,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"title"},on:{input:t.searchTitle,focus:t.searchTitle},model:{value:t.templateTitle,callback:function(e){t.templateTitle=e},expression:"templateTitle"}})],1),t._v(" "),a("b-field",{attrs:{label:"模板类别"}},[a("b-select",{model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("单笔")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("CPS")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("赠版")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("年框")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("平台服务费")])])],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),t.hasPermission("crm_new.contract.muban.shangchuan")?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"模板名称"}},[a("b-input",{model:{value:t.setTemplateTitle,callback:function(e){t.setTemplateTitle=e},expression:"setTemplateTitle"}})],1),t._v(" "),a("b-field",{attrs:{label:"模板描述"}},[a("b-input",{model:{value:t.setDescription,callback:function(e){t.setDescription=e},expression:"setDescription"}})],1),t._v(" "),a("b-field",{attrs:{label:"模板类别"}},[a("b-select",{model:{value:t.contract_type_id,callback:function(e){t.contract_type_id=e},expression:"contract_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("单笔")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("CPS")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("赠版")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("年框")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("平台服务费")])])],1),t._v(" "),a("b-field",{attrs:{label:"上传文件"}},[a("div",[a("b-upload",{on:{input:t.fileUpload},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("选择文件")])],1)]),t._v(" "),a("div",{staticClass:"tags inline"},t._l(t.files,function(e,n){return a("span",{key:n,staticClass:"tag is-primary"},[t._v("\n                                "+t._s(e.name)+"\n                                "),a("button",{staticClass:"delete is-small",attrs:{type:"button"},on:{click:function(e){t.deleteDropFile(n)}}})])}))],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.addTemplate}},[t._v("上传")])])],1)]):t._e(),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.totalTemplate))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients",attrs:{data:t.templates,striped:!0,loading:t.loading},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"模板名称"}},[t.hasPermission("crm_new.contract.muban.xiazai")?[a("a",{attrs:{href:e.row.file_url,target:"_blank"}},[t._v(t._s(e.row.title))])]:[t._v("\n                        "+t._s(e.row.title)+"\n                    ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"模板描述"}},[t._v("\n                    "+t._s(e.row.description)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"模板类别"}},[t._v("\n                    "+t._s(e.row.contract_type_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[t.hasPermission("crm_new.contract.muban.bianji")?a("a",{staticClass:"button is-link",on:{click:function(a){t.EditTemplate(e.row.id,e.row.title,e.row.description,e.row.contract_type_id)}}},[t._v("编辑")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.muban.shanchu")?a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.deleteTemplate(e.row.id,e.index)}}},[t._v("删除")]):t._e()])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalTemplate,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),t.showEdit?a("div",{staticClass:"modal-background showEdit"},[a("div",{staticClass:"EditBox"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("编辑合同信息是是是")])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"标题"}},[a("b-input",{attrs:{required:""},model:{value:t.toEdit.title,callback:function(e){t.$set(t.toEdit,"title",e)},expression:"toEdit.title"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"描述"}},[a("b-input",{attrs:{required:""},model:{value:t.toEdit.description,callback:function(e){t.$set(t.toEdit,"description",e)},expression:"toEdit.description"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{label:"模板类别",horizontal:"",expanded:""}},[a("b-select",{model:{value:t.toEdit.contract_type_id,callback:function(e){t.$set(t.toEdit,"contract_type_id",e)},expression:"toEdit.contract_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("单笔")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("CPS")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("赠版")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("年框")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("平台服务费")])])],1),t._v(" "),a("div",{staticClass:"z-buttons buttonbox"},[a("a",{staticClass:"button is-primary",on:{click:t.updateTemplate}},[t._v("保存")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.cancelUpdate}},[t._v("取消")])])],1)]):t._e()])},staticRenderFns:[]}},EJhb:function(t,e,a){var n=a("VU/8")(a("ket1"),a("NTgk"),null,null);t.exports=n.exports},EPHI:function(t,e){},EoyU:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{active:t.show,width:640,scroll:"keep"},on:{"update:active":function(e){t.show=e}}},[a("div",{staticClass:"card"},[a("div",{staticClass:"flex-layout"},[a("label",{staticClass:"label"},[t._v("需求名称：")]),t._v(" "),a("b-field",[a("b-input",{staticClass:"search-input-width"})],1)],1),t._v(" "),a("div",{staticClass:"flex-layout"},[a("label",{staticClass:"label"},[t._v("需求部门：")]),t._v(" "),a("b-field",[a("b-input",{staticClass:"search-input-width"})],1)],1),t._v(" "),a("div",{staticClass:"flex-layout"},[a("label",{staticClass:"label"},[t._v("需求地址：")]),t._v(" "),a("b-field",[a("b-input",{staticClass:"search-input-width"})],1)],1),t._v(" "),a("div",{staticClass:"button-group"},[a("button",{staticClass:"button is-primary btn-search"},[t._v("\n                查询\n            ")]),t._v(" "),a("button",{staticClass:"button is-primary btn-search"},[t._v("\n                新建需求\n            ")])])])])},staticRenderFns:[]}},Ev7r:function(t,e,a){a("EPHI");var n=a("VU/8")(a("XwYQ"),a("uMTL"),"data-v-9f4ea4fc",null);t.exports=n.exports},FUzp:function(t,e){},Fqjm:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"用户管理"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"登录名",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.loginNameList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"loginName"},on:{input:t.getLoginName,focus:t.getLoginName,select:t.onLoginNameSelect},model:{value:t.loginName,callback:function(e){t.loginName=e},expression:"loginName"}})],1),t._v(" "),a("b-field",{attrs:{label:"姓名",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.nameList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getName,focus:t.getName,select:t.onNameSelect},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),a("b-field",{attrs:{label:"所属部门",horizontal:""}},[a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"是否组长",horizontal:""}},[a("b-select",{model:{value:t.isGroupLeader,callback:function(e){t.isGroupLeader=e},expression:"isGroupLeader"}},[a("option",{attrs:{value:"-1"}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")]),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("否")])])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"事业部"}},[a("b-select",{model:{value:t.business_id,callback:function(e){t.business_id=e},expression:"business_id"}},[a("option",{attrs:{value:"0"}}),t._v(" "),t._l(t.DEPARTMENT,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])})],2)],1),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")])],1)],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-space-between"},[a("b",[t._v("总数："+t._s(t.totalUsers))])]),t._v(" "),a("div",{staticClass:"z-block-content"},[t.usersData&&t.usersData.length?a("b-table",{attrs:{data:t.usersData,bordered:"","mobile-cards":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"登录名",width:"120"}},[a("b-field",[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.username))])])],1),t._v(" "),a("b-table-column",{attrs:{label:"姓名",width:"120"}},[a("b-field",[e.row.isEdit?a("b-input",{ref:"name_"+e.index,attrs:{required:""},model:{value:e.row.name,callback:function(a){t.$set(e.row,"name",a)},expression:"props.row.name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.name))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"事业部",width:"320"}},[a("b-field",{ref:"user_business_"+e.index},[e.row.isEdit?a("ul",t._l(t.DEPARTMENT,function(n,i){return a("li",{key:i},[a("b-checkbox",{attrs:{"native-value":n.id},on:{input:function(a){t.onBusinessChange(e.row,n)}},model:{value:e.row.selBusiness,callback:function(a){t.$set(e.row,"selBusiness",a)},expression:"props.row.selBusiness"}},[a("span",{class:2===n.level?"strong":""},[t._v(t._s(n.name))])])],1)})):a("div",{staticClass:"z-field-text"},t._l(e.row.selBusinessNames,function(n,i){return a("span",{key:i,class:t.LEVEL.indexOf(n)>-1?"strong":""},[t._v("\n                                    "+t._s(n+(i===e.row.selBusinessNames.length-1?"":"，"))+"\n                                ")])}))])],1),t._v(" "),a("b-table-column",{attrs:{label:"部门"}},[a("b-field",{ref:"department_ids_"+e.index,attrs:{type:e.row.departmentFieldType,message:e.row.departmentFieldMsg}},[e.row.isEdit?a("ul",t._l(t.departments,function(n){return a("li",{key:n.id},[a("b-checkbox",{attrs:{"native-value":n.id},on:{input:function(a){t.onDepartmentChange(e.row)}},model:{value:e.row.selDepartments,callback:function(a){t.$set(e.row,"selDepartments",a)},expression:"props.row.selDepartments"}},[t._v(t._s(n.name))])],1)})):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.selDepartmentNames))])])],1),t._v(" "),a("b-table-column",{attrs:{label:"设置组长",width:"120"}},[a("b-field",[e.row.isEdit?a("b-checkbox",{attrs:{"true-value":1,"false-value":0},model:{value:e.row.is_headman,callback:function(a){t.$set(e.row,"is_headman",a)},expression:"props.row.is_headman"}},[t._v("设置为组长")]):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.is_headman?"是":"否"))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"B级客户上限个数",width:"120"}},[a("b-field",[e.row.isEdit?a("b-input",{ref:"level_b_max_"+e.index,attrs:{type:"number",min:"0",required:""},model:{value:e.row.level_b_max,callback:function(a){t.$set(e.row,"level_b_max",a)},expression:"props.row.level_b_max"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.level_b_max))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("b-field",[e.row.isEdit?a("a",{staticClass:"button is-primary",on:{click:function(a){t.saveUser(e.row,e.index)}}},[t._v("保存")]):a("a",{staticClass:"button is-link",on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")]),t._v(" "),a("button",{staticClass:"button is-link",staticStyle:{"margin-left":"10px"},on:{click:function(a){t.checkUser(e.row)}}},[t._v("删除")])])],1)]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalUsers,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2):t._e()],1)])])},staticRenderFns:[]}},FsW9:function(t,e,a){a("VL37"),a("5all"),a("tw7b");var n=a("VU/8")(a("7teg"),a("N40d"),"data-v-54fdd56b",null);t.exports=n.exports},G2jM:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"formWrapper"},[a("div",{staticClass:"z-form",class:{"z-has-datepicker":t.isEdit}},[t.isEdit?a("b-field",{attrs:{horizontal:"",label:"地区"}},[a("b-radio",{attrs:{"native-value":"native"},model:{value:t.companyArea,callback:function(e){t.companyArea=e},expression:"companyArea"}},[t._v("\n                国内\n            ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"oversea"},model:{value:t.companyArea,callback:function(e){t.companyArea=e},expression:"companyArea"}},[t._v("\n                海外\n            ")])],1):t._e(),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"签约公司名称",type:t.companyNameStatus,message:t.companyNameMsg}},[t.isEdit?a("b-input",{ref:"companyName",attrs:{expanded:"",maxlength:"100",required:""},on:{blur:t.checkCompanyName},model:{value:t.company.company_name,callback:function(e){t.$set(t.company,"company_name",e)},expression:"company.company_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.company_name))])],1),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"所在省份"}},[t.isEdit?a("b-select",{ref:"provinceId",attrs:{expanded:""},model:{value:t.provinceId,callback:function(e){t.provinceId=e},expression:"provinceId"}},t._l(t.provinces,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.province_name))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"注册地址"}},[t.isEdit?a("b-input",{attrs:{maxlength:"200"},on:{blur:function(e){t.company.reg_address=t.company.reg_address.trim()}},model:{value:t.company.reg_address,callback:function(e){t.$set(t.company,"reg_address",e)},expression:"company.reg_address"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.reg_address))])],1):t._e(),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"联系地址"}},[t.isEdit?a("b-input",{ref:"companyAddress",attrs:{maxlength:"200",required:"oversea"===t.companyArea},on:{blur:function(e){t.company.address=t.company.address.trim()}},model:{value:t.company.address,callback:function(e){t.$set(t.company,"address",e)},expression:"company.address"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.address))])],1),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"邮编"}},[t.isEdit?a("b-input",{attrs:{min:"0",type:"number"},model:{value:t.company.zipcode,callback:function(e){t.$set(t.company,"zipcode",e)},expression:"company.zipcode"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.zipcode))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"电话"}},[t.isEdit?a("b-input",{attrs:{min:"0",type:"tel"},model:{value:t.company.tel,callback:function(e){t.$set(t.company,"tel",e)},expression:"company.tel"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.tel))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"传真"}},[t.isEdit?a("b-input",{attrs:{min:"0",type:"tel"},model:{value:t.company.fax,callback:function(e){t.$set(t.company,"fax",e)},expression:"company.fax"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.fax))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"法人代表"}},[t.isEdit?a("b-input",{ref:"companyFrdb",attrs:{maxlength:"20",required:""},model:{value:t.company.frdb,callback:function(e){t.$set(t.company,"frdb",e)},expression:"company.frdb"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.frdb))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"营业执照注册号"}},[t.isEdit?a("b-input",{ref:"companyYyzzzch",attrs:{required:""},model:{value:t.company.yyzzzch,callback:function(e){t.$set(t.company,"yyzzzch",e)},expression:"company.yyzzzch"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.yyzzzch))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"纳税人识别号"}},[t.isEdit?a("b-input",{ref:"companyNsrsbh",attrs:{required:""},model:{value:t.company.nsrsbh,callback:function(e){t.$set(t.company,"nsrsbh",e)},expression:"company.nsrsbh"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.nsrsbh))])],1):t._e(),t._v(" "),a("b-field",{directives:[{name:"show",rawName:"v-show",value:"oversea"===t.companyArea,expression:"companyArea === 'oversea'"}],attrs:{horizontal:"",label:"Swift Code"}},[t.isEdit?a("b-input",{ref:"companySwiftCode",attrs:{type:"text"},model:{value:t.company.swift_code,callback:function(e){t.$set(t.company,"swift_code",e)},expression:"company.swift_code"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.swift_code))])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"开户行"}},[t.isEdit?a("b-input",{ref:"companyBank",attrs:{required:"native"===t.companyArea},model:{value:t.company.bank,callback:function(e){t.$set(t.company,"bank",e)},expression:"company.bank"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.bank))])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"开户账号",message:t.companyMessage,type:"is-danger"}},[t.isEdit?a("div",{staticClass:"control is-clearfix",class:t.companyMessage.length>0?"has-icons-right":""},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.company.bank_number,expression:"company.bank_number"}],ref:"companyBankNumber",staticClass:"input",class:t.companyMessage.length>0?"is-danger":"",attrs:{type:"text",required:"native"===t.companyArea},domProps:{value:t.company.bank_number},on:{blur:t.blurValidator,input:function(e){e.target.composing||t.$set(t.company,"bank_number",e.target.value)}}}),t._v(" "),(t.companyMessage.length>0?"is-danger":"")?a("span",{staticClass:"icon is-right has-text-danger"},[a("i",{staticClass:"mdi mdi-alert-circle mdi-24px"})]):t._e()]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.bank_number))])]),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"年检到期日期"}},[t.isEdit?a("b-datepicker",{ref:"companyDueDate",attrs:{icon:"calendar-today",required:""},model:{value:t.annualInspectionDueDate,callback:function(e){t.annualInspectionDueDate=e},expression:"annualInspectionDueDate"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.annual_inspection_due_date))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"合同回收周期"}},[t.isEdit?a("b-select",{ref:"recoveryCycle",model:{value:t.company.contractRecoveryCycle,callback:function(e){t.$set(t.company,"contractRecoveryCycle",e)},expression:"company.contractRecoveryCycle"}},t._l(t.contractRecoveryCycleList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                    "+t._s(e.value)+"\n                ")])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.company.contractRecoveryCycle))])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{attrs:{horizontal:"",label:"是否一般纳税人"}},[t.isEdit?[a("b-radio",{attrs:{"native-value":"0"},model:{value:t.company.ybnsr,callback:function(e){t.$set(t.company,"ybnsr",e)},expression:"company.ybnsr"}},[t._v("\n                    否\n                ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"1"},model:{value:t.company.ybnsr,callback:function(e){t.$set(t.company,"ybnsr",e)},expression:"company.ybnsr"}},[t._v("\n                    是\n                ")])]:a("div",{staticClass:"z-field-text"},[t._v(t._s(Number(t.company.ybnsr)?"是":"否"))])],2):t._e(),t._v(" "),a("b-field",{staticClass:"z-upload",attrs:{horizontal:"",label:"native"===t.companyArea?"营业执照":"营业执照或其他证明材料",type:t.states.yyzz.status,message:t.states.yyzz.msg}},[t.isEdit?a("b-upload",{ref:"companyYyzzFile",attrs:{disabled:t.states.yyzz.loading,loading:t.states.yyzz.loading,accept:"image/*",required:!t.company.yyzz_image_url},on:{input:function(e){t.fileUpload("yyzz")}},model:{value:t.yyzzFiles,callback:function(e){t.yyzzFiles=e},expression:"yyzzFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.company.yyzz_image_url?a("a",{staticClass:"file-name",attrs:{href:t.company.yyzz_image_url,target:"_blank"}},[t._v("预览")]):t._e()])],1),t._v(" "),"native"===t.companyArea?a("b-field",{staticClass:"z-upload",attrs:{horizontal:"",label:"税务登记",type:t.states.swdj.status,message:t.states.swdj.msg}},[t.isEdit?a("b-upload",{ref:"companySwdjFile",attrs:{disabled:t.states.swdj.loading,loading:t.states.swdj.loading,accept:"image/*",required:!t.company.swdj_image_url},on:{input:function(e){t.fileUpload("swdj")}},model:{value:t.swdjFiles,callback:function(e){t.swdjFiles=e},expression:"swdjFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.company.swdj_image_url?a("a",{staticClass:"file-name",attrs:{href:t.company.swdj_image_url,target:"_blank"}},[t._v("预览")]):t._e()])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{staticClass:"z-upload",attrs:{horizontal:"",label:"开户银行",type:t.states.khyh.status,message:t.states.khyh.msg}},[t.isEdit?a("b-upload",{ref:"companyKhyhFile",attrs:{disabled:t.states.khyh.loading,loading:t.states.khyh.loading,accept:"image/*",required:!t.company.khyh_image_url},on:{input:function(e){t.fileUpload("khyh")}},model:{value:t.khyhFiles,callback:function(e){t.khyhFiles=e},expression:"khyhFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.company.khyh_image_url?a("a",{staticClass:"file-name",attrs:{href:t.company.khyh_image_url,target:"_blank"}},[t._v("预览")]):t._e()])],1):t._e(),t._v(" "),"native"===t.companyArea?a("b-field",{staticClass:"z-upload",attrs:{horizontal:"",label:"纳税人证明",type:t.states.nsrzm.status,message:t.states.nsrzm.msg}},[t.isEdit?a("b-upload",{ref:"companyNsrzmFile",attrs:{disabled:t.states.nsrzm.loading,loading:t.states.nsrzm.loading,accept:"image/*",required:!t.company.nsrzm_image_url},on:{input:function(e){t.fileUpload("nsrzm")}},model:{value:t.nsrzmFiles,callback:function(e){t.nsrzmFiles=e},expression:"nsrzmFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.company.nsrzm_image_url?a("a",{staticClass:"file-name",attrs:{href:t.company.nsrzm_image_url,target:"_blank"}},[t._v("预览")]):t._e()])],1):t._e(),t._v(" "),t.isEdit?[a("a",{staticClass:"button is-primary",on:{click:function(e){t.saveCompanyData(!1)}}},[t._v("保存")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.saveCompanyData(!0)}}},[t._v("保存并提交审核")])]:t.companyId&&1===t.company.approve_status_id?[t.hasPermission("crm_new.company.list.tongguo")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.approvePass()}}},[t._v("通过")]):t._e(),t._v(" "),t.hasPermission("crm_new.company.list.bohui")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.approveReject()}}},[t._v("驳回")]):t._e()]:t._e(),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")])],2)])},staticRenderFns:[]}},G39i:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"我的回款认领"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门"}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.department_id,callback:function(e){t.department_id=e},expression:"department_id"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"认领人"}},[t.userReadonly?a("b-input",{attrs:{disabled:t.userReadonly},model:{value:t.currUserName,callback:function(e){t.currUserName=e},expression:"currUserName"}}):a("b-select",{model:{value:t.user_id,callback:function(e){t.user_id=e},expression:"user_id"}},t._l(t.departmentUsers,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"回款状态"}},[a("b-select",{model:{value:t.defaultStatus,callback:function(e){t.defaultStatus=e},expression:"defaultStatus"}},t._l(t.isStatus,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"认领时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{"min-date":t.enteredDateStart},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"交易时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.endCashCollectionDate},model:{value:t.startCashCollectionDate,callback:function(e){t.startCashCollectionDate=e},expression:"startCashCollectionDate"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{"min-date":t.startCashCollectionDate},model:{value:t.endCashCollectionDate,callback:function(e){t.endCashCollectionDate=e},expression:"endCashCollectionDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onSelectedCompany},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.contractsNumber,expression:"contractsNumber"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.contractsNumber},on:{input:function(e){e.target.composing||(t.contractsNumber=e.target.value)}}})])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportALL}},[t._v("导出")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.data,loading:t.isLoading,striped:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"transaction_number",label:"交易流水号"}},[t._v("\n                    "+t._s(e.row.transaction_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_number",label:"合同号"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"client_name",label:"客户名称"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"signing_company_name",label:"甲方签约公司"}},[t._v("\n                    "+t._s(e.row.signing_company_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_username",label:"认领人"}},[t._v("\n                    "+t._s(e.row.detail_username)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_amount",label:"认领金额"}},[t._v("\n                    "+t._s(e.row.detail_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"currency_id",label:"币种"}},[t._v("\n                    "+t._s(t.currencies["type_"+e.row.currency_id])+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"is_deduct_money",label:"抵扣应收"}},[t._v("\n                    "+t._s(t.isDeductMoney[e.row.is_deduct_money])+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_entered_date",label:"认领时间"}},[t._v("\n                    "+t._s(e.row.detail_entered_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"cash_collection_date",label:"交易时间"}},[t._v("\n                    "+t._s(e.row.cash_collection_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[t._v("\n                    "+t._s(e.row.remark)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_status_text",label:"状态"}},[t._v("\n                    "+t._s(e.row.detail_status_text)+"\n                ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>1,expression:"total > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},GdUM:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={name:"SuperManage",data:function(){return{selected:null,showContract:!1,contractColumns:[{field:"contract_number",label:"合同编号"},{field:"contract_name",label:"合同名称"}],contractNumber:"",contractName:"",change_field:"",old_contract:"",new_contract:null,contractList:[],contractResult:{contract_name:"",contract_number:"",contract_charge_name:"",account_period:""},contract:[{id:1,name:"合同编号"},{id:2,name:"合同名称"},{id:3,name:"合同负责人"},{id:4,name:"客户账期"}],saveType:0,codeList:[],charge_userName:""}},watch:{selected:function(){this.selected&&(this.showContract=!1,this.contractResult=this.selected,this.contractName=this.contractResult.contract_name)}},methods:{getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.charge_userName,role_code:"role-crm-shangwu"}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},onChargenameSelected:function(t){t&&(this.new_contract=t.id)},searchContract:function(){var t=this;this.ajax({url:"/contract/get_contract_by_number",params:{contract_number:this.contractNumber}}).then(function(e){0===e.error_code&&(1===e.data.length?(t.contractResult=e.data[0],t.contractName=t.contractResult.contract_name):(t.showContract=!0,t.contractList=e.data))})},selectContract:function(t){switch(this.saveType=t,t){case 1:this.old_contract=this.contractResult.contract_number;break;case 2:this.old_contract=this.contractResult.contract_name;break;case 3:this.old_contract=this.contractResult.contract_charge_name,this.getCodeList();break;case 4:this.old_contract=this.contractResult.account_period}},saveContract:function(){var t=this;if(!this.contractResult.id)return void this.$dialog.alert("请输入合同号，查询数据");if(!this.new_contract)return void this.$dialog.alert("请填写变更字段");var e={};switch(this.saveType){case 1:e={id:this.contractResult.id,contract_number:this.new_contract};break;case 2:e={id:this.contractResult.id,contract_name:this.new_contract};break;case 3:e={id:this.contractResult.id,user_id:this.new_contract};break;case 4:e={id:this.contractResult.id,account_period:this.zDateFormatter(this.new_contract)}}this.ajax({url:"/contract/update_contract_online_data",data:e,method:"post"}).then(function(e){console.log(e),0===e.error_code?(t.$dialog.alert("操作成功"),t.contractNumber="",t.contractName="",t.old_contract="",t.new_contract="",t.change_field=""):t.$dialog.alert(e.error_msg)})}}}},"Gk/c":function(t,e,a){a("9d6h");var n=a("VU/8")(a("BY7w"),a("2Q8F"),"data-v-565a9e2a",null);t.exports=n.exports},"Gp+1":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),s=n(i),r=a("O4Lo"),o=n(r),c=a("LZT1"),l=n(c),d=a("lHK6"),u=n(d),_=a("Km5v"),p=n(_);e.default={props:{isCoop:{type:Boolean,default:!1}},data:function(){return{isChecked:!0,checkedRows:[],companyName:"",companyList:[],departments:[],departmentId:"",contractCharges:[],contractChargeId:"",contractChargeSelected:null,clientLists:[],clientName:"",clientListSelected:null,signingCompanys:[],signingCompany:"",signingCompanySelected:null,isFetching_2:!1,contractName:"",contractNames:[],contractNumber:"",contractNumberList:[],isFetching_3:!1,enteredDateStart:null,enteredDateEnd:null,cooperation_type:"",cooperation_obj:null,hard_wide_detail_type:"",signingCompanySortList:[{name:"",id:-1},{name:"直客",id:0},{name:"代理",id:1}],signingCompanySortId:"",opposingCompanyList:[{name:"",id:-1},{name:"北京值得买科技股份有限公司",id:0},{name:"北京值得买科技股份有限公司上海分公司",id:1},{name:"北京值得买科技股份有限公司青岛分公司",id:2},{name:"青岛无忧直购网络科技有限公司",id:3},{name:"青岛星罗创想网络科技有限公司",id:4},{name:"青岛优讯创想信息技术有限公司",id:5}],opposingCompanyId:"",contractSortList:[{name:"",id:-1},{name:"旅游",id:0},{name:"金融",id:1},{name:"汽车",id:2},{name:"其他",id:3}],contractSortId:"",applyPeopleList:[],applyPeopleId:"",applyPeopleSelected:null,applyPeopleIdLone:null,lone:!1,waibumeijie:!1,reviewStatusList:[{name:"",id:-1},{name:"未提交",id:0},{name:"审核中",id:1},{name:"审核通过",id:2},{name:"驳回",id:3},{name:"再驳回待修改",id:4}],reviewStatusId:"",contractTypeList:[{name:"",id:-1},{name:"单笔",id:0},{name:"赠版",id:2},{name:"资源置换",id:8}],contractTypeId:"",client_type_id:0,total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,data:[],isLoading:!1,userInfoId:this.$root.crmUser.id,meiJieZuZhang:null,forSearch:!0,levelData:[],level:null,contract_brand_id:"",contract_second_brand_id:"",clickGet:0,clickReset:0,showLogModal:!1,logData:[],logColumns:[{field:"updated_user",label:"审核人"},{field:"approve_type",label:"审核类型"},{field:"approve_status",label:"审核状态"},{field:"approve_step",label:"审核步骤"},{field:"updated_date",label:"审核时间"},{field:"reason",label:"驳回原因"}],urlParams:{}}},watch:{currPage:function(t){this.questFn(t)},urlParams:function(t){var e=(0,s.default)({},t),a=[];e.page=1===this.currPage?null:this.currPage;for(var n in e){var i=e[n];if(i){var r=encodeURIComponent(n)+"="+encodeURIComponent(i);a.push(r)}}var o=this.$router.currentRoute.path+"?"+a.join("&");this.$router.replace(o)}},components:{CooperationSelect:p.default},created:function(){var t=this.$root.user.roleCodes.split(", ");this.meiJieZuZhang=function(){return t.indexOf("role-crm-meijiezuzhang")>-1}(),this.getDepartments(),this.getContractCharges(),this.getClientLists(),this.getSigningCompanys(),this.getContractNumberList();for(var e=[],a=0,n=t;a<n.length;a++)n[a].indexOf("role-crm")>-1&&e.push(n[a]);1!==e.length||"role-crm-mejierenyuan"!==e[0]&&"role-crm-waibumeijie"!==e[0]?this.getApplyPeopleList():(this.applyPeopleIdLone=this.$root.crmUser.name,this.applyPeopleIdNum=this.$root.crmUser.id,this.lone=!0),1===e.length&&"role-crm-waibumeijie"===e[0]?this.waibumeijie=!0:this.waibumeijie=!1,this.initQueryData(),this.questFn();var i=this;document.onkeydown=function(t){i.ifEnter(t)&&i.forSearch&&i.onQueryClick()},this.getLevel(),this.getCompany()},computed:{filterContractCharges:function(){var t=this;return this.contractCharges.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.contractChargeId.toLowerCase())>=0})},filterClientLists:function(){var t=this;return this.clientLists.filter(function(e){return e.client_name.toString().toLowerCase().indexOf(t.clientName.toLowerCase())>=0})},filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})},filterapplyPeople:function(){var t=this;return this.applyPeopleList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.applyPeopleId.toLowerCase())>=0})},filtercontractNumberList:function(){var t=this;return this.contractNumberList.filter(function(e){return e.contract_number.toString().toLowerCase().indexOf(t.contractNumber.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},methods:{searchContract:(0,o.default)(function(){this.isFetching_2=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},onClientSelected:function(t){t&&(this.clientName=t.client_name,this.clientListSelected=t.client_id)},onCompanySelected:function(t){t&&(this.signingCompany=t.company_name,this.signingCompanySelected=t.id)},getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name)},getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")},getDepartments:function(){var t=this;return this.ajax({url:"/department/index"}).then(function(e){if(0===e.error_code){var a=(0,l.default)(e.data);t.departments=a}})},getContractCharges:function(){var t=this;return this.ajax({url:"/user/index",method:"post",data:{is_delete:0}}).then(function(e){0===e.error_code&&(t.contractCharges=e.data.rows)})},getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list"}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},getClientLists:function(){var t=this;return this.ajax({url:"/client/get_client_list",params:{client_level_id_neq:2}}).then(function(e){0===e.error_code&&(t.clientLists=e.data.list)})},getApplyPeopleList:function(){var t=this;return this.ajax({url:"/user/index",method:"post",data:{is_delete:0}}).then(function(e){0===e.error_code&&(t.applyPeopleList=e.data.rows)})},getContractNumberList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber,page_size:30}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},handleOption:function(t){return null!==t&&""!==t&&"undefined"!==t},questFn:function(t){var e=this;Number(t)||(t=1,this.currPage=1);var a={loading:this.$loading.open(),url:"/contract_applied/get_contract_lists",params:{page:t,page_size:this.perPage}},n=this.handleOption;n(this.departmentId)&&(a.params.department_id=this.departmentId),n(this.contractChargeId)&&n(this.contractChargeSelected)&&(a.params.user_id=this.contractChargeSelected),n(this.clientName)&&(a.params.client_name=this.clientName),n(this.signingCompany)&&(a.params.company_name=this.signingCompany),n(this.contractName)&&(a.params.contract_name=this.contractName),n(this.contractNumber)&&(a.params.contract_number=this.contractNumber),n(this.enteredDateStart)&&(a.params.start_date=this.zDateFormatter(this.enteredDateStart)),n(this.enteredDateEnd)&&(a.params.end_date=this.zDateFormatter(this.enteredDateEnd)),n(this.cooperation_type)&&(a.params.cooperation_type=this.cooperation_type),n(this.hard_wide_detail_type)&&(a.params.hard_wide_detail_type=this.hard_wide_detail_type),n(this.signingCompanySortId)&&(a.params.signing_company_type_id=this.signingCompanySortId),n(this.opposingCompanyId)&&(a.params.party_b_name=this.opposingCompanyId),this.lone?n(this.applyPeopleIdNum)&&(a.params.apply_user_id=this.applyPeopleIdNum):n(this.applyPeopleId)&&n(this.applyPeopleSelected)&&(a.params.apply_user_id=this.applyPeopleSelected),n(this.reviewStatusId)&&(a.params.applied_approved_status=this.reviewStatusId),n(this.contractTypeId)&&-1!==this.contractTypeId&&(a.params.contract_type_id=this.contractTypeId),n(this.companyName)&&(a.params.group_name=this.companyName),this.loading=!0;var i="";i=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"",a.params.contract_brand_id=i,a.params.client_type_id=Number(this.client_type_id);var r={client_type_id:Number(this.client_type_id),departmentId:this.departmentId,contractChargeId:this.contractChargeId,clientName:this.clientName,signing_company_id:this.signing_company_id,signingCompany:this.signingCompany,contractName:this.contractName,contractNumber:this.contractNumber,enteredDateStart:this.enteredDateStart,enteredDateEnd:this.enteredDateEnd,cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type,signingCompanySortId:0===this.signingCompanySortId?"0":this.signingCompanySortId,opposingCompanyId:this.opposingCompanyId,contract_brand_id:i,applyPeopleId:this.lone?this.applyPeopleIdLone:this.applyPeopleId,reviewStatusId:0===this.reviewStatusId?"0":this.reviewStatusId,contractTypeId:0===this.contractTypeId?"0":this.contractTypeId};this.ajax(a).then(function(t){if(0===t.error_code){e.checkedRows=[],e.urlParams=(0,s.default)({},r);var a=t.data.lists||[];e.data=a,e.total=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1)}})},doContract:function(){var t=[];return this.checkedRows.forEach(function(e){t.push(e.ad_project_id)}),t.join(",")},moreChange:function(){var t="";this.checkedRows.length||(this.checkedRows=this.data),t=this.doContract(),console.log(t),this.$router.push("/contract_change/"+t+"/more/")},getAdUrl:function(){this.checkedRows.length?this.ajax({url:"/contract_applied/add_material_batch",method:"post",data:{ad_project_ids:this.doContract()},successTip:!0}).then(function(t){console.log(t.data.url),window.location.href=t.data.url}):this.$toast.open({duration:3e3,message:"请选择添加合同",position:"is-top",type:"is-danger"})},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?this.questFn(t):this.currPage=1,this.clickGet+=1},resetParams:function(){this.checkedRows=[],this.client_type_id=0,this.departmentId="",this.contractChargeId="",this.contractChargeSelected=null,this.signingCompany="",this.signingCompanySelected=null,this.clientName="",this.clientListSelected=null,this.contractName="",this.contractNumber="",this.enteredDateStart=null,this.enteredDateEnd=null,this.cooperation_type="",this.hard_wide_detail_type="",this.signingCompanySortId="",this.opposingCompanyId="",this.contractSortId="",this.level=null,this.contract_brand_id="",this.contract_second_brand_id="",this.applyPeopleSelected=null,this.applyPeopleId="",this.reviewStatusId="",this.contractTypeId="",this.currPage=1,this.companyName=""},pageHandle:function(t){this.currPage=t},rejectHandle:function(t){var e=this;this.$dialog.confirm({message:"您确定要再驳回此合同？",onConfirm:function(){e.ajax({loading:e.$loading.open(),url:"/contract_approval_options/contract_applied_approved_recall",method:"post",data:{contract_id:t.id},successTip:!0}).then(function(e){0===e.error_code&&(t.applied_approved_status=4,t.applied_approved_status_name="再驳回待修改")})}})},deleteHandle:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此合同吗？",onConfirm:function(){return a.ajax({loading:a.$loading.open(),url:"/contract/delete_contract",params:{contract_id:t.id},successTip:!0}).then(function(t){0===t.error_code&&(a.data.splice(e,1),a.questFn())})}})},showClientLog:function(t){var e=this;this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/contract/get_contract_approve_log",params:{contract_id:t,type:2}}).then(function(t){0===t.error_code&&(e.logData=t.data)})},initQueryData:function(){var t=this,e=this.$route.query;if(console.log("querys=",e),!(0,u.default)(e)){for(var a in e)!function(a){var n=e[a];switch(a){case"departmentId":t.departmentId=n;break;case"contractChargeId":t.contractChargeId=n;break;case"clientName":t.clientName=n;break;case"signingCompany":t.signingCompany=n;break;case"contractName":t.contractName=n;break;case"contractNumber":t.contractNumber=n;break;case"enteredDateStart":t.enteredDateStart=new Date(n);break;case"enteredDateEnd":t.enteredDateEnd=new Date(n);break;case"cooperation_type":t.cooperation_type=+n;break;case"hard_wide_detail_type":t.hard_wide_detail_type=+n?+n:n;break;case"signingCompanySortId":t.signingCompanySortId=n;break;case"opposingCompanyId":t.opposingCompanyId=n;break;case"contract_brand_id":t.contract_brand_id=+n.split("_")[0],t.contract_second_brand_id=n,t.getLevel().then(function(){t.levelData.forEach(function(e){e.id===+n.split("_")[0]&&(t.level=e)})});break;case"applyPeopleId":t.lone?t.applyPeopleIdLone=n:t.applyPeopleId=n;break;case"reviewStatusId":t.reviewStatusId=n;break;case"contractTypeId":t.contractTypeId=n;break;case"client_type_id":t.client_type_id=n;break;case"group_name":t.companyName=n}}(a)}},getCooperation:function(t,e){if(this.cooperation_obj=t,this.cooperation_type=this.cooperation_obj.cooperation_type,e)this.hard_wide_detail_type=e;else{var a=[];this.cooperation_obj.level&&this.cooperation_obj.level.length?(this.cooperation_obj.level.map(function(t){a.push(t.id)}),this.hard_wide_detail_type=a.join(",")):this.hard_wide_detail_type=e}}}}},GwlV:function(t,e){},"H+Rs":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-contact-list"},[t.contacts.length?a("b-table",{attrs:{data:t.contacts,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"姓名"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"contactName_"+e.index,attrs:{expanded:"",required:"",maxlength:"10"},model:{value:e.row.contact_name,callback:function(a){t.$set(e.row,"contact_name",a)},expression:"props.row.contact_name"}})],1):[t._v("\n                    "+t._s(e.row.contact_name)+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"电话"}},[e.row.isEdit?a("b-field",{attrs:{type:e.row.fieldType,message:e.row.fieldMessage}},[a("b-input",{ref:"contactPhone_"+e.index,attrs:{type:"tel",required:"",expanded:""},on:{blur:function(a){t.checkContactDuplicate(e.index)}},model:{value:e.row.tel,callback:function(a){t.$set(e.row,"tel",a)},expression:"props.row.tel"}})],1):[t._v(t._s(e.row.tel))]],2),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"130"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveContact(e.index)}}},[t._v("保存")]):a("button",{staticClass:"button is-link",on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")]),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteContact(e.index,e.row)}}},[t._v("删除")])])]}}])}):t._e(),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addContact}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1)],1)},staticRenderFns:[]}},H61S:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),s=n(i),r=a("//Fk"),o=n(r),c=a("mvHQ"),l=n(c),d=a("LZT1"),u=n(d),_=a("g7r0"),p=n(_),m=a("O4Lo"),h=n(m);e.default={name:"CostManageList",data:function(){return{companyName:"",companyList:[],isHeader:!1,isFetching:!1,isFetching_2:!1,isFetching_3:!1,departments:[],loading:!1,contracts:[],sum:{actual_details_sum:"",actual_cost_sum:"",estimated_cost_sum:""},departmentId:"",departmentName:null,departmentReadonly:!1,userId:"",userName:"",users:[],contractDirector:[],userReadonly:!1,clientList:[],clientId:"",clientName:"",brandId:"",brands:[],brand_title:"",companies:[],signingCompany:"",signingCompanyId:"",contractName:"",contractNumber:"",contractNumberList:[],contractNames:[],partyName:"",totalContracts:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,checkedRows:[],isChecked:!0,clickGet:0,clickReset:0,costApprovalStatus:{0:"未提交",1:"待审核",2:"被驳回",3:"已关闭"},estimated_start_time:null,estimated_end_time:null,costApprovalStatusID:null,DEPARTMENT:JSON.parse((0,l.default)(p.default)),amounts:null,showLogModal:!1,logData:[],logColumns:[{field:"updated_user",label:"审核人"},{field:"approve_status",label:"审核状态"},{field:"approve_step",label:"审核步骤"},{field:"updated_date",label:"审核时间"},{field:"reason",label:"驳回原因"}]}},watch:{currPage:function(){var t=!1;t=!(this.clickReset>this.clickGet),this.getCostList(t)},page:function(t){this.currPage=t||1},departmentId:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.userId=null,this.getDirector({department_id:t}))}},created:function(){this.DEPARTMENT[0]="",this.getCompany(),this.getDepartment(),this.getCostList()},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},methods:{getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name)},onUserSelected:function(t){t&&(this.userId=t.id)},isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:t}).then(function(t){0===t.error_code&&t.data&&t.data.rows?e.contractDirector=t.data.rows:e.contractDirector=[]})},searchCompany:(0,h.default)(function(){this.isFetching=!0,this.getCompanies()},500),searchContract:(0,h.default)(function(){this.isFetching_2=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},searchContractList:(0,h.default)(function(){this.isFetching_3=!0,this.getContractList()},500),getContractList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.signingCompany}}).then(function(e){t.companies=e.data.lists,t.isFetching=!1})},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list",params:{title:this.brand_title,user_id:Number(this.userId)}}).then(function(e){t.brands=e.data})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,u.default)(e.data);t.departments=a})},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brand_title=t.title)},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},onCompanySelected:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?this.getCostList(t):this.currPage=1,this.clickGet+=1},makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},getCostList:function(t){var e=this,a={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,contract_number:this.contractNumber,contract_name:this.contractName,party_b_name:this.partyName,cost_approval_status:this.costApprovalStatusID,estimated_start_time:this.makeStringDate(this.estimated_start_time),estimated_end_time:this.makeStringDate(this.estimated_end_time),group_name:this.companyName,page:this.currPage,page_size:this.perPage};console.log(11,a),this.loading=!0,new o.default(function(a,n){e.isShangwu()?t?a():(e.contractDirector=[],1===e.$root.crmUser.is_headman?(e.isHeader=!0,a()):(e.isRole(e.ROLE.shangwuzhichi)?console.log("shangwuzhichi"):(e.isHeader=!1,e.departmentReadonly=!0,e.userReadonly=!0,e.contractDirector=[{name:e.$root.crmUser.username,id:e.$root.crmUser.id}],e.userName=e.$root.crmUser.name,e.userId=e.$root.crmUser.id,e.departmentId=e.$root.crmUser.department_id,e.departmentName=e.$root.crmUser.department_name),a())):a()}).then(function(){e.urlParams=(0,s.default)({},a),e.ajax({url:"/contract_cost/getContractCostList",params:a}).then(function(t){e.checkedRows=[],e.totalContracts=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1),e.contracts=t.data.lists,e.sum=t.data.sum;for(var a=0;a<e.contracts.length;a++)!function(t){e.contracts[t].bianji=function(){return!!e.hasPermission("crm_new.cbgl.cbgl.bjcb")&&[0,2].indexOf(e.contracts[t].cost_approval_status)>-1},e.contracts[t].bohui=function(){return!!e.hasPermission("crm_new.cbgl.cbgl.bjcb")&&[1,3].indexOf(e.contracts[t].cost_approval_status)>-1},e.contracts[t].tijiao=function(){return!!e.hasPermission("crm_new.cbgl.cbgl.tj")&&[0,2].indexOf(e.contracts[t].cost_approval_status)>-1}}(a);e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})})},resetParams:function(){this.checkedRows=[],this.contractDirector.length>1&&(this.userId=null),(this.isHeader||!this.isShangwu()||this.isRole(this.ROLE.shangwuzhichi))&&(this.departmentId="",this.userId="",this.userName=""),this.clientId=null,this.clientName=null,this.brands=[],this.brand_title="",this.brandId="",this.signingCompany="",this.signingCompanyId="",this.contractNumber="",this.contractName="",this.partyName=null,this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1,this.costApprovalStatusID=null,this.companyName="",this.estimated_start_time=null,this.estimated_end_time=null},doContract:function(){var t=[];return this.checkedRows.forEach(function(e){t.push(e.contract_id)}),t.join(",")},submitAll:function(t,e){var a="";return a=t?this.doContract():e.contract_id,this.ajax({url:"/contract_cost/costRefer",method:"post",data:{contract_ids:a}}).then(function(t){0===t.error_code&&window.location.reload()})},rejectCost:function(t){var e={contract_id:t,status:0};return this.ajax({url:"/contract_cost/changeCostStatus",method:"post",data:e}).then(function(t){console.log(t),0===t.error_code&&window.location.reload()})},exportALL:function(){var t=this,e={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,contract_number:this.contractNumber,contract_name:this.contractName,party_b_name:this.partyName,cost_approval_status:this.costApprovalStatusID,group_name:this.companyName,page:this.currPage,page_size:this.perPage,estimated_start_time:this.makeStringDate(this.estimated_start_time),estimated_end_time:this.makeStringDate(this.estimated_end_time),contract_ids:this.doContract()};this.ajax({url:"/contract_cost/exportContractCostLists",params:e}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},showClientLog:function(t){var e=this;this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/contract/get_contract_approve_log",params:{contract_id:t,type:4}}).then(function(t){0===t.error_code&&(e.logData=t.data)})}}}},HMmD:function(t,e,a){a("IODh"),a("S+il");var n=a("VU/8")(a("q37w"),a("IHVa"),"data-v-1fe0944a",null);t.exports=n.exports},HXef:function(t,e,a){var n=a("VU/8")(a("yoR7"),a("2u47"),null,null);t.exports=n.exports},Hhng:function(t,e,a){a("UBJS");var n=a("VU/8")(a("tDx6"),a("7yFa"),"data-v-088ed42b",null);t.exports=n.exports},Hoix:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),s=n(i),r=a("woOf"),o=n(r),c=a("LlsJ"),l=a("cUls"),d=a("NDNc"),u=a("ZpP4"),_=a("imj+"),p=a("d9Mn"),m=a("I4uM"),h=a("QgFC"),f={1:"电商",2:"品牌商",3:"店铺",4:"联盟"},v=["clientName","clientType","userName","brandName","productLineId","accessMerchant","merchantNumber","accessLinkstar","linkstarNumber","countryId","provinceId","cityId","areaId","address"],b={};e.default={props:["clientId","isEdit","isAdd"],data:function(){return{CLIENT_TYPES:f,ifReject:!1,rejectReason:"",userName:"",userId:"",showReg:!1,brands:[],productLines:[],productLineName:this.$route.query.product_line_name||"",countries:c.country,provinces:d.province,provinceId:"",cityId:"",areaId:"",brandId:this.$route.query.brand_id||"",first:!0,brandName:this.$route.query.brand||"",brandChangeNum:0,productLineId:this.$route.query.product_line_id||"",newClientId:"",showCheckDuplicate:!1,clientName:this.$route.query.brand+"-"+this.$route.query.product_line_name||"",client_type_id:this.$route.query.client_type||"",brand_product_type:this.$route.query.brand_product_type||"",client:{client_name:this.$route.query.brand+"-"+this.$route.query.product_line_name||"",clientNameStatus:"",clientNameMsg:"",brand:this.$route.query.brand||"",brand_id:this.$route.query.brand_id||"",product_line_id:this.$route.query.product_line_id||"",product_line_name:this.$route.query.product_line_name||"",brand_product_type:this.$route.query.brand_product_type||"",is_sjzx:0,is_xlsm:0,is_ka:2,is_auto:1,newest_degree:0,accessLinkstar:0,client_type_id:"",country_id:"",address:"",sjzx_number:"",xlsm_number:"",referrer_name:""},checkClientsResult:[]}},watch:{brandId:function(t){t?(this.getProductLines(t),this.productLineId="",this.productLineName=""):(this.productLineId="",this.productLineName="",this.productLines=[])},provinceId:function(t){this.cityId=""},"client.client_name":function(t){this.clientName=t},"client.client_type_id":function(t){this.client_type_id=t},brandName:function(t){this.client.client_name=t+"-"+this.productLineName},"client.brand":function(t){this.isEdit?(console.log("---------this.client.brand--------",t,this.brandId),this.client.client_name=this.brandName+"-"+this.productLineName,this.$forceUpdate()):this.client.client_name=this.client.brand+"-"+this.client.product_line_name,this.clientName=this.client.client_name,console.log("00000",this.clientName)},"client.product_line_name":function(t){this.productLineName=t,this.client.client_name=this.client.brand+"-"+this.productLineName,this.clientName=this.client.client_name}},computed:{filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.client.brand.toLowerCase())>=0})},cities:function(){return this.provinceId?_.city[this.provinceId]:[]},areas:function(){return this.cityId?m.area[this.cityId]:[]},provinceName:function(){return this.provinceId?u.province_object[this.provinceId].name:""},cityName:function(){return this.cityId?p.city_object[this.cityId].name:""},areaName:function(){return this.areaId?h.area_object[this.areaId].name:""}},filters:{countryName:function(t){return l.countryObject[t]&&l.countryObject[t].name}},created:function(){this.initUserData(),this.isEdit?(this.getBrands(),this.clientId&&this.getClientData(),this.brandId&&this.getProductLines(this.brandId)):this.getClientData()},methods:{checkReg:function(){if(""!==this.client.referrer_name){/^[a-zA-Z0-9\u4E00-\u9FA5]+$/.test(this.client.referrer_name)?this.showReg=!1:this.showReg=!0}},onChange:function(t){console.log(t)},getClientData:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/client/get_client_by_id",params:{client_id:this.clientId}}).then(function(e){b=(0,o.default)({},e.data),t.client=e.data,t.$emit("getClient",t.client),t.client.user_id&&(t.userId=t.client.user_id,t.userName=t.client.principal_user),t.isEdit&&(t.brand_product_type=t.client.brand_product_type,t.brandId=t.client.brand_id,t.first=!0,t.brandName=t.client.brand,t.provinceId=t.getProvinceId(t.client.province_name),t.$nextTick(function(){t.cityId=t.getCityId(t.client.city_name),t.$nextTick(function(){t.areaId=t.getAreaId(t.client.district_name)})}))})},initUserData:function(){var t=this.$root;t.crmUser&&(this.userName=t.crmUser.name,this.userId=t.crmUser.id)},checkClientName:function(){var t=this;this.client.client_name=this.client.client_name.trim(),0!==this.client.client_name.length&&(this.isEdit&&this.clientId&&this.client.client_name===b.client_name||this.ajax({url:"/client/check_client_name",params:{client_name:this.client.client_name}}).then(function(e){30012===e.error_code?(t.client.clientNameStatus="is-danger",t.client.clientNameMsg=e.error_msg):(t.client.clientNameStatus="",t.client.clientNameMsg="")}))},getProductLines:function(t){var e=this;return this.ajax({url:"/brand/get_product_line_by_brand_id",params:{brand_id:t}}).then(function(t){e.productLines=t.data,console.log("products: ",t.data),e.isEdit&&e.first&&(e.first=!1,console.log("productId: ",e.client.product_line_id,new Date),e.productLineId=e.client.product_line_id)})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list"}).then(function(e){t.brands=e.data})},onBrandSelected:function(t){console.log("------brandId--------",t),t&&(this.brandChangeNum+=1,this.brandId=t.brand_id,this.brandName=t.title)},clientDataValidate:function(t){var e=this,a=[];return t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(n.checkHtml5Validity()||a.push(n))}),!a.length||(a[0].focus(),!1)},saveClientData:function(t){var e=this;if(this.clientDataValidate(v)&&!this.showReg){var a=this.isEdit&&this.clientId,n=this.client,i={client_type_id:n.client_type_id,client_name:n.client_name,brand_id:this.brandId,product_line_id:this.productLineId,user_id:this.userId,is_sjzx:n.is_sjzx,sjzx_number:n.sjzx_number,is_xlsm:n.is_xlsm,xlsm_number:n.xlsm_number,country_id:n.country_id,province_name:this.provinceName,city_name:this.cityName,district_name:this.areaName,address:n.address,hand:t?1:0,is_ka:n.is_ka,is_auto:n.is_auto,referrer_name:n.referrer_name},s="/client/add_submit_client";return a&&(s="/client/update_submit_client",i.client_id=this.clientId),this.ajax({loading:this.$loading.open(),method:"post",url:s,data:i,successTip:!0}).then(function(t){0===t.error_code&&(a?(e.$router.push("/clients/"+e.clientId+"/edit?activeTab=1"),window.location.reload()):(e.newClientId=t.data.client_id,e.$emit("clientsaved",e.newClientId),e.$router.push("/clients/"+e.newClientId+"/add?activeTab=1")))})}},onBrandBlur:function(){this.brandName="",this.brandId=""},getProvinceId:function(t){var e=!0,a=!1,n=void 0;try{for(var i,r=(0,s.default)(d.province);!(e=(i=r.next()).done);e=!0){var o=i.value;if(o.name===t)return o.id}}catch(t){a=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}return""},getCityId:function(t){var e=!0,a=!1,n=void 0;try{for(var i,r=(0,s.default)(this.cities);!(e=(i=r.next()).done);e=!0){var o=i.value;if(o.name===t)return o.id}}catch(t){a=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}return""},getAreaId:function(t){var e=!0,a=!1,n=void 0;try{for(var i,r=(0,s.default)(this.areas);!(e=(i=r.next()).done);e=!0){var o=i.value;if(o.name===t)return o.id}}catch(t){a=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}return""},approvePass:function(){var t=this;return this.ajax({url:"/client/approve_status_pass",method:"post",successTip:!0,loading:this.$loading.open(),data:{client_id:this.clientId}}).then(function(e){0===e.error_code&&(t.client.approve_status_id=2,t.$router.push("/pending_clients"))})},toReject:function(){this.ifReject?this.ifReject=!1:this.ifReject=!0,this.rejectReason=""},approveReject:function(){var t=this;if(this.clientDataValidate(["rejectReason_ref"]))return this.ajax({url:"/client/approve_status_reject",method:"post",successTip:!0,loading:this.$loading.open(),data:{client_id:this.clientId,reason:this.rejectReason}}).then(function(e){0===e.error_code&&(t.client.approve_status_id=3,t.$router.push("/pending_clients"),t.ifReject=!1)})},checkDuplicate:function(){var t=this;if(this.showCheckDuplicate=!0,this.checkClientsResult=[],0!==this.clientName.trim().length)return this.ajax({url:"/client/client_name_duplicate_checking",loading:this.$loading.open(),params:{client_name:this.clientName}}).then(function(e){0===e.error_code&&(t.checkClientsResult=e.data.list||[])})},selectLine:function(t){console.log("hello----");var e=this.productLines.filter(function(e){return e.product_line_id===t});e.length?(this.productLineName=e[0].product_line_name,this.client_type_id=e[0].client_type_id,this.brand_product_type=e[0].brand_product_type_name):(this.productLineName="",this.client_type_id="",this.brand_product_type=""),this.isEdit?this.client.client_name=this.brandName+"-"+this.productLineName:this.client.client_name=this.client.brand+"-"+this.client.product_line_name,this.clientName=this.client.client_name}}}},HqxH:function(t,e,a){a("ViwI");var n=a("VU/8")(a("5tWb"),a("spla"),null,null);t.exports=n.exports},I3gy:function(t,e){},IHVa:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合同列表"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门",horizontal:""}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团名称",horizontal:""}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"产品线类型"}},[a("b-select",{model:{value:t.brand_product_type,callback:function(e){t.brand_product_type=e},expression:"brand_product_type"}},t._l(t.levelData,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.val))])}))],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brands,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"title"},on:{input:t.getBrands,focus:t.getBrands,select:t.onBrandSelected},model:{value:t.brand_title,callback:function(e){t.brand_title=e},expression:"brand_title"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companies,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.partyName,callback:function(e){t.partyName=e},expression:"partyName"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},on:{focus:t.searchContractList,input:t.searchContractList},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"发布额确认时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.confirmDateEnd},model:{value:t.confirmDateStart,callback:function(e){t.confirmDateStart=e},expression:"confirmDateStart"}}),t._v("\n                            -\n                            "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.confirmDateStart},model:{value:t.confirmDateEnd,callback:function(e){t.confirmDateEnd=e},expression:"confirmDateEnd"}})],1)]),t._v(" "),a("cooperation-select",{attrs:{isCoop:t.isCoop,cooperationType:t.cooperation_type,hardWideDetailType:t.hard_wide_detail_type},on:{hasCooperation:t.getCooperation}}),t._v(" "),a("b-field",{attrs:{label:"合同品类",horizontal:""}},[a("b-select",{on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):t._e()],1),t._v(" "),a("b-field",{attrs:{label:"回款时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.endTranslationDate},model:{value:t.startTranslationDate,callback:function(e){t.startTranslationDate=e},expression:"startTranslationDate"}}),t._v("\n                            -\n                            "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.startTranslationDate},model:{value:t.endTranslationDate,callback:function(e){t.endTranslationDate=e},expression:"endTranslationDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"合同执行时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.endExecuteDate},model:{value:t.startExecuteDate,callback:function(e){t.startExecuteDate=e},expression:"startExecuteDate "}}),t._v("\n                            -\n                            "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.startExecuteDate},model:{value:t.endExecuteDate,callback:function(e){t.endExecuteDate=e},expression:"endExecuteDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"审核状态",horizontal:""}},[a("b-select",{model:{value:t.approveStatusId,callback:function(e){t.approveStatusId=e},expression:"approveStatusId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("未提交")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("待审核")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("审核通过")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("驳回待修改")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("再驳回待修改")])])],1),t._v(" "),a("b-field",{attrs:{label:"开票状态",horizontal:""}},[a("b-select",{attrs:{disabled:t.isInvoice},model:{value:t.invoiceStatusId,callback:function(e){t.invoiceStatusId=e},expression:"invoiceStatusId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("未开票")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("已开票")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("待审核")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("驳回待修改")])])],1),t._v(" "),a("b-field",{attrs:{label:"客户关系",horizontal:""}},[a("b-select",{model:{value:t.client_relationship,callback:function(e){t.client_relationship=e},expression:"client_relationship"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("新客户")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("老客户")])])],1),t._v(" "),a("b-field",{attrs:{label:"是否首次签约",horizontal:""}},[a("b-select",{model:{value:t.is_first_contract,callback:function(e){t.is_first_contract=e},expression:"is_first_contract"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("否")])])],1),t._v(" "),a("b-field",{attrs:{label:"客户类型",horizontal:""}},[a("b-select",{model:{value:t.client_type_id,callback:function(e){t.client_type_id=e},expression:"client_type_id"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"合同类型",horizontal:""}},[a("div",{staticClass:"block"},[a("b-checkbox",{attrs:{"native-value":"0"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                单笔\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"1"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                CPS\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"2"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                赠版\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"3"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                年框\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"4"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                CPS对账单\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"5"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                平台服务费\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"6"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                CPS预估合同\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"7"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                CPS结算合同\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"8"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                资源置换\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"9"},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[t._v("\n                                阿里微任务\n                            ")])],1)]),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"可选签订状态",horizontal:""}},[a("div",{staticClass:"block"},[a("b-checkbox",{attrs:{"native-value":"9"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                                双方未签\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"1"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                                对方已签\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"0"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                                我方已签\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"2"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                                双方已签\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"10"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                                无需合同\n                            ")])],1)]),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"回款状态",horizontal:""}},[a("div",{staticClass:"block"},[a("b-checkbox",{attrs:{"native-value":"1"},model:{value:t.contractCollectionStatus,callback:function(e){t.contractCollectionStatus=e},expression:"contractCollectionStatus"}},[t._v("\n                                未回款\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"2"},model:{value:t.contractCollectionStatus,callback:function(e){t.contractCollectionStatus=e},expression:"contractCollectionStatus"}},[t._v("\n                                回款未结清\n                            ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"3"},model:{value:t.contractCollectionStatus,callback:function(e){t.contractCollectionStatus=e},expression:"contractCollectionStatus"}},[t._v("\n                                回款已结清\n                            ")])],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL(!1)}}},[t._v("导出")]),t._v(" "),t.hasPermission("crm_new.contract.list.ruanxingdaochu")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL(1)}}},[t._v("按软性合作方式导出")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.yingguangdaochu")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL(2)}}},[t._v("按硬广折扣导出")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.piliangbiangeng")&&t.isChecked?a("a",{staticClass:"button is-right is-primary",on:{click:t.moreChange}},[t._v("批量变更")]):t._e()])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalContracts},[t._v("总数："+t._s(t.totalContracts))]),t._v(" "),a("b",[t._v("金额统计："+t._s(t.amounts.total_amount))]),t._v(" "),a("b",[t._v("应收统计："+t._s(t.amounts.total_receivable))]),t._v(" "),a("b",[t._v("上月税金统计："+t._s(t.amounts.total_tax))]),t._v(" "),a("router-link",{staticClass:"button is-primary",attrs:{to:"/contracts/add"}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("添加合同")])],1),t._v(" "),a("router-link",{staticClass:"button is-primary",attrs:{to:"/contracts/add/yugu"}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("添加预估合同")])],1)],1),t._v(" "),a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("人民币："+t._s(t.amounts.cny_amount))]),t._v(" "),a("b",[t._v("美元："+t._s(t.amounts.usd_amount))]),t._v(" "),a("b",[t._v("日元："+t._s(t.amounts.jpy_amount))]),t._v(" "),a("b",[t._v("欧元："+t._s(t.amounts.eur_amount))]),t._v(" "),a("b",[t._v("英镑："+t._s(t.amounts.gbp_amount))]),t._v(" "),a("b",[t._v("韩元："+t._s(t.amounts.krw_amount))]),t._v(" "),a("b",[t._v("加拿大元："+t._s(t.amounts.cad_amount))]),t._v(" "),a("b",[t._v("澳元："+t._s(t.amounts.aud_amount))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{checkable:t.isChecked,"checked-rows":t.checkedRows,data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{"update:checkedRows":function(e){t.checkedRows=e},sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number",sortable:""}},[t._v("\n                        "+t._s(e.row.contract_number)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同名称",field:"contract_name",sortable:""}},[t._v("\n                        "+t._s(e.row.contract_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                        "+t._s(e.row.client_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户关系",field:"client_relationship"}},[t._v("\n                        "+t._s(e.row.client_relationship_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"品牌名称",field:"brand_name"}},[t._v("\n                        "+t._s(e.row.brand_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"负责人"}},[t._v("\n                        "+t._s(e.row.contract_charge_name)+"\n                    ")]),t._v(" "),a("b-table-column",{staticClass:"z-date-td",attrs:{label:"起止时间",field:"start_date",sortable:""}},[t._v("\n                        "+t._s(e.row.start_date)+" - "+t._s(e.row.end_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"发布额",field:"current_detail",sortable:""}},[t._v("\n                        "+t._s(e.row.current_detail)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"发布额应收",field:"current_receivable",sortable:""}},[t._v("\n                        "+t._s(e.row.current_receivable)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同金额",field:"amount",sortable:""}},[t._v("\n                        "+t._s(e.row.amount)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态",field:"approve_status_id",sortable:""}},[t._v("\n                        "+t._s(e.row.approve_status_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"签订状态",field:"status_id",sortable:""}},[t._v("\n                        "+t._s(e.row.status_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[e.row.chakan()?a("router-link",{staticClass:"button is-link",attrs:{to:"/contracts/"+e.row.id}},[t._v("查看")]):t._e(),t._v(" "),e.row.zaibohui()?a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.recallClient(e.row.id,e.row)}}},[t._v("再驳回")]):t._e(),t._v(" "),e.row.bianji()?a("router-link",{staticClass:"button is-link",attrs:{to:"/contracts/"+e.row.id+"/edit"}},[t._v("编辑")]):t._e(),t._v(" "),e.row.delete()?a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.deleteClient(e.row.id,e.row)}}},[t._v("删除")]):t._e(),t._v(" "),e.row.kaipiao()?a("router-link",{staticClass:"button is-link",attrs:{to:"/contracts/"+e.row.id+"/invoice"}},[t._v("开票")]):t._e()],1)]),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e.row.id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},IODh:function(t,e){},IQDX:function(t,e){},IZDD:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"财务核准"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门",horizontal:""}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团名称",horizontal:""}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brands,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"title"},on:{input:t.getBrands,focus:t.getBrands,select:t.onBrandSelected},model:{value:t.brand_title,callback:function(e){t.brand_title=e},expression:"brand_title"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companies,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.partyName,callback:function(e){t.partyName=e},expression:"partyName"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},on:{focus:t.searchContractList,input:t.searchContractList},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"项目经理",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{focus:t.getCodeList,input:t.getCodeList,select:t.onChargenameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.cost_pm_name,callback:function(e){t.cost_pm_name=e},expression:"cost_pm_name"}})],1),t._v(" "),a("b-field",{attrs:{label:"财务审核状态",horizontal:""}},[a("b-select",{model:{value:t.financialStatus,callback:function(e){t.financialStatus=e},expression:"financialStatus"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("待核准")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("已核准")])])],1),t._v(" "),a("b-field",{attrs:{label:"预估时间",horizontal:""}},[a("b-datepicker",{attrs:{"max-date":t.estimated_end_time},model:{value:t.estimated_start_time,callback:function(e){t.estimated_start_time=e},expression:"estimated_start_time"}}),t._v("\n                    -  \n                    "),a("b-datepicker",{attrs:{"min-date":t.estimated_start_time},model:{value:t.estimated_end_time,callback:function(e){t.estimated_end_time=e},expression:"estimated_end_time"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL()}}},[t._v("导出")])])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.totalContracts))]),t._v(" "),a("b",[t._v("总预估成本："+t._s(t.sum.estimated_cost_sum))]),t._v(" "),a("b",[t._v("总实际成本："+t._s(t.sum.actual_cost_sum))]),t._v(" "),a("b",[t._v("总发生金额："+t._s(t.sum.actual_details_sum))]),t._v(" "),a("b"),t._v(" "),a("b"),t._v(" "),a("b"),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{href:"https://crm-bgm.smzdm.com/file_template/spending_template.xlsx",target:"_blank"}},[t._v("下载发生金额模版")]),t._v(" "),a("b-upload",{ref:"rateFiles",on:{input:t.importFile},model:{value:t.rateFiles,callback:function(e){t.rateFiles=e},expression:"rateFiles"}},[a("a",{staticClass:"button is-primary"},[t._v("导入财务发生金额")])]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.checkAllApprove}},[t._v("批量核准")])],1),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{checkable:t.isChecked,"checked-rows":t.checkedRows,data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":""},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同名称",field:"contract_name"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"pm_name",label:"项目经理"}},[t._v("\n                    "+t._s(e.row.pm_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"预估成本"}},[t._v("\n                    "+t._s(e.row.estimated_cost)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"actual_cost",label:"实际成本"}},[t._v("\n                    "+t._s(e.row.actual_cost)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"financial_amount",label:"发生金额"}},[t._v("\n                    "+t._s(e.row.financial_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"diff",label:"出入"}},[t._v("\n                    "+t._s(e.row.diff)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"financial_approval_status",label:"财务审核状态"}},[t._v("\n                    "+t._s(t.FinancialStatus[e.row.financial_approval_status])+"\n                ")]),t._v(" "),a("b-table-column",{staticClass:"z-operate-td",attrs:{label:"操作"}},[a("router-link",{staticClass:"button is-link",attrs:{to:"/cost_manage/"+e.row.contract_id}},[t._v("查看成本")]),t._v(" "),Number(e.row.financial_approval_status)?t._e():[Number(0===e.row.diff)?a("button",{staticClass:"button is-link",on:{click:function(a){t.submitApprove(e.row)}}},[t._v("核准")]):a("button",{staticClass:"button is-gray"},[t._v("核准")])]],2),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e.row.contract_id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},IhEF:function(t,e,a){a("r8Ms");var n=a("VU/8")(a("3pWD"),a("uSYJ"),"data-v-87c316ea",null);t.exports=n.exports},JMa8:function(t,e){},JTee:function(t,e,a){a("jCdm");var n=a("VU/8")(a("r9vc"),a("m6pK"),"data-v-4717f012",null);t.exports=n.exports},JevJ:function(t,e,a){a("fZ/S");var n=a("VU/8")(a("D5cE"),a("iNgt"),"data-v-6b77b9c2",null);t.exports=n.exports},Jgwl:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"签约公司"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companiesName,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany},model:{value:t.likeCompany,callback:function(e){t.likeCompany=e},expression:"likeCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"编号"}},[a("b-input",{model:{value:t.likeNumber,callback:function(e){t.likeNumber=e},expression:"likeNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"年检到期日期",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd,placeholder:"开始时间"},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.enteredDateStart=new Date}}},[a("b-icon",{attrs:{icon:"calendar-today"}}),t._v(" "),a("span",[t._v("Today")])],1),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(e){t.enteredDateStart=null}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("Clear")])],1)]),t._v("\n                            -\n                            "),a("b-datepicker",{attrs:{"min-date":t.enteredDateStart,placeholder:"结束时间"},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.enteredDateEnd=new Date}}},[a("b-icon",{attrs:{icon:"calendar-today"}}),t._v(" "),a("span",[t._v("Today")])],1),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(e){t.enteredDateEnd=null}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("Clear")])],1)])],1)]),t._v(" "),a("b-field",{attrs:{label:"录入人"}},[a("b-autocomplete",{attrs:{data:t.filteredCompany,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.enteredUser,callback:function(e){t.enteredUser=e},expression:"enteredUser"}})],1),t._v(" "),a("b-field",{attrs:{label:"法人代表"}},[a("b-input",{model:{value:t.likeFrdb,callback:function(e){t.likeFrdb=e},expression:"likeFrdb"}})],1),t._v(" "),a("b-field",{attrs:{label:"审核状态"}},[a("b-select",{model:{value:t.approveStatus,callback:function(e){t.approveStatus=e},expression:"approveStatus"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("未提交")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("待审核")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("审核通过")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("驳回待修改")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("再驳回待修改")])])],1),t._v(" "),a("b-field",{attrs:{label:"国别"}},[a("b-select",{model:{value:t.areaId,callback:function(e){t.areaId=e},expression:"areaId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("国内")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("海外")])])],1),t._v(" "),a("b-field",{attrs:{label:"省份"}},[a("b-select",{attrs:{disabled:t.disableProvince},model:{value:t.provinceName,callback:function(e){t.provinceName=e},expression:"provinceName"}},t._l(t.provinces,function(e){return a("option",{domProps:{value:e.name}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同回收周期"}},[a("b-select",{model:{value:t.contractRecoveryCycle,callback:function(e){t.contractRecoveryCycle=e},expression:"contractRecoveryCycle"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("180天")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("120天")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("90天")])])],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalCompanies},[t._v("总数："+t._s(t.totalCompanies))]),t._v(" "),t.hasPermission("crm_new.company.list.addguonei")?a("router-link",{staticClass:"button is-primary",attrs:{to:"/companies/add"}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("添加签约公司")])],1):t._e()],1),t._v(" "),a("b-table",{key:t.companies.length,staticClass:"z-table-clients",attrs:{data:t.companies,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"编号",field:"number",sortable:""}},[t._v("\n                        "+t._s(e.row.number)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"甲方签约公司",field:"company_name",sortable:""}},[t._v("\n                        "+t._s(e.row.company_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"国别",field:"area_id",sortable:""}},[t._v("\n                        "+t._s(e.row.area_text)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"所在省份",field:"province_name",sortable:""}},[t._v("\n                        "+t._s(e.row.province_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"法人代表",field:"frdb",sortable:""}},[t._v("\n                        "+t._s(e.row.frdb)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"注册地址",field:"reg_address",sortable:""}},[t._v("\n                        "+t._s(e.row.reg_address)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"录入人",field:"updated_user_id",sortable:""}},[t._v("\n                        "+t._s(e.row.entered_user_text)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"年检到期日期",field:"annual_inspection_due_date",sortable:""}},[t._v("\n                        "+t._s(e.row.annual_inspection_due_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"登记时间",field:"entered_date",sortable:""}},[t._v("\n                        "+t._s(e.row.entered_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态",field:"approve_status_id",sortable:""}},[t._v("\n                        "+t._s(e.row.approve_status_text)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[t.hasPermission("crm_new.company.list.chakan")?a("router-link",{staticClass:"button is-link",attrs:{to:"/companies/"+e.row.id}},[t._v("查看")]):t._e(),t._v(" "),t.hasPermission("crm_new.company.list.zaibohui")&&2===e.row.approve_status_id?a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.recallCompanies(e.row.id,e.row)}}},[t._v("再驳回")]):t._e(),t._v(" "),!t.hasPermission("crm_new.company.list.update")||0!==e.row.approve_status_id&&3!==e.row.approve_status_id&&4!==e.row.approve_status_id?t._e():a("router-link",{staticClass:"button is-link",attrs:{to:"/companies/"+e.row.id+"/edit"}},[t._v("编辑")]),t._v(" "),0===e.row.approve_status_id?a("a",{staticClass:"button is-danger",attrs:{href:"javascript:;"},on:{click:function(a){t.deleteCompany(e.row,e.index)}}},[t._v("删除")]):t._e()],1)])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],key:t.totalPage,staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalCompanies,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},Jitu:function(t,e){},KKfj:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("O4Lo"),o=n(r),c=a("NDNc");e.default={props:{page:{type:Number,default:null}},data:function(){return{defaultSortDirection:"asc",provinceName:"",contractRecoveryCycle:"",areaId:null,approveStatus:null,likeFrdb:null,enteredUser:"",enteredUserId:null,likeNumber:"",likeCompany:"",totalCompanies:0,companies:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,enteredDateStart:null,enteredDateEnd:null,start_time:"",end_time:"",provinces:JSON.parse((0,s.default)(c.province)),disableProvince:!1,enteredusers:[],sortField:"number",sortOrder:"asc",companiesName:[],isFetching:!1,forSearch:!0}},computed:{filteredCompany:function(){var t=this;return this.enteredusers.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.enteredUser.toLowerCase())>=0})}},watch:{currPage:function(t){this.getCompanies()},page:function(t){this.currPage=t||1},areaId:function(t){"1"===this.areaId?(this.disableProvince=!0,this.provinceName=""):this.disableProvince=!1},enteredDateStart:function(t){this.start_time=null===t?"":this.zDateFormatter(t)},enteredDateEnd:function(t){this.end_time=null===t?"":this.zDateFormatter(t)}},mounted:function(){this.provinces.unshift({name:"",id:""}),this.getEnteredUser(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getCompanies();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},methods:{getCompanies:function(){var t=this;return this.loading=!0,this.ajax({url:"/signing_company/get_list",params:{order_name:this.sortField,order_asc_desc:this.sortOrder,like_company_name:this.likeCompany,like_number:this.likeNumber,entered_user_id:this.enteredUserId,like_frdb:this.likeFrdb,approve_status_id:this.approveStatus,area_id:this.areaId,province_name:this.provinceName,contract_recovery_cycle:this.contractRecoveryCycle,start_time:this.start_time,end_time:this.end_time,page:this.currPage,size:this.perPage}}).then(function(e){t.totalCompanies=e.data.counts,t.totalPage=Math.ceil(e.data.counts/t.perPage),0===t.totalPage&&(t.totalPage=1),t.companies=e.data.lists,1!==t.currPage&&t.currPage!==t.page?t.$router.push(t.$router.currentRoute.path+"?page="+t.currPage):1===t.currPage&&t.$router.push(t.$router.currentRoute.path),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},getEnteredUser:function(){var t=this;return this.loading=!0,this.ajax({url:"/user/index/",params:{is_delete:0}}).then(function(e){t.enteredusers=e.data.rows})},searchCompany:(0,o.default)(function(){this.isFetching=!0,this.getcompaniesName()},500),getcompaniesName:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.likeCompany}}).then(function(e){t.companiesName=e.data.lists,t.isFetching=!1})},resetParams:function(){this.provinceName="",this.contractRecoveryCycle="",this.areaId=null,this.approveStatus=null,this.likeFrdb=null,this.enteredUser="",this.enteredUserId=null,this.likeNumber="",this.likeCompany="",this.enteredDateStart=null,this.enteredDateEnd=null},onQueryClick:function(){1===this.currPage?this.getCompanies():this.currPage=1},recallCompanies:function(t,e){return this.ajax({url:"/signing_company/after_approve_refuse",successTip:!0,loading:this.$loading.open(),method:"post",data:{id:t}}).then(function(t){0===t.error_code&&(e.approve_status_id=4,e.approve_status_text="再驳回待修改")})},onUserSelected:function(t){t&&(this.enteredUserId=t.id)},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getCompanies()},deleteCompany:function(t,e){var a=this;this.$dialog.confirm({message:"确定删除？",onConfirm:function(){return a.ajax({url:"/signing_company/delete",method:"post",successTip:!0,loading:a.$loading.open(),data:{id:t.id}}).then(function(t){0===t.error_code&&(a.companies.splice(e,1),a.getCompanies())})}})}}}},KjVe:function(t,e){},Km5v:function(t,e,a){a("l8hM");var n=a("VU/8")(a("/KGx"),a("DhVk"),"data-v-c4a5277a",null);t.exports=n.exports},L46q:function(t,e,a){a("+9n3"),a("Nku+");var n=a("VU/8")(a("3faH"),a("XVnZ"),"data-v-95b8e230",null);t.exports=n.exports},L6A2:function(t,e,a){a("/Jog"),a("wUtP"),a("JMa8");var n=a("VU/8")(a("Hoix"),a("rJoM"),"data-v-3ade1c46",null);t.exports=n.exports},M4QK:function(t,e){},M5fO:function(t,e,a){a("2Iok");var n=a("VU/8")(a("MxIm"),a("sWpo"),"data-v-20cca3ec",null);t.exports=n.exports},M93x:function(t,e,a){a("clMa"),a("d46e"),a("dL7g");var n=a("VU/8")(a("VFb8"),a("nm+Z"),null,null);t.exports=n.exports},MNrR:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("Xxa5"),o=n(r),c=a("Dd8w"),l=n(c),d=a("exGp"),u=n(d),_=a("d7EF"),p=n(_),m=a("z93h"),h=a("jELS");e.default={props:{title:{type:String,default:""}},data:function(){return{flag:!0,frame_id:"",infinite:!1,active:!1,dataList:[],saveForm:{data_type:"",data_type_id:""},form:{delete_ids:[]}}},methods:{changeMin:function(t,e,a){if(e&&t){var n=a.target.value;this.dataList[t].min=n,this.dataList[t-1].max=n}},changeMax:function(t,e,a){if(e){var n=a.target.value;this.dataList[t].max=n,this.dataList[t+1].min=n}},changeInfinite:function(t){this.infinite=!this.infinite,t.max=0},cleanOldData:function(){this.form.delete_ids=[],this.infinite=!1},deleteRule:function(t){var e=this.dataList,a=e[t-1],n=e[t+1];a&&n&&(a.max=n.min);var i=this.dataList.splice(t,1),s=(0,p.default)(i,1),r=s[0].id;r&&0!==r&&this.form.delete_ids.push(r)},addIssuingAmount:function(){var t=this.dataList,e=t[t.length-1],a="";e&&e.max&&(a=e.max),t.push({min:a,max:"",rebate:""})},open:function(t,e){var a=this;return(0,u.default)(o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a.cleanOldData(),a.saveForm=(0,l.default)({},a.saveForm,{data_type:e}),a.frame_id=t,n.next=5,a.rebateFrameShowDetail();case 5:a.active=!0;case 6:case"end":return n.stop()}},n,a)}))()},rebateFrameShowDetail:function(){var t=this;return(0,u.default)(o.default.mark(function e(){var a,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.rebateFrameShowDetail)((0,l.default)({},t.saveForm,{id:t.frame_id}));case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:return n=a.content,n.length&&!parseInt(n[n.length-1].max)&&(t.infinite=!0),t.dataList=n,n.length||t.addIssuingAmount(),e.abrupt("return",!0);case 10:case"end":return e.stop()}},e,t)}))()},saveRule:function(){if(this.flag){this.flag=!1;if(!(0,h.validateRuleData)(this.dataList,!!this.infinite))return this.flag=!0,this.$toast.error("发布额数据遗漏或返点规则小数超过两位或小于0");this.rabateSaveRule()}},rabateSaveRule:function(){var t=this;return(0,u.default)(o.default.mark(function e(){var a,n,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dataList.map(function(t){return{max:t.max,min:t.min,rebate:t.rebate,id:t.id||0}}),a.sort(function(t,e){return t.min-e.min}),t.infinite&&a.length&&(a[a.length-1].max=0),n={0:a},e.next=6,(0,m.rabateSaveRule)({frame_id:t.frame_id,delete_ids:t.form.delete_ids.join(","),data_type:t.saveForm.data_type,rule:(0,s.default)(n)});case 6:if(i=e.sent,t.flag=!0,i){e.next=10;break}return e.abrupt("return");case 10:t.$toast.success("编辑成功"),t.$emit("reload"),t.active=!1;case 13:case"end":return e.stop()}},e,t)}))()}}}},MWDS:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("O4Lo"),s=n(i),r=a("LZT1"),o=n(r);e.default={props:{page:{type:Number,default:null}},data:function(){return{defaultSortDirection:"asc",departmentId:"",userId:"",userName:"",clientId:"",clientName:"",contractNumber:"",contractName:"",startDate:null,endDate:null,contract_cost_start:"",contract_cost_end:"",contract_brand_id:"",levelData:[],level:null,contract_second_brand_id:"",selectedContractStatus:[],departments:[],contractDirector:[],clients:[],contractNames:[],isFetching:!1,userReadonly:!1,totalContracts:0,contracts:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"id",sortOrder:"asc",forSearch:!0}},computed:{filteredClients:function(){var t=this;return this.clients.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.clientName.toLowerCase())>=0})},filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})}},watch:{currPage:function(t){this.getContract()},page:function(t){this.currPage=t||1},departmentId:function(t){this.getDirector({department_id:t})},userId:function(t){this.clientName="",this.clientId=null,this.getClients({user_id:t})}},mounted:function(){this.getDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getContract();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()},this.getLevel()},methods:{onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},getLevel:function(){var t=this;this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")},onUserSelected:function(t){t&&(this.userId=t.id)},getContract:function(){var t=this;this.loading=!0;var e="";e=this.contract_second_brand_id?this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";var a={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,contract_number:this.contractNumber,contract_name:this.contractName,entered_date_start:this.startDate,entered_date_end:this.endDate,contract_cost_start:this.contract_cost_start,contract_cost_end:this.contract_cost_end,contract_brand_id:e,selected_contract_status:this.selectedContractStatus.join(","),order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage};this.ajax({url:"/backlog/get_contract_lists_backlog",params:a}).then(function(e){t.totalContracts=e.data.total,t.totalPage=Math.ceil(e.data.total/t.perPage),0===t.totalPage&&(t.totalPage=1),t.contracts=e.data.lists,console.log(t.contracts,"list"),1!==t.currPage&&t.currPage!==t.page?t.$router.push(t.$router.currentRoute.path+"?page="+t.currPage):1===t.currPage&&t.$router.push(t.$router.currentRoute.path),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,o.default)(e.data);t.departments=a})},getDirector:function(t){var e=this;return this.ajax({url:"/user/index",params:t}).then(function(t){e.contractDirector=t.data.rows})},getClients:function(t){var e=this;return this.ajax({url:"/contract/get_contract_clients_by_user_id",params:t}).then(function(t){t.data.length&&(e.clients=t.data,e.clientName=t.data[0].name,e.clientId=t.data[0].id)})},searchContract:(0,s.default)(function(){this.isFetching=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/backlog/get_contract_lists_backlog",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching=!1})},resetParams:function(){this.defaultSortDirection="asc",this.departmentId="",this.userId=null,this.userName="",this.clientId=null,this.contractNumber="",this.contractName="",this.startDate=null,this.endDate=null,this.contract_cost_start="",this.contract_cost_end="",this.contract_brand_id="",this.selectedContractStatus=[],this.level=null,this.contract_brand_id="",this.contract_second_brand_id=""},onQueryClick:function(){1===this.currPage?this.getContract():this.currPage=1},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getContract()}}}},MY1v:function(t,e){},MxIm:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("Km5v"),s=n(i),r=a("uzIf"),o=n(r),c=a("LZT1"),l=n(c);e.default={name:"CheckAchievement",props:{isCheck:{type:Boolean,default:!1}},components:{CooperationSelect:s.default,SelectDate:o.default},data:function(){return{create:!1,show:"1",tableDetal:!0,business_id:null,DEPARTMENT:"",clickGet:0,clickReset:0,table_label:[],release:[],isPaginated:!0,isPaginationSimple:!1,totalRelease:0,loading:!1,currentPage:1,defaultSortDirection:"asc",currPage:1,perPage:20,totalPage:1,jumpPage:1,cooperation_type:"",cooperation_obj:null,hard_wide_detail_type:null,levelData:[],level:null,contract_brand_id:"",contract_second_brand_id:"",el:null,ifserch:!1,clickBtn:!1,start_time:null,end_time:null}},watch:{currPage:function(t){console.log("分页",t);var e=!1;e=!(this.clickReset>this.clickGet),this.el=1,this.ifserch=e,this.clickBtn=this.clickBtn,this.getAchievement(1,e)},page:function(t){this.currPage=t||1}},mounted:function(){this.getAllDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getAchievement(null,!1),this.getLevel()},methods:{getAllDepartment:function(){var t=this;return this.ajax({url:"/user/get_my_business_list"}).then(function(e){var a=(0,l.default)(e.data);t.DEPARTMENT=a;var n={id:"",value:""};t.DEPARTMENT.unshift(n)})},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?(this.el=1,this.ifserch=t,this.clickBtn=!this.clickBtn):this.currPage=1,this.clickGet+=1,this.tableDetal=1===Number(this.show)},resetParams:function(){this.business_id=null,this.start_time=null,this.end_time=null,this.search_time_by="month",this.show=1,this.cooperation_type="",this.hard_wide_detail_type="",this.clickReset=this.clickGet,this.clickReset+=1,this.el=null,this.contract_brand_id="",this.contract_second_brand_id="",this.level=null},exportAll:function(){var t=this,e="";e=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";var a={business_id:this.business_id,start_time:this.start_time,end_time:this.end_time,search_time_by:this.search_time_by,show:this.show.toString(),page:this.currPage,size:this.perPage,contract_brand_id:e,cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type};a=this.delNullParam(a),this.ajax({url:"/contract_split_search/export",method:"post",data:a}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:1===a.error_code&&e.exportLive(t)})},getCooperation:function(t,e){if(this.cooperation_obj=t,this.cooperation_type=this.cooperation_obj.cooperation_type,e)this.hard_wide_detail_type=e;else{var a=[];this.cooperation_obj.level&&this.cooperation_obj.level.length?(this.cooperation_obj.level.map(function(t){a.push(t.id)}),this.hard_wide_detail_type=a.join(",")):this.hard_wide_detail_type=e}},getDate:function(t,e,a,n){this.start_time=t,this.end_time=e,this.search_time_by=n,console.log("selectDate",t,e,a,n),1===this.el&&this.getAchievement(this.el,this.ifserch)},delNullParam:function(t){for(var e in t)null!==t[e]&&void 0!==t[e]||delete t[e];return t},totalPageFn:function(t){var e=void 0;e=t.data.counts,this.totalRelease=e,this.totalPage=Math.ceil(e/this.perPage),0===this.totalPage&&(this.totalPage=1),1!==this.currPage&&this.currPage!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+this.currPage):1===this.currPage&&this.$router.push(this.$router.currentRoute.path),this.isPaginated=!0},childData:function(t){var e=[],a={};if(t.length>0)for(var n=0;n<t.length;n++)a=t[n].business_compute,a["事业部名称"]=t[n].business_name,a.child=this.childData(t[n].child),e.push(a);return e},processData:function(t){this.loading=!0;var e=[],a={},n=[],i=void 0;if(t.data.counts>0){for(var s=0;s<t.data.lists.length;s++)"1"===this.show.toString()?(a=t.data.lists[s].business_compute,a["事业部名称"]=t.data.lists[s].business_name,a.child=this.childData(t.data.lists[s].child)):"3"===this.show.toString()?(a=t.data.lists[s].contract_brand_compute,a["行业名称"]=t.data.lists[s].contract_brand_name):"2"===this.show.toString()&&(a=t.data.lists[s].business_compute,a["事业部名称"]=t.data.lists[s].business_name,a["软性合作方式"]=t.data.lists[s].detail_cooperation_name),e.push(a);for(i in e[0])if("合计"===i)n.unshift({name:i});else{if("child"===i)continue;n.push({name:i})}var r=n.pop();n.unshift(r),"2"===this.show.toString()&&(r=n.pop(),n.unshift(r))}this.release=e,this.table_label=n,this.create=!0},getAchievement:function(t){var e=this;console.log("/contract_split_search/index"),this.create=!1,this.loading=!0,this.el=t,console.log(t,"check",this.start_time,this.end_time),this.loading=!0;var a="";a=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";var n={business_id:this.business_id,start_time:this.start_time,end_time:this.end_time,search_time_by:this.search_time_by,show:this.show.toString(),page:this.currPage,size:this.perPage,contract_brand_id:a,cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type};n=this.delNullParam(n),this.ajax({url:"/contract_split_search/index",loading:this.$loading.open(),method:"post",data:n}).then(function(t){console.log(t),e.table_label=[],e.release=[],e.processData(t),e.totalPageFn(t),e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")}}}},N40d:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"工单明细页"}},[a("div",{staticClass:"z-block z-scaling workDetail"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"rowCol"},[a("b-field",{staticClass:"w33",attrs:{label:"商务名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input w100",attrs:{data:t.filteredUser,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:function(e){return t.autoSelect(e&&e.id,"user_id",e&&e.name)}},model:{value:t.mapping.user_id,callback:function(e){t.$set(t.mapping,"user_id",e)},expression:"mapping.user_id"}})],1),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"项目经理",horizontal:""}},[a("b-autocomplete",{ref:"contractCharge",staticClass:"w100",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.postCodeList,fouce:t.postCodeList,select:function(e){return t.autoSelect(e&&e.id,"manager_id",e&&e.name)}},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.mapping.manager_id,callback:function(e){t.$set(t.mapping,"manager_id",e)},expression:"mapping.manager_id"}})],1),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"项目名称",horizontal:""}},[a("b-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),a("div",{staticClass:"rowCol"},[a("b-field",{staticClass:"w33",attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input w100",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClientList,focus:t.getClientList,select:function(e){return t.autoSelect(e&&e.id,"client_id",e&&e.name,e)}},model:{value:t.mapping.client_id,callback:function(e){t.$set(t.mapping,"client_id",e)},expression:"mapping.client_id"}})],1),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"客户类型",horizontal:""}},[a("b-select",{staticClass:"w100",attrs:{disabled:""},model:{value:t.client_type,callback:function(e){t.client_type=e},expression:"client_type"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"落地平台",horizontal:""}},[a("b-input",{attrs:{readonly:"",disabled:""},model:{value:t.filterPlatform,callback:function(e){t.filterPlatform=e},expression:"filterPlatform"}}),t._v(" "),a("button",{staticClass:"is-primary button",on:{click:t.checkPlatform}},[t._v("\n                        编辑\n                    ")])],1)],1),t._v(" "),a("div",{staticClass:"rowCol"},[a("b-field",{staticClass:"w33",attrs:{label:"下单时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers w100"},[a("b-datepicker",{model:{value:t.form.order_date,callback:function(e){t.$set(t.form,"order_date",e)},expression:"form.order_date"}})],1)]),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"起止时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers w100"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.form.end_date},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.form.start_date},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1)]),t._v(" "),a("b-field",{staticClass:"w33",attrs:{label:"执行状态",horizontal:""}},[a("b-select",{staticClass:"w100",model:{value:t.form.run_status,callback:function(e){t.$set(t.form,"run_status",e)},expression:"form.run_status"}},t._l(t.RUNSTATUS,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1)],1),t._v(" "),a("div",{staticClass:"rowCol"},[a("b-field",{staticClass:"w33 isFlex",attrs:{label:"备注",addons:!1,horizontal:""}},[a("b-input",{staticClass:"w100",attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),a("b-field",{staticClass:"w33 isFlex",attrs:{label:"问题",addons:!1,horizontal:""}},[a("b-input",{staticClass:"w100",attrs:{type:"textarea"},model:{value:t.form.problem,callback:function(e){t.$set(t.form,"problem",e)},expression:"form.problem"}})],1),t._v(" "),a("div",{staticStyle:{width:"33%"}})],1),t._v(" "),a("button",{staticClass:"is-primary button",on:{click:t.saveData}},[t._v("\n                保存\n            ")])])]),t._v(" "),t.id?[a("div",{staticClass:"z-block z-scaling workDetail"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"w33",attrs:{label:"关联合同",addons:!1,horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{disabled:t.isAssociate,data:t.contractList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"contract_number"},on:{focus:t.getContractLists,input:t.getContractLists,select:t.selectContract},model:{value:t.contract_number,callback:function(e){t.contract_number=e},expression:"contract_number"}}),t._v(" "),t.isAssociate?[a("button",{staticClass:"is-primary button",on:{click:t.checkUnAssociateContract}},[t._v("\n                            取消关联\n                        ")])]:[a("button",{staticClass:"is-primary button",on:{click:t.postAssociateContract}},[t._v("\n                            关联\n                        ")])]],2)],1)]),t._v(" "),a("div",{staticClass:"z-block z-scaling workDetail"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"w33",attrs:{label:"下单金额",addons:!1,horizontal:""}},[t._v("\n                    "+t._s(t.total_amount)+"\n                ")]),t._v(" "),a("b-field",{staticClass:"w10 mt20 mb10",attrs:{label:"下单内容",addons:!1,horizontal:""}},[a("button",{staticClass:"is-primary button",on:{click:t.addDetailData}},[t._v("\n                        新增\n                    ")])]),t._v(" "),t.detailList.length?a("b-table",{attrs:{data:t.detailList,bordered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("b-table-column",{attrs:{label:"事业部",field:"frame_number"}},[t._v("\n                                "+t._s(e.row.business_name)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{width:"240",label:"软性合作方式",field:"frame_name"}},[t._v("\n                                "+t._s(e.row.cooperation_name)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{width:"60",label:"数量",field:"frame_leader"}},[t._v("\n                                "+t._s(e.row.count)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"该项总金额"}},[t._v("\n                                "+t._s(e.row.amount)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"执行时间"}},[t._v("\n                                "+t._s(e.row.run_date)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"发布额确认月份"}},[t._v("\n                                "+t._s(e.row.confirm_month)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("a",{staticClass:"button is-primary",on:{click:function(a){t.deleteData(e.row,e.index)}}},[t._v("删除")])])]:[a("b-table-column",{attrs:{label:"事业部",field:"frame_number"}},[a("b-select",{on:{input:t.changeBusiness},model:{value:e.row.editData.business_id,callback:function(a){t.$set(e.row.editData,"business_id",a)},expression:"props.row.editData.business_id"}},t._l(t.businessList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-table-column",{attrs:{label:"软性合作方式",field:"frame_name"}},[a("b-select",{model:{value:e.row.editData.cooperation_id,callback:function(a){t.$set(e.row.editData,"cooperation_id",a)},expression:"props.row.editData.cooperation_id"}},t._l(t.cooperationObj[e.row.editData.business_id],function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.cooperation_name))])}))],1),t._v(" "),a("b-table-column",{attrs:{label:"数量",field:"frame_leader"}},[a("b-input",{attrs:{type:"number"},model:{value:e.row.editData.count,callback:function(a){t.$set(e.row.editData,"count",a)},expression:"props.row.editData.count"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"该项总金额"}},[a("b-input",{attrs:{type:"number"},model:{value:e.row.editData.amount,callback:function(a){t.$set(e.row.editData,"amount",a)},expression:"props.row.editData.amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"执行时间"}},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.form.start_date,"max-date":t.form.end_date},model:{value:e.row.editData.run_date,callback:function(a){t.$set(e.row.editData,"run_date",a)},expression:"props.row.editData.run_date"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"发布额确认月份"}},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{position:"is-bottom-left",disabled:!t.contract_number||!t.contract_id||!t.isAssociate,"selectable-dates":t.selectable,type:"month"},model:{value:e.row.editData.confirm_month,callback:function(a){t.$set(e.row.editData,"confirm_month",a)},expression:"props.row.editData.confirm_month"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("a",{staticClass:"button is-primary",on:{click:function(a){t.deleteData(e.row,e.index)}}},[t._v("删除")])])]]}}])}):t._e(),t._v(" "),a("div",{staticClass:"mt30"},[a("button",{staticClass:"is-primary button",on:{click:t.checkSaveProjectOrder}},[t._v("\n                        "+t._s(t.contract_id&&t.isAssociate?"保存并更新":"保存")+"\n                    ")])])],1)]),t._v(" "),a("div",{staticClass:"z-block z-scaling workDetail"},[a("div",{staticClass:"z-block-content"},[a("button",{staticClass:"is-primary button",on:{click:t.getDeleteProjectOrder}},[t._v("\n                    删除工单\n                ")])])])]:t._e(),t._v(" "),a("b-modal",{attrs:{active:t.showModal},on:{"update:active":function(e){t.showModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("选择落地平台")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"block"},t._l(t.platfromList,function(e){return a("b-checkbox",{key:e.id,attrs:{"native-value":e.id},model:{value:t.form.platform_id,callback:function(e){t.$set(t.form,"platform_id",e)},expression:"form.platform_id"}},[t._v("\n                        "+t._s(e.value)+"\n                    ")])}))]),t._v(" "),a("footer",{staticClass:"modal-card-foot"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.showModal=!t.showModal}}},[t._v("保存")])])])])],2)},staticRenderFns:[]}},N4ip:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"成本管理"}},[a("div",{staticClass:"cost-view"},[a("div",{staticClass:"title"},[t._v("成本管理模块")]),t._v(" "),a("b-field",{staticClass:"search-input",attrs:{label:"成本模块名称",horizontal:""}},[a("b-autocomplete",{attrs:{"keep-first":!1,"open-on-focus":!0,data:t.filteredDataObj,field:"cost_name"},model:{value:t.cost_name,callback:function(e){t.cost_name=e},expression:"cost_name"}}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.getCostList}},[t._v("查询")])],1),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addCost}},[t._v("新增成本模块")]),t._v(" "),t.costList.length?a("b-table",{staticStyle:{width:"750px"},attrs:{data:t.costList,bordered:t.isBorder},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"成本模块",width:"260"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{expanded:"",type:"text"},model:{value:e.row.cost_name,callback:function(a){t.$set(e.row,"cost_name",a)},expression:"props.row.cost_name"}})],1):a("b-field",[t._v(t._s(e.row.cost_name))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"260"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveCost(e.row)}}},[t._v("保存")]):t._e(),t._v(" "),e.row.isEdit?a("button",{staticClass:"button is-link",on:{click:function(a){t.checkStatus(e.row,1,e.index)}}},[t._v("取消")]):a("button",{staticClass:"button is-primary",on:{click:function(a){t.checkStatus(e.row,0)}}},[t._v("编辑")]),t._v(" "),e.row.can_delete?a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteCost(e.row,e.index)}}},[t._v("删除")]):t._e()])]}}])}):t._e()],1)])},staticRenderFns:[]}},NDp1:function(t,e,a){var n=a("VU/8")(a("Rekb"),a("G2jM"),null,null);t.exports=n.exports},NTgk:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.hasPermission(t.permission)?a("div",[t._t("default")],2):t._e()},staticRenderFns:[]}},"Nku+":function(t,e){},"O/lM":function(t,e){},Of3N:function(t,e){},"P/hE":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"返点框架"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"框架名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterFrameNames,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"frame_name"},model:{value:t.frameName,callback:function(e){t.frameName=e},expression:"frameName"}})],1),t._v(" "),a("b-field",{attrs:{label:"框架号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterFrameNumbers,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"frame_number"},model:{value:t.frameNumber,callback:function(e){t.frameNumber=e},expression:"frameNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onSelectedCompany},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.party_b_id,callback:function(e){t.party_b_id=e},expression:"party_b_id"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"所含特殊品牌"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title"},on:{select:t.onBrandSelected},model:{value:t.brandName,callback:function(e){t.brandName=e},expression:"brandName"}})],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"所含特殊品类"}},[a("b-select",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                            "+t._s(e.val)+"\n                        ")])}))],1),t._v(" "),a("b-field",{attrs:{label:"框架负责人",horizontal:""}},[a("b-input",{attrs:{disabled:!t.isAdmin},model:{value:t.frameOwner,callback:function(e){t.frameOwner=e},expression:"frameOwner"}})],1),t._v(" "),a("b-field",{attrs:{label:"生效时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{type:"month","max-date":t.end_date},model:{value:t.start_date,callback:function(e){t.start_date=e},expression:"start_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{type:"month","min-date":t.start_date},model:{value:t.end_date,callback:function(e){t.end_date=e},expression:"end_date"}})],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("router-link",{staticClass:"button is-link is-primary",attrs:{to:"/rebateManagement/rebateDetail/"}},[t._v("新增")])],1)],1),t._v(" "),a("div",{staticClass:"z-block-content"},[a("b-table",{attrs:{data:t.frameLists},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"框架号",field:"frame_number"}},[t._v("\n                        "+t._s(e.row.frame_number)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"框架名称",field:"frame_name"}},[t._v("\n                        "+t._s(e.row.frame_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"框架负责人",field:"frame_leader"}},[t._v("\n                        "+t._s(e.row.frame_leader)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"生效时间"}},[t._v("\n                        "+t._s(e.row.start_date)+"-"+t._s(e.row.end_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[a("router-link",{staticClass:"button is-link is-primary",attrs:{to:"/rebateManagement/rebateDetail?id="+e.row.id}},[t._v("查看")]),t._v(" "),t.hasPermission("crm_new.fandian.delete")?a("a",{staticClass:"button is-link",on:{click:function(a){t.deleteFn(e.row.id,e.index)}}},[t._v("删除数据")]):t._e()],1)])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalFrame,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])])},staticRenderFns:[]}},"PRl+":function(t,e){},PWFT:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("lHA8"),s=n(i),r=a("c/Tr"),o=n(r),c=a("Xxa5"),l=n(c),d=a("exGp"),u=n(d),_=a("LZT1"),p=n(_),m={};e.default={props:["page"],data:function(){return{usersData:[],departments:[],perPage:20,currPage:1,totalUsers:0,jumpPage:1}},computed:{totalPage:function(){return Math.ceil(this.totalUsers/this.perPage)}},watch:{currPage:function(t){1!==t&&t!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+t):1===t&&this.$router.push(this.$router.currentRoute.path),this.getUsers()},page:function(t){this.currPage=t||1}},created:function(){var t=this;return(0,u.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDepartments();case 2:t.page&&t.page!==t.currPage?t.currPage=t.page:t.getUsers();case 3:case"end":return e.stop()}},e,t)}))()},methods:{getDepartments:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/department/index"}).then(function(e){if(0===e.error_code){var a=(0,p.default)(e.data);a.forEach(function(t){m[t.id]=t.name}),t.departments=a,console.log(a)}})},getUsers:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/user/get_business_support_user",method:"post",data:{page:this.currPage,limit:this.perPage,with_department:1,is_delete:0}}).then(function(e){if(0===e.error_code)return t.usersData=t.formatUserData(e.data.rows),t.totalUsers=e.data.total,!0})},formatUserData:function(t){var e=this,a=this.departments.map(function(t){return t.id});return t.map(function(t){t.isEdit=!1,t.department_list=t.department_list||[];var n=t.department_list.map(function(t){return t.department_id}).filter(function(t){return a.includes(parseInt(t))});t.selDepartments=n;var i=n.map(function(t){return e.departments.find(function(e){return e.id===parseInt(t)}).name.replace(/-/g,"")}).join(", ");return t.selDepartmentNames=i,t.bizFieldType="",t.bizFieldMsg="",t.departmentFieldType="",t.departmentFieldMsg="",t})},userDataValidate:function(t,e){var a=this,n=[],i=this.usersData[e];return t.forEach(function(t){var s=a.$refs[t+"_"+e];"department_ids"===t?0===i.selDepartments.length?(i.departmentFieldType="is-danger",i.departmentFieldMsg="请至少选择一项",n.push(s)):(i.departmentFieldType="",i.departmentFieldMsg=""):s.checkHtml5Validity&&(s.checkHtml5Validity()||n.push(s))}),!n.length||(n[0].focus&&n[0].focus(),!1)},saveUser:function(t,e){var a=["department_ids"];if(this.userDataValidate(a,e)){console.log(this.user);var n={id:t.id,user_no:t.user_no,department_ids:t.selDepartments,department_names:t.selDepartmentNames};return console.log(n),this.ajax({url:"/user/update_business_support_user",method:"post",loading:this.$loading.open(),successTip:!0,data:n}).then(function(e){0===e.error_code&&(t.isEdit=!1)})}},onDepartmentChange:function(t,e){var a=this.traverseTree2(e),n=a.map(function(t){return t.id+""});-1===t.selDepartments.indexOf(e.id)?t.selDepartments=t.selDepartments.filter(function(t){return!n.includes(t)}):t.selDepartments=(0,o.default)(new s.default(t.selDepartments.concat(n))),t.department_ids=t.selDepartments,t.selDepartmentNames=t.selDepartments.map(function(t){return m[t].replace(/^-+/,"")}).join(", "),console.log(t.selDepartmentNames)},traverseTree2:function(t){if(t){var e=[];e.push(t);for(var a=void 0,n=[],i=0;e.length>0;)if(a=e.pop(),i>0&&n.push(a),a.child&&a.child.length>0){var s=a.child.length-1;for(s=a.child.length-1;s>=0;s--)i++,e.push(a.child[s])}return n}}}}},PYju:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:t.pageTitle}},[a("div",{staticClass:"z-block"},[a("b-tabs",{attrs:{animated:!1},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[a("b-tab-item",{attrs:{disabled:t.clientId&&t.isAdd,label:"基本信息"}},[a("client-info",{attrs:{"client-id":t.id,"is-edit":t.isEdit,"is-add":t.isAdd},on:{getClient:t.getClientInfo,clientsaved:t.onClientSaved}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"联系人信息",disabled:!t.clientId}},[a("client-contacts-list",{attrs:{"is-add":t.isAdd,"is-edit":t.isEdit,"client-status":t.client.approve_status_id,"client-id":t.clientId}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"客户跟踪日志",disabled:!t.clientId}},[a("client-visits-list",{attrs:{"client-id":t.clientId}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"操作日志",disabled:!t.logData.length}},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"信誉等级",disabled:!t.clientId}},[a("client-degrees",{attrs:{"client-id":t.clientId}})],1)],1)],1)])},staticRenderFns:[]}},"QR/r":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("O4Lo"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={props:{page:{type:Number,default:null}},data:function(){return{templateTitle:"",contractTypeId:null,isFetching:!1,showEdit:!1,setTemplateTitle:"",setDescription:"",fileUrl:"",fileType:"",contract_type_id:null,templates:[],Titles:[],files:[],userReadonly:!1,totalTemplate:0,contracts:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"",sortOrder:"DESC",toEdit:{title:"",id:"",description:"",contract_type_id:null}}},computed:{},watch:{currPage:function(t){this.getTemplates()},page:function(t){this.currPage=t||1},departmentId:function(t){this.getDirector({department_id:t})},userId:function(t){this.getClients({user_id:t})},clientId:function(t){this.getBrands({client_id:t})}},mounted:function(){this.page&&this.page!==this.currPage?this.currPage=this.page:this.getTemplates()},methods:{isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},getTemplates:function(){var t=this;return this.loading=!0,this.templates=[],this.ajax({url:"/contract_template/get_contract_template_lists",params:{title:this.templateTitle,contract_type_id:this.contractTypeId,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage}}).then(function(e){t.totalTemplate=e.data.total,console.log(e),t.totalPage=Math.ceil(e.data.total/t.perPage),0===t.totalPage&&(t.totalPage=1),t.templates=e.data.lists,1!==t.currPage&&t.currPage!==t.page?t.$router.push(t.$router.currentRoute.path+"?page="+t.currPage):1===t.currPage&&t.$router.push(t.$router.currentRoute.path),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},searchTitle:(0,i.default)(function(){this.isFetching=!0,this.getTitles()},500),getTitles:function(){var t=this;return this.ajax({url:"/contract_template/get_contract_template_lists",params:{title:this.templateTitle}}).then(function(e){t.Titles=e.data.lists,t.isFetching=!1})},resetParams:function(){this.defaultSortDirection="asc",this.templateTitle="",this.contractTypeId=null},onQueryClick:function(){1===this.currPage?this.getTemplates():this.currPage=1},deleteDropFile:function(t){this.files.splice(t,1),this.fileUrl=""},deleteTemplate:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此模板么？",onConfirm:function(){a.ajax({url:"/contract_template/delete_contract_template",loading:a.$loading.open(),successTip:!0,params:{id:t}}).then(function(t){0===t.error_code&&(a.templates.splice(e,1),a.getTemplates())})}})},fileUpload:function(){var t=this;this.ajax({url:"/tools/file_upload",method:"post",data:{file_name:this.$data.files}}).then(function(e){console.log(e),t.fileUrl=e.data.file_name})},addTemplate:function(){var t=this;this.fileUrl.length&&this.ajax({url:"/contract_template/add_contract_template",params:{title:this.setTemplateTitle,description:this.setDescription,contract_type_id:this.contract_type_id,file_url:this.fileUrl}}).then(function(e){0===e.error_code&&(t.setTemplateTitle="",t.setDescription="",t.contract_type_id="0",t.fileUrl="",t.deleteDropFile(0),t.getTemplates())})},cancelUpdate:function(){this.showEdit=!1,this.toEdit.title="",this.toEdit.id="",this.toEdit.description=""},updateTemplate:function(){var t=this;this.ajax({url:"/contract_template/update_contract_template",params:{title:this.toEdit.title,description:this.toEdit.description,contract_type_id:this.toEdit.contract_type_id,id:this.toEdit.id}}).then(function(e){t.showEdit=!1,t.getTemplates()})},EditTemplate:function(t,e,a,n){this.showEdit=!0,this.toEdit.title=e,this.toEdit.id=t,this.toEdit.description=a,this.toEdit.contract_type_id=n,console.log(this.toEdit.contracttypeid)}}}},QXNi:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),s=n(i),r=a("Xxa5"),o=n(r),c=a("exGp"),l=n(c),d=a("z93h"),u=a("AwEB");e.default={props:{title:{type:String,default:""}},computed:{minDate:function(){if(1===this.form.is_frame){var t=new Date((0,u.nowMonth)()),e=new Date(this.form.start_date);if(t.getTime()>e.getTime())return console.log(t.getMonth()+1),t}return this.form.start_date}},data:function(){return{flag:!0,form:{frame_number:"",frame_leader:"",frame_name:"",start_date:null,end_date:null,is_frame:2},active:!1,id:0}},methods:{toastTip:function(){this.$toast.error("返点数据已生成，无法修改起始时间")},postRebateCheck:function(){var t=this;return(0,l.default)(o.default.mark(function e(){var a,n,i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.form,n=a.start_date,i=a.end_date,e.next=3,(0,d.postRebateCheck)({start_date:(0,u.changeMonth)(n),end_date:(0,u.changeMonth)(i),frame_id:t.id});case 3:if(s=e.sent){e.next=7;break}return t.$toast.error("时间段冲突无法修改"),e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}},e,t)}))()},saveBaseInfo:function(){var t=this;return(0,l.default)(o.default.mark(function e(){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.flag){e.next=2;break}return e.abrupt("return");case 2:t.flag=!1,e.prev=3,["frame_leader","frame_name","start_date","end_date"].forEach(function(e){if(!t.form[e])throw new Error}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(3),t.flag=!0,e.abrupt("return",t.$toast.error("请填写相应信息"));case 11:if(!t.id){e.next=18;break}return e.next=14,t.postRebateCheck();case 14:if(a=e.sent,t.flag=!0,a){e.next=18;break}return e.abrupt("return");case 18:t.rebateFrameBaseSave();case 19:case"end":return e.stop()}},e,t,[[3,7]])}))()},rebateFrameBaseSave:function(){var t=this;return(0,l.default)(o.default.mark(function e(){var a,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.rebateFrameBaseSave)((0,s.default)({id:t.id},t.form));case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:n=a.id,t.$emit("reload",n),t.$toast.success("编辑成功"),t.close();case 9:case"end":return e.stop()}},e,t)}))()},close:function(){this.active=!1},open:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1];this.flag||(this.flag=!0),t&&(this.form=(0,s.default)({},e,{start_date:new Date(e.start_date+"-1"),end_date:new Date(e.end_date+"-1")})),this.active=!0,this.id=t}}}},"R/L5":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={name:"CostManagePart",data:function(){return{cost:null,costList:[],isBorder:!0,selected:[],level:[],cost_name:""}},computed:{filteredDataObj:function(){var t=this;return this.costList.filter(function(e){return e.cost_name.toString().toLowerCase().indexOf(t.cost_name.toLowerCase())>=0})}},created:function(){this.getCostList()},methods:{checkStatus:function(t,e,a){e?(this.one!==t.val&&(t.val=this.one),t.id?t.isEdit=!1:this.cooperationList[0].level.splice(a,1)):(this.one=t.val,t.isEdit=!0),this.$forceUpdate()},addCost:function(){this.costList.unshift({isEdit:!0,cost_name:"",can_delete:1,id:0})},deleteCost:function(t,e){var a=this,n=this;if(t.id)return n.ajax({url:"/contract_amount_detail_cost/delete_cost",data:{id:t.id},method:"post"}).then(function(t){0===t.error_code&&(console.log(111),a.$toast.open({duration:3e3,message:"删除成功",position:"is-top",type:"is-success"}),n.costList.splice(e,1))});n.costList.splice(e,1)},saveCost:function(t){var e=this,a="",n={};return t.id?(a="/contract_amount_detail_cost/update_cost",n={id:t.id,cost_name:t.cost_name}):(a="/contract_amount_detail_cost/add_cost",n={id:t.id,cost_name:t.cost_name}),this.ajax({url:a,method:"post",data:n}).then(function(a){0===a.error_code&&(t.isEdit=!1,t.id=a.data.id,t.cooperation_type=a.data.cooperation_type,e.$forceUpdate(),e.$toast.open({duration:3e3,message:"保存成功",position:"is-top",type:"is-success"}))})},getCostList:function(){var t=this;return this.ajax({url:"/contract_amount_detail_cost/get_cost_lists",params:{cost_name:this.cost_name}}).then(function(e){0===e.error_code&&(t.costList=e.data)})}}}},RM0n:function(t,e,a){a("oG4N");var n=a("VU/8")(a("qZcH"),a("CNe9"),null,null);t.exports=n.exports},Rekb:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),s=n(i),r=a("woOf"),o=n(r),c=a("NDNc"),l=a("ZpP4"),d={},u=["companyName","companyFrdb","companyYyzzzch","companyNsrsbh","companyBank","companyBankNumber","companyDueDate","companyYyzzFile","companySwdjFile","companyKhyhFile","companyNsrzmFile","recoveryCycle"],_={yyzz:"营业执照",nsrzm:"纳税人证明",khyh:"开户银行",swdj:"税务登记"};e.default={props:["companyId","isEdit"],data:function(){return{contractRecoveryCycleList:[{id:1,value:"90天"},{id:2,value:"120天"},{id:3,value:"180天"}],companyArea:"native",provinces:c.province,provinceId:null,annualInspectionDueDate:new Date,companyNameStatus:"",companyNameMsg:"",yyzzFiles:[],swdjFiles:[],khyhFiles:[],nsrzmFiles:[],states:{yyzz:{status:"",msg:"",loading:!1},swdj:{status:"",msg:"",loading:!1},khyh:{status:"",msg:"",loading:!1},nsrzm:{status:"",msg:"",loading:!1}},company:{company_name:"",province_name:"",reg_address:"",address:"",zipcode:"",tel:"",fax:"",frdb:"",yyzzzch:"",nsrsbh:"",bank:"",bank_number:"",annual_inspection_due_date:new Date,contractRecoveryCycle:"",ybnsr:"0",yyzz_image_url:"",swdj_image_url:"",khyh_image_url:"",nsrzm_image_url:"",swift_code:""},companyMessage:""}},computed:{provinceName:function(){return this.provinceId?l.province_object[this.provinceId].name:null}},watch:{companyArea:function(t){this.$emit("areaseleted",t),this.$refs.companySwiftCode.type="text",this.blurValidator()}},created:function(){this.isEdit?this.companyId&&this.getCompanyData():this.getCompanyData()},methods:{contractRecoveryCycleFindHandle:function(t){return 0===t?"":1===t?"90天":2===t?(console.log(t),"120天"):3===t?"180天":void 0},blurValidator:function(){if("native"===this.companyArea){/^[0-9]*$/.test(this.company.bank_number)?this.companyMessage="":this.companyMessage="仅支持数字格式，请确认输入正确的格式账号"}else{var t=/^[A-Za-z0-9]+$/;this.company.bank_number&&!t.test(this.company.bank_number)?this.companyMessage="请确认输入正确的字母/数字格式账号":this.companyMessage=""}},getCompanyData:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/signing_company/get_by_id",params:{id:this.companyId}}).then(function(e){d=(0,o.default)({},e.data),t.companyArea=0===e.data.area_id?"native":"oversea",t.provinceId=t.getProvinceId(e.data.province_name),t.annualInspectionDueDate=new Date(e.data.annual_inspection_due_date),t.company=e.data,t.isEdit?t.company.contractRecoveryCycle=e.data.contract_recovery_cycle:t.company.contractRecoveryCycle=t.contractRecoveryCycleFindHandle(e.data.contract_recovery_cycle),console.log("this.company.contractRecoveryCycle=",t.company.contractRecoveryCycle)})},checkCompanyName:function(){var t=this;this.company.company_name=this.company.company_name.trim(),0!==this.company.company_name.length&&(this.isEdit&&this.companyId&&this.company.company_name===d.company_name||this.ajax({url:"/signing_company/get_by_company_name",params:{company_name:this.company.company_name}}).then(function(e){0!==e.error_code?(t.companyNameStatus="is-danger",t.companyNameMsg=e.error_msg):(t.companyNameStatus="",t.companyNameMsg="")}))},fileUpload:function(t){var e=this,a=this.$data[t+"Files"],n=_[t];if("native"===this.companyArea&&"yyzz"===t&&(n="营业执照或其他证明材料"),console.log(a),0!==a.length){var i=a;if(i.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+n+"】附件大小不能超过50M");this.states[t].status="",this.states[t].msg="",this.states[t].loading=!0,this.ajax({url:"/tools/file_upload",method:"post",data:{file_type:i.name.match(/\.([^.]+)$/)[1],file_name:i}}).then(function(a){0===a.error_code&&(e.states[t].loading=!1,e.company[t+"_image_url"]=a.data.file_name)})}},companyDataValidate:function(t){var e=this,a=[];return t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(n.checkHtml5Validity()||a.push(n))}),!a.length||(a[0].focus(),!1)},saveCompanyData:function(t){var e=this,a=u;if("oversea"===this.companyArea&&(a=["companyName","companyAddress","companyYyzzFile"]),this.companyDataValidate(a)){var n=this.isEdit&&this.companyId,i=this.company,s={company_name:i.company_name,province_name:this.provinceName,reg_address:i.reg_address,address:i.address,zipcode:i.zipcode,tel:i.tel,fax:i.fax,frdb:i.frdb,yyzzzch:i.yyzzzch,nsrsbh:i.nsrsbh,bank:i.bank,bank_number:i.bank_number,annual_inspection_due_date:this.zDateFormatter(this.annualInspectionDueDate),contract_recovery_cycle:this.company.contractRecoveryCycle,ybnsr:i.ybnsr,yyzz_image_url:i.yyzz_image_url,swdj_image_url:i.swdj_image_url,khyh_image_url:i.khyh_image_url,nsrzm_image_url:i.nsrzm_image_url,btn_save:t?2:1},r="/signing_company/domestic_save";return"oversea"===this.companyArea&&(r="/signing_company/over_sea_save",s={signing_company_type_id:i.signing_company_type_id,company_name:i.company_name,address:i.address,bank:i.bank,bank_number:i.bank_number,swift_code:i.swift_code,yyzz_image_url:i.yyzz_image_url,btn_save:t?2:1}),n&&(s.id=this.companyId),this.ajax({loading:this.$loading.open(),url:r,method:"post",data:s,successTip:!0}).then(function(a){0===a.error_code&&(n||e.$emit("companysaved",a.data),t&&e.$router.push("/companies"))})}},getProvinceId:function(t){var e=!0,a=!1,n=void 0;try{for(var i,r=(0,s.default)(c.province);!(e=(i=r.next()).done);e=!0){var o=i.value;if(o.name===t)return o.id}}catch(t){a=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}return null},approvePass:function(){var t=this;return this.ajax({url:"/signing_company/approve",method:"post",successTip:!0,loading:this.$loading.open(),data:{id:this.companyId}}).then(function(e){0===e.error_code&&(t.company.approve_status_id=2,t.$router.push("/pending_companies"))})},approveReject:function(){var t=this;return this.ajax({url:"/signing_company/not_approve",method:"post",successTip:!0,loading:this.$loading.open(),data:{id:this.companyId}}).then(function(e){0===e.error_code&&(t.company.approve_status_id=3,t.$router.push("/pending_companies"))})}}}},"S+il":function(t,e){},"S5+M":function(t,e,a){var n=a("VU/8")(a("jjsM"),a("m3w+"),null,null);t.exports=n.exports},S9Dq:function(t,e){},SgY0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={name:"CooperationList",data:function(){return{one:"",cooperationList:[],isBorder:!0,showLogModal:!1,logData:[]}},created:function(){this.getCooperationList()},methods:{deleteCooperation:function(t,e){var a=this;if(t.id)return a.ajax({url:"/contract_amount_detail_cooperation/delete_cooperation",data:{id:t.id}}).then(function(t){0===t.error_code&&a.cooperationList.splice(e,1)});a.cooperationList.splice(e,1)},saveCooperation:function(t){var e=this,a="",n={};return t.id?(a="/contract_amount_detail_cooperation/update_cooperation",n={id:t.id,cooperation_name:t.val}):(a="/contract_amount_detail_cooperation/add_cooperation",n={parent_id:t.id,cooperation_name:t.val,cooperation_type:t.cooperation_type}),this.ajax({url:a,method:"post",data:n}).then(function(a){0===a.error_code&&(t.isEdit=!1,t.id=a.data.id,t.cooperation_type=a.data.cooperation_type,e.$forceUpdate(),e.$toast.open({duration:5e3,message:"保存成功",position:"is-top",type:"is-success"}))})},checkStatus:function(t,e){e?(this.one!==t.val&&(t.val=this.one),t.isEdit=!1):(this.one=t.val,t.isEdit=!0),this.$forceUpdate()},getCooperationList:function(){var t=this;return this.ajax({url:"/contract_amount_detail_cooperation/get_cooperation_lists"}).then(function(e){0===e.error_code&&(t.cooperationList=e.data,t.cooperationList.map(function(t){return t.isEdit=!1,t}))})},showCooperationLog:function(t){var e=this;return this.showLogModal=!0,this.logData=[],this.ajax({url:"/contract_amount_detail_cooperation/get_cooperation_log",params:{id:t}}).then(function(t){0===t.error_code&&(console.log(t.data),e.logData=e.formatLogData(t.data))})},formatLogData:function(t){return t.map(function(t){return t.description=JSON.parse(t.description),t})}}}},TQye:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("/peU"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={data:function(){return{companyName:"",companyList:[],enteredDateStart:null,enteredDateEnd:null,clientLists:[],clientListId:"",clientListSelected:"",clientType:null,brands:[],brandName:"",brandId:null,infoType:null,loading:!1,meetPeople:"",total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"updated_date",sortOrder:"desc",questList:[],forSearch:!0,is_referrer:0,referrer_name:""}},components:{ReferrerName:i.default},mounted:function(){this.getCustoms(),this.getBrands(),this.getCompany(),this.questFn();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},watch:{currPage:function(t){this.questFn(t)},questList:function(t){var e=this;t.length>0&&setTimeout(function(){e.questList.forEach(function(t){var a=e.$refs["result_"+t.id].offsetHeight,n=e.$refs["core_problem_"+t.id].offsetHeight,i=e.$refs["conclusion_"+t.id].offsetHeight;a>60?(e.$refs["result_"+t.id].style.height="60px",t.zk=!0):t.zk=!1,n>60?(e.$refs["core_problem_"+t.id].style.height="60px",t.pk=!0):t.pk=!1,i>60?(e.$refs["conclusion_"+t.id].style.height="60px",t.ck=!0):t.ck=!1,e.$forceUpdate()})},0)}},computed:{filterClientLists:function(){var t=this;return this.clientLists.filter(function(e){return e.client_name.toString().toLowerCase().indexOf(t.clientListSelected.toLowerCase())>=0})},filterBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.brandName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},methods:{getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanySelected:function(t){t&&(this.companyName=t.name)},clickFn:function(t,e,a){var n=document.getElementById(a+"_"+e),i=document.getElementById("btn_"+a+"_"+e);"收起"===i.innerHTML?(i.innerHTML="展开",n.style.height="60px"):(n.style.height="auto",i.innerHTML="收起")},onCustomSelected:function(t){t&&(this.clientListId=t.client_id)},getCustoms:function(){var t=this;return this.ajax({url:"/client/get_client_list",params:{client_level_id_neq:2}}).then(function(e){0===e.error_code&&(t.clientLists=e.data.list)})},onBrandSelected:function(t){t&&(this.brandId=t.brand_id)},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list"}).then(function(e){t.brands=e.data})},handleOption:function(t){return null!==t&&""!==t&&"undefined"!==t},questFn:function(t){var e=this;Number(t)||(t=1,this.currPage=1);var a={loading:this.$loading.open(),url:"/client_visited_log/get_client_visited_log_list",params:{page:t,page_size:this.perPage,order_name:this.sortField,sort:this.sortOrder,is_referrer:this.is_referrer}},n=this.handleOption;n(this.enteredDateStart)&&(a.params.start_entered_date=this.zDateFormatter(this.enteredDateStart)),n(this.enteredDateEnd)&&(a.params.end_entered_date=this.zDateFormatter(this.enteredDateEnd)),n(this.clientListSelected)&&(a.params.client_name=this.clientListSelected),n(this.clientType)&&(a.params.client_type=this.clientType),n(this.brandName)&&(a.params.title=this.brandName),n(this.infoType)&&(a.params.visit_type=this.infoType),n(this.meetPeople)&&(a.params.visit_users=this.meetPeople),n(this.companyName)&&(a.params.group_name=this.companyName),n(this.referrer_name)&&(a.params.referrer_name=this.referrer_name),this.questList=[],this.ajax(a).then(function(t){if(0===t.error_code){var a=t.data.list||[];e.questList=a,e.total=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1)}})},onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},resetParams:function(){this.enteredDateStart=null,this.enteredDateEnd=null,this.clientListId="",this.clientListSelected="",this.clientType=null,this.brandName="",this.brandId=null,this.infoType=null,this.meetPeople="",this.currPage=1,this.companyName="",this.is_referrer=0,this.referrer_name=""},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.questFn()},deleteSale:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此条客户信息么？",onConfirm:function(){a.ajax({url:"/client_visited_log/delete_client_visited_log",method:"post",data:{id:t}}).then(function(t){0===t.error_code&&(a.questList.splice(e,1),a.questFn())})}})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},exportALL:function(){var t=this,e={loading:this.$loading.open(),url:"/client_visited_log/export_client_visited_log_list",params:{page:this.currPage,page_size:this.perPage,order_name:this.sortField,sort:this.sortOrder,is_referrer:this.is_referrer}},a=this.handleOption;a(this.enteredDateStart)&&(e.params.start_entered_date=this.zDateFormatter(this.enteredDateStart)),a(this.enteredDateEnd)&&(e.params.end_entered_date=this.zDateFormatter(this.enteredDateEnd)),a(this.clientListSelected)&&(e.params.client_name=this.clientListSelected),a(this.clientType)&&(e.params.client_type=this.clientType),a(this.brandName)&&(e.params.title=this.brandName),a(this.infoType)&&(e.params.visit_type=this.infoType),a(this.meetPeople)&&(e.params.visit_users=this.meetPeople),a(this.companyName)&&(e.params.group_name=this.companyName),a(this.referrer_name)&&(e.params.referrer_name=this.referrer_name),this.ajax(e).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},getReferrer:function(t,e){console.log("-----getReferrer-----",t,e),this.is_referrer=t,this.referrer_name=e},getReferrerType:function(t){console.log("-----getReferrerType-----",t),this.is_referrer=t}}}},U8UC:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("mvHQ"),i=function(t){return t&&t.__esModule?t:{default:t}}(n),s=["默认","是","否"],r=["userId"];e.default={name:"CostManageView",props:{id:{type:String,default:null},isAdd:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},isPending:{type:Boolean,default:!1}},data:function(){return{IS_FIRST:s,CostStatus:{0:"待审核",1:"已核准"},contract_number:"",isInfoShow:!1,isAddShow:!1,errorMsg:"",contractId:null,cost_email_path:"",cost_email_source_name:"",urlFiles:[],msg:"",status:"",contract:{apply_user_name:"",contract_type_id:null,contract_type_name:"",contract_number:"",contract_name:"",contract_charge_name:"",contract_brand_name:"",contract_second_brand_name:"",department_name:"",parent_department_name:"",client_name:"",signing_company_name:"",signing_company_type:null,party_b_name:"",start_date:new Date,startDate:new Date,end_date:new Date,endDate:new Date,account_period:new Date,client_relationship_name:null},userId:this.$root.crmUser.id,userName:this.$root.crmUser.name,codeList:[],details:[],charge_userName:"",charge_userId:null,cost_order_content:"",SOFTWAYS:[],costList:[],financial:[],ifReject:!1,rejectReason:"",params:{}}},created:function(){this.isAdd?this.addCostManage():(this.getContract(this.id),this.getCost(this.id)),this.isEdit||this.getApproval(),this.getCodeList(),this.getCostList()},computed:{minDate:function(){var t=new Date;return new Date(t-864e5*t.getDate())}},watch:{},methods:{getCostList:function(){var t=this;return this.ajax({url:"/contract_amount_detail_cost/get_cost_lists"}).then(function(e){0===e.error_code&&(console.log("成本管理"),t.costList=e.data)})},filteredDataObj:function(t){return t.options=this.costList.filter(function(e){return e.cost_name.toString().toLowerCase().indexOf((t.cost_name||"").toLowerCase())>=0}),this.$forceUpdate(),t.options},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.charge_userName,role_code:"role-crm-xiangmujingli",use_swzc:0}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},onChargenameSelected:function(t){console.log(t),t&&(this.charge_userId=t.id)},getContract:function(){var t=this;return this.ajax({url:"/contract_cost/getContractDetail",loading:this.$loading.open(),params:{contract_number:this.contract_number,contract_id:this.id,type:this.isAdd?1:0}}).then(function(e){0===e.error_code?(t.contract=e.data,t.isInfoShow=!0,t.contractId=e.data.contract_id,t.charge_userId=e.data.cost_pm_id||t.userId,t.charge_userName=e.data.cost_pm_name||t.userName,t.cost_order_content=e.data.cost_order_content,t.cost_email_path=e.data.cost_email_path,t.cost_email_source_name=e.data.cost_email_source_name,t.cost_email_source_name&&t.isEdit&&(t.msg=t.cost_email_source_name,t.status=""),t.contract.file_url=e.data.cost_email_path):10079===e.error_code&&(t.isAddShow=!0,t.errorMsg=e.error_msg,t.contractId=e.data.contract_id)})},getCost:function(){var t=this;return this.ajax({url:"/contract_cost/getCostDetail",params:{contract_id:this.id}}).then(function(e){if(e.data&&e.data.cost_json){var a=e.data.cost_json;t.details=a,t.details.forEach(function(t){t.estimated_date=new Date(t.estimated_time),t.options=[],t.cost_name=1===t.cost_type?t.cooperation_name:t.cost_name});var n={cost_template:"合计",cooperation_name:"合计",estimated_time:null,estimated_cost:e.data.estimated_cost_count,actual_details:"",actual_cost:e.data.actual_cost_count,cost_status:"",isAdd:0,isLast:!0};t.details.push(n)}})},getApproval:function(){var t=this;return this.ajax({url:"/contract_cost/getContractApproval",params:{contract_id:this.id}}).then(function(e){t.financial=e.data})},deleteCostManage:function(t,e){var a=this;this.$dialog.confirm({message:"确定删除吗？",onConfirm:function(){a.details.splice(e,1),a.onBlurCost(0,"estimated_cost"),a.onBlurCost(0,"actual_cost")}})},addCostManage:function(){0===this.details.length&&this.details.push({cost_template:"合计",cooperation_name:"合计",estimated_time:null,estimated_cost:"",actual_details:"",actual_cost:"",cost_status:"",isAdd:0,isLast:!0});var t={cost_template:"",cooperation_name:"",estimated_time:null,estimated_cost:"",actual_details:"",actual_cost:"",cost_status:"",cost_name:"",cost_type:"",options:[],isAdd:1,isLast:!1,is_update:1};this.details.splice(-1,0,t)},onBlurCost:function(t,e){/^\d+(\.\d+)?$/.test(t)||(this.$dialog.alert("请输入数字"),t=0);var a=0;this.details.forEach(function(t){t.isLast?t[e]=a:a+=Number(t[e])})},fileUpload:function(t){var e=this,a=this.$data[t+"Files"];if(0!==a.length){var n=a;if(-1===["doc","docx","xml","rar","zip","png","jpg","jpeg","eml"].indexOf(n.name.match(/\.([^.]+)$/)[1]))return this.status="is-danger",this.msg="请上传.doc,.docx,.xml,.rar,.zip,.png,.jpg,.jpeg,.eml格式的文件",void this.$dialog.alert(this.msg);if(n.size>52428800)return this.status="is-danger",this.msg="文件大小不能超过50M",void this.$dialog.alert("文件大小不能超过50M");this.status="",this.msg="",this.ajax({url:"/tools/file_upload",method:"post",data:{file_type:n.name.match(/\.([^.]+)$/)[1],file_name:n}}).then(function(a){e.contract["file_"+t]=a.data.file_name,e.cost_email_path=a.data.file_name,e.status="",e.msg=a.data.source_name,e.cost_email_source_name=a.data.source_name})}},contractDataValidate:function(t){var e=this,a=[];if(t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(/_(start|end)_date_/.test(t)?n.value||a.push({type:"datepicker",component:n}):/^file_url/.test(t)?e.contract[t]||(n.checkHtml5Validity(),a.push(n)):n.checkHtml5Validity()?r.indexOf(t)>-1&&!e.contract[t]&&(a.push(n),n.newValue="",e.$nextTick(function(){n.checkHtml5Validity()})):a.push(n))}),a.length){var n=a[0];return"datepicker"===n.type?n.component.$el.querySelector('input[type="text"]').focus():n.focus(),!1}return!0},saveContract:function(){var t=this,e=[];if(this.details.length){console.log("成本管理验证");var a=["cost_template_cooperation_id","cost_estimated_cost","cost_actual_cost","cost_estimated_time_start_date","cost_actual_details","cost_actual_details"];this.details.forEach(function(t,n){a.forEach(function(t){e.push(t+"_"+n)})})}if(!this.contractDataValidate(e))return!1;console.log("保存");var n=[];this.details.forEach(function(e){e.isLast||n.push({cost_template:e.cost_template,estimated_cost:e.estimated_cost,estimated_time:t.zDateFormatter(e.estimated_date),actual_details:e.actual_details,cost_status:0,actual_cost:e.actual_cost,cost_name:e.cost_name,cost_type:e.cost_type})});var s={cost_json:(0,i.default)(n),contract_id:this.contractId,cost_pm_id:this.charge_userId,cost_email_path:this.cost_email_path,cost_order_content:this.cost_order_content,cost_approval_status:0,cost_email_source_name:this.cost_email_source_name};return console.log(s),this.ajax({url:"/contract_cost/createContractCost",data:s,method:"post"}).then(function(e){0===e.error_code&&(t.$toast.open({duration:3e3,message:"操作成功",position:"is-top",type:"is-success"}),t.isAdd?t.$router.push("/cost_manage/"):t.$router.push("/cost_manage/"+e.data.contract_id))})},reviewCost:function(t){console.log(t),1===t?(this.params={contract_id:this.id,status:3},this.changeCost(this.params)):this.ifReject=!0},changeCost:function(t){var e=this;return this.ajax({url:"/contract_cost/changeCostStatus",method:"post",data:t}).then(function(t){console.log(t),0===t.error_code&&e.$router.push("/pending_cost")})},rejectCost:function(){this.params={contract_id:this.id,status:2,reason:this.rejectReason},this.changeCost(this.params),this.toReject()},toReject:function(){this.ifReject=!1,this.rejectReason=""},deleteCostEmail:function(){var t=this;console.log(1111),this.$dialog.confirm({message:"您确定要删除此文件么？",onConfirm:function(){console.log(23322),t.ajax({url:"/contract_cost/costEmailDestory",method:"post",data:{contract_id:t.contractId}}).then(function(e){0===e.error_code&&(t.$toast.open({message:"删除文件成功！",type:"is-success"}),window.location.reload())})}})}}}},U9Mp:function(t,e){},UBJS:function(t,e){},UsLl:function(t,e){},Uymz:function(t,e,a){a("a9gC");var n=a("VU/8")(a("fhg8"),a("IZDD"),"data-v-37fc82e9",null);t.exports=n.exports},VARa:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={start_quarter_1:"01",start_quarter_2:"04",start_quarter_3:"07",start_quarter_4:"10",end_quarter_1:"03",end_quarter_2:"06",end_quarter_3:"09",end_quarter_4:"12"};e.default={name:"SelectDate",props:["el","isCheck","clickBtn","clickReset","title","year"],watch:{search_time_by:function(){this.start_time=null,this.end_time=null},clickBtn:function(t){console.log("clickBtn",t),this.selectDate()},clickReset:function(){console.log("reset",this.clickReset),this.search_time_by="month",this.start_year=(new Date).getFullYear(),this.start_month=(new Date).getMonth()+1,this.end_year=(new Date).getFullYear(),this.end_month=(new Date).getMonth()+1,this.start_quarter="1",this.end_quarter="4",this.selectDate()}},mounted:function(){this.selectDate()},data:function(){return{defaultYear:this.year||2009,start_time:null,end_time:null,start_year:(new Date).getFullYear(),start_month:(new Date).getMonth()+1,end_year:(new Date).getFullYear(),start_quarter:"1",end_quarter:"4",end_month:(new Date).getMonth()+1,search_time_by:"month",startTime:null,endTime:null,mon:null}},methods:{setDate:function(){var t=void 0,e=void 0,a=void 0,i=void 0,s=this.el;"day"===this.search_time_by?(t=this.start_time?this.zDateFormatter(this.start_time):"",e=this.end_time?this.zDateFormatter(this.end_time):""):"month"===this.search_time_by?(this.start_year?(s?(console.log("2--el",this.el),a=this.start_month,i=this.start_year):(console.log("1--el",this.el),a=1!==this.start_month?this.start_month-1:12,i=1!==this.start_month?this.start_year:this.start_year-1),this.start_month=a,Number(a)<10&&(a="0"+a),t=i+"-"+a):t=(new Date).getFullYear(),this.end_year?(s?(a=this.end_month,i=this.end_year):(a=12!==this.end_month?this.end_month+1:1,i=12!==this.end_month?this.end_year:this.end_year+1),this.end_month=a,Number(a)<10&&(a="0"+a),e=i+"-"+a):e=(new Date).getFullYear()):"year"===this.search_time_by?(t=this.start_time?this.start_time:this.start_year,e=this.end_time?this.end_time:this.end_year):(t=this.start_year+"-"+n["start_quarter_"+this.start_quarter],e=this.end_year+"-"+n["end_quarter_"+this.end_quarter]),this.startTime=t,this.endTime=e,this.mon=a,console.log(this.startTime,this.endTime,this.mon,this.search_time_by),this.$forceUpdate()},selectDate:function(){this.setDate(),this.$emit("selectDate",this.startTime,this.endTime,this.mon,this.search_time_by)}}}},VFb8:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),s=n(i),r=a("/YQ4"),o=n(r),c=a("7oH8"),l=n(c);e.default={data:function(){return{menuExpanded:!0,leftMenu:l.default,user:null,crmUser:null,permissonCodes:""}},created:function(){var t=this;this.getLoginInfo(),this.getMenu(),this.leftMenu.forEach(function(e,a){var n=!0,i=!1,r=void 0;try{for(var o,c=(0,s.default)(e.menus);!(n=(o=c.next()).done);n=!0){var l=o.value;if(new RegExp(l.path).test(t.$route.path))return void(e.open=!0)}}catch(t){i=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw r}}})},methods:{getLoginInfo:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/session/check_login"}).then(function(e){0===e.error_code?(o.default.$emit("login",e),t.user=e.data.user,t.crmUser=e.data.crm_user,t.permissonCodes=e.data.permissions):setTimeout(function(){window.location="https://sso-bgm.smzdm.com/cas/login"},1e3)})},getMenu:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/ad_jumper/get_sale_rate_zone_secluded"}).then(function(e){0===e.error_code&&t.leftMenu.forEach(function(t){t.menus.forEach(function(t){"/sales"===t.path?t.url=e.data.sale_rate_url:"/positions"===t.path&&(t.url=e.data.zone_schedule_url)})})})},deleteCookie:function(){return this.ajax({url:"/cas_callback/crm_logout"}).then(function(t){0===t.error_code&&(window.location.href="https://sso-bgm.smzdm.com/cas/logout")})}}}},VL37:function(t,e){},VLaJ:function(t,e,a){var n=a("VU/8")(a("CWIr"),a("qNRk"),null,null);t.exports=n.exports},ViwI:function(t,e){},W4Kq:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=n(i),r=a("woOf"),o=n(r),c=a("LZT1"),l=n(c),d=a("lHK6"),u=n(d),_=a("/peU"),p=n(_);e.default={props:{page:{type:Number,default:null}},data:function(){return{isHeader:!1,defaultSortDirection:"asc",sortField:"updated_date",sortOrder:"desc",is_referrer:0,referrer_name:"",departments:[],departmentId:null,departmentName:null,brands:[],brandName:"",brandId:null,companyName:"",companyList:[],productLines:[],productLineId:null,clientList:[],clientId:"",clientName:"",numberList:[],clientNumber:null,accessSJZX:null,accessXLSM:null,clientLevelId:null,newest_degree:"",approveStatusId:null,enteredDateStart:null,enteredDateEnd:null,userId:"",userName:"",totalClients:0,is_ka:0,is_wastage:0,clients:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,userReadonly:!1,departmentReadonly:!1,departmentUsers:[],currUserName:"",showLogModal:!1,logData:[],forSearch:!0,logColumns:[{width:"80",field:"creation_time",label:"操作时间"},{width:"80",field:"user_name",label:"用户"},{field:"info",label:"操作内容"}],urlParams:{},brand_product_type:"",levelData:[]}},components:{ReferrerName:p.default},computed:{filteredUser:function(){var t=this;return this.departmentUsers.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})},filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.brandName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},watch:{brandId:function(t){t&&this.getProductLines(t)},currPage:function(t){0!==t&&this.getClients(!0)},departmentId:function(t){t&&(this.userId=null,this.userName="",this.getUsersByDepartment(t))},page:function(t){this.currPage=t||1},urlParams:function(t){var e=(0,o.default)({},t),a=[];e.page=1===this.currPage?null:this.currPage;for(var n in e){var i=e[n];if(i){var s=encodeURIComponent(n)+"="+encodeURIComponent(i);a.push(s)}}var r=this.$router.currentRoute.path+"?"+a.join("&");this.$router.replace(r)}},mounted:function(){this.getLevel(),this.getCompany(),this.initQueryData(),this.initUserData(),this.getDepartments(),this.getBrands(),this.getClientsList(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getClients(!1);var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()},this.isShangwu()},methods:{getClientsList:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},getNumberList:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_number:this.clientNumber}}).then(function(e){if(!e.data.length)return void(t.numberList=[]);t.numberList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id)},onNumberSelected:function(t){t&&(this.clientNumber=t.client_number)},getLevel:function(){var t=this;this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:""};t.levelData.unshift(a)})},getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanySelected:function(t){t&&(this.companyName=t.name)},isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},initUserData:function(){var t=this.$parent;t.user&&t.crmUser&&(this.isRole(this.ROLE.zuzhang)?this.getUsersByRole(this.ROLE.zuzhang):this.isRole(this.ROLE.shangwu)&&(this.currUserName=t.crmUser.name))},initQueryData:function(){var t=this.$route.query;if(!(0,u.default)(t))for(var e in t){var a=t[e];switch(e){case"user_id":this.userId=a;break;case"brand_id":this.brandId=a;break;case"product_line_id":this.productLineId=a;break;case"client_name":this.clientName=a;break;case"number":this.clientNumber=a;break;case"is_sjzx":this.accessSJZX=a;break;case"is_xlsm":this.accessXLSM=a;break;case"client_level_id":this.clientLevelId=a;break;case"newest_degree":this.newest_degree=a;break;case"approve_status_id":this.approveStatusId=a;break;case"page":this.currPage=a;break;case"entered_date_start":this.enteredDateStart=new Date(a);break;case"entered_date_end":this.enteredDateEnd=new Date(a);break;case"department_id":this.departmentId=a;break;case"brand_name":this.brandName=a;break;case"is_ka":this.is_ka=a;break;case"is_wastage":this.is_wastage=a;break;case"group_name":this.companyName=a;break;case"is_referrer":this.is_referrer=a;break;case"referrer_name":this.referrer_name=a}}},onQueryClick:function(){1===this.currPage?this.getClients(!0):this.currPage=1},getDepartments:function(){var t=this;return this.ajax({url:"/department/index"}).then(function(e){var a=(0,l.default)(e.data);t.departments=a})},getClients:function(t){var e=this;console.log("ifserch",t),this.loading=!0;var a={department_id:this.departmentId,user_id:this.userId,brand_name:this.brandName,product_line_id:this.productLineId,client_name:this.clientName,number:this.clientNumber,is_sjzx:this.accessSJZX,is_xlsm:this.accessXLSM,client_level_id:this.clientLevelId,newest_degree:this.newest_degree,approve_status_id:this.approveStatusId,entered_date_start:this.enteredDateStart&&this.zDateFormatter(this.enteredDateStart),entered_date_end:this.enteredDateEnd&&this.zDateFormatter(this.enteredDateEnd),order_name:this.sortField,order_asc_desc:this.sortOrder,group_name:this.companyName,brand_product_type:this.brand_product_type,page:this.currPage,is_ka:this.is_ka,is_wastage:this.is_wastage,is_referrer:this.is_referrer,referrer_name:this.referrer_name};new s.default(function(a,n){e.isShangwu()?t?a():(e.departmentUsers=[],1===e.$root.crmUser.is_headman?(console.log("是商务组长"),e.isHeader=!0,a()):(console.log("不是商务组长"),e.isHeader=!1,e.departmentReadonly=!0,e.departmentName=e.$root.crmUser.department_name,e.departmentUsers=[{name:e.$root.crmUser.name,id:e.$root.crmUser.id}],e.currUserName=e.$root.crmUser.name,e.userReadonly=!0,a())):a()}).then(function(){e.urlParams=(0,o.default)({department_id:e.departmentId,brand_name:e.brandName},a);var t=(0,o.default)({page_size:e.perPage},a);return e.loading=!0,e.ajax({url:"/client/get_client_list",params:t}).then(function(t){e.totalClients=t.data.total,e.totalPage=t.data.total_page,e.clients=t.data.list,e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list"}).then(function(e){t.brands=e.data})},getProductLines:function(t){var e=this;return this.ajax({url:"/brand/get_product_line_by_brand_id",params:{brand_id:t}}).then(function(t){e.productLines=t.data;var a={product_line_id:"",product_line_name:""};e.productLines.unshift(a)})},getUsersByDepartment:function(t){var e=this;return this.ajax({method:"post",url:"/user/get_list_by_department_id",data:{department_id:t}}).then(function(t){e.departmentUsers=t.data.rows||[]})},getUsersByRole:function(t){var e=this;return this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{role_code:t}}).then(function(t){e.departmentUsers=t.data.rows||[]})},onUserSelected:function(t){t&&(this.userId=t.id)},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brandName=t.title)},resetParams:function(){!this.isHeader&&this.isShangwu()||(this.departmentId=null,this.userId=null,this.userName=""),this.brands=[],this.brandName="",this.companyName="",this.brandId=null,this.productLines=[],this.productLineId=null,this.clientName="",this.clientNumber=null,this.clientId=null,this.accessSJZX=null,this.accessXLSM=null,this.clientLevelId=null,this.newest_degree="",this.approveStatusId=null,this.enteredDateStart=null,this.enteredDateEnd=null,this.is_ka=0,this.is_wastage=0,this.brand_product_type="",this.is_referrer=0,this.referrer_name=""},exportALL:function(){var t=this,e={department_id:this.departmentId,user_id:this.userId,brand_name:this.brandName,product_line_id:this.productLineId,client_name:this.clientName,number:this.clientNumber,is_sjzx:this.accessSJZX,is_xlsm:this.accessXLSM,client_level_id:this.clientLevelId,newest_degree:this.newest_degree,approve_status_id:this.approveStatusId,entered_date_start:this.enteredDateStart&&this.zDateFormatter(this.enteredDateStart),entered_date_end:this.enteredDateEnd&&this.zDateFormatter(this.enteredDateEnd),order_name:this.sortField,group_name:this.companyName,brand_product_type:this.brand_product_type,order_asc_desc:this.sortOrder,page:this.currPage,is_ka:this.is_ka,is_wastage:this.is_wastage,is_referrer:this.is_referrer,referrer_name:this.referrer_name};this.ajax({url:"/client/export_client",params:e}).then(function(e){""===e.error_msg&&t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},degradeC:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要降级此客户么？",onConfirm:function(){a.ajax({url:"/client/down_grading_c",loading:a.$loading.open(),successTip:!0,params:{client_id:t}}).then(function(t){0===t.error_code&&(e.client_level_id=2,e.clevel="C")})}})},deleteClient:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此客户么？",onConfirm:function(){a.ajax({url:"/client/delete_client",method:"post",successTip:!0,data:{client_id:t}}).then(function(t){0===t.error_code&&(a.clients.splice(e,1),a.getClients())})}})},recallClient:function(t,e){return this.ajax({url:"/client/approve_status_recall",loading:this.$loading.open(),successTip:!0,params:{client_id:t}}).then(function(t){0===t.error_code&&(e.approve_status_id=4,e.approve_status="再驳回待修改")})},showClientLog:function(t){var e=this;return this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/client/get_client_log_union",params:{client_id:t}}).then(function(t){0===t.error_code&&(console.log("logData: ",t.data),e.logData=t.data.list)})},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getClients(!0)},getReferrer:function(t,e){console.log("-----getReferrer-----",t,e),this.is_referrer=t,this.referrer_name=e},getReferrerType:function(t){console.log("-----getReferrerType-----",t),this.is_referrer=t}}}},"WK/Q":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"menu-list"},[t._l(t.data,function(e,n){return a("li",{key:n},[a("a",[e.child&&t.level<3?a("button",{staticClass:"button is-small z-btn-expand",on:{click:function(t){e.expanded=!e.expanded}}},[a("b-icon",{attrs:{icon:e.expanded?"minus":"plus"}})],1):t._e(),t._v(" "),a("b-field",[e.isEdit?a("b-input",{ref:"department_"+t.level+"_"+n,refInFor:!0,attrs:{required:""},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"menu.name"}}):a("span",[t._v(t._s(e.name))]),t._v(" "),t.level>0?[e.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveDepartment(e,n)}}},[t._v("保存")]):a("button",{staticClass:"button is-link",on:{click:function(t){e.isEdit=!0}}},[t._v("修改")]),t._v(" "),a("button",{staticClass:"button is-link",on:{click:function(a){t.deleteDepartment(e,n)}}},[t._v("删除")])]:t._e()],2)],1),t._v(" "),a("menu-list",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"menu.expanded"}],ref:"subMenuList",refInFor:!0,attrs:{isDepart:t.isDepart,data:e.child,parentId:e.id,level:t.level+1}})],1)}),t._v(" "),t.level>0&&t.level<4?a("li",[a("button",{staticClass:"button is-primary",on:{click:t.addDepartment}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("添加")])],1)]):t._e()],2)},staticRenderFns:[]}},WPfQ:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"成本管理"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门",horizontal:""}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团名称",horizontal:""}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brands,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"title"},on:{input:t.getBrands,focus:t.getBrands,select:t.onBrandSelected},model:{value:t.brand_title,callback:function(e){t.brand_title=e},expression:"brand_title"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companies,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.partyName,callback:function(e){t.partyName=e},expression:"partyName"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},on:{focus:t.searchContractList,input:t.searchContractList},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"状态",horizontal:""}},[a("b-select",{model:{value:t.costApprovalStatusID,callback:function(e){t.costApprovalStatusID=e},expression:"costApprovalStatusID"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("未提交")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("待审核")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("被驳回")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("已关闭")])])],1),t._v(" "),a("b-field",{attrs:{label:"预估时间",horizontal:""}},[a("b-datepicker",{attrs:{"max-date":t.estimated_end_time},model:{value:t.estimated_start_time,callback:function(e){t.estimated_start_time=e},expression:"estimated_start_time"}}),t._v("\n                    -  \n                    "),a("b-datepicker",{attrs:{"min-date":t.estimated_start_time},model:{value:t.estimated_end_time,callback:function(e){t.estimated_end_time=e},expression:"estimated_end_time"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[t.hasPermission("crm_new.cbgl.cbgl.cx")?a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]):t._e(),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),t.hasPermission("crm_new.cbgl.cbgl.dc")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL()}}},[t._v("导出")]):t._e()])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.totalContracts))]),t._v(" "),a("b",[t._v("总预估成本："+t._s(t.sum.estimated_cost_sum))]),t._v(" "),a("b",[t._v("总实际成本："+t._s(t.sum.actual_cost_sum))]),t._v(" "),a("b",[t._v("总发生金额："+t._s(t.sum.actual_details_sum))]),t._v(" "),a("b"),t._v(" "),a("b"),t._v(" "),a("b"),t._v(" "),t.hasPermission("crm_new.cbgl.cbgl.bjcb")?a("router-link",{staticClass:"button is-primary",attrs:{to:"/cost_manage/add"}},[t._v("新增成本")]):t._e()],1),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{checkable:t.isChecked,"checked-rows":t.checkedRows,data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":""},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"项目经理",field:"cost_pm_name"}},[t._v("\n                    "+t._s(e.row.cost_pm_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"预估成本"}},[t._v("\n                    "+t._s(e.row.estimated_cost)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"实际成本"}},[t._v("\n                    "+t._s(e.row.actual_cost)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"发生金额"}},[t._v("\n                    "+t._s(e.row.actual_details)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"applied_approved_status_name",label:"审核状态"}},[t._v("\n                    "+t._s(t.costApprovalStatus[e.row.cost_approval_status])+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[t.hasPermission("crm_new.cbgl.cbgl.ckcb")?a("router-link",{staticClass:"button is-link",attrs:{to:"/cost_manage/"+e.row.contract_id}},[t._v("查看成本")]):t._e(),t._v(" "),e.row.bianji()?a("router-link",{staticClass:"button is-link",attrs:{to:"/cost_manage/"+e.row.contract_id+"/edit"}},[t._v("编辑成本")]):t._e(),t._v(" "),e.row.bohui()?a("a",{staticClass:"button is-link",on:{click:function(a){t.rejectCost(e.row.contract_id)}}},[t._v("再驳回")]):t._e(),t._v(" "),e.row.tijiao()?a("a",{staticClass:"button is-link",on:{click:function(a){t.submitAll(0,e.row)}}},[t._v("提交")]):t._e()],1),t._v(" "),a("b-table-column",{attrs:{label:"操作日志",visible:t.hasPermission("crm_new.cbgl.cbgl.ckczrz")}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e.row.contract_id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},"Wci/":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["contactName","contactPhone"];e.default={props:["companyId"],data:function(){return{contacts:[]}},created:function(){this.companyId&&this.getContacts()},methods:{getContacts:function(){var t=this;return this.ajax({url:"/signing_company_contact/get_list",params:{signing_company_id:this.companyId}}).then(function(e){t.contacts=t.formatContactData(e.data.lists||[])})},formatContactData:function(t){return t.map(function(t){return t.isEdit=!1,t.fieldType="",t.fieldMessage="",t})},contactDataValidate:function(t){var e=this,a=[];return console.log(t),n.forEach(function(n){var i=e.$refs[n+"_"+t];console.log(i),i.checkHtml5Validity&&(i.checkHtml5Validity()||a.push(i))}),!a.length||(a[0].focus(),!1)},saveContact:function(t){if(this.contactDataValidate(t)&&this.checkContactDuplicate(t)){console.log("pass");var e=this.contacts[t],a={contact_name:e.contact_name,tel:e.tel,signing_company_id:this.companyId};return e.id&&(a.id=e.id),this.ajax({loading:this.$loading.open(),successTip:!0,method:"post",url:"/signing_company_contact/save",data:a}).then(function(t){0===t.error_code&&(e.isEdit=!1,e.id||(e.id=t.data))})}},addContact:function(){this.contacts.push({isEdit:!0,contact_name:"",tel:"",signing_company_id:this.companyId,fieldType:"",fieldMessage:""})},deleteContact:function(t,e){var a=this;e.id?this.$dialog.confirm({message:"确定要删除此联系人吗？",onConfirm:function(){return a.ajax({url:"/signing_company_contact/delete",method:"post",successTip:!0,loading:a.$loading.open(),data:{id:e.id}}).then(function(e){0===e.error_code&&a.contacts.splice(t,1)})}}):this.contacts.splice(t,1)},checkContactDuplicate:function(t){var e=this.contacts[t];if(e.tel){for(var a=0,n=this.contacts.length;a<n;a++)if(t!==a&&e.tel.trim()===this.contacts[a].tel)return console.log(a,this.contacts[a]),e.fieldType="is-danger",e.fieldMessage="该联系人已存在！",!1;return e.fieldType="",e.fieldMessage="",!0}}}}},XNUm:function(t,e){},XVnZ:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:t.fromContract?"合同":"预占合同"}},[t.dataReady?[a("b-field",{staticClass:"columns z-contracts-top",attrs:{grouped:""}},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同类型"}},[t.isEdit?a("b-select",{ref:"contract_type_id",attrs:{required:""},on:{input:t.onContractTypeSelect},model:{value:t.contract.contract_type_id,callback:function(e){t.$set(t.contract,"contract_type_id",e)},expression:"contract.contract_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("单笔")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("赠版")]),t._v(" "),a("option",{attrs:{value:"8"}},[t._v("资源置换")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_type_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同编号"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_number))])]),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同基础信息")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同名称"}},[t.isEdit?a("b-input",{ref:"contract_name",attrs:{maxlength:"30",expanded:"",required:""},model:{value:t.contract.contract_name,callback:function(e){t.$set(t.contract,"contract_name",e)},expression:"contract.contract_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同品类"}},[t.isEdit?a("b-select",{ref:"contract_brand_id",attrs:{required:""},on:{input:t.onSelectLevel},model:{value:t.contract.contract_brand_id,callback:function(e){t.$set(t.contract,"contract_brand_id",e)},expression:"contract.contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_brand_name)+"---"+t._s(t.contract.contract_second_brand_name))]),t._v(" "),t.isEdit&&t.level&&t.level.level.length?a("b-select",{ref:"contract_second_brand_id",attrs:{required:""},model:{value:t.contract.contract_second_brand_id,callback:function(e){t.$set(t.contract,"contract_second_brand_id",e)},expression:"contract.contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):t._e()],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同负责人"}},[t.isEdit?a("b-autocomplete",{ref:"user_id",attrs:{data:t.contractUsers,"max-results":10,"keep-first":!0,"open-on-focus":!0,loading:t.fetchingUsers,field:"name",required:""},on:{input:t.getUsers,focus:t.getUsers,select:t.onUserSelect},model:{value:t.contractChargeName,callback:function(e){t.contractChargeName=e},expression:"contractChargeName"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_charge_name))])],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户名称"}},[t.isEdit?a("b-autocomplete",{ref:"client_id",attrs:{data:t.filteredClients,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"client_name",required:""},on:{select:t.onClientSelect},model:{value:t.contractClientName,callback:function(e){t.contractClientName=e},expression:"contractClientName"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户类型"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_type))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"所属部门"}},[t.isEdit?a("b-input",{ref:"contractParentDepartment",attrs:{disabled:""},model:{value:t.contract.parent_department_name,callback:function(e){t.$set(t.contract,"parent_department_name",e)},expression:"contract.parent_department_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.parent_department_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"业务组"}},[t.isEdit?a("b-input",{ref:"contractDepartment",attrs:{disabled:""},model:{value:t.contract.department_name,callback:function(e){t.$set(t.contract,"department_name",e)},expression:"contract.department_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.department_name))])],1)],1),t._v(" "),a("div",{staticClass:"columns"},[2===Number(t.contract.contract_type_id)?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"赠版类型"}},[t.isEdit?a("b-select",{ref:"free_type",attrs:{required:""},model:{value:t.contract.free_type,callback:function(e){t.$set(t.contract,"free_type",e)},expression:"contract.free_type"}},[a("option",{attrs:{value:"1"}},[t._v("Free")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("试投")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(1===Number(t.contract.free_type)?"Free":"试投"))])],1):t._e(),t._v(" "),1===Number(t.contract.free_type)&&2===Number(t.contract.contract_type_id)?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联单笔合同"}},[t.isEdit?a("b-autocomplete",{ref:"free_join_contract_id",attrs:{data:t.singleContracts,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"contract_name"},on:{focus:t.getSingleContracts,input:t.getSingleContracts,select:t.onSingleContractSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.contract_number)+" "+t._s(e.option.contract_name))]}}]),model:{value:t.singleContractsName,callback:function(e){t.singleContractsName=e},expression:"singleContractsName"}}):a("div",{staticClass:"z-field-text clickLink",on:{click:function(e){t.routePush(t.contract.free_join_contract_id)}}},[t._v(t._s(t.contract.free_join_contract_number))])],1):t._e(),t._v(" "),a("div",{staticClass:"column"}),t._v(" "),1!==Number(t.contract.free_type)||2!==Number(t.contract.contract_type_id)?a("div",{staticClass:"column"}):t._e()],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司"}},[t.isEdit?a("b-autocomplete",{ref:"signing_company_id",attrs:{data:t.partyAs,"max-results":10,"keep-first":!0,"open-on-focus":!0,loading:t.fetchingPartyAs,required:!!t.id,field:"company_name"},on:{focus:t.getSigningCompanies,input:t.getSigningCompanies,select:t.onSigningCompanySelect},model:{value:t.partyAName,callback:function(e){t.partyAName=e},expression:"partyAName"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.signing_company_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司类型"}},[t.isEdit?a("b-select",{ref:"signing_company_type_id",attrs:{required:!!t.id},on:{input:t.onSignCompayTypeSelect},model:{value:t.contract.signing_company_type_id,callback:function(e){t.$set(t.contract,"signing_company_type_id",e)},expression:"contract.signing_company_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("直客")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("代理")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.signing_company_type_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联年框"}},[t.isEdit?a("b-autocomplete",{ref:"join_contract_id",attrs:{data:t.yearContracts,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"contract_name"},on:{focus:t.getYearContracts,input:t.getYearContracts,select:t.onYearContractSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.contract_number)+" "+t._s(e.option.contract_name))]}}]),model:{value:t.yearContractName,callback:function(e){t.yearContractName=e},expression:"yearContractName"}}):a("div",{staticClass:"z-field-text clickLink",on:{click:function(e){t.routePush(t.contract.join_contract_id)}}},[t._v(t._s(t.contract.join_contract_number))])],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"乙方签约公司"}},[t.isEdit?a("b-select",{ref:"party_b_name",attrs:{required:!!t.id},model:{value:t.contract.party_b_name,callback:function(e){t.$set(t.contract,"party_b_name",e)},expression:"contract.party_b_name"}},[a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.party_b_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"起止日期"}},[t.isEdit?a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.contractDateEnd},model:{value:t.contractDateStart,callback:function(e){t.contractDateStart=e},expression:"contractDateStart"}}),t._v("\n                            -\n                            "),a("b-datepicker",{attrs:{"min-date":t.contractDateStart},model:{value:t.contractDateEnd,callback:function(e){t.contractDateEnd=e},expression:"contractDateEnd"}})],1):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.start_date)+" - "+t._s(t.contract.end_date))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户账期"}},[t.isEdit?a("b-datepicker",{model:{value:t.accountPeriod,callback:function(e){t.accountPeriod=e},expression:"accountPeriod"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.account_period))])],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同申请人"}},[!t.isEdit||t.isAdd?a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.apply_user_name||t.$root.crmUser&&t.$root.crmUser.name))]):t.isAdd||!t.isRole(t.ROLE.meijiezuzhang)&&!t.isRole(t.ROLE.meijierenyuan)?t._e():a("b-select",{model:{value:t.contract.apply_user_id,callback:function(e){t.$set(t.contract,"apply_user_id",e)},expression:"contract.apply_user_id"}},t._l(t.roleList,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同签订人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_signing))])]),t._v(" "),t.fromContract&&t.contract.client_relationship_name&&[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户关系"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_relationship_name))])]):t._e(),t._v(" "),[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{label:"客户首签",horizontal:"",expanded:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.IS_FIRST[t.contract.is_first_contract]))])]):t._e(),t._v(" "),[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{label:"品牌首签",horizontal:"",expanded:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.IS_FIRST[t.contract.is_first_brand]))])]):t._e()],1)])]),t._v(" "),t.id?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-space-between"},[a("h2",[t._v("硬广 ")]),t._v(" "),a("b-field",{attrs:{grouped:""}},[a("b-field",{attrs:{horizontal:"",expanded:"",label:"合作方式"}},[t.isEdit?a("b-select",{ref:"hard_wide_detail_type",attrs:{disabled:!t.contract.is_hard_update,required:""},on:{input:t.onHardCoopWaySelect},model:{value:t.contract.hard_wide_detail_type,callback:function(e){t.$set(t.contract,"hard_wide_detail_type",e)},expression:"contract.hard_wide_detail_type"}},t._l(t.COOPWAYS,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.val))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.hard_wide_detail_type_name))])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",expanded:"",label:"币种"}},[t.isEdit?a("b-select",{ref:"contract_currency_type_id",attrs:{required:"",disabled:!t.contract.is_currency_update},on:{input:t.onCurrencySelected},model:{value:t.contract.contract_currency_type_id,callback:function(e){t.$set(t.contract,"contract_currency_type_id",e)},expression:"contract.contract_currency_type_id"}},t._l(t.CURRENCIES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_currency_type_name))])],1)],1),t._v(" "),t.isEdit&&!t.waibumeijie?a("div",[t.hasPermission("crm_new.ad.yuzhan.paiqi")?a("a",{staticClass:"button is-primary",attrs:{target:"_blank",href:t.contract.ad_add_schdule_url}},[t._v("添加排期")]):t._e(),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{target:"_blank",href:t.contract.ad_schdule_detail_url}},[t._v("详情展示")])]):t._e(),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{disabled:!t.contract.expore_ad_schdule_url,href:t.contract.expore_ad_schdule_url}},[t._v("导出排期")])],1),t._v(" "),t.contract.ad_schedules&&t.contract.ad_schedules.length?a("div",{staticClass:"z-block-content"},[t.contract.ad_schedules_days>0?a("div",{staticClass:"z-table-head"},[a("b",[t._v("点位数统计："+t._s(t.contract.ad_schedules_days))])]):t._e(),t._v(" "),a("b-table",{attrs:{data:t.contract.ad_schedules,bordered:!0,"mobile-cards":!0,"checked-rows":t.hardAdsCheckedRows,"is-row-checkable":t.hardAdsDisabledRows,checkable:t.isEdit},on:{"update:checkedRows":function(e){t.hardAdsCheckedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"编号"}},[t._v("\n                            "+t._s(e.index+1)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"媒体"}},[t._v("\n                            "+t._s(e.row.media)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"版位"}},[t._v("\n                            "+t._s(e.row.position)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"时间"}},[t._v("\n                            "+t._s(e.row.start_date)+" - "+t._s(e.row.end_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:2===Number(t.contract.hard_wide_detail_type)?"点击数":9===Number(t.contract.hard_wide_detail_type)?"CPM数":10===Number(t.contract.hard_wide_detail_type)?"CPA数":"天数"}},[t.isEdit?a("b-field",[[2,9,10].indexOf(Number(t.contract.hard_wide_detail_type))>-1?a("b-input",{ref:"hard_clicks_"+e.row.index,attrs:{disabled:-1===[9,10].indexOf(Number(t.contract.hard_wide_detail_type)),type:"number",required:""},on:{blur:function(a){t.onBlurTotalPrice(e.row)}},model:{value:e.row.clicks,callback:function(a){t.$set(e.row,"clicks",a)},expression:"props.row.clicks"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.days))])],1):[t._v(t._s([2,9,10].indexOf(Number(t.contract.hard_wide_detail_type))>-1?e.row.clicks:e.row.days))]],2),t._v(" "),a("b-table-column",{attrs:{label:"购买类型"}},[t.isEdit?a("b-field",[a("b-select",{ref:"hard_buy_type_"+e.index,attrs:{required:"",disabled:2===Number(t.contract.contract_type_id)||!e.row.is_update},on:{input:function(a){t.onBuyTypeChange(e.row)}},model:{value:e.row.buy_type,callback:function(a){t.$set(e.row,"buy_type",a)},expression:"props.row.buy_type"}},t._l(t.BUY_TYPES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])}))],1):[t._v(t._s(t.BUY_TYPES[e.row.buy_type]))]],2),t._v(" "),a("b-table-column",{attrs:{label:"刊例价"}},[t.isEdit?a("b-field",[-1===[9,10].indexOf(Number(t.contract.hard_wide_detail_type))?a("b-input",{ref:"hard_publish_price_"+e.index,attrs:{disabled:!e.row.is_update,required:""},on:{input:function(a){t.onPublishPriceChange(e.row)}},model:{value:e.row.publish_price,callback:function(a){t.$set(e.row,"publish_price",a)},expression:"props.row.publish_price"}}):a("b-input",{ref:"hard_publish_price_"+e.index,attrs:{disabled:"",required:""},model:{value:e.row.publish_price,callback:function(a){t.$set(e.row,"publish_price",a)},expression:"props.row.publish_price"}})],1):[t._v(t._s(e.row.publish_price))]],2),t._v(" "),a("b-table-column",{attrs:{label:"刊例总价"}},[t.isEdit?a("b-field",[a("b-input",{ref:"hard_total_price_"+e.index,attrs:{disabled:-1===[2,9,10].indexOf(Number(t.contract.hard_wide_detail_type))||!e.row.is_update,required:""},on:{blur:function(a){t.onBlurTotalPrice(e.row)},input:function(a){t.onTotalPriceChange(e.row)}},model:{value:e.row.total_price,callback:function(a){t.$set(e.row,"total_price",a)},expression:"props.row.total_price"}})],1):[t._v(t._s(e.row.total_price))]],2),t._v(" "),a("b-table-column",{staticStyle:{width:"70px"},attrs:{label:"折扣率"}},[t.isEdit?a("b-field",[2!==Number(e.row.buy_type)?a("b-input",{ref:"hard_discount_"+e.index,staticStyle:{width:"40px","border-bottom-right-radius":"4px","border-top-right-radius":"4px",overflow:"hidden"},attrs:{disabled:2===Number(e.row.buy_type)||!e.row.is_update,required:""},on:{input:function(a){t.onDiscountChange(e.row)}},model:{value:e.row.discount,callback:function(a){t.$set(e.row,"discount",a)},expression:"props.row.discount"}}):t._e(),t._v(" "),2!==Number(e.row.buy_type)?a("div",{staticClass:"z-field-text"},[t._v("%")]):[t._v(t._s(e.row.discount)+"%")]],2):[t._v(t._s(e.row.discount)+" %")]],2),t._v(" "),a("b-table-column",{attrs:{label:"净价"}},[t.isEdit?a("b-field",[a("b-input",{ref:"hard_real_price_"+e.index,attrs:{disabled:!e.row.is_update,required:""},on:{blur:function(a){t.updateDiscount(e.row)}},model:{value:e.row.real_price,callback:function(a){t.$set(e.row,"real_price",a)},expression:"props.row.real_price"}})],1):[t._v(t._s(e.row.real_price))]],2),t._v(" "),a("b-table-column",{staticStyle:{"min-width":"120px"},attrs:{label:"确认时间",visible:1!==Number(t.contract.hard_wide_detail_type)}},[t.isEdit?a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"confirm_date",attrs:{icon:"calendar-today",disabled:!e.row.is_changeDate,"focused-date":new Date,required:""},model:{value:e.row.confirmDate,callback:function(a){t.$set(e.row,"confirmDate",a)},expression:"props.row.confirmDate"}},[a("button",{staticClass:"button is-danger",on:{click:function(a){t.clearDate(e.row)}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("清除")])],1)])],1):[t._v(t._s(e.row.confirm_date))]],2),t._v(" "),t.isEdit?a("b-table-column",{attrs:{label:"操作"}},[1!==Number(t.contract.hard_wide_detail_type)?a("a",{staticClass:"button is-primary",attrs:{disabled:!e.row.is_update||!e.row.is_changeDate},on:{click:function(a){t.confirmHardAd([e.row],1)}}},[t._v("确认")]):t._e(),t._v(" "),a("a",{staticClass:"button is-danger",attrs:{disabled:!e.row.is_update||!e.row.is_changeDate},on:{click:function(a){t.deleteHardAd(e.row,e.index)}}},[t._v("删除")])]):t._e()]}}])}),t._v(" "),t.isEdit?a("div",{staticClass:"z-block"},[t.isEdit?a("button",{staticClass:"button is-primary",staticStyle:{"margin-top":"10px","margin-right":"10px"},attrs:{disabled:0===t.hardAdsCheckedRows.length},on:{click:function(e){t.confirmHardDel(t.hardAdsCheckedRows)}}},[t._v("批量删除")]):t._e(),t._v(" "),0!==t.hardAdsCheckedRows.length&&1!==Number(t.contract.hard_wide_detail_type)?[a("b-field",{staticStyle:{width:"200px","margin-top":"10px"}},[a("b-datepicker",{attrs:{"first-day-of-week":7,placeholder:"选择批量确认的日期",icon:"calendar-today",required:""},model:{value:t.all_confirm_date,callback:function(e){t.all_confirm_date=e},expression:"all_confirm_date"}},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.all_confirm_date=new Date}}},[a("b-icon",{attrs:{icon:"calendar-today"}}),t._v(" "),a("span",[t._v("Today")])],1),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(e){t.all_confirm_date=null}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("Clear")])],1)])],1)]:t._e(),t._v(" "),t.isEdit&&1!==Number(t.contract.hard_wide_detail_type)?a("button",{staticClass:"button is-primary",staticStyle:{"margin-top":"10px"},attrs:{disabled:0===t.hardAdsCheckedRows.length},on:{click:function(e){t.confirmHardAd(t.hardAdsCheckedRows,2)}}},[t._v("批量确认")]):t._e()],2):t._e(),t._v(" "),1===Number(t.contract.hard_wide_detail_type)?a("div",{staticClass:"z-space-between"},[a("b-field",{attrs:{horizontal:"",expanded:"",label:"整单折扣"}},[t.isEdit?[a("b-input",{ref:"entire_single_discount",attrs:{required:""},model:{value:t.contract.entire_single_discount,callback:function(e){t.$set(t.contract,"entire_single_discount",e)},expression:"contract.entire_single_discount"}}),t._v(" "),a("div",{staticClass:"z-field-text"},[t._v("%")])]:a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.entire_single_discount)+" %")])],2)],1):t._e(),t._v(" "),a("b-table",{attrs:{bordered:!0,"mobile-cards":!0,data:t.reviseData},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"修订值"}},[e.row.isEdit&&e.row.is_update?a("b-field",[a("b-input",{ref:"revisePrice",attrs:{required:""},model:{value:e.row.price,callback:function(a){t.$set(e.row,"price",a)},expression:"props.row.price"}})],1):[t._v(t._s(e.row.price))]],2),t._v(" "),a("b-table-column",{attrs:{label:"修订时间"}},[e.row.isEdit?a("div",{staticClass:"z-datepicker"},[a("b-datepicker",{staticClass:"confirm_date",attrs:{icon:"calendar-today","focused-date":new Date,required:""},model:{value:e.row.reviseDate,callback:function(a){t.$set(e.row,"reviseDate",a)},expression:"props.row.reviseDate"}},[a("button",{staticClass:"button is-danger",on:{click:function(t){e.row.reviseDate=null}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("清除")])],1)])],1):a("div",[t._v(t._s(e.row.revise_date))])]),t._v(" "),a("b-table-column",{attrs:{label:"操作记录"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showReviseLog(e.row)}}},[t._v("查看")])]),t._v(" "),a("b-table-column",{attrs:{label:"操作",visible:!0===t.isEdit}},[e.row.isEdit?a("button",{staticClass:"button is-primary",attrs:{disabled:!e.row.is_update},on:{click:function(a){t.saveRevise(e.row,e.index)}}},[t._v("保存")]):a("button",{staticClass:"button is-link",attrs:{disabled:!e.row.is_update},on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")]),t._v(" "),e.row.isDelete?a("button",{staticClass:"button is-link",on:{click:function(a){t.deleteRevise(e.row,e.index)}}},[t._v("删除")]):t._e()])]}}])}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addRevise}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增修订值")])],1)],1):t._e()]):t._e(),t._v(" "),t.id?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-space-between"},[a("h2",[t._v("软性")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[t.contract.details&&t.contract.details.length?a("b-table",{attrs:{data:t.contract.details,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"编号"}},[t._v("\n                            "+t._s(e.index+1)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"事业部",visible:0===Number(t.contract.contract_type_id)||8===Number(t.contract.contract_type_id)}},[a("b-field",[t.isEdit?a("b-select",{ref:"business_id_"+e.index,attrs:{required:""},on:{input:function(a){t.onSelectDepartment(e.row,"get")}},model:{value:e.row.business_id,callback:function(a){t.$set(e.row,"business_id",a)},expression:"props.row.business_id"}},t._l(t.DEPARTMENT,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.business_name.replace(/^-+/,"")))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"合作方式",width:"300"}},[a("b-field",[t.isEdit?a("b-autocomplete",{ref:"contract_detail_cooperation_id_"+e.index,attrs:{"keep-first":!1,"open-on-focus":!0,data:e.row.options,field:"cooperation_name",disabled:!e.row.business_id},on:{focus:function(a){t.filteredDataObj(e.row)},input:function(a){t.filteredDataObj(e.row)},select:function(t){e.row.contract_detail_cooperation_id=t&&t.id?t.id:0}},model:{value:e.row.contract_detail_cooperation_val,callback:function(a){t.$set(e.row,"contract_detail_cooperation_val",a)},expression:"props.row.contract_detail_cooperation_val"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.contract_detail_cooperation_val))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"投放起止时间",width:"240"}},[t.isEdit?a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{ref:"soft_start_date_"+e.index,attrs:{"max-date":e.row.dateEnd,disabled:!e.row.is_update,required:""},on:{input:function(a){t.onSoftAdStartDateChange(e.row)}},model:{value:e.row.dateStart,callback:function(a){t.$set(e.row,"dateStart",a)},expression:"props.row.dateStart"}},[a("button",{staticClass:"button is-danger",on:{click:function(a){t.clearDate(e.row)}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("清除")])],1)]),t._v("\n                                -\n                                "),a("b-datepicker",{ref:"soft_end_date_"+e.index,attrs:{"min-date":t.init_end_date(e.row.dateStart),disabled:!e.row.is_update,required:""},on:{input:function(a){t.onSoftAdStartDateChange(e.row)}},model:{value:e.row.dateEnd,callback:function(a){t.$set(e.row,"dateEnd",a)},expression:"props.row.dateEnd"}},[a("button",{staticClass:"button is-danger",on:{click:function(a){t.clearDate(e.row)}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("清除")])],1)])],1):[t._v(t._s(e.row.start_date)+" - "+t._s(e.row.end_date))]],2),t._v(" "),a("b-table-column",{attrs:{label:"币种"}},[a("b-field",[t.isEdit?a("b-select",{attrs:{disabled:""},on:{input:function(a){t.onCurrencyTypeChange(e.row,e.index,"soft")}},model:{value:t.contract.contract_currency_type_id,callback:function(e){t.$set(t.contract,"contract_currency_type_id",e)},expression:"contract.contract_currency_type_id"}},t._l(t.CURRENCIES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_currency_type_name))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"原币金额"}},[a("b-field",[t.isEdit?a("b-input",{ref:"soft_currency_amount_"+e.index,attrs:{disabled:!e.row.is_update||0===t.contract.contract_currency_type_id,required:e.row.currencyRequired},on:{input:function(a){t.updateRMBInRow(e.row)}},model:{value:e.row.currency_amount,callback:function(a){t.$set(e.row,"currency_amount",a)},expression:"props.row.currency_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.currency_amount))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"人民币金额"}},[a("b-field",[t.isEdit?a("b-input",{ref:"soft_rmb_amount_"+e.index,attrs:{required:e.row.rmbRequired,disabled:0!==t.contract.contract_currency_type_id},model:{value:e.row.rmb_amount,callback:function(a){t.$set(e.row,"rmb_amount",a)},expression:"props.row.rmb_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.rmb_amount))])],1)],1),t._v(" "),t.isEdit?a("b-table-column",{attrs:{label:"操作"}},[a("a",{staticClass:"button is-danger",attrs:{disabled:!e.row.is_update},on:{click:function(a){t.deleteSoftAd(e.row,e.index)}}},[t._v("删除")])]):t._e()]}}])}):t._e(),t._v(" "),t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.addSoftAd}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e()],1)]):t._e(),t._v(" "),t.id&&"预占合同"!=t.contract.contract_number&&-1===[0,2,8].indexOf(t.contract.contract_type_id)?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("业绩拆分")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[this.contract.splits&&this.contract.splits.length?a("b-table",{attrs:{data:this.contract.splits,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"合作方式"}},[a("b-field",[t.isEdit?a("b-select",{ref:"splits_contract_detail_cooperation_id_"+e.index,attrs:{required:""},model:{value:e.row.contract_detail_cooperation_id,callback:function(a){t.$set(e.row,"contract_detail_cooperation_id",a)},expression:"props.row.contract_detail_cooperation_id"}},[a("option",{attrs:{value:"0"}},[t._v("ROI")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("视频")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("众测")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.contract_detail_cooperation_name))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"时间"}},[t.isEdit?a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":e.row.dateEnd},on:{input:function(a){t.updateRMBInRow(e.row)}},model:{value:e.row.dateStart,callback:function(a){t.$set(e.row,"dateStart",a)},expression:"props.row.dateStart"}}),t._v("\n                                -\n                                "),a("b-datepicker",{attrs:{"min-date":e.row.dateStart},model:{value:e.row.dateEnd,callback:function(a){t.$set(e.row,"dateEnd",a)},expression:"props.row.dateEnd"}})],1):[t._v(t._s(e.row.start_date)+" - "+t._s(e.row.end_date))]],2),t._v(" "),a("b-table-column",{attrs:{label:"币种"}},[a("b-field",[t.isEdit?a("b-select",{attrs:{disabled:""},on:{input:function(a){t.onCurrencyTypeChange(e.row,e.index,"splits")}},model:{value:t.contract.contract_currency_type_id,callback:function(e){t.$set(t.contract,"contract_currency_type_id",e)},expression:"contract.contract_currency_type_id"}},t._l(t.CURRENCIES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_currency_type_name))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"原币金额"}},[a("b-field",[t.isEdit?a("b-input",{ref:"splits_currency_amount_"+e.index,attrs:{disabled:0===t.contract.contract_currency_type_id,required:e.row.currencyRequired},on:{input:function(a){t.updateRMBInRow(e.row)}},model:{value:e.row.currency_amount,callback:function(a){t.$set(e.row,"currency_amount",a)},expression:"props.row.currency_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.currency_amount))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"人民币金额"}},[a("b-field",[t.isEdit?a("b-input",{ref:"splits_rmb_amount_"+e.index,attrs:{required:e.row.rmbRequired,disabled:0!==t.contract.contract_currency_type_id},model:{value:e.row.rmb_amount,callback:function(a){t.$set(e.row,"rmb_amount",a)},expression:"props.row.rmb_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.rmb_amount))])],1)],1),t._v(" "),t.isEdit?a("b-table-column",{attrs:{label:"操作"}},[a("a",{staticClass:"button is-danger",on:{click:function(a){t.deleteDivid(e.row,e.index)}}},[t._v("删除")])]):t._e()]}}])}):t._e(),t._v(" "),t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.addDivid}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e()],1)]):t._e(),t._v(" "),t.id?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("拆分方式")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("b-radio",{attrs:{disabled:t.isEdit&&2===Number(t.contract.is_split)||!t.isEdit,"native-value":"1"},model:{value:t.isSplit,callback:function(e){t.isSplit=e},expression:"isSplit"}},[t._v("\n                    系统自动拆分\n                ")]),t._v(" "),a("b-radio",{attrs:{disabled:t.isEdit&&2===Number(t.contract.is_split)||!t.isEdit,"native-value":"2"},model:{value:t.isSplit,callback:function(e){t.isSplit=e},expression:"isSplit"}},[t._v("\n                    系统自动+手动拆分\n                ")])],1)]):t._e(),t._v(" "),"预占合同"!=t.contract.contract_number&&t.contract.addsplits&&t.contract.addsplits.lists?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("业绩拆分详情")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("b-field",{attrs:{label:"项目经理：",horizontal:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.achieve_pm_name))]),t._v(" "),a("div",{staticClass:"column"})])],1),t._v(" "),a("div",{staticClass:"z-block-content"},[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:t.contract.addsplits.lists,bordered:!0,detailed:"","has-detailed-visible":function(t){return t.length}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"事业部",field:"business_id"}},[a("b-field",[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.business_name.replace(/^-+/,"")||"合计"))])])],1),t._v(" "),a("b-table-column",{attrs:{label:"硬广发布额",field:"ad_amount"}},[[t._v(t._s(e.row.ad_amount))]],2),t._v(" "),a("b-table-column",{attrs:{label:"硬广业绩",field:"ad_split"}},[[t._v(t._s(e.row.ad_split))]],2),t._v(" "),a("b-table-column",{attrs:{label:"软性发布额",field:"detail_amount"}},[[t._v(t._s(e.row.detail_amount))]],2),t._v(" "),a("b-table-column",{attrs:{label:"软性业绩",field:"detail_split"}},[t._v("\n                            "+t._s(e.row.detail_split)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"发布额合计",field:"amount_count"}},[t._v("\n                            "+t._s(e.row.amount_count)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"业绩合计",field:"total_split"}},[t._v("\n                            "+t._s(e.row.split_count)+"\n                        ")])]}},{key:"detail",fn:function(e){return e.row.lists.length?[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.lists,bordered:!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"软性业绩明细（按合作方式拆分）"}},[[t._v(t._s(e.row.contract_detail_cooperation_val))]],2),t._v(" "),a("b-table-column",{attrs:{label:"软性发布额"}},[t._v(t._s(e.row.detail_amount))]),t._v(" "),a("b-table-column",{attrs:{label:"软性业绩"}},[[t._v(t._s(e.row.detail_split))]],2)]}}])})]:void 0}}])})],1)]):t._e(),t._v(" "),t.id&&t.contract.amounts?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("金额统计")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"人民币金额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.new_amount))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同币种"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.contract_currency_type_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原币金额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.new_contract_currency_amount))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"回款金额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.total_cash_collection_amount))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"应收款金额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.receivable_balance))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"刊例总额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.publish_price))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"购买刊例总额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.buy_publish_price))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"赠送刊例总额"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.free_publish_price))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"购买折扣"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.buy_discount))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"配送比例"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.distribution_rate))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"整单折扣"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.amounts.entire_single_discount))])]),t._v(" "),a("div",{staticClass:"column"})],1)])]):t._e(),t._v(" "),t.id&&t.contract.swzc_approved&&t.fromContract?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同文本信息")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",type:t.states.url.status,message:t.states.url.msg,label:"合同文本"}},[t.isEdit||t.isRe?a("b-upload",{ref:"file_url",attrs:{loading:t.states.url.loading,required:t.ifSave&&!t.contract.file_url.length&&!t.contract.file_url2.length},on:{input:function(e){t.fileUpload("url")}},model:{value:t.urlFiles,callback:function(e){t.urlFiles=e},expression:"urlFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.contract.file_url?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url,target:"_blank"}},[t._v("预览")]):t._e()])],1),t._v(" "),a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",type:t.states.url2.status,message:t.states.url2.msg,label:"合同附件"}},[t.isEdit||t.isRe?a("b-upload",{ref:"file_url2",attrs:{loading:t.states.url2.loading,required:t.ifSave&&!t.contract.file_url.length&&!t.contract.file_url2.length},on:{input:function(e){t.fileUpload("url2")}},model:{value:t.url2Files,callback:function(e){t.url2Files=e},expression:"url2Files"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.contract.file_url2?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url2,target:"_blank"}},[t._v("预览")]):t._e()])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"审核状态"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.approve_status_name))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",type:t.states.url3.status,message:t.states.url3.msg,label:"补充协议"}},[a("b-upload",{attrs:{loading:t.states.url3.loading,required:""},on:{input:function(e){t.fileUpload("url3")}},model:{value:t.url3Files,callback:function(e){t.url3Files=e},expression:"url3Files"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]),t._v(" "),a("div",[t.contract.file_url3?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url3,target:"_blank"}},[t._v("预览")]):t._e()])],1),t._v(" "),a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",type:t.states.url4.status,message:t.states.url4.msg,label:"结案报告"}},[1!==!t.contract.approve_status_id?a("b-upload",{attrs:{loading:t.states.url4.loading,required:""},on:{input:function(e){t.fileUpload("url4")}},model:{value:t.url4Files,callback:function(e){t.url4Files=e},expression:"url4Files"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.contract.file_url4?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url4,target:"_blank"}},[t._v("预览")]):t._e()])],1),t._v(" "),0==t.contract.contract_type_id||8==t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{disabled:t.isEdit,horizontal:"",expanded:"",label:"签订状态"}},[a("b-select",{key:1,on:{input:t.selectStatus},model:{value:t.thestatus_id,callback:function(e){t.thestatus_id=e},expression:"thestatus_id"}},[a("option",{attrs:{value:"9"}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("我方已签")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("对方已签")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("双方已签")]),t._v(" "),a("option",{attrs:{value:"10"}},[t._v("无需合同")])])],1):a("div",{staticClass:"column"})],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同管理员"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.file_manager_user_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"审核通过时间"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.swzc_approved_time))])]),t._v(" "),a("div",{staticClass:"column"})],1)])]):t._e(),t._v(" "),t.id&&t.contract.swzc_approved&&t.fromContract?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("成本管理")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估返点比例"}},[t.isEdit?[a("b-input",{on:{input:t.onYgRateChange},model:{value:t.contract.ygfd_rate,callback:function(e){t.$set(t.contract,"ygfd_rate",e)},expression:"contract.ygfd_rate"}}),t._v(" "),a("div",{staticClass:"z-field-text"},[t._v("%")])]:a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.ygfd_rate)+"%")])],2),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估时间"}},[t.isEdit?a("b-input",{attrs:{disabled:""},model:{value:t.contract.ygfd_date_time,callback:function(e){t.$set(t.contract,"ygfd_date_time",e)},expression:"contract.ygfd_date_time"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.ygfd_date_time))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"确认返点比例"}},[t.isEdit?[a("b-input",{on:{input:t.onQrRateChange},model:{value:t.contract.qrfd_rate,callback:function(e){t.$set(t.contract,"qrfd_rate",e)},expression:"contract.qrfd_rate"}}),t._v(" "),a("div",{staticClass:"z-field-text"},[t._v("%")])]:a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.qrfd_rate)+"%")])],2),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"确认时间"}},[t.isEdit?a("b-input",{attrs:{disabled:""},model:{value:t.contract.qrfd_date_time,callback:function(e){t.$set(t.contract,"qrfd_date_time",e)},expression:"contract.qrfd_date_time"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.qrfd_date_time))])],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"项目成本"}},[t.isEdit?a("b-input",{attrs:{type:"number"},model:{value:t.contract.contract_cost,callback:function(e){t.$set(t.contract,"contract_cost",e)},expression:"contract.contract_cost"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_cost))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"项目成本1"}},[t.isEdit?a("b-input",{attrs:{type:"number"},model:{value:t.contract.contract_cost1,callback:function(e){t.$set(t.contract,"contract_cost1",e)},expression:"contract.contract_cost1"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_cost1))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"项目成本2"}},[t.isEdit?a("b-input",{attrs:{type:"number"},model:{value:t.contract.contract_cost2,callback:function(e){t.$set(t.contract,"contract_cost2",e)},expression:"contract.contract_cost2"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_cost2))])],1),t._v(" "),a("div",{staticClass:"column"})],1)])]):t._e(),t._v(" "),t.id&&t.contract.swzc_approved&&t.fromContract?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("回款管理")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[t.contract.cash_collections&&t.contract.cash_collections.length?a("b-table",{attrs:{data:t.contract.cash_collections,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"交易时间"}},[t.isEdit?a("b-datepicker",{model:{value:e.row.cashCollectionDate,callback:function(a){t.$set(e.row,"cashCollectionDate",a)},expression:"props.row.cashCollectionDate"}}):[t._v(t._s(e.row.cash_collection_date))]],2),t._v(" "),a("b-table-column",{attrs:{label:"确认时间"}},[t.isEdit?a("b-datepicker",{model:{value:e.row.confirmDate,callback:function(a){t.$set(e.row,"confirmDate",a)},expression:"props.row.confirmDate"}}):[t._v(t._s(e.row.confirm_date))]],2),t._v(" "),a("b-table-column",{attrs:{label:"币种"}},[a("b-field",[t.isEdit?a("b-select",{ref:"payments_currency_id_"+e.index,attrs:{required:""},on:{input:function(a){t.updatePaymentRMB(e.row)}},model:{value:e.row.currency_id,callback:function(a){t.$set(e.row,"currency_id",a)},expression:"props.row.currency_id"}},t._l(t.CURRENCIES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.CURRENCIES[e.row.currency_id]))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"原币金额"}},[a("b-field",[t.isEdit?a("b-input",{ref:"payments_current_amount_"+e.index,attrs:{required:""},on:{input:function(a){t.updatePaymentRMB(e.row)}},model:{value:e.row.current_amount,callback:function(a){t.$set(e.row,"current_amount",a)},expression:"props.row.current_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.current_amount))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"回款金额"}},[a("b-field",[t.isEdit?a("b-input",{attrs:{disabled:""},on:{input:function(a){t.updatePaymentRebateAmount(e.row)}},model:{value:e.row.amount,callback:function(a){t.$set(e.row,"amount",a)},expression:"props.row.amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.amount))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"回款类型"}},[a("b-field",[t.isEdit?a("b-select",{ref:"payments_cash_type_"+e.index,attrs:{required:""},model:{value:e.row.cash_type,callback:function(a){t.$set(e.row,"cash_type",a)},expression:"props.row.cash_type"}},[a("option",{attrs:{value:"0"}},[t._v("现金")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("返点发票")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.cash_type?"返点发票":"现金"))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"抵扣应收"}},[a("b-field",[t.isEdit?a("b-select",{ref:"payments_is_deduct_money_"+e.index,attrs:{required:""},model:{value:e.row.is_deduct_money,callback:function(a){t.$set(e.row,"is_deduct_money",a)},expression:"props.row.is_deduct_money"}},[a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.is_deduct_money?"是":"否"))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"抵扣返点金额"}},[a("b-field",[t.isEdit?a("b-input",{attrs:{disabled:""},model:{value:e.row.rebate_amount,callback:function(a){t.$set(e.row,"rebate_amount",a)},expression:"props.row.rebate_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.rebate_amount))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"计算时间"}},[a("b-field",[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.computing_date))])])],1),t._v(" "),t.isEdit?a("b-table-column",{attrs:{label:"操作"}},[a("a",{staticClass:"button is-danger",on:{click:function(a){t.deletePayment(e.row,e.index)}}},[t._v("删除")])]):t._e()]}}])}):t._e(),t._v(" "),t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.addPayment}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e()],1)]):t._e(),t._v(" "),t.id&&t.contract.swzc_approved&&t.fromContract?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("备注")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[t.contract.remarks&&t.contract.remarks.length?a("b-table",{attrs:{data:t.contract.remarks,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"添加时间"}},[t._v("\n                            "+t._s(e.row.entered_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"添加人"}},[t._v("\n                            "+t._s(e.row.username)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{label:"内容"}},[t.isEdit?a("b-input",{ref:"remark_content_"+e.index,attrs:{maxlength:"200",required:""},model:{value:e.row.remark,callback:function(a){t.$set(e.row,"remark",a)},expression:"props.row.remark"}}):[t._v(t._s(e.row.remark))]],2),t._v(" "),t.isEdit?a("b-table-column",{attrs:{label:"操作"}},[a("a",{staticClass:"button is-danger",on:{click:function(a){t.deleteRemark(e.row,e.index)}}},[t._v("删除")])]):t._e()]}}])}):t._e(),t._v(" "),t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.addRemark}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e()],1)]):t._e(),t._v(" "),t.fromContract&&t.changeList.length>0?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("变更信息")])]),t._v(" "),t._l(t.changeList,function(e){return a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更时间"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.changed_time))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更信息"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.typeArray[parseInt(e.change_type)]))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同信息"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.old_description))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后信息"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.new_description))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"审批邮件"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.approved_file))])])],1)])})],2):t._e(),t._v(" "),t.isEdit?[a("a",{staticClass:"button is-primary",on:{click:function(e){t.saveContract(!1)}}},[t._v("保存")]),t._v(" "),t.id?a("a",{staticClass:"button is-primary",on:{click:function(e){t.saveContract(!0)}}},[t._v("保存并提交审核")]):t._e()]:[1!==t.contract.approve_status_id&&1!==t.contract.applied_approved_status||!t.inApproveFlow?t._e():[t.hasPermission("crm_new.ad.yuzhan.bohui")||t.hasPermission("crm_new.contract.list.tongguo")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("驳回")]):t._e(),t._v(" "),t.hasPermission("crm_new.ad.yuzhan.tongguo")||t.hasPermission("crm_new.contract.list.bohui")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.passContract()}}},[t._v("通过")]):t._e(),t._v(" "),a("b-modal",{attrs:{active:t.ifReject,"has-modal-card":""},on:{"update:active":function(e){t.ifReject=e}}},[a("div",{staticClass:"modal-card",staticStyle:{width:"500px"}},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("驳回原因")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-input",{ref:"rejectReason_ref",attrs:{required:"",type:"textarea"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}}),t._v(" "),a("div",{staticClass:"z-block z-block-reject"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.rejectContract()}}},[t._v("确定")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("取消")])])],1)])])],t._v(" "),2===t.contract.approve_status_id||2===t.contract.applied_approved_status?[t.hasPermission("crm_new.contract.list.chakan.update")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.renewContract()}}},[t._v("更新")]):t._e()]:t._e()],t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")]),t._v(" "),t.fromContract&&t.hasPermission("crm_new.contract.list.chakan.biangeng")?a("a",{staticClass:"button is-right",class:t.isChange&&t.user_code?"is-primary":"is-gray",attrs:{href:t.isChange&&t.user_code?"#/contract_change/"+t.contract.contract_number+"/edit?one_id="+t.contract.signing_company_id+"&contract_type_id="+t.contract.contract_type_id+"&one_des="+t.contract.signing_company_name+"&two_des="+t.contract.party_b_name+"&id="+t.id:"javascript:(0)"}},[t._v("变更")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.chakan.user_biangeng")?a("a",{staticClass:"button is-right",class:!t.isRole(t.ROLE.shangwuzhichi)||2!=t.contract.approve_status_id&&1!=t.contract.approve_status_id?"is-gray":"is-primary",attrs:{href:!t.isRole(t.ROLE.shangwuzhichi)||2!=t.contract.approve_status_id&&1!=t.contract.approve_status_id?"javascript:(0)":"#/contract_change/"+t.contract.contract_number+"/edit?isCharge=1&contract_company_id=3&contract_type_id="+t.contract.contract_type_id+"&charge_name="+t.contract.contract_charge_name+"&id="+t.id+"&userId="+t.contractUserId}},[t._v("负责人变更")]):t._e(),t._v(" "),t.fromContract&&t.hasPermission("crm_new.contract.list.chakan.bizhong_biangeng")&&(0==t.contract.contract_type_id||8==t.contract.contract_type_id)?a("a",{staticClass:"button is-right is-primary",attrs:{href:"#/contract_change/"+t.contract.contract_number+"/edit?isCurrency=1&contract_type_id="+t.contract.contract_type_id+"&id="+t.id+"&contract_currency_type_id="+t.contract.contract_currency_type_id+"&contract_currency_type_name="+t.contract.contract_currency_type_name+"&contract_company_id=5"}},[t._v("币种变更")]):t._e(),t._v(" "),a("b-modal",{attrs:{active:t.reviseLogActive,"has-modal-card":""},on:{"update:active":function(e){t.reviseLogActive=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("修订值操作记录")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.reivseLogs,columns:t.logColumns}})],1)])])]:t._e()],2)},staticRenderFns:[]}},"Xbi+":function(t,e){},XwYQ:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("fZjL"),s=n(i),r=a("mvHQ"),o=n(r),c=a("u2KI"),l=n(c),d=a("Xxa5"),u=n(d),_=a("Dd8w"),p=n(_),m=a("exGp"),h=n(m),f=a("z93h"),v=a("jELS");e.default={props:{title:{type:String,default:""}},data:function(){return{flag:!0,frame_id:"",brandList:[],isLoading:!1,brand:{title:""},level:{id:""},saveForm:{data_type:"",data_type_id:""},isOpen:-1,dataList:[],active:!1,validate:!1,storageBrand:{id:"",title:""},ruleFrom:{delete_ids:[]},brandFrom:{insert_ids:[],delete_ids:[]}}},computed:{themeName:function(){return 5===this.saveForm.data_type?"品牌":"品类"}},methods:{changeMax:function(t,e,a,n){var i=n.target.value;a.max=i,this.dataList[t].rule[e+1].min=i},changeMin:function(t,e,a,n){if(e){var i=n.target.value;a.min=i,this.dataList[t].rule[e-1].max=i}},changeSelect:function(t){var e=this;return(0,h.default)(u.default.mark(function a(){var n,i;return u.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.saveForm.data_type_id=t,n=e.brandList.filter(function(e){return e.id===t})[0].val,a.next=4,(0,f.rebateFrameValidate)((0,p.default)({},e.saveForm,{id:e.frame_id}));case 4:if(i=a.sent){a.next=9;break}return e.validate=!1,e.$toast.error("该品类已存在"),a.abrupt("return");case 9:e.validate=!0,e.storageBrand={id:t,title:n};case 11:case"end":return a.stop()}},a,e)}))()},getlevelList:function(){var t=this;return(0,h.default)(u.default.mark(function e(){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.getlevelList)();case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.brandList=(0,l.default)(a);case 6:case"end":return e.stop()}},e,t)}))()},changeInfinite:function(t,e){t.infinite=!t.infinite,e.max=0},rabateSaveRule:function(){var t=this;return(0,h.default)(u.default.mark(function e(){var a,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.dataList.reduce(function(t,e){var a=e.rule.map(function(t){return{max:t.max,min:t.min,id:t.id||0,rebate:t.rebate}});return e.infinite&&a.length&&(a.sort(function(t,e){return t.min-e.min}),a[a.length-1].max=0),t[e.data_type_id]=a,t},{}),e.next=3,(0,f.rabateSaveRule)({frame_id:t.frame_id,delete_ids:t.ruleFrom.delete_ids.join(","),data_type:t.saveForm.data_type,rule:(0,o.default)(a)});case 3:if(!(n=e.sent)){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}},e,t)}))()},rebateFrameSave:function(){var t=this;return(0,h.default)(u.default.mark(function e(){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.rebateFrameSave)((0,p.default)({},t.brandFrom,{frame_id:t.frame_id,data_type:t.saveForm.data_type}));case 2:if(!(a=e.sent)){e.next=5;break}return e.abrupt("return",!0);case 5:case"end":return e.stop()}},e,t)}))()},saveData:function(){var t=this;return(0,h.default)(u.default.mark(function e(){var a,n,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.flag){e.next=2;break}return e.abrupt("return");case 2:if(t.flag=!1,a=t.dataList.every(function(t){return(0,v.validateRuleData)(t.rule,!!t.infinite)})){e.next=7;break}return t.flag=!0,e.abrupt("return",t.$toast.error("发布额数据遗漏或返点规则小数超过两位或小于0"));case 7:if(!(0,s.default)(t.brandFrom).some(function(e){return t.brandFrom[e].length})){e.next=14;break}return e.next=10,t.rebateFrameSave();case 10:if(n=e.sent){e.next=14;break}return t.flag=!0,e.abrupt("return");case 14:return e.next=16,t.rabateSaveRule();case 16:if(i=e.sent,t.flag=!0,i){e.next=20;break}return e.abrupt("return");case 20:t.$toast.success("编辑成功"),t.$emit("reload"),t.active=!1;case 23:case"end":return e.stop()}},e,t)}))()},deleteRule:function(t,e,a){var n=this.dataList,i=n[a].rule[e-1],s=n[a].rule[e+1];i&&s&&(i.max=s.min);var r=t.splice(e,1)[0];r.id&&this.ruleFrom.delete_ids.push(r.id)},addRule:function(t,e){var a=t[t.length-1],n="";a&&a.max&&(n=a.max),t.push({min:n,max:"",rebate:""}),this.isOpen=e},resetConfirm:function(){this.brand.title="",this.level.id="",this.resetData()},deleteBrand:function(t,e){var a=t.data_type_id,n=this.brandFrom.insert_ids.findIndex(function(t){return t===a});-1!==n?this.brandFrom.insert_ids.splice(n,1):this.brandFrom.delete_ids.push(a),this.dataList.splice(e,1)},addBrand:function(){return this.storageBrand.id?!this.validate||this.brandFrom.insert_ids.includes(this.storageBrand.id)?void this.$toast.error("该"+this.themeName+"已存在"):(this.dataList.push({data_type_name:this.storageBrand.title,rule:[],data_type_id:this.storageBrand.id,infinite:!1}),this.addRule(this.dataList[this.dataList.length-1].rule,this.dataList.length-1),this.brandFrom.insert_ids.push(this.storageBrand.id),this.brand.title="",this.level.id="",void this.resetData()):void this.$toast.error("请选择"+this.themeName)},resetData:function(){this.storageBrand={id:"",title:""}},clearData:function(){this.storageBrand={id:"",title:""},this.brandFrom={insert_ids:[],delete_ids:[]},this.ruleFrom={delete_ids:[]}},brandSelect:function(t){var e=this;return(0,h.default)(u.default.mark(function a(){var n,i,s;return u.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t){a.next=3;break}return e.resetData(),a.abrupt("return");case 3:return n=t.brand_id,i=t.title,e.saveForm.data_type_id=n,e.brand_name=i,a.next=8,(0,f.rebateFrameValidate)((0,p.default)({},e.saveForm,{id:e.frame_id}));case 8:if(s=a.sent){a.next=13;break}return e.validate=!1,e.$toast.error("该品牌已存在"),a.abrupt("return");case 13:e.validate=!0,e.storageBrand={id:n,title:i};case 15:case"end":return a.stop()}},a,e)}))()},getBrandList:function(){var t=this;return(0,h.default)(u.default.mark(function e(){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,(0,f.getBrandList)(t.brand);case 3:if(a=e.sent,t.isLoading=!1,a){e.next=7;break}return e.abrupt("return");case 7:t.brandList=(0,l.default)(a);case 8:case"end":return e.stop()}},e,t)}))()},open:function(t,e){var a=this;return(0,h.default)(u.default.mark(function n(){return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a.flag||(a.flag=!0),a.clearData(),a.saveForm=(0,p.default)({},a.saveForm,{data_type:e}),a.frame_id=t,6===e&&a.getlevelList(),n.next=7,a.rebateFrameShowDetail();case 7:a.active=!0;case 8:case"end":return n.stop()}},n,a)}))()},rebateFrameShowDetail:function(){var t=this;return(0,h.default)(u.default.mark(function e(){var a,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.rebateFrameShowDetail)((0,p.default)({},t.saveForm,{id:t.frame_id}));case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:return n=a.content,n.forEach(function(t){var e=(t.rule||0)&&t.rule.length;t.infinite=!!e&&0===t.rule[t.rule.length-1].max}),n.length&&!parseInt(n[n.length-1].max)&&(t.infinite=!0),t.dataList=n,e.abrupt("return",!0);case 10:case"end":return e.stop()}},e,t)}))()}}}},XxnQ:function(t,e,a){a("mexl"),a("8AOX");var n=a("VU/8")(a("QXNi"),a("v79A"),"data-v-066d5445",null);t.exports=n.exports},Y20y:function(t,e){},YG1J:function(t,e){},YjCD:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"签约公司"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companiesName,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany},model:{value:t.likeCompany,callback:function(e){t.likeCompany=e},expression:"likeCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"省份"}},[a("b-select",{attrs:{disabled:t.disableProvince},model:{value:t.provinceName,callback:function(e){t.provinceName=e},expression:"provinceName"}},t._l(t.provinces,function(e){return a("option",{domProps:{value:e.name}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"年检到期日期",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}}),t._v("\n                            -\n                            "),a("b-datepicker",{attrs:{"min-date":t.enteredDateStart},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"法人代表"}},[a("b-input",{model:{value:t.likeFrdb,callback:function(e){t.likeFrdb=e},expression:"likeFrdb"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalCompanies},[t._v("总数："+t._s(t.totalCompanies))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients",attrs:{data:t.companies,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"签约公司名称",field:"company_name",sortable:""}},[t._v("\n                        "+t._s(e.row.company_name)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"所在省份",field:"province_name",sortable:""}},[t._v("\n                        "+t._s(e.row.province_name)+"级客户\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"法人代表",field:"frdb",sortable:""}},[t._v("\n                        "+t._s(e.row.frdb)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"注册地址",field:"reg_address",sortable:""}},[t._v("\n                        "+t._s(e.row.reg_address)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"录入人",field:"updated_user_id",sortable:""}},[t._v("\n                        "+t._s(e.row.entered_user_text)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"年检到期日期",field:"annual_inspection_due_date",sortable:""}},[t._v("\n                        "+t._s(e.row.annual_inspection_due_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"登记时间",field:"entered_date",sortable:""}},[t._v("\n                        "+t._s(e.row.entered_date)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态",field:"approve_status_id",sortable:""}},[t._v("\n                        "+t._s(e.row.approve_status_text)+"\n                    ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[a("router-link",{staticClass:"button is-link",attrs:{to:"/companies/"+e.row.id}},[t._v("查看")])],1)])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],key:t.totalPage,staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalCompanies,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},Yp9P:function(t,e){},Ytv6:function(t,e){},Yzek:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=n(i),r=a("O4Lo"),o=n(r);e.default={data:function(){return{list:[],total:0,currPage:1,perPage:10,totalPage:1,jumpPage:1,contractsName:"",contractNames:[],contractsNumber:"",contractTypeList:[{name:"",id:-1},{name:"单笔",id:0},{name:"CPS",id:1},{name:"赠版",id:2},{name:"年框",id:3},{name:"CPS对账单",id:4},{name:"平台服务费",id:5},{name:"预估CPS合同",id:6},{name:"CPS实际发生额",id:7},{name:"阿里微任务",id:9},{name:"资源置换",id:8}],contractTypeId:"",partyName:"",businessLine:"",isFetching_2:!1,signingCompanys:[],signingCompany:"",signingCompanySelected:null,status:null,contractCharges:[],contractChargeId:"",contractChargeSelected:null,forSearch:!0}},watch:{currPage:function(t){this.questFn(t)}},computed:{filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})},filterContractCharges:function(){var t=this;return this.contractCharges.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.contractChargeId.toLowerCase())>=0})}},created:function(){this.getSigningCompanys(),this.getContractCharges(),this.questFn();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},methods:{getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{no_limit:1}}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},getContractCharges:function(){var t=this;return this.ajax({url:"/user/index",method:"post",data:{is_delete:0}}).then(function(e){0===e.error_code&&(t.contractCharges=e.data.rows)})},searchContract:(0,o.default)(function(){this.isFetching_2=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractsName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},onSelectedCompany:function(t){t&&(this.signingCompanySelected=t.id,this.signingCompany=t.company_name)},onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},questFn:function(t){var e=this;Number(t)||(t=1);var a={page:t,page_size:this.perPage};this.addOptions(a,this),this.ajax({loading:this.$loading.open(),url:"/backlog/get_finance_account_period_backlog",params:a}).then(function(t){if(0===t.error_code){e.list=t.data.list;for(var a=0;a<e.list.length;a++)e.list[a].start_date=e.timeFormat(e.list[a].start_date),e.list[a].end_date=e.timeFormat(e.list[a].end_date),e.list[a].account_period=e.timeFormat(e.list[a].account_period);console.log("this.list",e.list),e.total=t.data.total||0,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1)}})},resetParams:function(){this.contractsName="",this.contractsNumber="",this.contractTypeId="",this.contractChargeId="",this.contractChargeSelected=null,this.businessLine="",this.partyName="",this.signingCompany="",this.signingCompanySelected=null,this.status=null,this.currPage=1},PageHandle:function(t){this.currPage=t,this.onQueryClick()},timeFormat:function(t){return t.split(" ")[0]},addOptions:function(t,e){e.contractsName&&(t.contract_name=e.contractsName),e.contractsNumber&&(t.contract_number=e.contractsNumber),""!==e.contractTypeId&&e.contractTypeId>-1&&(t.contract_type_id=e.contractTypeId),e.contractChargeId&&e.contractChargeSelected&&(t.user_id=e.contractChargeSelected),e.partyName&&(t.party_b_name=e.partyName),e.signingCompany&&(t.company_name=e.signingCompany),e.status&&(t.overdue=e.status)},Export:function(){var t=this,e=(new Date).getTime(),a=function a(n){return new s.default(function(i,s){var r={file_path:n.data.file_path,file_name:n.data.file_name};t.ajax({url:"/export/is_live",method:"post",data:r,export:!0}).then(function(i){if(0===i.error_code){var s=document.createElement("a");s.style="display: none",s.download=n.data.file_name+".xlsx",s.href=n.data.file_path,document.body.appendChild(s),s.click(),s.remove()}else{if(!((new Date).getTime()-e<1e4))return console.log("失败"),t.$toast.open({duration:5e3,message:"生成文件失败，请重新操作！",position:"is-top",type:"is-danger"}),!1;setTimeout(a(n),2e3)}})})};(function(){return new s.default(function(e,a){var n={};t.addOptions(n,t),t.ajax({url:"/backlog/get_finance_account_period_backlog_export",params:n}).then(function(t){e(t)})})})().then(function(t){a(t)})}}}},ZggN:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合作方式"}},[a("div",{staticClass:"cooperation-list"},[t.cooperationList.length?a("b-table",{attrs:{data:t.cooperationList,bordered:t.isBorder},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"合作方式",width:"260"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{expanded:"",type:"text"},model:{value:e.row.val,callback:function(a){t.$set(e.row,"val",a)},expression:"props.row.val"}})],1):a("b-field",[t._v(t._s(e.row.val))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"260"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveCooperation(e.row)}}},[t._v("保存")]):t._e(),t._v(" "),e.row.isEdit?a("button",{staticClass:"button is-link",on:{click:function(a){t.checkStatus(e.row,1)}}},[t._v("取消")]):a("button",{staticClass:"button is-primary",on:{click:function(a){t.checkStatus(e.row,0)}}},[t._v("编辑")]),t._v(" "),e.row.is_deleted?a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteCooperation(e.row,e.index)}}},[t._v("删除")]):t._e()]),t._v(" "),a("b-table-column",{attrs:{label:"合作方式明细"}},[a("router-link",{staticClass:"button is-link",attrs:{to:"/cooperation/"+e.row.id}},[t._v("编辑明细")])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showCooperationLog(e.row.id)}}},[t._v("查看")])])]}}])}):t._e()],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[t.logData.length?a("b-table",{attrs:{data:t.logData},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"操作人",width:"60"}},[a("b-field",[t._v(t._s(e.row.updated_user))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作信息",width:"260"}},[a("b-field",[t._v(t._s(e.row.description.desc))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作时间",width:"160"}},[a("b-field",[t._v(t._s(e.row.create_time))])],1)]}}])}):t._e()],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},Zo6z:function(t,e,a){a("2zWw");var n=a("VU/8")(a("s8ni"),a("pHXc"),null,null);t.exports=n.exports},a9gC:function(t,e){},aAl0:function(t,e){},aHuk:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("fZjL"),i=function(t){return t&&t.__esModule?t:{default:t}}(n),s={EUR:"欧元",GBP:"英镑",JPY:"日元",KRW:"韩国元",USD:"美元",RMB:"人民币",CAD:"加拿大元",AUD:"澳元"},r=new Date;e.default={data:function(){return{rateFiles:[],yearList:[],selectedYear:r.getFullYear(),rateData:{},isEdit:!1,currYear:r.getFullYear(),currMonthIndex:r.getMonth(),currRateData:[],tableRowIndex:{},serverHtmlString:"",logs:[],totalLogs:0,perPage:20,currPage:1,jumpPage:1,LOG_TYPES:{1:"操作日志",2:"错误日志",3:"调用外部API结果日志",4:"登录日志"},ACTION_TYPES:{1:"添加",2:"修改",3:"软删除",4:"硬删除",5:"查看"},SECTION_TYPES:{1:"用户",2:"客户",3:"签约公司",4:"合同",5:"合同明细",6:"合同回款",7:"合同发票"},STATUS_TYPES:{"-1":"失败",1:"成功"}}},computed:{totalPage:function(){return Math.ceil(this.totalLogs/this.perPage)}},created:function(){this.generateYears(),this.getExchangeRates(),this.getLogs()},watch:{selectedYear:function(t){this.getExchangeRates()},currPage:function(t){this.getLogs()}},methods:{generateYears:function(){var t=(new Date).getFullYear(),e=t+6;this.yearList=new Array(e-2016).join(",").split(",").map(function(t,e){return 2016+e})},importFile:function(){var t=this;if(0===this.rateFiles.length)return this.$refs.rateFiles.checkHtml5Validity(),void this.$dialog.alert("请选择文件");var e=this.rateFiles;if(!/\.(xls|xlsx)$/.test(e.name))return void this.$dialog.alert("请选择后缀为 .xls 或 .xlsx 的文件");this.ajax({url:"/contract_cash_collection_pool/import_currency_rate/",method:"post",successTip:!0,loading:this.$loading.open(),headers:{"Content-Type":"multipart/form-data"},data:{filename:e}}).then(function(e){0===e.error_code&&(t.serverHtmlString=e.data.export_response_html,t.getExchangeRates(),t.getLogs())})},getExchangeRates:function(){var t=this;return this.ajax({url:"/currency_rate/get_currency_rate",loading:this.$loading.open(),params:{year:this.selectedYear}}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.rateData=e.data,t.currRateData=t.formatRateData(t.rateData))})},rateDataValidate:function(t,e){var a=this,n=[];return t.forEach(function(t){var i=a.$refs[t+"_"+e][0];i.checkHtml5Validity&&(i.checkHtml5Validity()||n.push(i))}),!n.length||(n[0].focus(),!1)},saveRates:function(){var t=this,e=(0,i.default)(this.rateData);if(this.rateDataValidate(e,this.currMonthIndex)){var a={},n=this.currMonthIndex;n=n<10?"0"+(n+1):n+1,a.date=this.selectedYear+"-"+n+"-01 00:00:00";for(var s in this.rateData){var r=this.tableRowIndex[s];a[s]=this.currRateData[r]["month_"+this.currMonthIndex]}return this.ajax({url:"/currency_rate/update_currency_rate",loading:this.$loading.open(),method:"post",successTip:!0,data:a}).then(function(e){0===e.error_code&&(t.isEdit=!1)})}},formatRateData:function(t){var e=this,a=[],n=0;for(var i in t)!function(i){var r={},o=t[i];r.currency=s[i],r.currencyCode=i,o.forEach(function(t,e){var a=new Date(t.date).getMonth();r["month_"+a]=t.rate}),o.length<12&&new Array(12-o.length).join(",").split(",").forEach(function(t,e){if(r["month_"+(o.length+e)])return!0;r["month_"+(o.length+e)]=""}),a.push(r),e.tableRowIndex[i]=n,n++}(i);return a},formatLogData:function(t){return t.map(function(t,e){return t.description=JSON.parse(t.description),t})},getLogs:function(){var t=this;return this.ajax({url:"/currency_rate/get_currency_rate_log",loading:this.$loading.open(),params:{page:this.currPage,page_size:this.perPage}}).then(function(e){0===e.error_code&&(t.logs=e.data.list||[],t.totalLogs=e.data.total||0)})}}}},aNNx:function(t,e){},b1KQ:function(t,e){},bYuL:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),s=n(i),r=a("Dd8w"),o=n(r),c=a("fZjL"),l=n(c),d=a("O4Lo"),u=n(d),_=a("LZT1"),p=n(_);e.default={props:{isSplitURL:{type:Boolean,default:!1}},data:function(){return{DEPARTMENT:"",business_id:null,userName:"",isHeader:!1,loadingList:{isFetching3:!1,isFetching4:!1,isFetching5:!1,isFetching1:!1},form:{contract_name:"",user_id:"",client_id:"",split_status_id:""},selectName:{user_id:"",client_id:""},loading:!1,charge_userName:"",clientName:"",charge_userId:null,clientList:[],codeList:[],contracts:[],contractDirector:[],contractName:"",contractNumber:"",contractNumberList:[],contractNames:[],splitStatusId:0,isSplit:0,totalContracts:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,checkedRows:[],sortField:"",sortOrder:"desc",defaultSortDirection:"asc",isChecked:!0,clickGet:0,clickReset:0,splitStatus:{1:"未拆分",2:"未提交",3:"待审核",4:"审核通过",5:"驳回待修改",6:"再驳回待修改"},amounts:null,approved_total_amount:null,not_approved_total_amount:null}},watch:{currPage:function(){var t=!1;t=!(this.clickReset>this.clickGet),this.getSplitList(t)},page:function(t){this.currPage=t||1}},created:function(){this.getAllDepartment(),this.getSplitList(),this.getCodeList(),this.isSplitURL||(this.searchContractName(),this.searchSplitUser(),this.searchGetClients())},methods:{selectAutoOption:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"form",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"id";t&&(0,l.default)(t).length&&(this[a][e]=t[n])},searchSplitUser:(0,u.default)(function(){this.loadingList.isFetching4=!0,this.getSplitUser()},500),getSplitUser:function(){var t=this;return this.ajax({url:"/contract_split/get_split_user",params:{keyword:this.selectName.user_id}}).then(function(e){var a=e.error_code,n=e.data;t.loadingList.isFetching4=!1,0===a&&(t.contractDirector=n)})},searchGetClients:(0,u.default)(function(){this.loadingList.isFetching5=!0,this.getClients()},500),getClients:function(){var t=this;return this.ajax({url:"/contract_split/get_split_client",params:{keyword:this.selectName.client_id}}).then(function(e){var a=e.error_code,n=e.data;t.loadingList.isFetching5=!1,0===a&&(t.clientList=n)})},searchContractName:(0,u.default)(function(){this.loadingList.isFetching3=!0,this.getContractsName()},500),getContractsName:function(){var t=this;return this.ajax({url:"/contract_split/get_split_contract_name",params:{keyword:this.form.contract_name}}).then(function(e){var a=e.error_code,n=e.data;t.loadingList.isFetching3=!1,0===a&&(t.contractNames=n)})},searchContracNumbertList:(0,u.default)(function(){this.loadingList.isFetching1=!0,this.getContractNumberList()},500),getContractNumberList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.loadingList.isFetching1=!1})},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getSplitList(!0)},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?this.getSplitList(t):this.currPage=1,this.clickGet+=1},makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},getAllDepartment:function(){var t=this;return this.ajax({url:"/user/get_my_business_list"}).then(function(e){var a=(0,p.default)(e.data);t.DEPARTMENT=a;var n={id:"",value:""};t.DEPARTMENT.unshift(n)})},getSplitList:function(){var t=this;this.isSplitURL||(0,l.default)(this.selectName).filter(function(e){return!t.selectName[e]&&e}).forEach(function(e){return t.form[e]=""});var e=(0,o.default)({},this.form,{business_id:this.business_id,contract_number:this.contractNumber,achieve_pm_id:this.charge_userId,split_status_id:this.isSplitURL?0:this.form.split_status_id,is_approve:this.isSplitURL?1:0,is_split:this.isSplit,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage});this.loading=!0,this.urlParams=(0,s.default)({},e),this.ajax({url:"/contract_split/getSplitLists",params:e}).then(function(e){t.checkedRows=[],t.totalContracts=e.data.total,t.totalPage=Math.ceil(e.data.total/t.perPage),0===t.totalPage&&(t.totalPage=1),t.contracts=e.data.lists;for(var a=0;a<t.contracts.length;a++)!function(e){t.contracts[e].chakan=function(){return t.hasPermission("crm_new.yeji.list.chakan")||!1},t.contracts[e].bianji=function(){return!!t.hasPermission("crm_new.yeji.list.bianji")&&(2===Number(t.contracts[e].is_split)||void 0)}}(a);t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0}),this.ajax({url:"/contract_split/statistics_amount",params:e}).then(function(e){t.amounts=e.data.list,t.approved_total_amount=e.data.approved_total_amount,t.not_approved_total_amount=e.data.not_approved_total_amount})},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.charge_userName,role_code:"role-crm-xiangmujingli",use_swzc:0}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},onChargenameSelected:function(t){t&&(this.charge_userId=t.id)},resetParams:function(){var t={};(0,l.default)(this.form).forEach(function(e){t[e]=""});var e={};(0,l.default)(this.selectName).forEach(function(t){e[t]=""}),this.charge_userId="",this.form=t,this.selectName=e,this.charge_userName="",this.checkedRows=[],this.defaultSortDirection="asc",this.splitStatusId=null,this.contractNumber="",this.contractName="",this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1,this.sortField="",this.sortOrder="desc",this.business_id=null},doContract:function(){var t=[];return this.checkedRows.forEach(function(e){t.push(e.id)}),t.join(",")},exportALL:function(t){var e=this,a=(0,o.default)({},this.form,{business_id:this.business_id,contract_number:this.contractNumber,achieve_pm_id:this.charge_userId,split_status_id:this.isSplitURL?0:this.form.split_status_id,is_approve:this.isSplitURL?1:0,is_split:this.isSplit,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage,contract_ids:this.doContract()}),n=t?"/contract_split/exportSplitDetailLists":"/contract_split/exportSplitLists";this.ajax({url:n,params:a}).then(function(t){e.exportLive({file_name:t.data.file_name,file_path:t.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})}}}},bcc1:function(t,e){},bllG:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("bOdI"),s=n(i),r=a("//Fk"),o=n(r),c=a("Dd8w"),l=n(c),d=a("d7EF"),u=n(d),_=a("Xxa5"),p=n(_),m=a("exGp"),h=n(m),f=a("u2KI"),v=n(f),b=a("z93h"),g=a("B6I+"),y=n(g),C=["北京值得买科技股份有限公司","北京值得买科技股份有限公司上海分公司","北京值得买科技股份有限公司青岛分公司","青岛无忧直购网络科技有限公司","青岛星罗创想网络科技有限公司","青岛优讯创想信息技术有限公司"].map(function(t,e){return{id:e+1,val:t}});e.default={mixins:[y.default],props:{title:{type:String,default:""}},data:function(){return{msg:"",flag:!0,time:{},partB:"",validate:!1,isLoading:!1,partAcompanyList:[],form:{like_company_name:""},dataList:[],active:!1,frame_id:"",saveForm:{data_type:"",data_type_id:""},rebateFrameSaveFrom:{insert_ids:[],delete_ids:[]},partBList:(0,v.default)(C),company_name:""}},computed:{editName:function(){return 1===this.saveForm.data_type?"甲方":"乙方"}},methods:{changeSelect:function(){},resetConfirm:function(){this.form.like_company_name="",this.resetData()},resetData:function(){this.company_name="",this.saveForm.data_type_id="",this.partB=""},addNewRelation:function(){var t=this;return(0,h.default)(p.default.mark(function e(){return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.company_name){e.next=2;break}return e.abrupt("return",t.$toast.error("请选择"+t.editName+"签约公司"));case 2:if(t.validate){e.next=4;break}return e.abrupt("return",t.$toast.error(t.msg));case 4:t.dataList.push({data_type_name:t.company_name,id:t.saveForm.data_type_id}),t.rebateFrameSaveFrom.insert_ids.push(t.saveForm.data_type_id),t.form.like_company_name="",t.resetData();case 8:case"end":return e.stop()}},e,t)}))()},deleteCompanyInfo:function(t){var e=this.dataList.splice(t,1),a=(0,u.default)(e,1),n=a[0].data_type_id,i=this.rebateFrameSaveFrom.insert_ids,s=i.findIndex(function(t){return t===n});if(-1!==s)return void i.splice(s,1);this.rebateFrameSaveFrom.delete_ids.push(n)},rebateFrameSave:function(){var t=this;return(0,h.default)(p.default.mark(function e(){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.flag){e.next=2;break}return e.abrupt("return");case 2:if(t.flag=!1,t.rebateFrameSaveFrom.insert_ids.length||t.rebateFrameSaveFrom.delete_ids.length){e.next=7;break}return t.active=!1,t.flag=!0,e.abrupt("return");case 7:return e.next=9,(0,b.rebateFrameSave)((0,l.default)({},t.rebateFrameSaveFrom,{data_type:t.saveForm.data_type,frame_id:t.frame_id}));case 9:if(a=e.sent,t.flag=!0,a){e.next=13;break}return e.abrupt("return");case 13:t.$toast.success("编辑成功"),t.$emit("reload"),t.active=!1;case 16:case"end":return e.stop()}},e,t)}))()},clearOldData:function(){this.rebateFrameSaveFrom={insert_ids:[],delete_ids:[]},this.form.like_company_name="",this.partB="",this.company_name=""},open:function(t,e,a){this.flag||(this.flag=!0),this.time=a,this.clearOldData(),this.saveForm=(0,l.default)({},this.saveForm,{data_type:e}),this.frame_id=t,this.rebateFrameShowDetail(),1===e&&this.getPartAcompany()},rebateFrameShowDetail:function(){var t=this;return(0,h.default)(p.default.mark(function e(){var a,n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.rebateFrameShowDetail)((0,l.default)({},t.saveForm,{id:t.frame_id}));case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:n=a.content,t.dataList=n,t.active=!0;case 8:case"end":return e.stop()}},e,t)}))()},getPartAcompany:function(){var t=this;return(0,h.default)(p.default.mark(function e(){var a,n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,(0,b.getPartAcompany)(t.form);case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return");case 6:n=a.lists,t.partAcompanyList=n,t.isLoading=!1;case 9:case"end":return e.stop()}},e,t)}))()},partCompanySelect:function(t){var e=this;return(0,h.default)(p.default.mark(function a(){var n,i,s,r,c;return p.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t){a.next=3;break}return e.resetData(),a.abrupt("return");case 3:return 2===e.saveForm.data_type&&(n=e.partBList.filter(function(e){return e.id===t})[0].val,t={id:t,company_name:n}),i=t,s=i.id,r=i.company_name,e.saveForm.data_type_id=s,e.company_name=r,a.next=10,o.default.all([e.postRebateCheck(),e.rebateFrameValidate(),e.postCheckedExisted(t)]);case 10:if(c=a.sent,c.every(function(t){return t})){a.next=14;break}return e.validate=!1,a.abrupt("return",e.$toast.error(e.msg));case 14:e.validate=!0;case 16:case"end":return a.stop()}},a,e)}))()},postCheckedExisted:function(t){var e=this;return(0,h.default)(p.default.mark(function a(){var n;return p.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=!e.dataList.some(function(e){return e.id===t.id}),n||(e.msg="该签约公司已关联其它框架"),a.abrupt("return",n);case 3:case"end":return a.stop()}},a,e)}))()},postRebateCheck:function(){var t=this;return(0,h.default)(p.default.mark(function e(){var a,n,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=1===t.saveForm.data_type?"party_a_ids":"party_b_ids",n=(0,s.default)({},a,t.saveForm.data_type_id),e.next=4,(0,b.postRebateCheck)((0,l.default)({},n,{frame_id:t.frame_id},t.time));case 4:return i=e.sent,i||(t.msg="已关联该签约公司，请勿重新关联"),e.abrupt("return",i);case 7:case"end":return e.stop()}},e,t)}))()},rebateFrameValidate:function(){var t=this;return(0,h.default)(p.default.mark(function e(){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.rebateFrameValidate)((0,l.default)({},t.saveForm,{id:t.frame_id}));case 2:return a=e.sent,a||(t.msg="已关联该签约公司，请勿重新关联"),e.abrupt("return",a);case 5:case"end":return e.stop()}},e,t)}))()}}}},bnbK:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-scaling"},[a("page-container",{attrs:{pageTitle:t.isAdd?"新增成本管理":t.isEdit?"编辑成本管理":"查看成本管理"}},[t.isAdd?a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{attrs:{label:"合同编号：",horizontal:""}},[a("b-input",{model:{value:t.contract_number,callback:function(e){t.contract_number=e},expression:"contract_number"}}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.getContract}},[t._v("查询")])],1)],1)]):t._e(),t._v(" "),t.isInfoShow?a("div",[a("b-field",{staticClass:"columns z-contracts-top",attrs:{grouped:""}},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同类型"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_type_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同编号"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_number))])]),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同名称"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同品类"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_brand_name)+"-"+t._s(t.contract.contract_second_brand_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同负责人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_charge_name))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户名称"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"所属部门"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.parent_department_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"业务组"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.department_name))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.signing_company_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司类型"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.signing_company_type))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联年框"}},[a("div",{staticClass:"z-field-text clickLink"},[t._v(t._s(t.contract.join_contract_number))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"乙方签约公司"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.party_b_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"起止日期"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.start_date)+" - "+t._s(t.contract.end_date))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户账期"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.account_period))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同申请人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.apply_user_name||t.$root.crmUser&&t.$root.crmUser.name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同签订人"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.contract_signing))])]),t._v(" "),t.contract.client_relationship_name&&[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户关系"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_relationship_name))])]):t._e(),t._v(" "),a("b-field",{staticClass:"column",attrs:{label:"首次签约",horizontal:"",expanded:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.IS_FIRST[t.contract.is_first_contract]))])])],1)])]),t._v(" "),a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{attrs:{label:"项目经理：",horizontal:""}},[t.isEdit?a("b-autocomplete",{ref:"contractCharge",staticClass:"search-input",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name",required:""},on:{input:t.getCodeList,select:t.onChargenameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.charge_userName,callback:function(e){t.charge_userName=e},expression:"charge_userName"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.cost_pm_name))]),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),a("b-field",{attrs:{label:"下单内容：",horizontal:""}},[t.isEdit?a("b-input",{attrs:{type:"textarea",maxlength:"3000"},model:{value:t.cost_order_content,callback:function(e){t.cost_order_content=e},expression:"cost_order_content"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.cost_order_content))]),t._v(" "),a("div",{staticClass:"column"})],1)],1)]),t._v(" "),t.details&&t.details.length?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[t.details&&t.details.length?a("b-table",{attrs:{data:t.details,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"成本模块"}},[t.isEdit?a("b-field",[e.row.isLast?a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.cost_template))]):a("b-autocomplete",{ref:"cost_template_cooperation_id_"+e.index,attrs:{required:"","keep-first":!1,"open-on-focus":!0,data:e.row.options,field:"cost_name"},on:{focus:function(a){t.filteredDataObj(e.row)},input:function(a){t.filteredDataObj(e.row)},select:function(t){e.row.cost_template=t&&t.id?t.id:0,e.row.cost_type=2}},model:{value:e.row.cost_name,callback:function(a){t.$set(e.row,"cost_name",a)},expression:"props.row.cost_name"}})],1):a("b-field",[t._v(t._s(e.row.cooperation_name||e.row.cost_name))])],1),t._v(" "),a("b-table-column",{attrs:{label:"预估成本"}},[a("b-field",[t.isEdit&&!e.row.isLast&&e.row.is_update?a("b-input",{ref:"cost_estimated_cost_"+e.index,attrs:{required:""},on:{blur:function(a){t.onBlurCost(e.row.estimated_cost,"estimated_cost")}},model:{value:e.row.estimated_cost,callback:function(a){t.$set(e.row,"estimated_cost",a)},expression:"props.row.estimated_cost"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.estimated_cost))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"预估时间"}},[t.isEdit&&!e.row.isLast&&e.row.is_update?a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{ref:"cost_estimated_time_start_date_"+e.index,attrs:{"min-date":t.minDate,required:""},model:{value:e.row.estimated_date,callback:function(a){t.$set(e.row,"estimated_date",a)},expression:"props.row.estimated_date"}},[a("button",{staticClass:"button is-danger",on:{click:function(a){t.clearDate(e.row)}}},[a("b-icon",{attrs:{icon:"close"}}),t._v(" "),a("span",[t._v("清除")])],1)])],1):[t._v(t._s(e.row.estimated_time))]],2),t._v(" "),a("b-table-column",{attrs:{label:"实际明细"}},[a("b-field",[t.isEdit&&!e.row.isLast?a("b-input",{ref:"cost_actual_details_"+e.index,attrs:{type:"textarea",required:""},model:{value:e.row.actual_details,callback:function(a){t.$set(e.row,"actual_details",a)},expression:"props.row.actual_details"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.actual_details))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"实际花费"}},[a("b-field",[t.isEdit&&!e.row.isLast?a("b-input",{ref:"cost_actual_cost_"+e.index,attrs:{required:""},on:{blur:function(a){t.onBlurCost(e.row.actual_cost,"actual_cost")}},model:{value:e.row.actual_cost,callback:function(a){t.$set(e.row,"actual_cost",a)},expression:"props.row.actual_cost"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(e.row.actual_cost))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"状态"}},[a("b-field",[e.row.isAdd?a("div",{staticClass:"z-field-text"},[t._v("待审核")]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.CostStatus[e.row.cost_status]))])])],1),t._v(" "),t.isEdit?a("b-table-column",{attrs:{label:"操作"}},[t.isEdit&&!e.row.isLast?a("a",{staticClass:"button is-danger",attrs:{disabled:!(0===e.row.cost_status)},on:{click:function(a){t.deleteCostManage(e.row,e.index)}}},[t._v("删除")]):t._e()]):t._e()]}}])}):t._e(),t._v(" "),t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.addCostManage}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e()],1)]):t._e(),t._v(" "),!t.isEdit&&t.financial&&t.financial.length?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-table",{attrs:{data:t.financial,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"导入金额发生时间"}},[t._v("\n                                "+t._s(e.row.financial_month)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"财务发生金额"}},[t._v("\n                                "+t._s(e.row.financial_amount)+"\n                            ")])]}}])})],1)]):t._e(),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("审批邮件")])]),t._v(" "),a("div",{staticClass:"z-block-content z-textWarp"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"上传合同相关成本证明",message:t.msg,type:t.status}},[t.isEdit?a("b-upload",{ref:"file_url",attrs:{required:!t.cost_email_path.length},on:{input:function(e){t.fileUpload("url")}},model:{value:t.urlFiles,callback:function(e){t.urlFiles=e},expression:"urlFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.cost_email_source_name))]),t._v(" "),a("div",{staticClass:"cost-file"},[t.cost_email_path.length?a("a",{staticClass:"file-name",attrs:{href:t.cost_email_path,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),t.cost_email_path.length&&t.isEdit?a("a",{staticClass:"file-name",attrs:{href:"javascript:void(0);"},on:{click:t.deleteCostEmail}},[t._v("删除")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.cost_email_path.length,expression:"!cost_email_path.length"}],staticClass:"nofiles"})])],1)],1)])]),t._v(" "),t.isEdit?[a("a",{key:3,staticClass:"button is-primary",on:{click:function(e){t.saveContract(1)}}},[t._v("保存")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")])]:t._e(),t._v(" "),t.isPending?[a("a",{key:1,staticClass:"button is-primary",on:{click:function(e){t.reviewCost(1)}}},[t._v("通过")]),t._v(" "),a("a",{key:2,staticClass:"button is-primary",on:{click:function(e){t.reviewCost(2)}}},[t._v("驳回")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")]),t._v(" "),a("b-modal",{attrs:{active:t.ifReject,"has-modal-card":""},on:{"update:active":function(e){t.ifReject=e}}},[a("div",{staticClass:"modal-card",staticStyle:{width:"500px"}},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("驳回原因")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"z-block"},[a("b-input",{ref:"rejectReason_ref",attrs:{required:"",type:"textarea"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}})],1),t._v(" "),a("div",{staticClass:"z-block z-block-reject"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.rejectCost()}}},[t._v("确定")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("取消")])])])])])]:t._e()],2):t._e(),t._v(" "),t.isAddShow?a("div",[a("b",[t._v(t._s(t.errorMsg))]),t._v(" "),a("router-link",{staticClass:"button is-primary",attrs:{to:"/cost_manage/"+t.contractId+"/edit"}},[t._v("跳转编辑页面")])],1):t._e()])],1)},staticRenderFns:[]}},bysM:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"page-container"},[t._t("default")],2)},staticRenderFns:[]}},"cF/X":function(t,e,a){a("UsLl");var n=a("VU/8")(a("R/L5"),a("N4ip"),"data-v-110601ca",null);t.exports=n.exports},cPuc:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"待审批预占合同"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"合同名称"}},[a("b-autocomplete",{attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"contract_name"},on:{input:t.searchContract,focus:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"所属部门"}},[a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人"}},[1===t.contractDirector.length?a("b-input",{attrs:{readonly:""},model:{value:t.userId,callback:function(e){t.userId=e},expression:"userId"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterClientLists,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"client_name"},on:{select:t.onSelectClient},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onSelectCompany},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同品类"}},[a("div",{staticClass:"z-level"},[a("b-select",{staticClass:"select-inline",on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{staticClass:"select-inline",model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):t._e()],1)]),t._v(" "),a("b-field",{attrs:{label:"合同类型"}},[a("b-select",{model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},t._l(t.contractTypeList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同有效期开始",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.endDate},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"合同有效期结束",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"min-date":t.startDate},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"申请人"}},[a("b-autocomplete",{attrs:{data:t.filterapplyPeople,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:function(e){return t.applyPeopleSelected=e?e.id:""}},model:{value:t.applyPeopleId,callback:function(e){t.applyPeopleId=e},expression:"applyPeopleId"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-yuzhan"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.totalContracts))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同名称",field:"contract_name"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同负责人",field:"contract_charge_name"}},[t._v("\n                    "+t._s(e.row.contract_charge_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"甲方签约公司",field:"signing_company_name"}},[t._v("\n                    "+t._s(e.row.signing_company_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同金额",field:"amount"}},[t._v("\n                    "+t._s(e.row.amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同品类",field:"contract_brand_name"}},[t._v("\n                    "+t._s(e.row.contract_brand_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同类型",field:"contract_type_name"}},[t._v("\n                    "+t._s(e.row.contract_type_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同有效期",field:"start_date"}},[t._v("\n                    "+t._s(e.row.start_date)+"-\n                    "+t._s(e.row.end_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"申请时间",field:"entered_date "}},[t._v("\n                    "+t._s(e.row.entered_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"申请人",field:"apply_user_name "}},[t._v("\n                    "+t._s(e.row.apply_user_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[a("router-link",{staticClass:"button is-link",attrs:{to:"/pre_contracts/"+e.row.id}},[t._v("查看")])],1)])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},cStc:function(t,e,a){a("Jitu");var n=a("VU/8")(a("dF0R"),a("wclT"),"data-v-8b52bb32",null);t.exports=n.exports},cY7y:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("woOf"),i=function(t){return t&&t.__esModule?t:{default:t}}(n),s=a("AwEB");e.default={data:function(){return{isAdmin:!1,frameName:"",nameList:[],frameNumber:"",numberList:[],signingCompany:"",signingCompanyId:"",signingCompanys:[],party_b_id:"",brandName:"",brandId:"",brands:[],type:"",levelData:[],frameOwner:"",start_date:null,end_date:null,frameList:[],frameLists:[],currPage:1,perPage:20,totalPage:1,jumpPage:1,totalFrame:0}},watch:{currPage:function(t){this.onQueryClick()}},computed:{filterFrameNames:function(){var t=this;return this.frameList.filter(function(e){return e.frame_name.toString().toLowerCase().indexOf(t.frameName.toLowerCase())>=0})},filterFrameNumbers:function(){var t=this;return this.frameList.filter(function(e){return e.frame_number.toString().toLowerCase().indexOf(t.frameNumber.toLowerCase())>=0})},filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})},filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.brandName.toLowerCase())>=0})}},created:function(){this.isRole(this.ROLE.caiwuguanli)||this.isRole(this.ROLE.caiwushenhe)||this.isRole(this.ROLE.admin)?(console.log(111),this.isAdmin=!0,this.frameOwner=""):(console.log(222),this.frameOwner=this.$root.crmUser.name,this.isAdmin=!1)},mounted:function(){this.getSigningCompanys(),this.getFrameList(),this.getBrands(),this.getLevel(),this.onQueryClick()},methods:{onSelectedCompany:function(t){t&&(this.signingCompanyId=t.id)},onBrandSelected:function(t){t&&(this.brandId=t.brand_id)},getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list",params:{title:this.brandName,is_contract_list:0}}).then(function(e){t.brands=e.data})},getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{no_limit:1}}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},getParams:function(){return{frame_name:this.frameName,frame_number:this.frameNumber,frame_leader:this.frameOwner,start_date:this.start_date?(0,s.changeMonth)(this.start_date):this.start_date,end_date:this.end_date?(0,s.changeMonth)(this.end_date):this.end_date,signing_company_id:this.signingCompanyId,party_b_id:this.party_b_id,brand_id:this.brandId,trade_id:this.type}},onQueryClick:function(){var t=this.getParams();t=(0,i.default)(t,{page_size:this.perPage,page:this.currPage}),this.getFrameList(t)},getFrameList:function(t){var e=this,a=this.getParams();return this.ajax({url:"/rebate_frame/get_frame_lists",params:t||(0,i.default)(a,{page_size:0})}).then(function(a){0===a.error_code?(e.totalFrame=a.data.total,e.totalPage=Math.ceil(a.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1),t?e.frameLists=a.data.lists:e.frameList=a.data.lists):t?e.frameLists=[]:e.frameList=[]})},deleteFn:function(t,e){var a=this;this.$dialog.confirm({message:"确定删除此条返点数据吗？",cancelText:"取消",confirmText:"确认",onConfirm:function(){return a.deleteRebate(t,e)}})},deleteRebate:function(t,e){var a=this;return this.ajax({url:"/rebate_frame/delete_frame",params:{id:t}}).then(function(t){0===t.error_code&&a.$toast.open({duration:3e3,message:"删除成功",position:"is-top",type:"is-success"})})},resetParams:function(){this.end_date=null,this.start_date=null,this.frameName="",this.frameNumber="",this.frameOwner="",this.signingCompany="",this.signingCompanyId="",this.party_b_id="",this.brandName="",this.brandId="",this.type="",this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1}}}},clMa:function(t,e){},clhW:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{active:t.active,"has-modal-card":"","trap-focus":"","destroy-on-hide":!1,"aria-role":"dialog","aria-modal":""},on:{"update:active":function(e){t.active=e}}},[a("div",{staticClass:"container"},[a("p",{staticClass:"title"},[t._v(t._s(t.title))]),t._v(" "),a("div",{staticClass:"flex"},[1===t.saveForm.data_type?a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.partAcompanyList,field:"company_name","max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isLoading},on:{input:t.getPartAcompany,focus:t.getPartAcompany,select:t.partCompanySelect},model:{value:t.form.like_company_name,callback:function(e){t.$set(t.form,"like_company_name",e)},expression:"form.like_company_name"}}):a("b-select",{staticClass:"mr10",on:{input:t.partCompanySelect},model:{value:t.partB,callback:function(e){t.partB=e},expression:"partB"}},t._l(t.partBList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.val))])})),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:t.resetConfirm}},[t._v("\n                重置\n            ")]),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:t.addNewRelation}},[t._v("\n                新增关联\n            ")])],1),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list z-scaling-releases mt20",attrs:{bordered:"",data:t.dataList},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"data_type_name",label:t.editName+"签约公司名称"}},[t._v("\n                    "+t._s(e.row.data_type_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作",centered:"",width:"80"}},[parseInt(e.row.is_update)?t._e():a("button",{staticClass:"button is-link is-primary",on:{click:function(a){t.deleteCompanyInfo(e.index)}}},[t._v("\n                        删除\n                    ")])])]}}])}),t._v(" "),a("button",{staticClass:"button is-link is-primary",on:{click:t.rebateFrameSave}},[t._v("\n            保存\n        ")])],1)])},staticRenderFns:[]}},d3xs:function(t,e,a){a("GwlV");var n=a("VU/8")(a("tiL8"),a("h/Zm"),"data-v-4e7e5548",null);t.exports=n.exports},d46e:function(t,e){},dF0R:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),s=n(i),r=a("//Fk"),o=n(r),c=a("XLwt"),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(c);a("Vb+l"),a("Oq2I"),a("miEh"),a("YsUA");var d=a("uzIf"),u=n(d),_=a("LZT1"),p=n(_);e.default={name:"",props:["isCheck"],data:function(){return{optionOne:{1:"部门",2:"商务",3:"品牌",4:"集团"},optionTwo:{1:"已完成的KPI",2:"未完成的KPI",3:"目标KPI"},showType:[1,1],picShow:!1,percent:!1,show:"1",pieShow:!0,loading:!1,dateTitle:"考核时间",admin:!1,el:null,clickBtn:!1,clickGet:0,clickReset:0,search_time_by:"month",start_time:null,end_time:null,isHeader:!1,userName:"",userId:"",userReadonly:!1,contractDirector:[],departmentName:null,departmentReadonly:!1,departmentId:this.$root.crmUser.department_id||"",departmentList:[],brandName:"",brandId:"",brands:[],companyName:"",companyId:"",companyList:[],ifserch:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,KPILIST:[],isPaginated:!1,totalKPI:0,table_label:[]}},components:{SelectDate:u.default},watch:{currPage:function(t){var e=!1;e=!(this.clickReset>this.clickGet),this.el=1,this.ifserch=e,this.clickBtn=this.clickBtn,this.getKPI(1,e)},page:function(t){this.currPage=t||1},departmentId:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.userId=null,this.userName="",this.getDirector({department_id:t,is_contract_list:1}))},show:function(t){1===Number(t)?this.getPieEcharts():this.getKPIList()},picShow:function(t){2===Number(this.show)&&this.getKPIList()}},computed:{filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.brandName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})},filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})}},created:function(){var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()},this.isShangwu(),this.firstChangeDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getKPI(null,!1)},mounted:function(){this.getDepartment(),this.getBrands(),this.getCompany(),!this.isHeader&&this.isShangwu()||this.getDirector({department_id:this.departmentId,is_contract_list:1})},methods:{firstChangeDepartment:function(){var t=this.$root.user.roleCodes.split(", ");(t.indexOf("role-crm-admin")>-1||t.indexOf("role-crm-shangwuzhichi")>-1||t.indexOf("role-crm-shujuzhongtai")>-1)&&(this.departmentId=621)},isShangwu:function(){var t=this.$root.user.roleCodes.split(", ");return(t.indexOf("role-crm-admin")>-1||t.indexOf("role-crm-shangwuzhichi")>-1||t.indexOf("role-crm-shujuzhongtai")>-1)&&(this.admin=!0),t.indexOf("role-crm-shangwu")>-1},getDepartment:function(){var t=this;return this.ajax({url:"/kpi_search/get_department_list_by_pid",params:{pid:this.departmentId}}).then(function(e){var a=(0,p.default)(e.data);t.departmentList=a})},getDirector:function(t){var e=this;return this.ajax({url:"/kpi_search/get_user_list",method:"post",data:t}).then(function(t){0===t.error_code?e.contractDirector=t.data:e.contractDirector=[]})},onUserSelected:function(t){console.log(t),t&&(this.userId=t.user_id)},getBrands:function(){var t=this;return this.ajax({url:"/kpi_search/get_brand_list"}).then(function(e){t.brands=e.data})},onBrandSelected:function(t){t&&(this.brandId=t.id,this.brandName=t.name)},getDate:function(t,e,a,n){this.start_time=t,this.end_time=e,this.search_time_by=n,console.log("selectDate",t,e,a,n),1===this.el&&this.getKPI(this.el,this.ifserch)},getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/kpi_search/get_group_list"}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name,this.companyId=t.id)},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?(this.el=1,this.ifserch=t,this.clickBtn=!this.clickBtn):this.currPage=1,this.clickGet+=1},delNullParam:function(t){for(var e in t)null!==t[e]&&void 0!==t[e]||delete t[e];return t},getPostData:function(){var t={department_id:this.departmentId,user_id:this.userName?this.userId:"",page:this.currPage,size:this.perPage,search_time_by:this.search_time_by,start_time:this.start_time,end_time:this.end_time,group_id:this.companyName?this.companyId:"",brand_id:this.brandName?this.brandId:""};return t=this.delNullParam(t)},getKPI:function(t,e){var a=this;this.loading=!0,this.el=t;var n=this.getPostData();new o.default(function(t,n){a.isShangwu()?e?t():(a.contractDirector=[],1===a.$root.crmUser.is_headman?(a.isHeader=!0,t()):(a.admin?(console.log("是商务支持or系统管理员"),a.optionOne={1:"部门",2:"商务",3:"品牌",4:"集团"},a.showType=[1,1]):(console.log("普通商务"),a.isHeader=!1,a.departmentReadonly=!0,a.userReadonly=!0,a.contractDirector=[{name:a.$root.crmUser.username,id:a.$root.crmUser.id}],a.userName=a.$root.crmUser.name,a.userId=a.$root.crmUser.id,a.departmentId=a.$root.crmUser.department_id,a.departmentName=a.$root.crmUser.department_name,a.optionOne={2:"商务",3:"品牌",4:"集团"},a.showType=[2,1]),t())):t()}).then(function(){1===Number(a.show)?a.getPieEcharts(n):a.getKPIList(n)})},resetParams:function(){this.contractDirector.length>1&&(this.userId=null),!this.isHeader&&this.isShangwu()||(this.departmentId=this.$root.crmUser.department_id||"",this.userId="",this.userName=""),this.firstChangeDepartment(),this.el=null,this.start_time=null,this.end_time=null,this.search_time_by="month",this.clickReset=this.clickGet===this.clickReset?this.clickGet+1:this.clickGet,this.brandName="",this.brandId="",this.companyName="",this.companyId=""},getKPIList:function(){var t=this,e=this.getPostData();e.level=this.showType[0],e.kpi_type=this.showType[1],e.is_format=Number(!this.picShow),this.ajax({url:"/kpi_search/index",loading:this.$loading.open(),params:e}).then(function(e){t.table_label=[],t.KPILIST=[],t.processData(e),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},childData:function(t){var e=[],a={};if(t.length>0)for(var n=0;n<t.length;n++)a=t[n].business_compute,a["部门"]=t[n].column_title[0],a.child=this.childData(t[n].child),e.push(a);return e},processData:function(t){console.log(t),this.loading=!0;var e=[],a={},n=[],i=void 0,s=void 0,r={1:["部门"],2:["商务名称","所属部门"],3:["品牌","集团"],4:["集团"]};if(t.data.counts>0){for(var o=0;o<t.data.lists.length;o++){a=t.data.lists[o].business_compute;for(var c=0;c<t.data.lists[o].column_title.length;c++)a[r[this.showType[0]][c]]=t.data.lists[o].column_title[c];t.data.lists[o].child&&(a.child=this.childData(t.data.lists[o].child)),e.push(a)}for(i in e[0])if("合计"===i)n.unshift({name:i});else{if("child"===i)continue;n.push({name:i})}for(var l=0;l<t.data.lists[0].column_title.length;l++){var d=n.pop();n.unshift(d)}}s=t.data.counts,this.totalKPI=s,this.totalPage=Math.ceil(s/this.perPage),0===this.totalPage&&(this.totalPage=1),1!==this.currPage&&this.currPage!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+this.currPage):1===this.currPage&&this.$router.push(this.$router.currentRoute.path),this.totalPage>1&&(this.isPaginated=!0),this.KPILIST=e,this.table_label=n,console.log(this.KPILIST),console.log(this.table_label),console.log(22222)},exportAll:function(){var t=this;this.ajax({url:"/kpi_search/export",params:(0,s.default)({},this.getPostData(),{level:this.showType[0],kpi_type:this.showType[1],is_format:Number(!this.picShow)})}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},onSelectedShow:function(){this.picShow=3===Number(this.showType[1]),this.getKPIList()},getPieEcharts:function(){var t=this,e=this.getPostData(),a=l.init(document.getElementById("pie"));a.showLoading(),this.ajax({loading:this.$loading.open(),url:"/kpi_search/pie_chart",params:e}).then(function(t){if(0!==t.error_code)document.getElementById("pie").style.display="none";else{document.getElementById("pie").style.display="block";var e=t.data.data,n=t.data.item,i={title:{left:"center",top:20,textStyle:{color:"#ccc"}},legend:{type:"scroll",orient:"vertical",right:0,y:"center",data:n,selectedMode:!1,formatter:function(t){for(var a=void 0,n=void 0,i=0,s=0;s<e.length;s++)i+=Number(e[s].value),e[s].name===t&&(a=Number(e[s].source_value),n=Number(e[s].value));return["{b|"+t+"}","{a|"+a+"万元}","{c|"+(n/i*100).toFixed(2)+"%}"].join(" ")},textStyle:{rich:{a:{fontSize:16,color:"#EA5504",padding:10},b:{fontSize:14,color:"#333"},c:{fontSize:12,color:"#f00"}}}},tooltip:{trigger:"item",formatter:function(t,e,a){return t.seriesName+"<br/>"+t.data.name+": "+t.data.source_value+"万元 （"+t.percent+"%）"}},series:[{name:"访问来源",type:"pie",radius:"65%",data:e,center:["30%","50%"],label:{show:!0,position:"outside",formatter:"{d}%",fontWeight:"bold",fontSize:16,color:"#333"}}]};a.setOption(i)}a.hideLoading()}).catch(function(e){console.log("当前展示方式没有相关数据",e),t.$toast.open({duration:3e3,message:"当前展示方式没有相关数据",position:"is-top",type:"is-danger"}),a.hideLoading()})}}}},dL7g:function(t,e){},eHLS:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"待审批项目成本"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门",horizontal:""}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-select",{staticClass:"z-fuze-input",model:{value:t.userId,callback:function(e){t.userId=e},expression:"userId"}},t._l(t.contractDirector,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brands,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"title"},on:{input:t.getBrands,focus:t.getBrands,select:t.onBrandSelected},model:{value:t.brand_title,callback:function(e){t.brand_title=e},expression:"brand_title"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companies,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.partyName,callback:function(e){t.partyName=e},expression:"partyName"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},on:{focus:t.searchContractList,input:t.searchContractList},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"项目经理",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{focus:t.getCodeList,input:t.getCodeList,select:t.onChargenameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.cost_pm_name,callback:function(e){t.cost_pm_name=e},expression:"cost_pm_name"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL()}}},[t._v("导出")])])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.totalContracts))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"预估成本"}},[t._v("\n                    "+t._s(e.row.estimated_cost)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"实际成本"}},[t._v("\n                    "+t._s(e.row.actual_cost)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"estimated_cost",label:"发生金额"}},[t._v("\n                    "+t._s(e.row.financial_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("router-link",{staticClass:"button is-link",attrs:{to:"/pending_cost/"+e.row.contract_id}},[t._v("审批")])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e.row.contract_id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},elnl:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("NDp1"),s=n(i),r=a("0nZW"),o=n(r),c=a("1rcG"),l=n(c);e.default={props:{id:{default:null},isEdit:{type:Boolean,default:!1}},data:function(){return{newCompanyId:null,area:"native",logData:[],logColumns:[{field:"creation_time",label:"操作时间"},{field:"user_name",label:"用户"},{field:"info",label:"操作内容"}]}},computed:{companyId:function(){return this.id?this.id:this.newCompanyId?this.newCompanyId:null},pageTitle:function(){return this.isEdit?this.id?"编辑签约信息":"添加签约公司":"签约公司详情"}},components:{CompanyInfo:s.default,CompanyContactsList:o.default,CompanyInvoceList:l.default},created:function(){(this.id||this.newClientId)&&this.getCompanyLog()},methods:{onCompanySaved:function(t){this.newCompanyId=t},onAreaSelect:function(t){this.area=t},getCompanyLog:function(){var t=this;return this.ajax({url:"/signing_company/get_signing_company_log_union",loading:this.$loading.open(),params:{signing_company_id:this.id||this.newCompanyId}}).then(function(e){0===e.error_code&&(t.logData=e.data.list)})}}}},esL9:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"客户跟踪日志"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"录入时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{"min-date":t.enteredDateStart},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterClientLists,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"client_name"},on:{select:t.onCustomSelected},model:{value:t.clientListSelected,callback:function(e){t.clientListSelected=e},expression:"clientListSelected"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团名称"}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanySelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户类型"}},[a("b-select",{model:{value:t.clientType,callback:function(e){t.clientType=e},expression:"clientType"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title"},on:{select:t.onBrandSelected},model:{value:t.brandName,callback:function(e){t.brandName=e},expression:"brandName"}})],1),t._v(" "),a("referrer-name",{attrs:{isReferrer:t.is_referrer,referrerName:t.referrer_name},on:{getReferrer:t.getReferrer,getReferrerType:t.getReferrerType}}),t._v(" "),a("b-field",{attrs:{label:"信息来源"}},[a("b-select",{model:{value:t.infoType,callback:function(e){t.infoType=e},expression:"infoType"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("电话")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("聊天工具")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("拜访")])])],1),t._v(" "),a("b-field",{attrs:{label:"我方会见人"}},[a("b-autocomplete",{model:{value:t.meetPeople,callback:function(e){t.meetPeople=e},expression:"meetPeople"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),t.hasPermission("crm_new.kehu.xiansuo.daochu")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL(!1)}}},[t._v("导出")]):t._e()])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))])]),t._v(" "),a("b-table",{ref:"result",staticClass:"z-table z-scaling-list",attrs:{data:t.questList,striped:!0,loading:t.loading,"backend-sorting":"","default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"沟通或拜访时间",width:"150",field:"visited_date",sortable:""}},[t._v("\n                    "+t._s(e.row.visited_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",width:"100",field:"client_name",sortable:""}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户推荐人",width:"100",field:"referrer_name"}},[t._v("\n                    "+t._s(e.row.referrer_name||"无")+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"我方会见人",width:"100",field:"visit_users"}},[t._v("\n                    "+t._s(e.row.visit_users)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户会见人-职位",width:"110",field:"visited_client_users"}},[t._v("\n                    "+t._s(e.row.visited_client_users.replace(/\&/g,"\n"))+"\n                ")]),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{label:"会议沟通计划",width:"100",field:"result"}},[a("div",{ref:"result_"+e.row.id,staticClass:"resultbox",attrs:{id:"result_"+e.row.id}},[t._v(t._s(e.row.meeting_plan))]),t._v(" "),e.row.zk?a("div",{staticClass:"clickBtn",attrs:{id:"btn_result_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"result")}}},[t._v("展开")]):t._e()]),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{label:"沟通要点、结论及反馈意见",width:"280",field:"conclusion"}},[a("div",{ref:"conclusion_"+e.row.id,staticClass:"resultbox",attrs:{id:"conclusion_"+e.row.id}},[t._l(e.row.conclusion,function(e,n){return[a("p",[a("strong",[t._v(t._s(n+1)+"、   ")]),t._v(t._s(e.content))])]})],2),t._v(" "),e.row.ck?a("div",{staticClass:"clickBtn",attrs:{id:"btn_conclusion_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"conclusion")}}},[t._v("展开")]):t._e()]),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{label:"待解决问题及计划",width:"120",field:"core_problem"}},[a("div",{ref:"core_problem_"+e.row.id,staticClass:"resultbox",attrs:{id:"core_problem_"+e.row.id}},[t._l(e.row.problem_action,function(e,n){return[a("p",[a("strong",[t._v(t._s(n+1)+"、   ")]),t._v(t._s(e.content))])]})],2),t._v(" "),e.row.pk?a("div",{staticClass:"clickBtn",attrs:{id:"btn_core_problem_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"core_problem")}}},[t._v("展开")]):t._e()]),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"100"}},[t.hasPermission("crm_new.kehu.list.read")?a("router-link",{staticClass:"button is-link",attrs:{to:"/clients/"+e.row.client_id+"?activeTab=2"}},[t._v("查看")]):t._e(),t._v(" "),t.hasPermission("crm_new.kehu.xiansuo.shanchu")?a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.deleteSale(e.row.id,e.row)}}},[t._v("删除")]):t._e()],1)]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},ev1a:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"发布额查询"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门"}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.department_id,callback:function(e){t.department_id=e},expression:"department_id"}},t._l(t.departments,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人"}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.user_name,callback:function(e){t.user_name=e},expression:"user_name"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companies,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方单位"}},[a("b-select",{model:{value:t.party_b_name,callback:function(e){t.party_b_name=e},expression:"party_b_name"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("cooperation-select",{attrs:{releaseType:1,cooperationType:t.cooperation_type,hardWideDetailType:t.hard_wide_detail_type},on:{hasCooperation:t.getCooperation}}),t._v(" "),a("b-field",{attrs:{label:"行业"}},[a("div",{staticClass:"z-level"},[a("b-select",{staticClass:"select-inline",on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{staticClass:"select-inline",model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):t._e()],1)]),t._v(" "),a("select-date",{attrs:{clickReset:t.clickReset,el:t.el,clickBtn:t.clickBtn},on:{selectDate:t.getDate}}),t._v(" "),a("b-field",{attrs:{label:"集团名称"}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClients,focus:t.getClients,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户类型"}},[a("b-select",{model:{value:t.client_type_id,callback:function(e){t.client_type_id=e},expression:"client_type_id"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"事业部"}},[a("b-select",{model:{value:t.business_id,callback:function(e){t.business_id=e},expression:"business_id"}},t._l(t.BUSINESS,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"媒体-版位"}},[a("div",{staticClass:"z-media"},[t._l(t.mediaSelectList,function(e,n){return a("div",{key:n,staticStyle:{display:"inline-block",height:"28px","line-height":"28px","margin-bottom":"4px","box-sizing":"border-box","margin-left":"10px"}},[a("span",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.mediaName))]),t._v("    \n                            "),a("span",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.positionName))]),t._v(" "),a("a",{staticClass:"button is-primary",staticStyle:{"margin-left":"2px"},on:{click:function(e){t.onDelPosition(n)}}},[t._v("删除")])])}),t._v(" "),a("div",{staticStyle:{display:"inline-block"}},[a("b-autocomplete",{staticClass:"z-inline-input",attrs:{data:t.filteredMediaDataArray,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"a_name"},on:{select:t.onMediaSelected},model:{value:t.search_media_name,callback:function(e){t.search_media_name=e},expression:"search_media_name"}}),t._v(" "),a("b-autocomplete",{staticClass:"z-inline-input",attrs:{data:t.filteredPositionDataArray,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"z_name",require:""},on:{select:t.onPositionSelected},model:{value:t.search_position_name,callback:function(e){t.search_position_name=e},expression:"search_position_name"}}),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.onAddPosition}},[t._v("添加")])],1)],2)]),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"查询类别：发布额  "}},[a("div",{staticClass:"block"})]),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"扣减成本:  "}},[a("div",{staticClass:"block"},[a("b-checkbox",{attrs:{"native-value":"0"},model:{value:t.rebate,callback:function(e){t.rebate=e},expression:"rebate"}},[t._v("\n                            返点\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"1"},model:{value:t.contract_cost,callback:function(e){t.contract_cost=e},expression:"contract_cost"}},[t._v("\n                            项目成本1\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"2"},model:{value:t.contract_cost1,callback:function(e){t.contract_cost1=e},expression:"contract_cost1"}},[t._v("\n                            项目成本2\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"3"},model:{value:t.contract_cost2,callback:function(e){t.contract_cost2=e},expression:"contract_cost2"}},[t._v("\n                            项目成本3\n                        ")])],1)]),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"展示方式："}},[a("div",{staticClass:"block"},[a("b-radio",{attrs:{"native-value":"2"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            部门汇总\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"3"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            商务汇总\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"4"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            甲方签约公司\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"5"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            品牌汇总\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"6"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            事业部汇总\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"7"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            事业部汇总+软性合作方式\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"8"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            行业汇总\n                        ")])],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportAll}},[t._v("导出")])])],1)]),t._v(" "),a("div",{key:t.perPage,staticClass:"z-block z-listbox z-listbox-releases"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalRelease},[t._v("行数："+t._s(t.totalRelease))])]),t._v(" "),t.create?a("b-table",{directives:[{name:"show",rawName:"v-show",value:t.totalRelease,expression:"totalRelease"}],staticClass:"z-table-clients z-scaling-list z-scaling-releases",attrs:{data:t.release,paginated:!t.isPaginated,"per-page":t.perPage,"current-page":t.currentPage,"pagination-simple":t.isPaginationSimple,"default-sort-direction":t.defaultSortDirection,"default-sort":"user.first_name"},on:{"update:currentPage":function(e){t.currentPage=e}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                    "+t._s(e.row[n.name])+"\n                ")])})}}])},[t.isPaginated?a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalRelease,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)]):t._e()],2):t._e()],1)])},staticRenderFns:[]}},"f6+o":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=n(i),r=a("lHA8"),o=n(r),c=a("c/Tr"),l=n(c),d=a("LZT1"),u=n(d),_=a("Km5v"),p=n(_),m=a("uzIf"),h=n(m),f=a("mbDd"),v=n(f),b=a("O4Lo"),g=n(b),y=a("XLwt"),C=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e.default=t,e}(y);a("Vb+l"),a("4UDB"),a("GbHy"),a("Oq2I"),a("miEh"),a("YsUA");var k=function(t){var e="",a=t.length,n=Math.ceil(a/7);if(a>7)for(var i=0;i<n;i++){var s="",r=7*i,o=r+7;s=i===n-1?t.substring(r,a):t.substring(r,o)+"\n",e+=s}else e=t;return e};e.default={props:{page:{type:Number,default:null}},data:function(){return{RELEASE:v.default.RELEASE,PIELIST:v.default.PIELIST,BARLIST:v.default.BARLIST,RELEASELIST:v.default.RELEASELIST,departmentLevel:"2",companies:[],signingCompany:"",signingCompanyId:"",companyName:"",isFetching:!1,companyList:[],clientList:[],clientId:"",clientName:"",departments:[],contractDirector:[],create:!1,table_label:[],total:[],user_id:"",user_name:"",department_id:621,business_id:"",BUSINESS:[],el:null,ifserch:!1,clickBtn:!1,start_time:null,end_time:null,search_time_by:"month",client_type_id:null,show:1,showType:{1:"3",2:"0",3:"0"},showClick:1,showChart:"",pieShow:!1,barShow:!1,percent:!1,title:"",picShow:!0,party_b_name:"",release:[],isPaginated:!1,defaultSortDirection:"asc",sortField:"field_合计",sortOrder:"asc",totalRelease:0,loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,forSearch:!0,cPage:1,tPage:1,cooperation_type:"",cooperation_obj:null,hard_wide_detail_type:null,levelData:[],level:null,contract_brand_id:"",contract_second_brand_id:"",mediaData:[],useMediaData:[],positionData:[],usePositionData:[],search_media_id:"",search_media_name:"",search_position_id:"",search_position_name:"",mediaSelectList:[],departmentReadonly:!1,isHeader:!1,userReadonly:!1,departmentName:null,clickGet:0,clickReset:0}},components:{SelectDate:h.default,CooperationSelect:p.default},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.user_name.toLowerCase())>=0})},filteredMediaDataArray:function(){var t=this;return this.search_media_name?this.mediaData.filter(function(e){return e.a_name.indexOf(t.search_media_name)>=0}):this.mediaData},filteredPositionDataArray:function(){var t=this;return this.search_position_name?this.usePositionData.filter(function(e){return e.z_name.indexOf(t.search_position_name)>=0}):this.usePositionData},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},watch:{currPage:function(t){var e=!1;e=!(this.clickReset>this.clickGet),"2"!==this.show&&(this.el=1,this.ifserch=e,this.clickBtn=this.clickBtn,this.getRelease(1,e))},department_id:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.user_id=null,this.user_name="",this.getDirector({department_id:t}))},departmentLevel:function(){this.getBarEcharts()},show:function(t){2===Number(t)?(this.showChart=3,this.barShow=!0,this.pieShow=!1,this.title=1===this.cPage?"发布额TOP"+10*this.cPage:"发布额TOP"+(10*(this.cPage-1)+1)+"—"+10*this.cPage,this.getBarEcharts()):3===Number(t)?this.getNewRelease():this.getLineEcharts()},picShow:function(t){3===Number(this.show)&&this.getNewRelease()},percent:function(t){2===Number(this.show)&&(this.title="发布额TOP",this.getBarEcharts())},cPage:function(){this.barShow&&(this.title="发布额TOP",this.getBarEcharts())}},mounted:function(){this.getDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getRelease(null,!1);var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()};var e=document.getElementsByClassName("z-echarts-title")[0].clientWidth||document.getElementsByClassName("z-echarts-title")[1].clientWidth||document.getElementsByClassName("z-block-title")[0].clientWidth;document.getElementById("bar").style.width=e+"px",document.getElementById("line").style.width=e+"px";var a=C.init(document.getElementById("line")),n=C.init(document.getElementById("bar"));setTimeout(function(){window.onresize=function(){e=document.getElementsByClassName("z-echarts-title")[0].clientWidth||document.getElementsByClassName("z-echarts-title")[1].clientWidth||document.getElementsByClassName("z-block-title")[0].clientWidth,document.getElementById("bar").style.width=e+"px",document.getElementById("line").style.width=e+"px",console.log(e),n.resize(),a.resize()}},200)},created:function(){this.getCompany(),this.getLevel(),this.getMediaPosition(),this.getAllDepartment()},methods:{onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getNewRelease()},getAllDepartment:function(){var t=this;return this.ajax({url:"/business/index",params:{level:2}}).then(function(e){var a=(0,u.default)(e.data);t.BUSINESS=a,t.BUSINESS.unshift("")})},getPieEcharts:function(t){var e=this;t=t||this.getPostData(),t.show_chart=this.showChart;var a=C.init(document.getElementById("pie"));a.showLoading(),this.ajax({loading:this.$loading.open(),url:"/pie_chart/index",data:t,method:"post"}).then(function(t){if(0!==t.error_code)document.getElementById("pie").style.display="none";else{document.getElementById("pie").style.display="block";var e=t.data.data,n=t.data.item,i={title:{left:"center",top:20,textStyle:{color:"#ccc"}},legend:{type:"scroll",orient:"vertical",right:0,y:"center",data:n,selectedMode:!1,formatter:function(t){for(var a=void 0,n=void 0,i=0,s=0;s<e.length;s++)i+=Number(e[s].value),e[s].name===t&&(a=Number(e[s].source_value),n=Number(e[s].value));return["{b|"+t+"}","{a|"+a+"万元}","{c|"+(n/i*100).toFixed(2)+"%}"].join(" ")},textStyle:{rich:{a:{fontSize:16,color:"#EA5504",padding:10},b:{fontSize:14,color:"#333"},c:{fontSize:12,color:"#f00"}}}},tooltip:{trigger:"item",formatter:function(t,e,a){return console.log(t),t.seriesName+"<br/>"+t.data.name+": "+t.data.value+"万元 （"+t.percent+"%）"}},series:[{name:"访问来源",type:"pie",radius:"65%",data:e,center:["30%","50%"],label:{show:!0,position:"outside",formatter:"{d}%",fontWeight:"bold",fontSize:16,color:"#333"}}]};a.setOption(i)}a.hideLoading()}).catch(function(t){console.log("当前展示方式没有相关数据",t),e.$toast.open({duration:3e3,message:"当前展示方式没有相关数据",position:"is-top",type:"is-danger"}),a.hideLoading()})},getLineEcharts:function(t){var e=this;t=t||this.getPostData();var a=document.getElementsByClassName("z-echarts-title")[0].clientWidth||document.getElementsByClassName("z-echarts-title")[1].clientWidth||document.getElementsByClassName("z-block-title")[0].clientWidth;document.getElementById("line").style.width=a+"px";var n=C.init(document.getElementById("line"));n.showLoading(),this.ajax({loading:this.$loading.open(),url:"/contract_release_search_by_es/trend",data:t,method:"post"}).then(function(t){if(0!==t.error_code)document.getElementById("line").style.display="none";else{document.getElementById("line").style.display="block";var e=t.data.time,a=t.data.value,i={xAxis:{type:"category",data:e,axisLabel:{interval:"auto"},axisLine:{lineStyle:{color:"#555"}}},yAxis:{type:"value",name:"单位（万元）",nameTextStyle:{color:"#333"},axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#eee",type:"dotted"}}},tooltip:{show:!0,trigger:"axis",position:"top",formatter:"{b}<br />{c}"},series:[{data:a,type:"line",smooth:!0,symbol:"circle",symbolSize:6,label:{show:a.length<=24,color:"#333"},lineStyle:{color:"#ff5151"}}]};n.setOption(i)}n.hideLoading()}).catch(function(t){console.log("当前展示方式没有相关数据",t),e.$toast.open({duration:3e3,message:"当前展示方式没有相关数据",position:"is-top",type:"is-danger"}),n.hideLoading()})},getBarEcharts:function(t){var e=this;if(t=t||this.getPostData(),t.first_level=this.showChart,3===Number(this.showChart)){var a="1"===this.departmentLevel?"565,630,632,1498,1499,1500,1504,1509,1511,1522":"-1";t.department_level_ids=a}t.is_format=Number(this.percent),t.page=this.cPage,t.size=10;var n=document.getElementsByClassName("z-echarts-title")[0].clientWidth||document.getElementsByClassName("z-echarts-title")[1].clientWidth||document.getElementsByClassName("z-block-title")[0].clientWidth;document.getElementById("bar").style.width=n+"px";var i=C.init(document.getElementById("bar"));i.showLoading(),this.ajax({loading:this.$loading.open(),url:"/contract_release_search_by_es/olumnar",data:t,method:"post"}).then(function(t){if(0!==t.error_code)document.getElementById("bar").style.display="none",e.cPage=1,e.tPage=1;else{document.getElementById("bar").style.display="block";var a=t.data.lists.name,n=t.data.lists.value;e.tPage=Math.ceil(t.data.counts/10),t.data.counts<10*e.cPage?e.title=1===e.cPage?"发布额TOP"+10*e.cPage:"发布额TOP"+(10*(e.cPage-1)+1)+"—"+t.data.counts:e.title=1===e.cPage?"发布额TOP"+10*e.cPage:"发布额TOP"+(10*(e.cPage-1)+1)+"—"+10*e.cPage;var s=e.percent?"单位（%）":"单位（万元）";i.setOption({tooltip:{},xAxis:{data:a,axisLabel:{interval:0,formatter:k},axisLine:{lineStyle:{color:"#555"}}},yAxis:{name:s,nameTextStyle:{color:"#333"},axisLine:{lineStyle:{color:"#aaa"}},splitLine:{lineStyle:{color:"#eee",type:"dotted"}}},series:[{name:"发布额",type:"bar",data:n,label:{show:!0,position:"top",color:"#333"},itemStyle:{color:"#FF5151"},barWidth:50}]})}i.hideLoading()}).catch(function(t){console.log("当前展示方式没有相关数据",t),e.$toast.open({duration:3e3,message:"当前展示方式没有相关数据",position:"is-top",type:"is-danger"}),i.hideLoading()})},addSelect:function(){this.showClick+=1},delSelect:function(){this.showType[this.showClick]=0,this.showClick-=1,this.getNewRelease()},onSelectedShow:function(t){this.getNewRelease()},onSelectedChart:function(t){this.pieShow=[8,9,11,12,13].indexOf(Number(this.showChart))>-1,this.barShow=[1,2,3,4,5,6,7,10,14].indexOf(Number(this.showChart))>-1,this.cPage=1,this.pieShow&&(this.title=this.PIELIST[this.showChart]+"分布",this.getPieEcharts()),this.barShow&&(this.title="发布额TOP",this.getBarEcharts())},clickPage:function(t){"prev"===t&&this.cPage>1&&(this.cPage-=1),"next"===t&&this.cPage<this.tPage&&(this.cPage+=1)},getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name)},searchCompany:(0,g.default)(function(){this.isFetching=!0,this.getCompanies()},500),getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.signingCompany}}).then(function(e){t.companies=e.data.lists,t.isFetching=!1})},onCompanySelected:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},onUserSelected:function(t){t&&(this.user_id=t.id)},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},onDelPosition:function(t){this.mediaSelectList.splice(t,1)},onAddPosition:function(){this.search_media_id?(this.mediaSelectList.push({mediaId:this.search_media_id,mediaName:this.search_media_name,positionId:this.search_position_id?this.search_position_id:this.getPositionWithMediaId(this.search_media_id),positionName:this.search_position_name}),this.search_media_id=null,this.search_media_name=null,this.search_position_id=null,this.search_position_name=null,this.usePositionData=[]):alert("媒体不能为空")},getPositionWithMediaId:function(t){for(var e=0;e<this.mediaData.length;e++)if(this.mediaData[e].a_id===t)return this.mediaData[e].zone.map(function(t){return t.z_id}).join(",");return""},onMediaSelected:function(t){if(t){this.search_media_id=t.a_id,this.search_media_name=t.a_name;for(var e=0;e<this.mediaData.length;e++)this.mediaData[e].a_id===t.a_id&&(this.mediaData[e].zone&&this.mediaData[e].zone.length>0?this.usePositionData=this.mediaData[e].zone:this.usePositionData=[]);this.search_position_name=null,this.search_position_id=null}},onPositionSelected:function(t){t&&(this.search_position_id=t.z_id,this.search_position_name=t.z_name)},getMediaPosition:function(){var t=this;return this.ajax({url:"/api/contract_ad/get_media_position_lists"}).then(function(e){t.mediaData=e.data,t.useMediaData=t.mediaData})},getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")},onSelectCooperationType:function(){this.hard_wide_detail_type=""},getPostData:function(){var t="";t=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";for(var e=[],a=0;a<this.mediaSelectList.length;a++)e=e.concat(this.mediaSelectList[a].positionId.split(","));e=(0,l.default)(new o.default(e));var n={search_time_by:this.search_time_by,start_time:this.start_time,end_time:this.end_time,user_id:this.user_id,department_id:this.department_id,business_id:this.business_id,party_b_name:this.party_b_name,cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type,contract_brand_id:t,position_ids:e,client_type_id:this.client_type_id,client_name:this.clientName,company_name:this.signingCompany,group_name:this.companyName,show:this.show.toString()};return n=this.delNullParam(n)},getRelease:function(t,e){var a=this;this.create=!1,this.loading=!0,this.el=t;var n=this.getPostData();new s.default(function(t,i){a.isShangwu()?e?t():(a.contractDirector=[],1===a.$root.crmUser.is_headman?(a.isHeader=!0,t()):(a.isHeader=!1,a.departmentReadonly=!0,a.userReadonly=!0,a.contractDirector=[{name:a.$root.crmUser.username,id:a.$root.crmUser.id}],a.userName=a.$root.crmUser.name,a.user_id=a.$root.crmUser.id,n.user_id=a.$root.crmUser.id,a.departmentId=a.$root.crmUser.department_id,n.departmentId=a.$root.crmUser.department_id,a.departmentName=a.$root.crmUser.department_name,t())):t()}).then(function(){1===Number(a.show)?a.getLineEcharts(n):2===Number(a.show)?a.pieShow?a.getPieEcharts(n):(a.title="发布额TOP",a.getBarEcharts(n)):a.getNewRelease(n)})},delNullParam:function(t){for(var e in t)null!==t[e]&&void 0!==t[e]||delete t[e];return t},getNewRelease:function(t){var e=this;t=t||this.getPostData(),t.first_level=this.showType[1],t.second_level=this.showType[2],t.third_level=this.showType[3],t.is_format=Number(!this.picShow),t.page=this.currPage,t.size=this.perPage,t.order=this.sortOrder,this.ajax({url:"/contract_release_search_by_es/index",loading:this.$loading.open(),method:"post",data:t}).then(function(t){e.table_label=[],e.release=[],e.processData(t),e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},exportAll:function(){var t=this,e=this.getPostData();e.first_level=this.showType[1],e.second_level=this.showType[2],e.third_level=this.showType[3],e.is_format=Number(!this.picShow),this.ajax({url:"/contract_release_search_by_es/export",method:"post",data:e}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:1===a.error_code&&e.exportLive(t)})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/get_children_by_pid",params:{pid:"629,621,1499"}}).then(function(e){if(0===e.error_code){var a=(0,u.default)(e.data);t.departments=a,!t.isHeader&&t.isShangwu()||t.getDirector({department_id:621})}})},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id",method:"post",data:t}).then(function(t){0===t.error_code&&t.data&&t.data.rows?e.contractDirector=t.data.rows:e.contractDirector=[]})},resetParams:function(){this.contractDirector.length>1&&(this.user_id=null),!this.isHeader&&this.isShangwu()||(this.department_id="",this.user_id="",this.user_name=""),this.clientId=null,this.clientName=null,this.signingCompany="",this.signingCompanyId="",this.start_time=null,this.end_time=null,this.search_time_by="month",this.party_b_name="",this.cooperation_type="",this.hard_wide_detail_type="",this.contract_brand_id="",this.contract_second_brand_id="",this.usePositionData=[],this.level=null,this.search_media_id="",this.search_media_name="",this.search_position_id="",this.search_position_name="",this.mediaSelectList=[],this.clickReset=this.clickGet,this.clickReset+=1,this.el=null,this.client_type_id=null,this.companyName="",this.business_id=""},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?(this.el=1,this.ifserch=t,this.clickBtn=!this.clickBtn):this.currPage=1,this.clickGet+=1},childData:function(t){var e=[],a={};if(t.length>0)for(var n=0;n<t.length;n++)a=t[n].business_compute,a["部门名称"]=t[n].business_name[0],a.child=this.childData(t[n].child),e.push(a);return e},processData:function(t){this.loading=!0;var e=[],a={},n=[],i=void 0,s=void 0;if(t.data.counts>0){for(var r=0;r<t.data.lists.length;r++){a=t.data.lists[r].business_compute;for(var o=0,c=0;c<t.data.lists[r].business_name.length;c++)Number(this.showType[c+2])===Number(this.showType[c+1])?o=c+2:o+=1,a[this.RELEASELIST[this.showType[o]]]=t.data.lists[r].business_name[c];t.data.lists[r].child&&(a.child=this.childData(t.data.lists[r].child)),e.push(a)}for(i in e[0])if("合计"===i)n.unshift({name:i});else{if("child"===i)continue;n.push({name:i})}for(var l=0;l<t.data.lists[0].business_name.length;l++){var d=n.pop();n.unshift(d)}}s=t.data.counts,this.totalRelease=s,this.totalPage=Math.ceil(s/this.perPage),0===this.totalPage&&(this.totalPage=1),1!==this.currPage&&this.currPage!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+this.currPage):1===this.currPage&&this.$router.push(this.$router.currentRoute.path),"2"!==this.show.toString()&&this.totalPage>1&&(this.isPaginated=!0),this.release=e,this.table_label=n,this.$forceUpdate(),this.create=!0},getCooperation:function(t,e){if(this.cooperation_obj=t,this.cooperation_type=this.cooperation_obj.cooperation_type,e)this.hard_wide_detail_type=e;else{var a=[];this.cooperation_obj.level&&this.cooperation_obj.level.length?(this.cooperation_obj.level.map(function(t){a.push(t.id)}),this.hard_wide_detail_type=a.join(",")):this.hard_wide_detail_type=e}},getDate:function(t,e,a,n){this.start_time=t,this.end_time=e,this.search_time_by=n,1===this.el&&this.getRelease(this.el,this.ifserch)}}}},"fZ/S":function(t,e){},fhg8:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("woOf"),o=n(r),c=a("//Fk"),l=n(c),d=a("LZT1"),u=n(d),_=a("O4Lo"),p=n(_);e.default={name:"FinancialApprove",data:function(){return{companyName:"",companyList:[],FinancialStatus:{0:"待核准",1:"已核准"},estimated_start_time:null,estimated_end_time:null,isHeader:!1,isFetching:!1,isFetching_2:!1,isFetching_3:!1,departments:[],loading:!1,contracts:[],sum:{actual_details_sum:"",actual_cost_sum:"",estimated_cost_sum:""},departmentId:"",departmentName:null,departmentReadonly:!1,userId:"",userName:"",users:[],contractDirector:[],userReadonly:!1,clientList:[],clientId:"",clientName:"",brandId:"",brands:[],brand_title:"",companies:[],signingCompany:"",signingCompanyId:"",contractName:"",contractNumber:"",contractNumberList:[],contractNames:[],partyName:"",totalContracts:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,isChecked:!0,checkedRows:[],clickGet:0,clickReset:0,cost_pm_id:null,cost_pm_name:"",codeList:[],financialStatus:null,amounts:null,rateFiles:[],showLogModal:!1,logData:[],logColumns:[{field:"updated_user",label:"审核人"},{field:"approve_status",label:"审核状态"},{field:"approve_step",label:"审核步骤"},{field:"updated_date",label:"审核时间"}]}},watch:{currPage:function(){var t=!1;t=!(this.clickReset>this.clickGet),this.getCostList(t)},page:function(t){this.currPage=t||1},departmentId:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.userId=null,this.getDirector({department_id:t}))}},created:function(){this.getCompany(),this.getDepartment(),this.getCostList()},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},methods:{getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name)},onUserSelected:function(t){t&&(this.userId=t.id)},isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:t}).then(function(t){0===t.error_code&&t.data&&t.data.rows?e.contractDirector=t.data.rows:e.contractDirector=[]})},searchContract:(0,p.default)(function(){this.isFetching_2=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},searchCompany:(0,p.default)(function(){this.isFetching=!0,this.getCompanies()},500),getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.signingCompany}}).then(function(e){t.companies=e.data.lists,t.isFetching=!1})},searchContractList:(0,p.default)(function(){this.isFetching_3=!0,this.getContractList()},500),getContractList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},onCompanySelected:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list",params:{title:this.brand_title,user_id:Number(this.userId)}}).then(function(e){t.brands=e.data})},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brand_title=t.name)},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?this.getCostList(t):this.currPage=1,this.clickGet+=1},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.cost_pm_name,role_code:"role-crm-xiangmujingli",use_swzc:0}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},onChargenameSelected:function(t){t&&(this.cost_pm_id=t.id)},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,u.default)(e.data);t.departments=a})},makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},getCostList:function(t){var e=this,a={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,contract_number:this.contractNumber,contract_name:this.contractName,party_b_name:this.partyName,cost_pm_id:this.cost_pm_id,financial_approval_status:this.financialStatus,group_name:this.companyName,estimated_start_time:this.makeStringDate(this.estimated_start_time),estimated_end_time:this.makeStringDate(this.estimated_end_time),page:this.currPage,page_size:this.perPage};console.log(11,a),this.loading=!0,new l.default(function(a,n){e.isShangwu()?t?a():(e.contractDirector=[],1===e.$root.crmUser.is_headman?(e.isHeader=!0,a()):(e.isRole(e.ROLE.shangwuzhichi)?console.log("shangwuzhichi"):(e.isHeader=!1,e.departmentReadonly=!0,e.userReadonly=!0,e.contractDirector=[{name:e.$root.crmUser.username,id:e.$root.crmUser.id}],e.userName=e.$root.crmUser.name,e.userId=e.$root.crmUser.id,e.departmentId=e.$root.crmUser.department_id,e.departmentName=e.$root.crmUser.department_name),a())):a()}).then(function(){e.urlParams=(0,o.default)({},a),e.ajax({url:"/contract_cost/ContractCostApprovalList",params:a}).then(function(t){e.checkedRows=[],e.totalContracts=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1),e.contracts=t.data.lists,e.sum=t.data.sum,e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})})},doContract:function(){var t=[];return this.checkedRows.forEach(function(e){t.push(e.contract_id)}),t.join(",")},resetParams:function(){this.checkedRows=[],this.contractDirector.length>1&&(this.userId=null),(this.isHeader||!this.isShangwu()||this.isRole(this.ROLE.shangwuzhichi))&&(this.departmentId="",this.userId="",this.userName=""),this.clientId=null,this.clientName=null,this.brands=[],this.brand_title="",this.brandId="",this.signingCompany="",this.signingCompanyId="",this.contractNumber="",this.contractName="",this.partyName=null,this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1,this.cost_pm_id=null,this.cost_pm_name="",this.financialStatus=null,this.rateFiles=[],this.companyName="",this.estimated_start_time=null,this.estimated_end_time=null},checkAllApprove:function(){var t=this;return this.ajax({url:"/contract_cost/canCostBatchApproval",method:"post"}).then(function(e){0===e.error_code&&t.submitAllApprove()})},submitAllApprove:function(){var t=this;this.$dialog.confirm({message:"确认进行批量核准吗？",onConfirm:function(){t.ajax({loading:t.$loading.open(),url:"/contract_cost/costBatchApproval",method:"post"}).then(function(t){0===t.error_code&&window.location.reload()})}})},submitApprove:function(t){var e=this,a=[];return t&&a.push({contract_id:t.contract_id,actual_time:t.actual_time}),this.ajax({url:"/contract_cost/costApproval",method:"post",data:{cost_approval:(0,s.default)(a)}}).then(function(t){e.$toast.open({duration:3e3,message:"操作成功",position:"is-top",type:"is-success"}),window.location.reload()})},importFile:function(){var t=this;if(0===this.rateFiles.length)return this.$refs.rateFiles.checkHtml5Validity(),void this.$dialog.alert("请选择文件");var e=this.rateFiles;if(!/\.(xls|xlsx)$/.test(e.name))return void this.$dialog.alert("请选择后缀为 .xls 或 .xlsx 的文件");this.ajax({url:"/contract_cost/approvelExcel",method:"post",successTip:!0,loading:this.$loading.open(),headers:{"Content-Type":"multipart/form-data"},data:{filename:e}}).then(function(e){0===e.error_code&&(t.getCostList(),window.location.reload())})},exportALL:function(){var t=this,e={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,contract_number:this.contractNumber,contract_name:this.contractName,party_b_name:this.partyName,cost_pm_id:this.cost_pm_id,contract_ids:this.doContract(),financial_approval_status:this.financialStatus,group_name:this.companyName,estimated_start_time:this.makeStringDate(this.estimated_start_time),estimated_end_time:this.makeStringDate(this.estimated_end_time),page:this.currPage,page_size:this.perPage};this.ajax({url:"/contract_cost/exportContractCostApprovalList",params:e}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},showClientLog:function(t){var e=this;this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/contract/get_contract_approve_log",params:{contract_id:t,type:5}}).then(function(t){0===t.error_code&&(e.logData=t.data)})}}}},fzpa:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-field",{attrs:{label:"客户推荐人"}},[a("div",{staticClass:"z-referrer"},[a("b-select",{staticClass:"select-inline",model:{value:t.is_referrer,callback:function(e){t.is_referrer=e},expression:"is_referrer"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("有")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("无")])]),t._v(" "),1===Number(t.is_referrer)?a("b-autocomplete",{staticClass:"select-inline",attrs:{"keep-first":!1,"open-on-focus":!0,data:t.filterReferrerName},on:{select:t.onSelectedReferrer},model:{value:t.referrer_name,callback:function(e){t.referrer_name=e},expression:"referrer_name"}}):t._e()],1)])},staticRenderFns:[]}},gGIh:function(t,e){},gKdn:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-visit-list"},[a("button",{staticClass:"button is-primary",on:{click:t.addVisit}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1),t._v(" "),t.visitList.length?a("b-table",{attrs:{data:t.visitList,bordered:t.isBorder,"opened-detailed":t.defaultOpenedDetails,"detail-key":"id",detailed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"沟通或拜访时间",width:"120"}},[e.row.isEdit?a("b-field",[a("b-datepicker",{ref:"visitedDate_"+e.index,attrs:{"max-date":new Date,icon:"calendar-today",required:""},model:{value:e.row.visited_date,callback:function(a){t.$set(e.row,"visited_date",a)},expression:"props.row.visited_date"}})],1):[t._v("\n                    "+t._s(t.zDateFormatter(e.row.visited_date))+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"沟通方式",width:"80"}},[a("b-field",[a("b-select",{attrs:{disabled:!e.row.isEdit},model:{value:e.row.visit_type,callback:function(a){t.$set(e.row,"visit_type",a)},expression:"props.row.visit_type"}},[a("option",{attrs:{value:"1"}},[t._v("电话")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("聊天工具")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("拜访")])])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"地点",width:"80"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{expanded:"",type:"textarea",maxlength:"500"},model:{value:e.row.address,callback:function(a){t.$set(e.row,"address",a)},expression:"props.row.address"}})],1):[t._v("\n                    "+t._s(e.row.address)+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"我方会见人",width:"100"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"visitedUsers_"+e.index,attrs:{expanded:"",required:"",type:"textarea",maxlength:"500"},model:{value:e.row.visit_users,callback:function(a){t.$set(e.row,"visit_users",a)},expression:"props.row.visit_users"}})],1):[t._v("\n                    "+t._s(e.row.visit_users)+"\n                ")]],2),t._v(" "),e.row.visited_client_users_new?a("b-table-column",{attrs:{label:"客户会见人-职位",width:"160"}},[t._l(e.row.visited_client_users_new,function(n){return e.row.isEdit?[a("b-field",{staticClass:"visitLen"},[a("b-input",{ref:"clientVisitedUsers_name_"+e.index,refInFor:!0,attrs:{expanded:"",required:"",type:"text",maxlength:"20"},model:{value:n.name,callback:function(e){t.$set(n,"name",e)},expression:"item.name"}})],1),t._v(" "),a("span",{staticStyle:{float:"left"}},[t._v("-")]),t._v(" "),a("b-field",{staticClass:"visitLen"},[a("b-input",{ref:"clientVisitedUsers_position_"+e.index,refInFor:!0,attrs:{expanded:"",required:"",type:"text",maxlength:"20"},model:{value:n.position,callback:function(e){t.$set(n,"position",e)},expression:"item.position"}})],1)]:t._e()}),t._v(" "),e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.addVisitUser(e.row.visited_client_users_new)}}},[a("b-icon",{attrs:{icon:"plus"}})],1):t._l(e.row.visited_client_users_new,function(e){return a("div",[t._v("\n                        "+t._s(e.name)+"\n                        "),""!==e.position?a("span",[t._v("-")]):t._e(),t._v("\n                        "+t._s(e.position)+"\n                    ")])})],2):a("b-table-column",{attrs:{label:"客户会见人",width:"100"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"clientVisitedUsers_"+e.index,attrs:{expanded:"",required:"",type:"textarea",maxlength:"500"},model:{value:e.row.visited_client_users,callback:function(a){t.$set(e.row,"visited_client_users",a)},expression:"props.row.visited_client_users"}})],1):[t._v("\n                    "+t._s(e.row.visited_client_users)+"\n                ")]],2),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{label:"会议沟通计划",width:"200"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{expanded:"",type:"textarea",maxlength:"500"},model:{value:e.row.meeting_plan,callback:function(a){t.$set(e.row,"meeting_plan",a)},expression:"props.row.meeting_plan"}})],1):[a("div",{ref:"result_"+e.row.id,staticClass:"resultbox",attrs:{id:"result_"+e.row.id}},[t._v(t._s(e.row.meeting_plan))]),t._v(" "),e.row.zk&&!e.row.isEdit?a("div",{staticClass:"clickBtn",attrs:{id:"btn_result_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"result")}}},[t._v("展开")]):t._e()]],2),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{label:"沟通要点、结论及反馈意见",width:"200"}},[e.row.isEdit?[t._l(e.row.conclusion,function(e,n){return a("b-field",{key:n},[a("strong",[t._v(t._s(n+1)+"、   ")]),t._v(" "),a("b-input",{attrs:{expanded:"",type:"textarea",maxlength:"500"},model:{value:e.content,callback:function(a){t.$set(e,"content",a)},expression:"item.content"}})],1)}),t._v(" "),e.row.conclusion.length<10?a("button",{staticClass:"button is-primary",on:{click:function(a){t.addConclusion(e.row.conclusion)}}},[a("b-icon",{attrs:{icon:"plus"}})],1):t._e()]:a("div",{ref:"conclusion_"+e.row.id,staticClass:"resultbox",attrs:{id:"conclusion_"+e.row.id}},[t._l(e.row.conclusion,function(e,n){return[a("p",[a("strong",[t._v(t._s(n+1)+"、   ")]),t._v(t._s(e.content))])]})],2),t._v(" "),e.row.ck&&!e.row.isEdit?a("div",{staticClass:"clickBtn",attrs:{id:"btn_conclusion_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"conclusion")}}},[t._v("展开")]):t._e()],2),t._v(" "),a("b-table-column",{staticClass:"z-block-result",attrs:{label:"待解决问题及计划",width:"200"}},[e.row.isEdit?[t._l(e.row.problem_action,function(e,n){return a("b-field",{key:n},[a("strong",[t._v(t._s(n+1)+"、   ")]),t._v(" "),a("b-input",{attrs:{expanded:"",type:"textarea",maxlength:"500"},model:{value:e.content,callback:function(a){t.$set(e,"content",a)},expression:"item.content"}})],1)}),t._v(" "),e.row.problem_action.length<10?a("button",{staticClass:"button is-primary",on:{click:function(a){t.addProblem(e.row.problem_action)}}},[a("b-icon",{attrs:{icon:"plus"}})],1):t._e()]:a("div",{ref:"core_problem_"+e.row.id,staticClass:"resultbox",attrs:{id:"core_problem_"+e.row.id}},[t._l(e.row.problem_action,function(e,n){return[a("p",[a("strong",[t._v(t._s(n+1)+"、   ")]),t._v(t._s(e.content))])]})],2),t._v(" "),e.row.pk&&!e.row.isEdit?a("div",{staticClass:"clickBtn",attrs:{id:"btn_core_problem_"+e.row.id},on:{click:function(a){t.clickFn(a,e.row.id,"core_problem")}}},[t._v("展开")]):t._e()],2),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveVisit(e.index)}}},[t._v("保存")]):a("button",{staticClass:"button is-link",on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")]),t._v(" "),a("button",{directives:[{name:"show",rawName:"v-show",value:!e.row.isNew&&t.crm_auth,expression:"!props.row.isNew && crm_auth"}],staticClass:"button is-link",on:{click:function(a){t.clickComment(e.row)}}},[t._v("批注")]),t._v(" "),e.row.isEdit&&!e.row.id?a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteVisit(e.index)}}},[t._v("删除")]):t._e()])]}},{key:"detail",fn:function(e){return[e.row.comments&&e.row.comments.length?a("ul",{staticClass:"comments-list"},t._l(e.row.comments,function(e,n){return a("li",[a("div",{staticClass:"list-box"},[a("div",{staticClass:"comment-info"},[a("span",[t._v(t._s(e.create_time))]),t._v(" "),a("span",[a("b",[t._v(t._s(e.name))]),t._v(" :")])]),t._v(" "),a("p",[t._v(t._s(e.content))]),t._v(" "),0!=e.reply.length||e.isRequest?t._e():a("button",{staticClass:"button is-primary",on:{click:function(a){t.requestFn(e)}}},[t._v("回复")])]),t._v(" "),e.reply.length>0?a("div",{staticClass:"list-box"},[a("div",{staticClass:"comment-info"},[a("span",[t._v(t._s(e.reply_time))]),t._v(" "),a("span",[a("b",[t._v(t._s(e.reply_username)+" 回复")]),t._v(" :")])]),t._v(" "),a("p",[t._v(t._s(e.reply))])]):t._e(),t._v(" "),e.isRequest?a("b-field",{staticClass:"comment-box",attrs:{horizontal:"",expanded:""}},[a("b-input",{ref:"reqComment_"+n,refInFor:!0,attrs:{maxlength:"500",type:"textarea",required:""},model:{value:e.reqComment,callback:function(a){t.$set(e,"reqComment",a)},expression:"item.reqComment"}}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(a){t.requestComment(e,n)}}},[t._v("回复")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(a){t.requestCancle(e)}}},[t._v("取消")])],1):t._e()],1)})):t._e(),t._v(" "),e.row.isShow?a("b-field",{staticClass:"comment-box",staticStyle:{width:"40rem"},attrs:{horizontal:"",expanded:""}},[a("b-input",{ref:"newComment_"+e.index,attrs:{maxlength:"500",type:"textarea",required:""},model:{value:e.row.newComment,callback:function(a){t.$set(e.row,"newComment",a)},expression:"props.row.newComment"}})],1):t._e(),t._v(" "),e.row.isShow?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveComment(e.row,e.index)}}},[t._v("添加批注")]):t._e(),t._v(" "),e.row.isShow?a("button",{staticClass:"button is-primary",on:{click:function(t){e.row.isShow=!1}}},[t._v("取消")]):t._e()]}}])}):t._e()],1)},staticRenderFns:[]}},ghZm:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("//Fk"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={data:function(){return{visited_client_backlog_list:[],visited_client_backlog_total:0,visited_client_backlog_currPage:1,visited_client_backlog_perPage:10,visited_client_backlog_totalPage:1,visited_client_backlog_jumpPage:1,visited_client_backlog_show:!0,expire_backlog_list:[],expire_backlog_show:!0,expire_backlog_total:0,expire_backlog_currPage:1,expire_backlog_perPage:10,expire_backlog_totalPage:1,expire_backlog_jumpPage:1,overdue_backlog_list:[],overdue_backlog_show:!0,overdue_backlog_total:0,overdue_backlog_currPage:1,overdue_backlog_perPage:10,overdue_backlog_totalPage:1,overdue_backlog_jumpPage:1,not_backlog_list:[],not_backlog_show:!0,not_backlog_total:0,not_backlog_currPage:1,not_backlog_perPage:10,not_backlog_totalPage:1,not_backlog_jumpPage:1,client_backlog_list:[],client_backlog_show:!1,client_backlog_total:0,client_backlog_currPage:1,client_backlog_perPage:10,client_backlog_totalPage:1,client_backlog_jumpPage:1,sign_company_backlog_list:[],sign_company_backlog_show:!1,sign_company_backlog_total:0,sign_company_backlog_currPage:1,sign_company_backlog_perPage:10,sign_company_backlog_totalPage:1,sign_company_backlog_jumpPage:1,client_level_list:[],client_level_show:!0,client_level_total:0,client_level_currPage:1,client_level_totalPage:1,client_level_perPage:10,client_level_jumpPage:1}},watch:{expire_backlog_currPage:function(t){this.getExpireBacklog(t)},overdue_backlog_currPage:function(t){this.getOverdueBacklog(t)},not_backlog_currPage:function(t){this.getNotBacklog(t)},client_backlog_currPage:function(t){this.getClientBacklog(t)},sign_company_backlog_currPage:function(t){this.getSignCompanyBacklog(t)},visited_client_backlog_currPage:function(t){this.getVisitedBacklog(t)},client_level_currPage:function(t){this.getClientLevel(t)}},created:function(){this.getExpireBacklog(),this.getOverdueBacklog(),this.getNotBacklog(),this.getClientBacklog(),this.getSignCompanyBacklog(),this.getClientLevel(),this.getVisitedBacklog()},methods:{getExpireBacklog:function(t){var e=this;return Number(t)||(t=1,this.expire_backlog_currPage=1),this.ajax({url:"/backlog/get_business_contract_expire_backlog",params:{page:t,page_size:this.expire_backlog_perPage}}).then(function(t){0===t.error_code&&(e.expire_backlog_show=!0,e.expire_backlog_list=t.data.list,e.expire_backlog_total=t.data.total||0,e.expire_backlog_totalPage=Math.ceil(t.data.total/e.expire_backlog_perPage),0===e.expire_backlog_totalPage&&(e.expire_backlog_totalPage=1))})},getOverdueBacklog:function(t){var e=this;return Number(t)||(t=1,this.overdue_backlog_currPage=1),this.ajax({url:"/backlog/get_business_contract_overdue_backlog",params:{page:t,page_size:this.overdue_backlog_perPage}}).then(function(t){0===t.error_code&&(e.overdue_backlog_show=!0,e.overdue_backlog_list=t.data.list,e.overdue_backlog_total=t.data.total||0,e.overdue_backlog_totalPage=Math.ceil(t.data.total/e.overdue_backlog_perPage),0===e.overdue_backlog_totalPage&&(e.overdue_backlog_totalPage=1))})},getNotBacklog:function(t){var e=this;return Number(t)||(t=1,this.not_backlog_currPage=1),this.ajax({url:"/backlog/get_business_contract_not_signed_backlog",params:{page:t,page_size:this.not_backlog_perPage}}).then(function(t){0===t.error_code&&(e.not_backlog_show=!0,e.not_backlog_list=t.data.list,e.not_backlog_total=t.data.total||0,e.not_backlog_totalPage=Math.ceil(t.data.total/e.not_backlog_perPage),0===e.not_backlog_totalPage&&(e.not_backlog_totalPage=1))})},getClientBacklog:function(t){var e=this;return Number(t)||(t=1,this.client_backlog_currPage=1),this.ajax({url:"/backlog/get_business_client_backlog",params:{page:t,page_size:this.client_backlog_perPage}}).then(function(t){0===t.error_code&&(e.client_backlog_show=!0,e.client_backlog_list=t.data.list,e.client_backlog_total=t.data.count||0,e.client_backlog_totalPage=Math.ceil(t.data.count/e.client_backlog_perPage),0===e.client_backlog_totalPage&&(e.client_backlog_totalPage=1))})},getSignCompanyBacklog:function(t){var e=this;return Number(t)||(t=1,this.sign_company_backlog_currPage=1),this.ajax({url:"/backlog/get_business_sign_company_backlog",params:{page:t,page_size:this.sign_company_backlog_perPage}}).then(function(t){0===t.error_code&&(e.sign_company_backlog_show=!0,e.sign_company_backlog_list=t.data.list,e.sign_company_backlog_total=t.data.total||0,e.sign_company_backlog_totalPage=Math.ceil(t.data.total/e.sign_company_backlog_perPage),0===e.sign_company_backlog_totalPage&&(e.sign_company_backlog_totalPage=1))})},getVisitedBacklog:function(t){var e=this;return Number(t)||(t=1,this.visited_client_backlog_currPage=1),this.ajax({url:"/backlog/get_client_visited_backlog",params:{page:t,page_size:this.visited_client_backlog_perPage}}).then(function(t){0===t.error_code&&(e.visited_client_backlog_show=!0,e.visited_client_backlog_list=t.data.lists,e.visited_client_backlog_total=t.data.total||0,e.visited_client_backlog_totalPage=Math.ceil(t.data.total/e.visited_client_backlog_perPage),0===e.visited_client_backlog_totalPage&&(e.visited_client_backlog_totalPage=1))})},getClientLevel:function(t){var e=this;return Number(t)||(t=1,this.client_level_currPage=1),this.ajax({url:"/backlog/get_change_client_level",params:{page:t,page_size:this.client_level_perPage}}).then(function(t){0===t.error_code&&(e.client_level_show=!0,e.client_level_list=t.data.lists,e.client_level_total=t.data.total||0,e.client_level_totalPage=Math.ceil(t.data.total/e.client_level_perPage),0===e.client_level_totalPage&&(e.client_level_totalPage=1))})},deleteList:function(t,e,a,n){var i=this;return this.ajax({url:"/backlog/read_client_visited_backlog",method:"post",data:{postil_id:e,type:a}}).then(function(e){0===e.error_code&&(i.visited_client_backlog_list.splice(t,1),i.$router.push("/clients/"+n+"?activeTab=2"),window.location.reload())})},expirePageHandle:function(t){this.expire_backlog_currPage=t},overduePageHandle:function(t){this.overdue_backlog_currPage=t},notbackPageHandle:function(t){this.not_backlog_currPage=t},clientPageHandle:function(t){this.client_backlog_currPage=t},signCompanyPageHandle:function(t){this.sign_company_backlog_currPage=t},visitedPageHandle:function(t){this.visited_client_backlog_currPage=t},clientLevelPageHandle:function(t){this.client_level_currPage=t},publicExport:function(t){var e=this,a=(new Date).getTime(),n=function t(n){return new i.default(function(i,s){e.ajax({url:"/export/is_live",method:"post",data:{file_path:n.data.file_path,file_name:n.data.file_name}}).then(function(i){if(0===i.error_code){var s=document.createElement("a");s.style="display: none",s.download=n.data.file_name+".xlsx",s.href=n.data.file_path,document.body.appendChild(s),s.click(),s.remove()}else{if(!((new Date).getTime()-a<1e4))return console.log("失败"),e.$toast.open({duration:5e3,message:"生成文件失败，请重新操作！",position:"is-top",type:"is-danger"}),!1;setTimeout(t(n),2e3)}})})};(function(){return new i.default(function(a,n){e.ajax({url:t}).then(function(t){a(t)})})})().then(function(t){n(t)})},expireExport:function(){this.publicExport("/backlog/get_business_contract_expire_backlog_export")},overdueExport:function(){this.publicExport("/backlog/get_business_contract_overdue_backlog_export")}}}},"h/Zm":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("span",[a("b",[t._v("品牌：")]),t._v(t._s(t.headInfo.title))]),t._v(" "),a("span",[a("b",[t._v("产品线：")]),t._v(t._s(t.headInfo.product_line_name))]),t._v(" "),a("span",[a("b",[t._v("客户名称：")]),t._v(t._s(t.headInfo.client_name))]),t._v(" "),a("span",[a("b",[t._v("客户类型：")]),t._v(t._s(t.CLIENT_TYPES[t.headInfo.client_type]))]),t._v(" "),a("span",[a("b",[t._v("商务负责人：")]),t._v(t._s(t.headInfo.user_name))]),t._v(" "),a("span",[a("b",[t._v("所属部门：")]),t._v(t._s(t.headInfo.department_name))])]),t._v(" "),a("div",{staticClass:"z-block-title z-table-head"},[a("span",[a("b",[t._v("总共发布额（RMB）：")]),t._v(t._s(t.headInfo.amount))]),t._v(" "),a("span",[a("b",[t._v("总应收回款（RMB）：")]),t._v(t._s(t.headInfo.receivable_balance))]),t._v(" "),a("span",[a("b",[t._v("总已收回款（RMB）：")]),t._v(t._s(t.headInfo.receivabled_balance))]),t._v(" "),t._l(6,function(t){return a("span",{key:"key_"+t})}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.exportALL}},[t._v("导出")])],2),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.degreesList},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"季度",field:"balance_date"}},[t._v("\n                "+t._s(e.row.balance_date)+"\n            ")]),t._v(" "),a("b-table-column",{attrs:{label:"信誉等级",field:"degree"}},[0===e.row.degree?a("span",[t._v("待评级")]):t._l(e.row.degree,function(t){return a("span",{key:"icon_"+t,staticClass:"icon"})})],2),t._v(" "),a("b-table-column",{attrs:{label:"本季发布额",field:"amount"}},[t._v("\n                "+t._s(e.row.amount)+"\n            ")]),t._v(" "),a("b-table-column",{attrs:{label:"本季回款",field:"collection_amount"}},[t._v("\n                "+t._s(e.row.collection_amount)+"\n            ")]),t._v(" "),a("b-table-column",{attrs:{label:"本季合作频次",field:"frequency"}},[t._v("\n                "+t._s(e.row.frequency)+"\n            ")]),t._v(" "),a("b-table-column",{attrs:{label:"本季合作类型",field:"season_type"}},[t._v("\n                "+t._s(e.row.season_type)+"\n            ")])]}}])})],1)},staticRenderFns:[]}},hJOm:function(t,e){},hoQN:function(t,e,a){a("U9Mp");var n=a("VU/8")(a("U8UC"),a("bnbK"),"data-v-117a2f7c",null);t.exports=n.exports},"i+rZ":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{show:!1}}}},iNgt:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"客户加分"}},[a("div",{staticClass:"degrees-view z-block"},[a("b-field",{staticClass:"search-input",attrs:{label:"客户名称：",horizontal:""}},[a("b-autocomplete",{attrs:{data:t.filterClientLists,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"client_name"},on:{select:t.onClientSelected},model:{value:t.clientListId,callback:function(e){t.clientListId=e},expression:"clientListId"}}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.checkDegrees}},[t._v("查询")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.resetName}},[t._v("重置")])],1)],1),t._v(" "),a("div",{staticClass:"z-block"},[t.degreesList.length?a("b-table",{staticClass:"degrees-list",staticStyle:{width:"750px"},attrs:{data:t.degreesList,striped:!0,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder],bordered:t.isBorder},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"客户名称",width:"260"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户加分",field:"manual_bonus",width:"260",sortable:""}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{expanded:"",type:"text"},model:{value:e.row.manual_bonus,callback:function(a){t.$set(e.row,"manual_bonus",a)},expression:"props.row.manual_bonus"}})],1):a("b-field",[t._v(t._s(e.row.manual_bonus))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"260"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveDegrees(e.row)}}},[t._v("保存")]):t._e(),t._v(" "),e.row.isEdit?a("button",{staticClass:"button is-link",on:{click:function(a){t.checkStatus(e.row,1)}}},[t._v("取消")]):a("button",{staticClass:"button is-primary",on:{click:function(a){t.checkStatus(e.row)}}},[t._v("编辑加分")])]),t._v(" "),a("b-table-column",{attrs:{label:"操作日志",width:"200"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showLog(e.row.id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2):t._e()],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[t.logData.length?a("b-table",{attrs:{data:t.logData},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"操作人",width:"60"}},[a("b-field",[t._v(t._s(e.row.updated_user))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作内容",width:"260"}},[a("b-field",[t._v(t._s(e.row.reason))])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作时间",width:"160"}},[a("b-field",[t._v(t._s(e.row.updated_date))])],1)]}}])}):t._e()],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},iRk6:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["contactName","contactMobilePhone"];e.default={props:["clientId","clientStatus","isAdd","isEdit"],data:function(){return{contacts:[],hand:0}},created:function(){this.clientId&&this.getContacts()},methods:{getContacts:function(){var t=this;return this.ajax({url:"/client_contact/get_client_contact_by_client_id",params:{client_id:this.clientId}}).then(function(e){t.contacts=t.formatContactData(e.data.list||[]),t.contacts.length||t.addContact()})},formatContactData:function(t){return t.map(function(t){return t.isEdit=!1,t.fieldType="",t.fieldMessage="",t.birthday=t.birthday?new Date(t.birthday):null,t})},contactDataValidate:function(t){var e=this,a=[];return console.log(t),n.forEach(function(n){var i=e.$refs[n+"_"+t];console.log(i),i.checkHtml5Validity&&(i.checkHtml5Validity()||a.push(i))}),!a.length||(a[0].focus(),!1)},saveContact:function(t){var e=this;if(this.contactDataValidate(t)){var a=this.contacts[t];if(!(a.tel||a.qq||a.wechat||a.mobile_phone))return this.$toast.open({duration:3e3,message:"手机号码/电话号码/QQ号/微信号 至少填一个",position:"is-top",type:"is-danger"}),0;var n=void 0!==a.client_contact_id,i={contact_name:a.contact_name,job_position:a.job_position,level:a.level,mobile_phone:a.mobile_phone,tel:a.tel,fax:a.fax,wechat:a.wechat,qq:a.qq,birthday:a.birthday&&this.zDateFormatter(a.birthday),hobbies:a.hobbies,remarks:a.remarks,client_id:this.clientId},s="/client_contact/add_submit_client_contact";return n&&(s="/client_contact/update_submit_client_contact",i.client_contact_id=a.client_contact_id),this.ajax({method:"post",url:s,data:i}).then(function(t){0===t.error_code&&(a.isEdit=!1,n||(a.client_contact_id=t.data.client_contact_id),e.$toast.open({duration:5e3,message:"保存成功",position:"is-top",type:"is-success"}))})}},addContact:function(){this.contacts.push({isEdit:!0,fieldType:"",fieldMessage:"",contact_name:"",job_position:"",level:"",mobile_phone:"",tel:"",wechat:"",qq:"",fax:"",birthday:null,hobbies:"",remarks:"",client_id:this.clientId})},deleteContact:function(t,e){var a=this;e.client_contact_id?this.$dialog.confirm({message:"确定要删除此联系人吗？",onConfirm:function(){return a.ajax({url:"/client_contact/delete_client_contact",params:{client_contact_id:e.client_contact_id}}).then(function(e){0===e.error_code&&a.contacts.splice(t,1)})}}):this.contacts.splice(t,1)},checkContactDuplicate:function(t,e){if(t.mobile_phone){if(!/^^[0-9]{5,20}$/.test(t.mobile_phone))return t.fieldType="is-danger",t.fieldMessage="请输入5-20位手机号码！",!1;for(var a=0,n=this.contacts.length;a<n;a++)if(e!==a&&t.mobile_phone.trim()===this.contacts[a].mobile_phone)return console.log(a,this.contacts[a]),t.fieldType="is-danger",t.fieldMessage="该联系人已存在！",!1;t.fieldType=""}},checkPhone:function(t){if(!/^1[34578]\d{9}$/.test(t))return alert("手机号码有误，请重填"),!1},saveSubmit:function(){var t=this;if(this.contacts.length>0){var e="";this.contacts.forEach(function(t){t.isEdit&&(e=!0)}),console.log("flag",e),e?this.$toast.open({duration:3e3,message:"还有未保存的联系人信息，请先保存。",type:"is-danger"}):this.ajax({url:"/client/change_submit_client",method:"post",data:{client_id:this.clientId,hand:1}}).then(function(e){0===e.error_code&&(t.$router.push("/clients/"),window.location.reload())})}else this.$toast.open({duration:3e3,message:"请添加一条有效联系人信息",type:"is-danger"})}}}},iePj:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-scaling"},[t.isPreContract?a("pre-contracts-view",{attrs:{id:t.id,isEdit:t.isEdit,signedStatusNoShow:t.signedStatusNoShow,fromContract:!0,isChange:t.contract.isChange,changeList:t.contract.changeList,user_code:t.user_code}}):a("page-container",{attrs:{pageTitle:"合同"}},[t.dataReady?[a("b-field",{staticClass:"columns z-contracts-top",attrs:{grouped:""}},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同类型"}},[a("b-select",{attrs:{disabled:!t.isEdit,required:""},on:{input:function(e){t.isClick=!0}},model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},[a("option",{attrs:{value:"1"}},[t._v("CPS")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("年框")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("CPS对账单")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("平台服务费")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("CPS预估合同")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("CPS结算合同")]),t._v(" "),a("option",{attrs:{value:"9"}},[t._v("阿里微任务")])])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同编号"}},[a("b-input",{attrs:{readonly:"readonly",required:""},model:{value:t.contract.contract_number,callback:function(e){t.$set(t.contract,"contract_number",e)},expression:"contract.contract_number"}})],1),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同基础信息")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同名称"}},[a("b-input",{ref:"contractName",attrs:{maxlength:"30",readonly:!t.isEdit,required:""},model:{value:t.contract.contract_name,callback:function(e){t.$set(t.contract,"contract_name",e)},expression:"contract.contract_name"}})],1),t._v(" "),"1"===t.contract.contract_type_id?a("b-field",{key:5,staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联年框合同"}},[t.isEdit?a("b-autocomplete",{attrs:{data:t.contracts,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"contract_number"},on:{input:t.searchContracts,select:t.onContractsSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.contract_number)+" "+t._s(e.option.contract_name))]}}]),model:{value:t.contract_msg,callback:function(e){t.contract_msg=e},expression:"contract_msg"}}):a("div",{staticClass:"z-field-text clickLink",on:{click:t.routePush}},[t._v(t._s(t.contract.join_contract_number))])],1):t._e(),t._v(" "),"7"===t.contract.contract_type_id?a("b-field",{key:6,staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联预估合同"}},[t.isEdit?a("b-autocomplete",{attrs:{data:t.contracts,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"contract_number",required:""},on:{input:t.searchContracts,select:t.onContractsSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.contract_number)+" "+t._s(e.option.contract_name))]}}]),model:{value:t.contract_msg,callback:function(e){t.contract_msg=e},expression:"contract_msg"}}):a("b-input",{attrs:{readonly:!t.isEdit,required:""},model:{value:t.contract.join_contract_number,callback:function(e){t.$set(t.contract,"join_contract_number",e)},expression:"contract.join_contract_number"}})],1):t._e(),t._v(" "),["4","5","6","9"].indexOf(t.contract.contract_type_id)>-1?a("b-field",{key:7,staticClass:"column",attrs:{horizontal:"",expanded:"",label:"关联CPS合同"}},[t.isEdit?a("b-autocomplete",{ref:"contractJoin",attrs:{data:t.contracts,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"contract_number",required:!(t.isEdit&&"9"===t.contract.contract_type_id)},on:{input:t.searchContracts,select:t.onContractsSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.contract_number)+" "+t._s(e.option.contract_name))]}}]),model:{value:t.contract_msg,callback:function(e){t.contract_msg=e},expression:"contract_msg"}}):a("div",{staticClass:"z-field-text clickLink",on:{click:t.routePush}},[t._v(t._s(t.contract.join_contract_number))])],1):t._e(),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同品类"}},[a("b-select",{ref:"contract_brand_id",attrs:{disabled:!t.isEdit,required:""},on:{input:t.onSelectLevel},model:{value:t.contract.contract_brand_id,callback:function(e){t.$set(t.contract,"contract_brand_id",e)},expression:"contract.contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                    "+t._s(e.val)+"\n                                ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{ref:"contract_second_brand_id",attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract.contract_second_brand_id,callback:function(e){t.$set(t.contract,"contract_second_brand_id",e)},expression:"contract.contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                    "+t._s(e.val)+"\n                                ")])})):t._e()],1),t._v(" "),0===t.contractTypeId||"0"===t.contractTypeId||"3"===t.contract.contract_type_id?a("div",{staticClass:"column"}):t._e()],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同负责人"}},[t.isEdit&&0!==t.contractTypeId&&"4"!==t.contract.contract_type_id&&"6"!==t.contract.contract_type_id&&"7"!==t.contract.contract_type_id?a("b-autocomplete",{ref:"contractCharge",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching1,field:"name"},on:{input:t.searchChargename,select:t.onChargenameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.charge_userName,callback:function(e){t.charge_userName=e},expression:"charge_userName"}}):a("b-input",{ref:"contractCharge",attrs:{readonly:!t.isEdit,required:""},model:{value:t.contract.contract_charge_name,callback:function(e){t.$set(t.contract,"contract_charge_name",e)},expression:"contract.contract_charge_name"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"所属部门"}},[t.isEdit?a("b-input",{ref:"contractParentDepartment",attrs:{disabled:""},model:{value:t.contract.parent_department_name,callback:function(e){t.$set(t.contract,"parent_department_name",e)},expression:"contract.parent_department_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.parent_department_name))])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"业务组"}},[t.isEdit?a("b-input",{ref:"contractDepartment",attrs:{disabled:""},model:{value:t.contract.department_name,callback:function(e){t.$set(t.contract,"department_name",e)},expression:"contract.department_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.department_name))])],1)],1),t._v(" "),3!==Number(t.contractTypeId)?a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户名称"}},[t.isEdit?a("b-autocomplete",{ref:"id",attrs:{data:t.filteredClients,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name",required:""},on:{select:t.onClientsSelected},model:{value:t.contractClientName,callback:function(e){t.contractClientName=e},expression:"contractClientName"}}):a("b-input",{ref:"contractClient",attrs:{readonly:"readonly",required:"",value:t.contract.client_name},model:{value:t.contract.client_name,callback:function(e){t.$set(t.contract,"client_name",e)},expression:"contract.client_name"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户类型"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_type_name))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"品牌"}},[a("b-input",{ref:"contractBrand",attrs:{readonly:!t.isEdit,value:t.contract.brand,required:""}})],1)],1):a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司类型"}},[a("b-select",{ref:"signingCompanyTypeId",attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract.signing_company_type_id,callback:function(e){t.$set(t.contract,"signing_company_type_id",e)},expression:"contract.signing_company_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("直客")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("代理")])])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户名称"}},[t.isEdit?a("b-autocomplete",{ref:"id",attrs:{data:t.filteredClients,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name",required:1!==Number(t.contract.signing_company_type_id)},on:{select:t.onClientsSelected},model:{value:t.contractClientName,callback:function(e){t.contractClientName=e},expression:"contractClientName"}}):a("b-input",{ref:"contractClient",attrs:{readonly:"readonly",required:"",value:t.contract.client_name},model:{value:t.contract.client_name,callback:function(e){t.$set(t.contract,"client_name",e)},expression:"contract.client_name"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户类型"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_type_name))])])],1),t._v(" "),3!==Number(t.contractTypeId)?a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司"}},[t.isEdit?a("b-autocomplete",{ref:"contractSigningCompany",attrs:{data:t.companyes,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching2,field:"company_name",required:""},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.contract.signing_company_name,callback:function(e){t.$set(t.contract,"signing_company_name",e)},expression:"contract.signing_company_name"}}):a("b-input",{attrs:{readonly:!t.isEdit,required:""},model:{value:t.contract.signing_company_name,callback:function(e){t.$set(t.contract,"signing_company_name",e)},expression:"contract.signing_company_name"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司类型"}},[a("b-select",{ref:"signingCompanyTypeId",attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract.signing_company_type_id,callback:function(e){t.$set(t.contract,"signing_company_type_id",e)},expression:"contract.signing_company_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("直客")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("代理")])])],1),t._v(" "),"9"!==t.contract.contract_type_id&&"3"!==t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合作方式"}},[a("b-input",{attrs:{readonly:"readonly",value:"CPS",required:""}})],1):t._e(),t._v(" "),"3"===t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合作方式"}},[a("b-select",{ref:"cooperationMode",attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract.cooperation_mode,callback:function(e){t.$set(t.contract,"cooperation_mode",e)},expression:"contract.cooperation_mode"}},[a("option",{attrs:{value:"15"}},[t._v("框架")]),t._v(" "),a("option",{attrs:{value:"14"}},[t._v("MP")])])],1):t._e()],1):a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"品牌"}},[a("b-input",{ref:"contractBrand",attrs:{readonly:!t.isEdit,value:t.contract.brand,required:1!==Number(t.contract.signing_company_type_id)}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"甲方签约公司"}},[t.isEdit?a("b-autocomplete",{ref:"contractSigningCompany",attrs:{data:t.companyes,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching2,field:"company_name",required:""},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.contract.signing_company_name,callback:function(e){t.$set(t.contract,"signing_company_name",e)},expression:"contract.signing_company_name"}}):a("b-input",{attrs:{readonly:!t.isEdit,required:""},model:{value:t.contract.signing_company_name,callback:function(e){t.$set(t.contract,"signing_company_name",e)},expression:"contract.signing_company_name"}})],1),t._v(" "),"9"!==t.contract.contract_type_id&&"3"!==t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合作方式"}},[a("b-input",{attrs:{readonly:"readonly",value:"CPS",required:""}})],1):t._e(),t._v(" "),"3"===t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合作方式"}},[a("b-select",{ref:"cooperationMode",attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract.cooperation_mode,callback:function(e){t.$set(t.contract,"cooperation_mode",e)},expression:"contract.cooperation_mode"}},[a("option",{attrs:{value:"15"}},[t._v("框架")]),t._v(" "),a("option",{attrs:{value:"14"}},[t._v("MP")])])],1):t._e()],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"乙方签约公司"}},[a("b-select",{ref:"partyBName",attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract.party_b_name,callback:function(e){t.$set(t.contract,"party_b_name",e)},expression:"contract.party_b_name"}},[a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),"6"===t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估时间"}},[a("b-datepicker",{ref:"emstimate_date",attrs:{disabled:!t.isEdit,"min-date":t.minYuguDate,message:t.emstimate_date_msg,icon:"calendar-today",required:""},on:{input:function(e){t.CHECK_ESTIMATE(!0)}},model:{value:t.emstimate_date,callback:function(e){t.emstimate_date=e},expression:"emstimate_date"}})],1):a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同有效期"}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{ref:"startDate",attrs:{"max-date":t.contract.endDate,disabled:!t.isEdit,required:""},model:{value:t.contract.startDate,callback:function(e){t.$set(t.contract,"startDate",e)},expression:"contract.startDate"}}),t._v("\n                                -\n                                "),a("b-datepicker",{ref:"endDate",attrs:{disabled:!t.isEdit,"min-date":t.contract.startDate,required:""},model:{value:t.contract.endDate,callback:function(e){t.$set(t.contract,"endDate",e)},expression:"contract.endDate"}})],1)]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户账期"}},[a("b-datepicker",{ref:"accountPeriod",attrs:{disabled:!t.isEdit,icon:"calendar-today",required:""},model:{value:t.contract.accountPeriod,callback:function(e){t.$set(t.contract,"accountPeriod",e)},expression:"contract.accountPeriod"}})],1)],1),t._v(" "),t.isEdit?a("div",{staticClass:"columns"},[t.isEdit?t._e():a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同录入人"}},[a("b-input",{attrs:{readonly:!t.isEdit,required:""},model:{value:t.contract.entered_user_name,callback:function(e){t.$set(t.contract,"entered_user_name",e)},expression:"contract.entered_user_name"}})],1),t._v(" "),t.isEdit&&void 0===t.id?a("b-field",{staticClass:"column",attrs:{horizontal:"",label:"备注"}},[a("b-input",{attrs:{readonly:!t.isEdit,expanded:"",maxlength:"200",required:""},model:{value:t.contract.remark_txt,callback:function(e){t.$set(t.contract,"remark_txt",e)},expression:"contract.remark_txt"}})],1):t._e(),t._v(" "),t.contract.client_relationship_name&&0===t.contractTypeId?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户关系"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_relationship_name))])]):a("div",{staticClass:"column"}),t._v(" "),t.isEdit?a("div",{staticClass:"column"}):t._e()],1):t._e(),t._v(" "),t.isEdit&&void 0===t.id?t._e():a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同成本1"}},[a("b-input",{ref:"contract_cost1",attrs:{disabled:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.contract_cost1,callback:function(e){t.$set(t.contract,"contract_cost1",e)},expression:"contract.contract_cost1"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同成本2"}},[a("b-input",{ref:"contract_cost2",attrs:{disabled:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.contract_cost2,callback:function(e){t.$set(t.contract,"contract_cost2",e)},expression:"contract.contract_cost2"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"返点"}},[a("b-input",{ref:"rebate",attrs:{disabled:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.rebate,callback:function(e){t.$set(t.contract,"rebate",e)},expression:"contract.rebate"}})],1),t._v(" "),t.contract.client_relationship_name&&0===t.contractTypeId?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"客户关系"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.contract.client_relationship_name))])]):t._e(),t._v(" "),[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{label:"客户首签",horizontal:"",expanded:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.IS_FIRST[t.contract.is_first_contract]))])]):t._e(),t._v(" "),[0,8].indexOf(Number(t.contract.contract_type_id))>-1?a("b-field",{staticClass:"column",attrs:{label:"品牌首签",horizontal:"",expanded:""}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(t.IS_FIRST[t.contract.is_first_brand]))])]):t._e()],1)])]),t._v(" "),void 0!==this.id||"3"===t.contract.contract_type_id?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同金额")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同金额"}},[a("b-input",{attrs:{readonly:!t.isEdit,min:"0",pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.contract_currency_amount,callback:function(e){t.$set(t.contract,"contract_currency_amount",e)},expression:"contract.contract_currency_amount"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同币种"}},[a("b-select",{ref:"contractCurrencyAamount",attrs:{required:""},model:{value:t.contract.contract_currency_type_id,callback:function(e){t.$set(t.contract,"contract_currency_type_id",e)},expression:"contract.contract_currency_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("人民币")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("美元")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("日元")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("欧元")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("英镑")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("韩国元")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("加拿大元")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("澳元")])])],1),t._v(" "),"3"!==t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"人民币金额"}},[a("b-input",{attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.amount,callback:function(e){t.$set(t.contract,"amount",e)},expression:"contract.amount"}})],1):a("div",{staticClass:"column"})],1)])]):t._e(),t._v(" "),"3"!==t.contract.contract_type_id&&"0"!==t.contract.contract_type_id?a("div",{key:8,staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同明细")])]),t._v(" "),t.detail.length||void 0===this.id?t._e():a("div",{staticClass:"z-block-title"},[a("h2",[t._v("无数据")])]),t._v(" "),t.detail.length?a("b-table",{staticClass:"z-mingxi",attrs:{data:t.detail,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"合同金额"}},[a("b-input",{ref:"currency_amount"+e.index,attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},on:{input:function(a){t.getRates(e.index,!1)}},model:{value:e.row.currency_amount,callback:function(a){t.$set(e.row,"currency_amount",a)},expression:"props.row.currency_amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"合同币种"}},[a("b-select",{ref:"currency_type_id"+e.index,attrs:{disabled:"disabled",required:""},on:{input:function(a){t.getRates(e.index,!1)}},model:{value:e.row.currency_type_id,callback:function(a){t.$set(e.row,"currency_type_id",a)},expression:"props.row.currency_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("人民币")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("美元")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("日元")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("欧元")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("英镑")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("韩国元")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("加拿大元")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("澳元")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"投放开始时间"}},[a("b-datepicker",{ref:"throw_start_date"+e.index,attrs:{"max-date":e.row.throw_end_date,disabled:!t.isEdit,required:""},on:{input:function(a){t.getRates(e.index,!0)}},model:{value:e.row.throw_start_date,callback:function(a){t.$set(e.row,"throw_start_date",a)},expression:"props.row.throw_start_date"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"投放截止时间"}},[a("b-datepicker",{ref:"throw_end_date"+e.index,attrs:{disabled:!t.isEdit,"min-date":e.row.throw_start_date,required:""},on:{input:function(a){t.changeEnd(e.index)}},model:{value:e.row.throw_end_date,callback:function(a){t.$set(e.row,"throw_end_date",a)},expression:"props.row.throw_end_date"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"人民币金额"}},[a("b-input",{ref:"rmb_amount"+e.index,attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:e.row.rmb_amount,callback:function(a){t.$set(e.row,"rmb_amount",a)},expression:"props.row.rmb_amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"汇率"}},[a("b-input",{ref:"currency_rate"+e.index,attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:e.row.currency_rate,callback:function(a){t.$set(e.row,"currency_rate",a)},expression:"props.row.currency_rate"}})],1),t._v(" "),t.isEdit?a("b-table-column",{key:21,attrs:{label:"操作"}},[0!==e.row.id?a("a",{key:e.index,staticClass:"button is-primary",on:{click:function(a){t.deleteDetail(e.index)}}},[t._v("删除")]):a("a",{staticClass:"button is-primary",on:{click:function(a){t.subDetail(e.index)}}},[t._v("删除")])]):t._e()]}}])}):t._e(),t._v(" "),t.toEdit||void 0===this.id?a("div",{key:15,staticClass:"z-block-content"},[a("div",{staticClass:"columns"},["6"===t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同金额"}},[a("b-input",{ref:"currency_amount",attrs:{readonly:!t.isEdit,min:"0",pattern:"\\d+(\\.\\d+)?",required:""},on:{input:t.countAmount},model:{value:t.contract.currency_amount,callback:function(e){t.$set(t.contract,"currency_amount",e)},expression:"contract.currency_amount"}})],1):a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同金额"}},[a("b-input",{ref:"currency_amount",attrs:{readonly:!t.isEdit,min:"0",pattern:"\\d+(\\.\\d+)?",required:""},on:{input:t.getRate},model:{value:t.contract.currency_amount,callback:function(e){t.$set(t.contract,"currency_amount",e)},expression:"contract.currency_amount"}})],1),t._v(" "),"6"===t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同币种"}},[a("b-select",{ref:"contractCurrencyAamount",attrs:{required:""},on:{input:function(e){t.CHECK_ESTIMATE(!1)}},model:{value:t.contract.currency_type_id,callback:function(e){t.$set(t.contract,"currency_type_id",e)},expression:"contract.currency_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("人民币")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("美元")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("日元")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("欧元")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("英镑")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("韩国元")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("加拿大元")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("澳元")])])],1):a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同币种"}},[a("b-select",{ref:"contractCurrencyAamount",attrs:{disabled:"7"===t.contract.contract_type_id,required:""},on:{input:t.getRate},model:{value:t.contract.currency_type_id,callback:function(e){t.$set(t.contract,"currency_type_id",e)},expression:"contract.currency_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("人民币")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("美元")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("日元")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("欧元")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("英镑")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("韩国元")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("加拿大元")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("澳元")])])],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"投放起止时间"}},[a("div",{staticClass:"z-datepickers"},["6"===t.contract.contract_type_id?a("b-datepicker",{ref:"throwStartDate",attrs:{readonly:"readonly","max-date":t.contract.throwEndDate,required:""},model:{value:t.contract.throwStartDate,callback:function(e){t.$set(t.contract,"throwStartDate",e)},expression:"contract.throwStartDate"}}):a("b-datepicker",{key:"12",ref:"throwStartDate",attrs:{readonly:!t.isEdit||"6"===t.contract.contract_type_id,"max-date":t.contract.throwEndDate,required:""},on:{input:t.getRate},model:{value:t.contract.throwStartDate,callback:function(e){t.$set(t.contract,"throwStartDate",e)},expression:"contract.throwStartDate"}}),t._v("\n                                -\n                                "),a("b-datepicker",{ref:"throwEndDate",attrs:{readonly:!t.isEdit||"6"===t.contract.contract_type_id,"min-date":t.contract.throwStartDate,required:""},model:{value:t.contract.throwEndDate,callback:function(e){t.$set(t.contract,"throwEndDate",e)},expression:"contract.throwEndDate"}})],1)])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"人民币金额"}},[a("b-input",{ref:"rmbAmount",attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.rmb_amount,callback:function(e){t.$set(t.contract,"rmb_amount",e)},expression:"contract.rmb_amount"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"汇率"}},[a("b-input",{ref:"currencyRate",attrs:{readonly:!t.isEdit||"6"===t.contract.contract_type_id,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:t.contract.currency_rate,callback:function(e){t.$set(t.contract,"currency_rate",e)},expression:"contract.currency_rate"}})],1),t._v(" "),"7"===t.contract.contract_type_id?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估合同金额"}},[a("b-input",{ref:"rmbAmount2",attrs:{readonly:"readonly",required:""},model:{value:t.contract.yuguAmount,callback:function(e){t.$set(t.contract,"yuguAmount",e)},expression:"contract.yuguAmount"}})],1):a("div",{staticClass:"column"})],1)]):t._e(),t._v(" "),void 0!==this.id&&t.isEdit?a("div",{staticClass:"z-block-title"},[a("button",{staticClass:"button is-primary",on:{click:t.addAmount}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1)]):t._e()],1):a("div",{key:9,staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("返点")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估返点比例"}},[a("b-input",{attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?"},model:{value:t.contract.ygfd_rate,callback:function(e){t.$set(t.contract,"ygfd_rate",e)},expression:"contract.ygfd_rate"}}),t._v("%\n                        ")],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估时间"}},[a("b-datepicker",{attrs:{disabled:!t.isEdit,icon:"calendar-today",required:""},model:{value:t.contract.emstimateDate,callback:function(e){t.$set(t.contract,"emstimateDate",e)},expression:"contract.emstimateDate"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"预估返点金额"}},[a("b-input",{attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?"},model:{value:t.contract.ygfd_amount,callback:function(e){t.$set(t.contract,"ygfd_amount",e)},expression:"contract.ygfd_amount"}})],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"确认返点比例"}},[a("b-input",{attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?"},model:{value:t.contract.qrfd_rate,callback:function(e){t.$set(t.contract,"qrfd_rate",e)},expression:"contract.qrfd_rate"}}),t._v("%\n                        ")],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"确认时间"}},[a("b-datepicker",{attrs:{disabled:!t.isEdit,icon:"calendar-today",required:""},model:{value:t.contract.enteredDate,callback:function(e){t.$set(t.contract,"enteredDate",e)},expression:"contract.enteredDate"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"确认返点金额"}},[a("b-input",{attrs:{readonly:!t.isEdit,pattern:"\\d+(\\.\\d+)?"},model:{value:t.contract.qrfd_amount,callback:function(e){t.$set(t.contract,"qrfd_amount",e)},expression:"contract.qrfd_amount"}})],1)],1),t._v(" "),void 0!==this.id?a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"回款总金额"}},[a("b-input",{attrs:{readonly:"readonly"},model:{value:t.contract.total_cash_collection_amount,callback:function(e){t.$set(t.contract,"total_cash_collection_amount",e)},expression:"contract.total_cash_collection_amount"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"回款抵扣返点金额"}},[a("b-input",{attrs:{readonly:"readonly"},model:{value:t.contract.hkdkfd_total_amount,callback:function(e){t.$set(t.contract,"hkdkfd_total_amount",e)},expression:"contract.hkdkfd_total_amount"}})],1),t._v(" "),a("div",{staticClass:"column"})],1):t._e()])]),t._v(" "),void 0!==t.id&&t.id.length?a("div",{staticClass:"z-block z-huikuan"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("回款管理")])]),t._v(" "),t.cash_collection.length||void 0===this.id?t._e():a("div",{staticClass:"z-block-title"},[a("h2",[t._v("无数据")])]),t._v(" "),t.cash_collection.length?a("b-table",{attrs:{data:t.cash_collection,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"交易时间"}},[a("b-datepicker",{ref:"cash_collection_date"+e.index,attrs:{icon:"calendar-today",disabled:0!==e.row.id,required:""},model:{value:e.row.cash_collection_date,callback:function(a){t.$set(e.row,"cash_collection_date",a)},expression:"props.row.cash_collection_date"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"确认时间"}},[a("b-datepicker",{ref:"confirm_date"+e.index,attrs:{icon:"calendar-today",disabled:0!==e.row.id,required:""},on:{input:function(a){t.getHuikuanRate(e.index)}},model:{value:e.row.confirm_date,callback:function(a){t.$set(e.row,"confirm_date",a)},expression:"props.row.confirm_date"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"币种"}},[a("b-select",{ref:"currency_id"+e.index,attrs:{disabled:0!==e.row.id,required:""},on:{input:function(a){t.getHuikuanRate(e.index)}},model:{value:e.row.currency_id,callback:function(a){t.$set(e.row,"currency_id",a)},expression:"props.row.currency_id"}},[a("option",{attrs:{value:"0"}},[t._v("人民币")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("美元")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("日元")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("欧元")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("英镑")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("韩国元")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("加拿大元")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("澳元")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"币种金额"}},[a("b-input",{ref:"current_amount"+e.index,attrs:{readonly:0!==e.row.id,pattern:"\\d+(\\.\\d+)?",required:""},on:{input:function(a){t.getHuikuanRate(e.index)}},model:{value:e.row.current_amount,callback:function(a){t.$set(e.row,"current_amount",a)},expression:"props.row.current_amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"人民币金额"}},[a("b-input",{ref:"amount"+e.index,attrs:{readonly:0!==e.row.id,pattern:"\\d+(\\.\\d+)?",required:""},model:{value:e.row.amount,callback:function(a){t.$set(e.row,"amount",a)},expression:"props.row.amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"回款类型"}},[a("b-select",{ref:"cash_type"+e.index,attrs:{disabled:0!==e.row.id,required:""},model:{value:e.row.cash_type,callback:function(a){t.$set(e.row,"cash_type",a)},expression:"props.row.cash_type"}},[a("option",{attrs:{value:"0"}},[t._v("现金")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("返点")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("资源置换")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"抵扣应收"}},[a("b-select",{ref:"is_deduct_money"+e.index,attrs:{disabled:0!==e.row.id,required:""},model:{value:e.row.is_deduct_money,callback:function(a){t.$set(e.row,"is_deduct_money",a)},expression:"props.row.is_deduct_money"}},[a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"抵扣返点金额"}},[a("b-input",{attrs:{readonly:0!==e.row.id},model:{value:e.row.rebate_amount,callback:function(a){t.$set(e.row,"rebate_amount",a)},expression:"props.row.rebate_amount"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"计算时间"}},[e.row.computing_date?a("b-datepicker",{ref:"computing_date"+e.index,attrs:{disabled:0!==e.row.id,icon:"calendar-today",required:""},model:{value:e.row.computing_date,callback:function(a){t.$set(e.row,"computing_date",a)},expression:"props.row.computing_date"}}):t._e()],1),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[0!==e.row.id?a("a",{key:e.index,staticClass:"button is-primary",on:{click:function(a){t.deleteCollection(e.index)}}},[t._v("删除")]):a("a",{staticClass:"button is-primary",on:{click:function(a){t.subCollection(e.index)}}},[t._v("删除")])])]}}])}):t._e(),t._v(" "),void 0!==this.id?a("div",{staticClass:"z-block-title"},[a("button",{staticClass:"button is-primary",on:{click:t.addCollection}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1)]):t._e()],1):t._e(),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("合同文本")])]),t._v(" "),a("div",{staticClass:"z-block-content z-textWarp"},[a("div",{staticClass:"columns"},["6"===t.contract.contract_type_id?a("b-field",{key:t.contractType.zero,staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"预估单后台截图",message:t.states.ygjt.msg,type:t.states.ygjt.status}},[t.isEdit?a("b-upload",{ref:"ygjtupload",attrs:{loading:t.states.ygjt.loading,accept:"image/*",required:!t.contract.file_url.length},on:{input:function(e){t.fileUpload("ygjt")}},model:{value:t.ygjtFiles,callback:function(e){t.ygjtFiles=e},expression:"ygjtFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.contract.file_url.length?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.contract.file_url.length,expression:"!contract.file_url.length"}],staticClass:"nofiles"})])],1):t._e(),t._v(" "),"7"===t.contract.contract_type_id?a("b-field",{key:t.contractType.one,staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"实际发生单后台截图",message:t.states.sjjt.msg,type:t.states.sjjt.status}},[t.isEdit?a("b-upload",{ref:"sjjtupload",attrs:{loading:t.states.sjjt.loading,accept:"image/*",required:!t.contract.file_url2.length},on:{input:function(e){t.fileUpload("sjjt")}},model:{value:t.sjjtFiles,callback:function(e){t.sjjtFiles=e},expression:"sjjtFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.contract.file_url2.length?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url2,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.contract.file_url2.length,expression:"!contract.file_url2.length"}],staticClass:"nofiles"})])],1):t._e(),t._v(" "),["1","3","4","5","9"].indexOf(t.contract.contract_type_id)>-1?a("b-field",{key:t.contractType.two,staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"合同文本",message:t.states.htwb.msg,type:t.states.htwb.status}},[t.isEdit||t.isRe?a("b-upload",{ref:"htwbupload",attrs:{loading:t.states.htwb.loading,required:!t.contract.file_url.length&&!t.contract.file_url2.length},on:{input:function(e){t.fileUpload("htwb")}},model:{value:t.htwbFiles,callback:function(e){t.htwbFiles=e},expression:"htwbFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.contract.file_url.length?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.contract.file_url.length,expression:"!contract.file_url.length"}],staticClass:"nofiles"})])],1):t._e(),t._v(" "),["1","3","4","5","9"].indexOf(t.contract.contract_type_id)>-1?a("b-field",{key:t.contractType.three,staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"合同附件",message:t.states.htfj.msg,type:t.states.htfj.status}},[t.isEdit||t.isRe?a("b-upload",{ref:"htfjupload",attrs:{loading:t.states.htfj.loading,required:!t.contract.file_url.length&&!t.contract.file_url2.length},on:{input:function(e){t.fileUpload("htfj")}},model:{value:t.htfjFiles,callback:function(e){t.htfjFiles=e},expression:"htfjFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[a("a",{directives:[{name:"show",rawName:"v-show",value:t.contract.file_url2.length,expression:"contract.file_url2.length"}],staticClass:"file-name",attrs:{href:t.contract.file_url2,target:"_blank"}},[t._v("预览")]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.contract.file_url2.length,expression:"!contract.file_url2.length"}],staticClass:"nofiles"})])],1):t._e(),t._v(" "),a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"补充协议",message:t.states.bcxy.msg,type:t.states.bcxy.status}},[a("b-upload",{attrs:{loading:t.states.bcxy.loading},on:{input:function(e){t.fileUpload("bcxy")}},model:{value:t.bcxyFiles,callback:function(e){t.bcxyFiles=e},expression:"bcxyFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]),t._v(" "),a("div",[t.contract.file_url3.length?a("a",{staticClass:"file-name",attrs:{href:t.contract.file_url3,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.contract.file_url3.length,expression:"!contract.file_url3.length"}],staticClass:"nofiles"})])],1),t._v(" "),t.signedStatusNoShow||"1"!==t.contractTypeId&&"3"!==t.contractTypeId?t._e():a("b-field",{staticClass:"column",attrs:{disabled:t.isEdit,horizontal:"",expanded:"",label:"签订状态"}},[a("b-select",{key:1,on:{input:t.selectStatus},model:{value:t.thestatus_id,callback:function(e){t.thestatus_id=e},expression:"thestatus_id"}},[a("option",{attrs:{value:"9"}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("我方已签")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("对方已签")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("双方已签")]),t._v(" "),a("option",{attrs:{value:"10"}},[t._v("无需合同")])])],1),t._v(" "),"6"===t.contract.contract_type_id||"7"===t.contract.contract_type_id?a("div",{key:t.contractType.four,staticClass:"column"}):t._e(),t._v(" "),a("div",{staticClass:"column"})],1)])]),t._v(" "),t.isEdit&&void 0===t.id?t._e():a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("备注")])]),t._v(" "),t.remark.length||void 0===this.id?t._e():a("div",{staticClass:"z-block-title"},[a("h2",[t._v("无数据")])]),t._v(" "),t.remark.length?a("b-table",{attrs:{data:t.remark,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"备注人"}},[a("b-input",{attrs:{readonly:"readonly",required:""},model:{value:e.row.username,callback:function(a){t.$set(e.row,"username",a)},expression:"props.row.username"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"时间"}},[a("b-datepicker",{ref:"entered_date"+e.index,attrs:{disabled:"disabled",icon:"calendar-today",required:""},model:{value:e.row.entered_date,callback:function(a){t.$set(e.row,"entered_date",a)},expression:"props.row.entered_date"}})],1),t._v(" "),a("b-table-column",{attrs:{label:"备注内容"}},[a("b-input",{ref:"remark"+e.index,attrs:{readonly:0!==e.row.id,maxlength:"200",required:""},model:{value:e.row.remark,callback:function(a){t.$set(e.row,"remark",a)},expression:"props.row.remark"}})],1),t._v(" "),t.isEdit?a("b-table-column",{key:20,attrs:{label:"操作"}},[0!==e.row.id?a("a",{key:e.index,staticClass:"button is-primary",on:{click:function(a){t.deleteRemark(e.index)}}},[t._v("删除")]):a("a",{staticClass:"button is-primary",on:{click:function(a){t.subRemark(e.index)}}},[t._v("删除")])]):t._e()]}}])}):t._e(),t._v(" "),void 0!==this.id&&t.isEdit?a("div",{staticClass:"z-block-title"},[a("button",{staticClass:"button is-primary",on:{click:t.addRemark}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1)]):t._e()],1),t._v(" "),t.contract.changeList&&t.contract.changeList.length>0?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("变更信息")])]),t._v(" "),t._l(t.contract.changeList,function(e){return a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更时间"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.changed_time))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更信息"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(1==e.change_type?"甲方":"乙方"))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同信息"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.old_description))])]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后信息"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.new_description))])])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"审批邮件"}},[a("div",{staticClass:"z-field-text"},[t._v(t._s(e.approved_file))])])],1)])})],2):t._e(),t._v(" "),t.isEdit?["6"!==t.contract.contract_type_id&&"7"!==t.contract.contract_type_id?a("a",{key:2,staticClass:"button is-primary",on:{click:function(e){t.saveContract(!1)}}},[t._v("保存")]):t._e(),t._v(" "),a("a",{key:3,staticClass:"button is-primary",on:{click:function(e){t.saveContract(!0)}}},[t._v("保存并提交审核")])]:[1===t.contract.approve_status_id&&t.inApproveFlow?[t.hasPermission("crm_new.contract.list.bohui")?a("a",{key:13,staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("驳回")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.tongguo")?a("a",{key:14,staticClass:"button is-primary",on:{click:function(e){t.passContract()}}},[t._v("通过")]):t._e(),t._v(" "),a("b-modal",{attrs:{active:t.ifReject,"has-modal-card":""},on:{"update:active":function(e){t.ifReject=e}}},[a("div",{staticClass:"modal-card",staticStyle:{width:"500px"}},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("驳回原因")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-input",{ref:"rejectReason_ref",attrs:{required:"",type:"textarea"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}}),t._v(" "),a("div",{staticClass:"z-block z-block-reject"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.rejectContract()}}},[t._v("确定")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("取消")])])],1)])])]:t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.chakan.update")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.renewClient()}}},[t._v("更新")]):t._e()],t._v(" "),a("a",{key:t.id,staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")]),t._v(" "),t.hasPermission("crm_new.contract.list.chakan.biangeng")?a("a",{staticClass:"button is-right",class:t.contract.isChange&&t.user_code?"is-primary":"is-gray",attrs:{href:t.contract.isChange&&t.user_code?"#/contract_change/"+t.contract.contract_number+"/edit?one_id="+t.contract.signing_company_id+"&contract_type_id="+t.contract.contract_type_id+"&one_des="+t.contract.signing_company_name+"&two_des="+t.contract.party_b_name+"&id="+t.id:"javascript:(0)"}},[t._v("变更")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.chakan.user_biangeng")?a("a",{staticClass:"button is-right",class:!t.isRole(t.ROLE.shangwuzhichi)||2!=t.contract.approve_status_id&&1!=t.contract.approve_status_id?"is-gray":"is-primary",attrs:{href:!t.isRole(t.ROLE.shangwuzhichi)||2!=t.contract.approve_status_id&&1!=t.contract.approve_status_id?"javascript:(0)":"#/contract_change/"+t.contract.contract_number+"/edit?isCharge=1&contract_company_id=3&contract_type_id="+t.contract.contract_type_id+"&charge_name="+t.contract.contract_charge_name+"&id="+t.id+"&userId="+t.userId}},[t._v("负责人变更")]):t._e(),t._v(" "),t.hasPermission("crm_new.contract.list.chakan.yanqi")&&1===Number(t.contractTypeId)?a("a",{staticClass:"button is-right is-primary",attrs:{href:"#/contract_change/"+t.contract.contract_number+"/edit?isCharge=1&contract_company_id=4&contract_type_id="+t.contract.contract_type_id+"&startDate="+t.contract.start_date+"&endDate="+t.contract.end_date+"&id="+t.id+"&userId="+t.userId}},[t._v("延期")]):t._e()]:t._e()],2)],1)},staticRenderFns:[]}},j6H9:function(t,e){},jCdm:function(t,e){},jXhV:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={name:"ReferrerName",props:["isReferrer","referrerName"],data:function(){return{is_referrer:this.isReferrer,referrer_name:this.referrerName,referrer_list:[]}},computed:{filterReferrerName:function(){var t=this;return this.referrer_list.filter(function(e){return e.toString().toLowerCase().indexOf(t.referrer_name.toString().toLowerCase())>=0})}},watch:{is_referrer:function(t){this.$emit("getReferrerType",this.is_referrer)},isReferrer:function(t){this.is_referrer=t,this.$emit("getReferrerType",this.is_referrer),1!==Number(t)&&this.$emit("getReferrer",this.is_referrer,"")},referrerName:function(t){this.referrer_name=t||""}},created:function(){this.getreferrer()},methods:{getreferrer:function(){var t=this;return this.ajax({url:"/client/get_referrer_name"}).then(function(e){t.referrer_list=e.data})},onSelectedReferrer:function(t){console.log(t),this.referrer_name=t,this.$emit("getReferrer",this.is_referrer,this.referrer_name)}}}},jjsM:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("BO1k"),i=function(t){return t&&t.__esModule?t:{default:t}}(n),s=["","广告服务*信息推广费","广告服务*信息服务费","广告服务*信息技术服务费","广告服务*广告发布费","广告服务*技术服务费","广告服务*广告费","广告服务*服务费","广告服务*技术推广服务","广告服务*推广费","信息技术服务*信息推广费","信息技术服务*信息服务费","信息技术服务*信息技术服务费","信息技术服务*广告发布费","信息技术服务*技术服务费","信息技术服务*广告费","信息技术服务*服务费","信息技术服务*技术推广服务","信息技术服务*推广费","现代服务*服务费","广告发布服务费","推广服务费","技术推广服务","营销推广费","广告推广费","代理费","现代服务*推广服务费"];e.default={props:["id","isCheck"],data:function(){return{selectList:s,mainCompany:{contract_currency_amount:"",contract_currency_type_id:"",invoice_amount:"",not_invoice_amount:"",company_name:"",reg_address:"",nsrsbh:"",bank:"",bank_number:"",party_b_name:"",contract_invoice:[],signing_company_invoice:[],contract_invoice_type:[]},companyInvoiceList:[]}},created:function(){this.getContractInvoce()},methods:{getContractInvoce:function(){var t=this;return this.ajax({url:"/contract_invoice/get_invoice_signing_company",loading:this.$loading.open(),params:{contract_id:this.id}}).then(function(e){if(0===e.error_code){var a=e.data,n=[a].concat(a.signing_company_invoice);n.forEach(function(e){e.company_name=a.company_name;var n=t.isRole(t.ROLE.fapiao);e.contract_invoice.forEach(function(e){e.isEdit=n&&t.checkStatus(e,[1]),e.reasonRequired=!1,e.invoice_date?e.invoiceDate=new Date(e.invoice_date):(e.invoiceDate=new Date,e.invoice_date=t.zDateFormatter(new Date))})}),t.mainCompany=a,t.companyInvoiceList=n}})},addInvoice:function(t){t.contract_invoice.push({isEdit:!0,contract_id:"",signing_company_id:"",signing_company_invoice_id:"",invoice_amount:"",invoice_type_id:"",currency_type_id:"",approve_status_id:0,invoice_number:"",invoice_date:"",invoiceDate:new Date,invoice_content:"",reject_reason:"",entered_date:"",invoice_type_name:"",party_b_name:this.mainCompany.party_b_name,currency_type_name:this.mainCompany.contract_currency_type_id,approve_status_name:"",auth:0,reasonRequired:!1})},invoiceDataValidate:function(t,e){var a=this,n=[];return e.forEach(function(e){var i=a.$refs[e+"_"+t];i.checkHtml5Validity&&(i.checkHtml5Validity()||n.push(i))}),!n.length||(n[0].focus(),!1)},saveInvoice:function(t,e,a){var n=this,i=["invoice_type_id","invoice_amount","invoice_content"],s={contract_id:this.id,signing_company_id:e.signing_company_id||e.sign_company_id,signing_company_invoice_id:e.id||0,invoice_type_id:t.invoice_type_id,invoice_amount:t.invoice_amount,invoice_content:t.invoice_content},r="/contract_invoice/add_contract_invoice";if(t.id&&(this.isRole(this.ROLE.shangwu)?(s.invoice_id=t.id,r="/contract_invoice/update_contract_invoice_commerce"):this.isRole(this.ROLE.fapiao)&&(i=["invoice_number"],s={invoice_id:t.id,invoice_number:t.invoice_number,invoice_date:this.zDateFormatter(t.invoiceDate)},r="/contract_invoice/update_contract_invoice_finance")),this.invoiceDataValidate(a,i))return this.ajax({url:r,method:"post",successTip:!0,loading:this.$loading.open(),data:s}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.id&&!n.checkStatus(t,[3])||(t.id=e.data.insert_id,t.invoice_type_name=n.getInvoiceType(t.invoice_type_id),t.approve_status_id=1,t.approve_status_name="待审核",t.entered_date=n.zDateFormatter(new Date)))})},getInvoiceType:function(t){var e=!0,a=!1,n=void 0;try{for(var s,r=(0,i.default)(this.mainCompany.contract_invoice_type);!(e=(s=r.next()).done);e=!0){var o=s.value;if(o.key===t)return o.value}}catch(t){a=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}return""},deleteInvoice:function(t,e,a){var n=this;t.id?this.$dialog.confirm({message:"确定删除？",onConfirm:function(){return n.ajax({url:"/contract_invoice/delete_contract_invoice",method:"post",successTip:!0,loading:n.$loading.open(),data:{invoice_id:t.id}}).then(function(t){0===t.error_code&&e.contract_invoice.splice(a,1)})}}):e.contract_invoice.splice(a,1)},passInvoice:function(t,e){if(this.invoiceDataValidate(e,["invoice_number"]))return this.ajax({url:"/contract_invoice/pass_contract_invoice",method:"post",successTip:!0,loading:this.$loading.open(),data:{invoice_id:t.id,invoice_number:t.invoice_number,invoice_date:this.zDateFormatter(t.invoiceDate)}}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.approve_status_name="已开票",t.approve_status_id=2)})},rejectInvoice:function(t,e){var a=this;t.reasonRequired=!0,this.$nextTick(function(){if(a.invoiceDataValidate(e,["reject_reason"]))return a.ajax({url:"/contract_invoice/reject_contract_invoice",method:"post",successTip:!0,loading:a.$loading.open(),data:{invoice_id:t.id,reject_reason:t.reject_reason,invoice_date:a.zDateFormatter(t.invoiceDate)}}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.approve_status_name="驳回待修改",t.approve_status_id=3)})})},checkStatus:function(t,e){if(!Array.isArray(e))throw new Error("状态id应该以数组形式传入");return e.indexOf(t.approve_status_id)>-1},authInvoice:function(t){return this.ajax({url:"/contract_invoice/contract_invoice_auth",method:"post",successTip:!0,loading:this.$loading.open(),data:{contract_invoice_id:t.id}}).then(function(e){0===e.error_code&&(t.auth=1)})}}}},jwvx:function(t,e,a){a("bcc1");var n=a("VU/8")(a("i+rZ"),a("EoyU"),"data-v-1972a2bf",null);t.exports=n.exports},kCnZ:function(t,e){},kPCt:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:t.pageTitle}},[a("div",{staticClass:"z-block"},[a("b-tabs",{attrs:{animated:!1}},[a("b-tab-item",{attrs:{label:"基本信息"}},[a("company-info",{attrs:{"company-id":t.companyId,"is-edit":t.isEdit},on:{companysaved:t.onCompanySaved,areaseleted:t.onAreaSelect}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"联系人信息",disabled:!t.companyId}},[a("company-contacts-list",{attrs:{"company-id":t.companyId,"is-edit":t.isEdit}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"子开票信息",disabled:!t.companyId||"native"!==t.area}},[a("company-invoce-list",{attrs:{"company-id":t.companyId,"is-edit":t.isEdit}})],1),t._v(" "),a("b-tab-item",{attrs:{label:"操作日志"}},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1)],1)],1)])},staticRenderFns:[]}},"kZm+":function(t,e){},kax9:function(t,e,a){a("nSoy");var n=a("VU/8")(a("Yzek"),a("pVxV"),"data-v-91c818b0",null);t.exports=n.exports},ket1:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"auth",props:["permission"]}},kz8j:function(t,e,a){a("FUzp"),a("O/lM");var n=a("VU/8")(a("sJIE"),a("CbQb"),"data-v-1bed231e",null);t.exports=n.exports},l45y:function(t,e,a){var n=a("VU/8")(a("zMiP"),a("PYju"),null,null);t.exports=n.exports},l8hM:function(t,e){},lB5T:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),s=n(i),r=a("//Fk"),o=n(r),c=a("LZT1"),l=n(c),d=a("O4Lo"),u=n(d);e.default={name:"PendingCostManage",data:function(){return{isHeader:!1,isFetching:!1,isFetching_2:!1,isFetching_3:!1,departments:[],loading:!1,contracts:[],departmentId:"",departmentName:null,departmentReadonly:!1,userId:"",users:[],contractDirector:[],userReadonly:!1,clientList:[],clientId:"",clientName:"",brandId:"",brands:[],brand_title:"",companies:[],signingCompany:"",signingCompanyId:"",contractName:"",contractNumber:"",contractNumberList:[],contractNames:[],partyName:"",totalContracts:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,isChecked:!0,clickGet:0,clickReset:0,cost_pm_id:null,cost_pm_name:"",codeList:[],amounts:null,showLogModal:!1,logData:[],logColumns:[{field:"updated_user",label:"审核人"},{field:"approve_status",label:"审核状态"},{field:"approve_step",label:"审核步骤"},{field:"updated_date",label:"审核时间"},{field:"reason",label:"驳回原因"}]}},watch:{currPage:function(){var t=!1;t=!(this.clickReset>this.clickGet),this.getCostList(t)},page:function(t){this.currPage=t||1},departmentId:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.userId=null,this.getDirector({department_id:t}))}},created:function(){this.getDepartment(),this.getCostList()},methods:{isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:t}).then(function(t){if(0===t.error_code&&t.data&&t.data.rows){if(e.contractDirector=t.data.rows,e.contractDirector.length){var a={id:"",name:""};e.contractDirector.unshift(a)}}else e.contractDirector=[]})},searchContract:(0,u.default)(function(){this.isFetching_2=!0,this.getContracts()},500),getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},searchCompany:(0,u.default)(function(){this.isFetching=!0,this.getCompanies()},500),getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.signingCompany}}).then(function(e){t.companies=e.data.lists,t.isFetching=!1})},searchContractList:(0,u.default)(function(){this.isFetching_3=!0,this.getContractList()},500),getContractList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},onCompanySelected:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list",params:{title:this.brand_title,user_id:Number(this.userId)}}).then(function(e){t.brands=e.data})},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brand_title=t.title)},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?this.getCostList(t):this.currPage=1,this.clickGet+=1},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.cost_pm_name,role_code:"role-crm-xiangmujingli",use_swzc:0}}).then(function(e){0===e.error_code&&(t.codeList=e.data.rows)})},onChargenameSelected:function(t){t&&(this.cost_pm_id=t.id)},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,l.default)(e.data);t.departments=a})},getCostList:function(t){var e=this,a={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,contract_number:this.contractNumber,contract_name:this.contractName,party_b_name:this.partyName,cost_pm_id:this.cost_pm_id,page:this.currPage,page_size:this.perPage};console.log(11,a),this.loading=!0,new o.default(function(a,n){e.isShangwu()?t?a():(e.contractDirector=[],1===e.$root.crmUser.is_headman?(e.isHeader=!0,a()):(e.isRole(e.ROLE.shangwuzhichi)?console.log("shangwuzhichi"):(e.isHeader=!1,e.departmentReadonly=!0,e.userReadonly=!0,e.contractDirector=[{name:e.$root.crmUser.username,id:e.$root.crmUser.id}],e.userName=e.$root.crmUser.name,e.userId=e.$root.crmUser.id,e.departmentId=e.$root.crmUser.department_id,e.departmentName=e.$root.crmUser.department_name),a())):a()}).then(function(){e.urlParams=(0,s.default)({},a),e.ajax({url:"/contract_cost/ContractCostToBeApprovalList",params:a}).then(function(t){e.totalContracts=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1),e.contracts=t.data.lists,e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})})},resetParams:function(){this.contractDirector.length>1&&(this.userId=null),(this.isHeader||!this.isShangwu()||this.isRole(this.ROLE.shangwuzhichi))&&(this.departmentId="",this.userId="",this.userName=""),this.clientId=null,this.clientName=null,this.brands=[],this.brand_title="",this.brandId="",this.signingCompany="",this.signingCompanyId="",this.contractNumber="",this.contractName="",this.partyName=null,this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1,this.cost_pm_id=null,this.cost_pm_name=""},exportALL:function(){var t=this,e={department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,contract_number:this.contractNumber,contract_name:this.contractName,party_b_name:this.partyName,cost_pm_id:this.cost_pm_id,page:this.currPage,page_size:this.perPage};this.ajax({url:"/contract_cost/exportContractCostToBeApprovalList",params:e}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},showClientLog:function(t){var e=this;this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/contract/get_contract_approve_log",params:{contract_id:t,type:4}}).then(function(t){0===t.error_code&&(e.logData=t.data)})}}}},lCE6:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("O4Lo"),o=n(r),c=a("L46q"),l=n(c),d=a("T0q9"),u=n(d),_="/contract_amount_detail/get_rate_amount",p=["contractName","contractJoin","contractCharge","contractDepartment","contractBizType","contractClient","contractBrand","contractSigningCompany","startDate","endDate","accountPeriod","emstimate_date","current_amount","currency_amount","contractCurrencyAamount","throwStartDate","throwEndDate","rmbAmount","currencyRate","rmbAmount2","signingCompanyTypeId","cooperationMode","partyBName","clientTypeId","contractBrandId","ygjtupload","sjjtupload","htwbupload","htfjupload"],m=["payment_date","signing_date","status_join_contract_id","contract_cost1","contract_cost2","rebate"],h=[],f=[],v=[],b={bcxy:"补充协议",htfj:"合同附件",htwb:"合同文本",sjjt:"实际发生单后台截图",ygjt:"预估单后台截图"},g=["默认","是","否"];e.default={props:["id","isEdit","yugu","signedStatusNoShow"],data:function(){return{IS_FIRST:g,isClick:!1,GET_CONTRACT:"/contract/getBoxContractLists",nowUser:{},user_code:this.getRole(this.$root.ROLE.shangwuzhichi),contracts:[],enteredUserId:"",contract_name:"",contract_msg:"",contract_number:"",charge_userName:"",isFetching:!1,isFetching1:!1,isFetching2:!1,loading:!1,newbcxy:!1,toEdit:!1,ifGuanlian:!0,bizTypeIdArr:[],bizTypeNameArr:[],bizTypeArr:[],clients:[],codeList:[],companyes:[],htwbFiles:[],htfjFiles:[],ygjtFiles:[],sjjtFiles:[],bcxyFiles:[],contractTypeId:null,userId:null,clientId:null,detail:[],cash_collection:[],remark:[],emstimate_date:null,emstimate_date_msg:"",minYuguDate:null,contract_status:[],inputContractName:"",fecthingContracts:!1,isupdate:!0,rejectReason:"",ifReject:!1,status:{join_contract_id:"",payment_date:new Date,signing_date:new Date},contractType:{zero:0,one:1,two:2,three:3,four:4},thestatus_id:"",dataReady:!1,contract:{join_contract_id:null,contract_type_id:null,contract_type_name:"",contract_number:"",contract_name:"",contract_charge_name:"",contract_brand_id:"",contract_brand_name:"",contract_second_brand_id:"",contract_second_brand_name:"",department_name:"",parent_department_name:"",user_id:null,departmentId:"",client_name:"",brand_id:null,brand:"",nowUser:"",biz_type_id:"0",client_id:null,client_type_id:null,client_type_name:"",signing_company_name:"",signing_company_id:null,signing_company_type_id:null,cooperation_mode:"15",signing_company_type_name:"",party_b_name:"",start_date:new Date,startDate:new Date,end_date:new Date,endDate:new Date,account_period:new Date,accountPeriod:new Date,ygfd_rate:"",emstimateDate:new Date,emstimate_date:new Date,ygfd_amount:"",qrfd_rate:"",enteredDate:new Date,entered_date:new Date,qrfd_amount:"",yuguAmount:"",file_url:"",file_url2:"",file_url3:"",remark_txt:"",current_amount:"",currency_amount:"",currency_type_id:0,throwStartDate:new Date,throw_start_date:new Date,throwEndDate:new Date,throw_end_date:new Date,rmb_amount:"",currency_rate:"",hard_wide_detail_type:8,approve_status_id:"",contract_currency_amount:"",contract_currency_type_id:"",isChange:0,changeList:[],client_relationship_name:null},levelData:[],level:null,states:{htwb:{status:"",msg:"",loading:!1},htfj:{status:"",msg:"",loading:!1},ygjt:{status:"",msg:"",loading:!1},sjjt:{status:"",msg:"",loading:!1},bcxy:{status:"",msg:"",loading:!1}},isPreContract:!1,isRe:!!this.$route.query.isRe||!1,contractClientName:""}},mixins:[u.default],components:{PreContractsView:l.default},computed:{filteredClients:function(){var t=this;return this.clients.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.contractClientName.toLowerCase())>=0})}},watch:{contractTypeId:function(t){var e=parseInt(t);this.isClick&&(this.contract_msg="",this.contract.contract_charge_name="",this.userId=null,this.contract.department_name="",this.contract.biz_type_id=""),this.contract.contract_type_id=t,1===e?this.GET_CONTRACT="/contract/getBoxContractLists":4===e||5===e||9===e?this.GET_CONTRACT="/contract/get_cps_contract_lists":6===e?this.GET_CONTRACT="/contract/getCpsContractListsByUid":7===e&&(this.GET_CONTRACT="/contract/getCpsEstimateContractLists"),3!==e&&(this.contract.hard_wide_detail_type=8),this.getContractEdit()},userId:function(t){(!this.ifGuanlian||this.isEdit&&void 0===this.id)&&(void 0!==t&&""!==t&&this.getClients({user_id:parseInt(t)}),this.contract.user_id=t,""!==t&&null!==t&&this.getUserById())},clientId:function(t){(!this.ifGuanlian||this.isEdit&&void 0===this.id)&&(this.contract.client_id=t,this.getOneClient({client_id:t}))},contract_number:function(){this.ifGuanlian||"6"!==this.contractTypeId||this.CHECK_ESTIMATE(!0)}},created:function(){if(this.getLevel(),this.getCodeList(),void 0!==this.id&&this.id.length>0?this.checkContract(this.id,!1):(this.dataReady=!0,this.yugu?(this.contract.contract_type_id="6",this.contractTypeId="6"):(this.contract.contract_type_id="1",this.contractTypeId="1"),this.getUser()),this.isEdit){var t=new Date;t.getDate()>3&&(this.minYuguDate=new Date(t.getFullYear()+"-"+(t.getMonth()+1)+"-3"))}},methods:{getLevel:function(){var t=this;this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data})},onSelectLevel:function(t){t&&(this.level=this.levelData[t-1],this.level&&0===this.level.level.length&&(this.contract.contract_second_brand_id=t+"_0"))},checkContract:function(t,e){var a=this;return this.ajax({url:"/contract/get_contract_by_id",loading:this.$loading.open(),params:{contract_id:t}}).then(function(t){if(console.log(t.data,"contract"),a.loading=!1,a.contract.client_relationship_name=t.data.client_relationship_name,a.contract.isChange=t.data.is_change,a.contract.isOld=t.data.is_old,a.contract.changeList=t.data.change_list,[0,2,8].indexOf(t.data.contract_type_id)>-1)return void(a.isPreContract=!0);if(a.contractClientName=t.data.client_name,a.thestatus_id=t.data.status_id,e)a.contract_msg=t.data.contract_number+t.data.contract_name,a.contract_number=t.data.contract_number,a.contract_name=t.data.contract_name,"4"===a.contractTypeId&&(a.contract.contract_charge_name=t.data.contract_charge_name,a.userId=t.data.user_id,a.clientId=t.data.client_id,a.getOneClient({client_id:a.clientId}));else{a.contract=t.data,a.contract.contract_charge_name=t.data.contract_charge_name,a.charge_userName=t.data.contract_charge_name,a.contract.contract_type_id=a.contract.contract_type_id.toString(),a.contractTypeId=a.contract.contract_type_id,a.userId=a.contract.user_id,a.clientId=a.contract.client_id,a.contract_number=a.contract.join_contract_number,a.getOneClient({client_id:a.clientId}),a.contract_name=a.contract.join_contract_name,a.contract_msg=a.contract.join_contract_number+a.contract.join_contract_name,a.contract.startDate=new Date(a.contract.start_date),a.contract.endDate=new Date(a.contract.end_date),a.contract.accountPeriod=new Date(t.data.account_period),""===a.contract.emstimate_date?(a.contract.emstimateDate=new Date,a.emstimate_date=null):(a.contract.emstimateDate=new Date(a.contract.ygfd_date_time),a.emstimate_date=new Date(a.contract.emstimate_date)),t.data.signing_date?a.status.signing_date=new Date(t.data.signing_date):a.status.signing_date=null,t.data.payment_date?a.status.payment_date=new Date(t.data.payment_date):a.status.payment_date=null,a.status.join_contract_id=t.data.join_contract_id,a.inputContractName=t.data.join_contract_name,a.contract.enteredDate=new Date(a.contract.qrfd_date_time);for(var n=0;n<a.contract.detail.length;n++)a.contract.detail[n].throw_start_date=new Date(a.contract.detail[n].throw_start_date),a.contract.detail[n].throw_end_date=new Date(a.contract.detail[n].throw_end_date);a.detail=a.contract.detail;for(var i=0;i<a.contract.cash_collection.length;i++)a.contract.cash_collection[i].cash_collection_date=new Date(a.contract.cash_collection[i].cash_collection_date),a.contract.cash_collection[i].confirm_date=new Date(a.contract.cash_collection[i].confirm_date),a.contract.cash_collection[i].computing_date=new Date;a.cash_collection=a.contract.cash_collection;for(var s=0;s<a.contract.remark.length;s++)a.contract.remark[s].entered_date?a.contract.remark[s].entered_date=new Date(a.contract.remark[s].entered_date):a.contract.remark[s].entered_date=null;a.remark=a.contract.remark,a.setCollectionRef(),a.setAmountRef(),a.setRemarkRef(),a.isEdit||void 0===a.id||a.setContractStatus()}"3"===a.contractTypeId&&(a.contract.cooperation_mode=t.data.hard_wide_detail_type),void 0!==a.userId&&""!==a.userId&&a.getClients({user_id:parseInt(a.userId)}),a.onSelectLevel(a.contract.contract_brand_id||""),a.dataReady=!0,a.$forceUpdate()})},getContract:function(t){var e=this;return this.contracts=[],this.fecthingContracts=!0,this.ajax({url:"/contract/getContractLists",params:t}).then(function(t){e.fecthingContracts=!1,e.contracts=t.data.lists,e.isFetching=!1})},getContractEdit:function(){var t=this;return this.contracts=[],this.fecthingContracts=!0,this.ajax({url:this.GET_CONTRACT,params:{search:this.contract_msg}}).then(function(e){t.fecthingContracts=!1,t.contracts=e.data,t.isFetching=!1})},getYuzhan:function(t){var e=this;return this.ajax({url:"/contract/getCpsEstimateContractLists",params:t}).then(function(t){e.contracts=t.data.lists})},getCodeList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,name:this.charge_userName,role_code:"role-crm-shangwu"}}).then(function(e){console.log(e,"fuzer"),t.isFetching1=!1,t.codeList=e.data.rows})},getClients:function(t){var e=this;return this.ajax({url:"/contract/get_contract_clients_by_user_id",params:t}).then(function(t){e.clients=t.data,1===e.clients.length&&(console.log(e.clients),e.clientId=e.clients[0].id),0===e.clients.length&&(e.contract.client_type_id=null,e.contract.client_type_name="",e.contract.brand_id=null,e.contract.brand="")})},getOneClient:function(t){var e=this;return this.contract.client_type_id=null,this.contract.client_type_name="",this.contract.brand_id=null,this.contract.brand="",t.client_id?this.ajax({url:"/client/get_client_by_id",params:t}).then(function(t){console.log("pinpai",t),e.contract.client_type_id=t.data.client_type_id,e.contract.client_type_name=t.data.client_type_name,e.contract.client_name=t.data.client_name,e.contract.brand_id=t.data.brand_id,e.contract.brand=t.data.brand}):0},getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{approve_status_id:2,like_company_name:this.contract.signing_company_name}}).then(function(e){t.companyes=e.data.lists,t.isFetching2=!1})},getUser:function(){var t=this;return this.ajax({url:"/session/check_login/"}).then(function(e){t.nowUser=e.data,t.isFetching=!1})},getRole:function(t){if(this.$root.user.roleCodes.indexOf(t)>-1)return this.user_code=!0,!0;this.user_code=!1},getUserById:function(){var t=this;this.contract.department_id="",this.contract.department_name="",this.contract.parent_department_name="";var e="/user/info/"+this.contract.user_id+"/";return this.ajax({url:e,params:{with_department:1}}).then(function(e){void 0!==e.data.biz_type&&(t.contract.biz_type_id=e.data.biz_type.split(",")[0]),void 0!==e.data&&e.data.department_list.length&&(t.contract.department_id=e.data.department_list[0].department_id,t.contract.department_name=e.data.department_list[0].department_name,t.contract.parent_department_name=e.data.department_list[0].parent_department_name)})},getRate:function(){var t=this;this.ajax({url:_,params:{currency_amount:this.contract.currency_amount,currency_type_id:this.contract.currency_type_id,start_date:this.zDateFormatter(this.contract.throwStartDate)}}).then(function(e){t.contract.currency_rate=e.data.rate,t.contract.rmb_amount=e.data.rmb_amount})},getRates:function(t,e){var a=this;return console.log(this.detail[t]),e&&(this.detail[t].changeStart=!0),this.ajax({url:_,params:{currency_amount:this.detail[t].currency_amount,currency_type_id:this.detail[t].currency_type_id,start_date:this.zDateFormatter(this.detail[t].throw_start_date)}}).then(function(e){console.log(e),a.detail[t].currency_rate=e.data.rate,a.detail[t].rmb_amount=e.data.rmb_amount})},getHuikuanRate:function(t){var e=this;return this.ajax({url:_,params:{currency_amount:this.cash_collection[t].current_amount,currency_type_id:this.cash_collection[t].currency_id,start_date:this.zDateFormatter(this.cash_collection[t].confirm_date)}}).then(function(a){console.log(a),e.cash_collection[t].amount=a.data.rmb_amount})},changeEnd:function(t){this.detail[t].changeEnd=!0},countAmount:function(){this.contract.rmb_amount=Number(this.contract.currency_amount)*Number(this.contract.currency_rate)},searchCompany:(0,o.default)(function(){this.isFetching2=!0,this.getCompanies()},500),checkContractJesuan:function(t){var e=this;return this.ajax({url:"/contract/getContractById",method:"post",loading:this.$loading.open(),data:{contract_id:t}}).then(function(t){e.loading=!1,console.log(t,"checkContractJesuan"),e.contract.contract_name=t.data.contract_name,e.contract.contract_charge_name=t.data.contract_charge_name,e.userId=t.data.user_id,e.clientId=t.data.client_id,e.getOneClient({client_id:e.clientId}),e.contract.signing_company_id=t.data.signing_company_id,e.contract.signing_company_name=t.data.signing_company_name,e.contract.signing_company_type_id=t.data.signing_company_type_id,e.contract.cooperation_mode=t.data.hard_wide_detail_type,e.contract.party_b_name=t.data.party_b_name,e.contract.contract_brand_id=t.data.contract_brand_id,"7"===e.contractTypeId&&(e.contract.currency_type_id=t.data.contract_currency_type_id.toString(),e.contract.yuguAmount=t.data.contract_currency_amount)})},onContractsSelected:function(t){t&&(this.ifGuanlian=!1,console.log(t,"onContractsSelected"),"6"===this.contractTypeId||"7"===this.contractTypeId?(this.contract_msg=t.contract_number+t.contract_name,this.contract_number=t.contract_number,this.contract_name=t.contract_name,this.checkContractJesuan(t.id)):this.checkContract(t.id,!0),this.contract.join_contract_id=t.id)},onChargenameSelected:function(t){t&&(console.log(t),this.ifGuanlian=!1,this.userId=t.id,this.contract.contract_charge_name=t.name,this.contractClientName="")},onCompanySelected:function(t){t&&(console.log(t),this.contract.signing_company_id=t.id)},fileUpload:function(t){var e=this,a=this.$data[t+"Files"];if(0!==a.length){var n=a,i=b[t];if(console.log(t,n),"bcxy"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("htwb"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("htfj"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("ygjt"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if("sjjt"===t&&n.size>52428800)return this.states[t].status="is-danger",void(this.states[t].msg="文件【"+i+"】附件大小不能超过50M");if(this.states[t].status="",this.states[t].msg="","htwb"===t){if(!(n.name.indexOf("doc")>0||n.name.indexOf("pdf")>0))return this.states[t].status="is-danger",this.states[t].msg="请使用.doc/.docx/.pdf格式的文件",void this.$dialog.alert("请使用.doc/.docx/.pdf格式的文件");this.states[t].status="",this.states[t].msg=""}this.states[t].loading=!0,this.ajax({url:"/tools/file_upload",method:"post",data:{file_type:n.name.match(/\.([^.]+)$/)[1],file_name:n}}).then(function(a){e.$toast.open({duration:5e3,message:"上传【"+i+"】附件成功",position:"is-top",type:"is-success"}),console.log(a),e.states[t].loading=!1,"bcxy"!==t||e.isEdit||(e.newbcxy=!0),"htwb"===t||"ygjt"===t?e.contract.file_url=a.data.file_name:"htfj"===t||"sjjt"===t?e.contract.file_url2=a.data.file_name:e.contract.file_url3=a.data.file_name,console.log(e.contract.file_url)})}},contractDataValidate:function(t){var e=this,a=[];return t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(n.checkHtml5Validity()||a.push(n))}),!a.length||(a[0].focus(),!1)},saveContract:function(t){var e=this,a=p;if(this.contractDataValidate(a)){var n=this.isEdit&&this.id,i="/contract/addContract";this.contract.approve_status_id=t?1:0;var r=this.contract,o="";o=r.contract_second_brand_id?r.contract_second_brand_id:r.contract_brand_id?r.contract_brand_id+"_0":"";var c={contract_name:r.contract_name,client_id:r.client_id,client_type_id:r.client_type_id,user_id:r.user_id,party_b_name:r.party_b_name,signing_company_id:r.signing_company_id,signing_company_type_id:r.signing_company_type_id,contract_number:r.contract_number,biz_type_id:r.biz_type_id,contract_brand_id:o||"",print_and_seal:1,contract_type_id:r.contract_type_id,start_date:this.zDateFormatter(r.startDate),end_date:this.zDateFormatter(r.endDate),account_period:this.zDateFormatter(r.accountPeriod),file_url:r.file_url,file_url2:r.file_url2,file_url3:r.file_url3,approve_status_id:r.approve_status_id,hard_wide_detail_type:r.hard_wide_detail_type,join_contract_id:r.join_contract_id};if("3"===this.contract.contract_type_id&&(c.hard_wide_detail_type=r.cooperation_mode),n){if(!this.contractDataValidate(v))return;if(!this.contractDataValidate(f))return;if(!this.contractDataValidate(h))return;if(i="/contract/update_contract",c.contract_id=this.id,"3"===this.contract.contract_type_id&&(c.contract_currency_type_id=r.contract_currency_type_id,c.contract_currency_amount=r.contract_currency_amount),c.contract_currency_amount=r.contract_currency_amount,c.contract_currency_type_id=r.contract_currency_type_id,this.cash_collection.length){var l=JSON.parse((0,s.default)(this.cash_collection));for(var d in l){var u=new Date(l[d].cash_collection_date.substring(0,10));u.setDate(u.getDate()+1);var _=new Date(l[d].confirm_date.substring(0,10));_.setDate(_.getDate()+1),l[d].cash_collection_date=this.zDateFormatter(u),l[d].confirm_date=this.zDateFormatter(_),delete l[d].isNew}c.cash_collections=l}var m=JSON.parse((0,s.default)(this.detail));for(var b in m){var g=new Date(m[b].throw_end_date.substring(0,10)),y=new Date(m[b].throw_start_date.substring(0,10));m[b].changeStart&&(y.setDate(y.getDate()+1),delete m[b].changeStart),m[b].changeEnd&&(g.setDate(g.getDate()+1),delete m[b].changeEnd),m[b].throw_end_date=this.zDateFormatter(g),m[b].throw_start_date=this.zDateFormatter(y)}c.details=m;var C=JSON.parse((0,s.default)(this.remark));c.remarks=C}else c.remark=r.remark_txt,c.currency_amount=r.currency_amount,c.currency_type_id=r.currency_type_id,c.throw_start_date=this.zDateFormatter(r.throwStartDate),c.throw_end_date=this.zDateFormatter(r.throwEndDate),c.currency_rate=r.currency_rate,c.rmb_amount=r.rmb_amount,"3"===this.contract.contract_type_id&&(c.currency_amount=r.contract_currency_amount,c.currency_type_id=r.contract_currency_type_id);if(("3"===this.contract.contract_type_id||r.ygfd_rate.length)&&(c.ygfd_rate=r.ygfd_rate,c.ygfd_amount=r.ygfd_amount,c.qrfd_rate=r.qrfd_rate),"6"===this.contract.contract_type_id){if(null===this.emstimate_date||""===this.emstimate_date)return void this.$dialog.alert("请设置预估时间");c.emstimate_date=this.zDateFormatter(this.emstimate_date)}var k=this.$loading.open(),w=void 0;return n?(console.log(c),w={data:(0,s.default)(c)}):w=c,this.ajax({method:"post",loading:this.$loading.open(),url:i,data:w,successTip:!0}).then(function(a){k.close(),0===a.error_code&&(n?e.checkContract(e.id,!1):(e.newContractId=a.data.insert_id,t?e.$router.push("/contracts/"):e.$router.push("/contracts/"+e.newContractId),window.location.reload()))})}},addAmount:function(){var t=void 0;t=0===this.detail.length?this.contract.contract_currency_type_id.toString():this.detail[0].currency_type_id,this.detail.push({currency_amount:"",id:0,contract_id:this.id,ad_type:2,contract_detail_cooperation_id:0,throw_start_date:new Date,throw_end_date:new Date,currency_type_id:t,rmb_amount:"",currency_rate:"",recount_receivable_amount:"",currency_type_name:"",contract_detail_cooperation_name:""}),this.setAmountRef()},addCollection:function(){this.cash_collection.push({id:0,contract_id:this.id,amount:"",current_amount:"",currency_id:0,cash_collection_date:null,confirm_date:null,cash_type:0,computing_date:null,rebate_amount:"",is_deduct_money:0,isNew:!0}),this.setCollectionRef()},addRemark:function(){this.remark.push({id:0,entered_date:new Date,remark:"",username:this.contract.contract_charge_name}),this.setRemarkRef()},setRemarkRef:function(){h=[];for(var t=0;t<this.remark.length;t++)h.push("entered_date"+t),h.push("remark"+t)},setCollectionRef:function(){f=[];for(var t=0;t<this.cash_collection.length;t++)f.push("cash_collection_date"+t),f.push("confirm_date"+t),f.push("currency_id"+t),f.push("current_amount"+t),f.push("amount"+t),f.push("cash_type"+t),f.push("is_deduct_money"+t),f.push("rebate_amount"+t),f.push("computing_date"+t)},setAmountRef:function(){v=[];for(var t=0;t<this.detail.length;t++)v.push("currency_amount"+t),v.push("currency_type_id"+t),v.push("throw_start_date"+t),v.push("throw_end_date"+t),v.push("rmb_amount"+t),v.push("currency_rate"+t);console.log(v)},subCollection:function(t){this.cash_collection.splice(t,1)},subDetail:function(t){this.detail.splice(t,1)},subRemark:function(t){this.remark.splice(t,1)},onContractSelect:function(t){t&&(this.status.join_contract_id=t.id,console.log(this.inputContractName))},onClientsSelected:function(t){this.ifGuanlian=!1,t&&(this.contract.client_id=t.id,this.contract.client_name=t.name,this.clientId=t.id)},searchContracts:(0,o.default)(function(){""===this.contract_msg&&["1","9"].indexOf(this.contract.contract_type_id)&&(this.contract_number="",this.contract_name="",this.contract.join_contract_id=0),this.isFetching=!0,this.getContractEdit()},500),searchChargename:(0,o.default)(function(){this.isFetching1=!0,this.getCodeList()},500),renewClient:function(){var t=m;if(this.contractDataValidate(t)){var e=void 0,a=void 0;e=null===this.status.signing_date||""===this.status.signing_date?"":this.zDateFormatter(this.status.signing_date),a=null===this.status.payment_date||""===this.status.payment_date?"":this.zDateFormatter(this.status.payment_date),console.log("this.contract_status=",this.contract_status);var n={contract_id:this.id,contract_cost1:this.contract.contract_cost1,contract_cost2:this.contract.contract_cost2,rebate:this.contract.rebate,file_url:this.contract.file_url,file_url2:this.contract.file_url2,file_url3:this.contract.file_url3,contract_status:this.contract_status,payment_date:a,signing_date:e,join_contract_id:this.status.join_contract_id};if(this.cash_collection.length){var i=JSON.parse((0,s.default)(this.cash_collection));for(var r in i){var o=new Date(i[r].cash_collection_date.substring(0,10)),c=new Date(i[r].confirm_date.substring(0,10));i[r].isNew&&(o.setDate(o.getDate()+1),delete i[r].isNew),c.setDate(c.getDate()+1),null!==i[r].computing_date&&""!==i[r].computing_date&&(i[r].computing_date=i[r].computing_date.substring(0,10)),i[r].cash_collection_date=this.zDateFormatter(o),i[r].confirm_date=this.zDateFormatter(c)}n.cash_collections=i}var l=(0,s.default)(n);return this.ajax({method:"post",url:"/contract/renew_contract",loading:this.$loading.open(),data:{data:l},successTip:!0}).then(function(t){t.error_code})}},toReject:function(){this.ifReject?this.ifReject=!1:this.ifReject=!0,this.rejectReason=""},rejectContract:function(){var t=this;this.contractDataValidate(["rejectReason_ref"])&&this.ajax({loading:this.$loading.open(),url:"/contract_approval_options/reject",method:"post",successTip:!0,data:{approve_type:this.approveType,contract_id:this.id,reason:this.rejectReason}}).then(function(e){0===e.error_code&&(t.contract.approve_status_id=2,t.$router.push("/pending_contracts"),t.ifReject=!1)})},passContract:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/contract_approval_options/pass",method:"post",successTip:!0,data:{approve_type:this.approveType,contract_id:this.id}}).then(function(e){0===e.error_code&&(t.contract.approve_status_id=3,t.$router.push("/pending_contracts"))})},CHECK_ESTIMATE:function(t){var e=this;return this.emstimate_date||t?""===this.contract_number?(this.emstimate_date_msg="请先选择关联合同",this.$dialog.alert("请先选择关联合同"),!1):void this.ajax({url:"/contract/checkEstimateTime",params:{contract_id:this.id||0,contract_number:this.contract_number,estimate_time:this.zDateFormatter(this.emstimate_date),currency:this.contract.currency_type_id}}).then(function(t){console.log(t),0===t.error_code&&(e.contract.currency_rate=t.data.currency_rate,e.contract.throwStartDate=new Date(t.data.start_date),e.contract.throwEndDate=new Date(t.data.end_date),e.countAmount())}):void this.$dialog.alert("请设置预估时间")},setContractStatus:function(){for(var t=this.contract.contract_status,e=0;e<t.length;e++)t[e].is_checked&&(console.log(t[e].key),this.contract_status.push(t[e].key.toString()))},deleteRemark:function(t){var e=this;this.$dialog.confirm({message:"您确定要删除此备注吗？",onConfirm:function(){e.ajax({loading:e.$loading.open(),url:"/contract_remark/delete_contract_remark",successTip:!0,params:{remark_id:e.remark[t].id}}).then(function(a){0===a.error_code&&e.subRemark(t)})}})},deleteDetail:function(t){var e=this;this.$dialog.confirm({message:"您确定要删除此明细吗？",onConfirm:function(){e.ajax({loading:e.$loading.open(),url:"/contract_amount_detail/delete_contract_amount_detail",successTip:!0,params:{detail_id:e.detail[t].id}}).then(function(a){0===a.error_code&&e.subDetail(t)})}})},deleteCollection:function(t){var e=this;this.$dialog.confirm({message:"您确定要删除此回款吗？",onConfirm:function(){e.ajax({loading:e.$loading.open(),url:"/contract_cash_collection/delete_contract_cash_collection",successTip:!0,params:{cash_collection_id:e.cash_collection[t].id}}).then(function(a){0===a.error_code&&e.subCollection(t)})}})},routePush:function(){this.$router.push("/contracts/"+this.contract.join_contract_id),window.location.reload()},selectStatus:function(){this.contract_status=this.thestatus_id}}}},lPeW:function(t,e,a){a("qBya");var n=a("VU/8")(a("H61S"),a("WPfQ"),"data-v-1a6800f5",null);t.exports=n.exports},"m+Od":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={name:"menu-list",props:{data:{type:Array,default:[]},level:{type:Number,default:0},parentId:{type:Number,default:0},isDepart:{type:Boolean,default:!1}},methods:{addDepartment:function(){this.data.push({isEdit:!0,child:[],name:"",expanded:!1,level:this.level})},deleteDepartment:function(t,e){var a=this;t.id?this.$dialog.confirm({message:"确定删除？",onConfirm:function(){a.ajax({loading:a.$loading.open(),url:a.isDepart?"/department/del":"/business/del",successTip:!0,params:{id:t.id}}).then(function(t){0===t.error_code&&a.data.splice(e,1)})}}):this.data.splice(e,1)},hideAll:function(){this.data.forEach(function(t){t.expanded=!1}),this.$refs.subMenuList&&this.$refs.subMenuList.length&&this.$refs.subMenuList[0].hideAll()},showAll:function(){this.data.forEach(function(t){t.expanded=!0}),this.$refs.subMenuList&&this.$refs.subMenuList.length&&this.$refs.subMenuList[0].showAll()},saveDepartment:function(t,e){if(0===t.name.trim().length){var a=this.$refs["department_"+this.level+"_"+e][0];if(a&&a.checkHtml5Validity&&!a.checkHtml5Validity())return void a.focus()}var n={name:t.name,parent_id:this.parentId};return t.id&&(n.id=t.id),this.ajax({url:this.isDepart?"/department/save":"/business/save",method:"post",successTip:!0,loading:this.$loading.open(),data:n}).then(function(e){0===e.error_code&&(t.isEdit=!1,t.id=e.data.id)})}}}},"m3w+":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"发票审核"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v(t._s(t.mainCompany.contract_name)+" ["+t._s(t.mainCompany.contract_number)+"] - 合同开票信息")]),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"z-space-between"},[a("div",[t._v("【原合同金额："+t._s(t.mainCompany.contract_currency_amount)+" ("+t._s(t.mainCompany.contract_currency_type_id)+") 】 - 【已开票金额："+t._s(t.mainCompany.invoice_amount)+" ("+t._s(t.mainCompany.contract_currency_type_id)+") 】 = 【未开票金额："+t._s(t.mainCompany.contract_currency_amount-t.mainCompany.invoice_amount)+" ("+t._s(t.mainCompany.contract_currency_type_id)+") 】")])])]),t._v(" "),a("div",{staticClass:"z-block-content z-has-datepicker"},[a("b-table",{attrs:{data:t.companyInvoiceList,bordered:!0,"mobile-cards":!0,detailed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"签约公司"}},[a("router-link",{attrs:{to:"/companies/"+(e.row.signing_company_id||e.row.sign_company_id)}},[t._v(t._s(e.row.company_name))])],1),t._v(" "),a("b-table-column",{attrs:{label:"注册地址"}},[t._v(t._s(e.row.reg_address))]),t._v(" "),a("b-table-column",{attrs:{label:"联系电话"}},[t._v(t._s(e.row.tel))]),t._v(" "),a("b-table-column",{attrs:{label:"纳税人识别号"}},[t._v(t._s(e.row.nsrsbh))]),t._v(" "),a("b-table-column",{attrs:{label:"开户行(账号)"}},[t._v(t._s(e.row.bank)+"("+t._s(e.row.bank_number)+")")])]}},{key:"detail",fn:function(e){return[a("div",{staticClass:"z-block-title"},[a("b",[t._v("总数："+t._s(e.row.contract_invoice.length))])]),t._v(" "),a("b-table",{attrs:{data:e.row.contract_invoice},scopedSlots:t._u([{key:"default",fn:function(n){return[a("b-table-column",{attrs:{label:"乙方签约公司"}},[t._v(t._s(t.mainCompany.party_b_name))]),t._v(" "),a("b-table-column",{attrs:{label:"开票类型"}},[a("b-field",[n.row.isEdit&&t.isRole(t.ROLE.shangwu)?a("b-select",{ref:"invoice_type_id_"+n.index,attrs:{required:""},model:{value:n.row.invoice_type_id,callback:function(e){t.$set(n.row,"invoice_type_id",e)},expression:"subProps.row.invoice_type_id"}},t._l(t.mainCompany.contract_invoice_type,function(e){return a("option",{domProps:{value:e.key}},[t._v(t._s(e.value))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(n.row.invoice_type_name))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"币种"}},[t._v(t._s(n.row.currency_type_name))]),t._v(" "),a("b-table-column",{attrs:{label:"开票金额"}},[a("b-field",[n.row.isEdit&&t.isRole(t.ROLE.shangwu)?a("b-input",{ref:"invoice_amount_"+n.index,attrs:{required:""},model:{value:n.row.invoice_amount,callback:function(e){t.$set(n.row,"invoice_amount",e)},expression:"subProps.row.invoice_amount"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(n.row.invoice_amount))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"开票内容"}},[a("b-field",[n.row.isEdit&&t.isRole(t.ROLE.shangwu)?a("b-select",{ref:"invoice_content_"+n.index,attrs:{required:""},model:{value:n.row.invoice_content,callback:function(e){t.$set(n.row,"invoice_content",e)},expression:"subProps.row.invoice_content"}},t._l(t.selectList,function(e){return a("option",{domProps:{value:e}},[t._v("\n                                            "+t._s(e)+"\n                                        ")])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(n.row.invoice_content))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"申请时间"}},[t._v(t._s(n.row.entered_date))]),t._v(" "),a("b-table-column",{attrs:{label:"申请状态"}},[t._v(t._s(n.row.approve_status_name))]),t._v(" "),a("b-table-column",{attrs:{label:"认证状态"}},[t._v(t._s(n.row.auth?"已认证":"未认证"))]),t._v(" "),a("b-table-column",{attrs:{label:"发票编号"}},[n.row.isEdit&&t.isRole(t.ROLE.fapiao)?a("b-field",[a("b-input",{ref:"invoice_number_"+n.index,attrs:{required:""},model:{value:n.row.invoice_number,callback:function(e){t.$set(n.row,"invoice_number",e)},expression:"subProps.row.invoice_number"}})],1):[t._v(t._s(n.row.invoice_number))]],2),t._v(" "),a("b-table-column",{attrs:{label:"开票时间"}},[a("b-field",[n.row.isEdit&&t.isRole(t.ROLE.fapiao)?a("b-datepicker",{on:{input:function(e){n.row.invoice_date=t.zDateFormatter(e)}},model:{value:n.row.invoiceDate,callback:function(e){t.$set(n.row,"invoiceDate",e)},expression:"subProps.row.invoiceDate"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(n.row.invoice_date))])],1)],1),t._v(" "),a("b-table-column",{attrs:{label:"驳回原因"}},[t.isCheck&&n.row.isEdit&&t.isRole(t.ROLE.fapiao)?a("b-field",[a("b-input",{ref:"reject_reason_"+n.index,attrs:{required:n.row.reasonRequired},model:{value:n.row.reject_reason,callback:function(e){t.$set(n.row,"reject_reason",e)},expression:"subProps.row.reject_reason"}})],1):[t._v(t._s(n.row.reject_reason))]],2),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[t.hasPermission("crm_new.contract.list.fapiaodelete")?a("button",{staticClass:"button is-link",on:{click:function(a){t.deleteInvoice(n.row,e.row,n.index)}}},[t._v("删除")]):t._e(),t._v(" "),n.row.auth?t._e():[t.checkStatus(n.row,[2])&&t.isRole(t.ROLE.shangwu)?a("button",{staticClass:"button is-link",on:{click:function(e){t.authInvoice(n.row)}}},[t._v("认证")]):t._e(),t._v(" "),n.row.isEdit?[t.checkStatus(n.row,[0,3])&&t.isRole(t.ROLE.shangwu)||t.checkStatus(n.row,[2])&&t.isRole(t.ROLE.fapiao)?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveInvoice(n.row,e.row,n.index)}}},[t._v("保存")]):t._e()]:[t.checkStatus(n.row,[3])&&t.isRole(t.ROLE.shangwu)||t.checkStatus(n.row,[2])&&t.isRole(t.ROLE.fapiao)?a("button",{staticClass:"button is-link",on:{click:function(t){n.row.isEdit=!0}}},[t._v("编辑")]):t._e()],t._v(" "),t.checkStatus(n.row,[1])&&t.isRole(t.ROLE.fapiao)?[a("button",{staticClass:"button is-link",on:{click:function(e){t.passInvoice(n.row,n.index)}}},[t._v("通过")]),t._v(" "),a("button",{staticClass:"button is-link",on:{click:function(e){t.rejectInvoice(n.row,n.index)}}},[t._v("驳回")])]:t._e()]],2)]}}])}),t._v(" "),t.isRole(t.ROLE.shangwu)?a("button",{staticClass:"button is-primary",on:{click:function(a){t.addInvoice(e.row)}}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e()]}}])})],1)])])},staticRenderFns:[]}},m6pK:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"回款认领"}},[t.hasPermission("crm_new.finance.pool.import")?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("回款导入")])]),t._v(" "),a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"z-space-between"},[a("b-field",{staticClass:"z-upload",attrs:{horizontal:"",expanded:"",label:"请选择回款文件"}},[a("b-upload",{staticClass:"is-primary",on:{input:t.fileIsOk},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传文件")])],1)]),t._v(" "),t.files&&t.files.length?a("div",[a("span",{staticClass:"file-name"},[t._v(t._s(t.files[0].name))])]):t._e()],1)],1),t._v(" "),a("p",[t._v("\n                说明："),a("br"),t._v("\n                1.文件支持xls和xlsx两种格式，其它格式不支持"),a("br"),t._v("\n                2.文件必须使用规定模板填写，谢谢合作。"),a("a",{staticStyle:{color:"red"},attrs:{href:"https://crm-bgm.smzdm.com/file_template/回款记录模板.xlsx"}},[t._v("点击这里下载模板文件")])]),t._v(" "),a("p",{staticClass:"btn-group"},[a("button",{staticClass:"button is-primary",on:{click:t.uploadForm}},[t._v("导入")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.resetForm}},[t._v("重置")])]),t._v(" "),a("p",{staticClass:"importResult",domProps:{innerHTML:t._s(t.resultString)}})])]):t._e(),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"回款状态"}},[a("b-select",{model:{value:t.defaultStatus,callback:function(e){t.defaultStatus=e},expression:"defaultStatus"}},t._l(t.isStatus,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"交易流水号"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.number,expression:"number"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.number},on:{input:function(e){e.target.composing||(t.number=e.target.value)}}})]),t._v(" "),t.permission?a("b-field",{attrs:{label:"是否删除"}},[a("b-select",{model:{value:t.defaultDelete,callback:function(e){t.defaultDelete=e},expression:"defaultDelete"}},t._l(t.isDelete,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1):t._e(),t._v(" "),a("b-field",{attrs:{label:"回款类型"}},[a("b-select",{model:{value:t.defaultClaimType,callback:function(e){t.defaultClaimType=e},expression:"defaultClaimType"}},t._l(t.claimType,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"交易时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{"min-date":t.enteredDateStart},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"审核时间"}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.approveDateEnd},model:{value:t.approveDateStart,callback:function(e){t.approveDateStart=e},expression:"approveDateStart"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{"min-date":t.approveDateStart},model:{value:t.approveDateEnd,callback:function(e){t.approveDateEnd=e},expression:"approveDateEnd"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"打款公司"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.signCompany,expression:"signCompany"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.signCompany},on:{input:function(e){e.target.composing||(t.signCompany=e.target.value)}}})])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),t.hasPermission("crm_new.finance.pool.export")?a("a",{staticClass:"button is-primary",on:{click:t.exportHandle}},[t._v("导出")]):t._e()])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))]),t._v(" "),a("b",[t._v("已认领金额合计"+t._s(t.totalAmount))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.data,loading:t.isLoading,striped:""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"id",label:"序号"}},[t._v("\n                    "+t._s(e.row.id)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"transaction_number",label:"交易流水号"}},[e.row.edit?a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.transaction_number,expression:"props.row.transaction_number"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:e.row.transaction_number},on:{input:function(a){a.target.composing||t.$set(e.row,"transaction_number",a.target.value)}}}):a("div",[t._v(t._s(e.row.transaction_number))])]),t._v(" "),a("b-table-column",{attrs:{field:"sign_company_name",label:"打款公司名称"}},[e.row.edit?a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.sign_company_name,expression:"props.row.sign_company_name"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:e.row.sign_company_name},on:{input:function(a){a.target.composing||t.$set(e.row,"sign_company_name",a.target.value)}}}):a("div",[t._v(t._s(e.row.sign_company_name))])]),t._v(" "),a("b-table-column",{attrs:{field:"currency_amount",label:"金额"}},[e.row.edit?a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.currency_amount,expression:"props.row.currency_amount"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:e.row.currency_amount},on:{input:function(a){a.target.composing||t.$set(e.row,"currency_amount",a.target.value)}}}):a("div",[t._v(t._s(e.row.currency_amount))])]),t._v(" "),a("b-table-column",{attrs:{field:"currency_id",label:"币种"}},[e.row.edit?a("b-select",{model:{value:e.row.defaultCurrency,callback:function(a){t.$set(e.row,"defaultCurrency",a)},expression:"props.row.defaultCurrency"}},t._l(e.row.currencyList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])})):a("div",[t._v(t._s(t.currencies["type_"+e.row.currency_id]))])],1),t._v(" "),a("b-table-column",{attrs:{field:"cash_collection_date",label:"交易时间"}},[e.row.edit?a("b-datepicker",{attrs:{placeholder:"Click to select...",icon:"calendar-today"},model:{value:e.row.default_date,callback:function(a){t.$set(e.row,"default_date",a)},expression:"props.row.default_date"}}):a("div",[t._v(t._s(e.row.cash_collection_date))])],1),t._v(" "),a("b-table-column",{attrs:{field:"use_amount",label:"已认领金额"}},[t._v("\n                    "+t._s(e.row.use_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"cash_type_text",label:"回款类型"}},[t._v("\n                    "+t._s(e.row.cash_type_text)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"status_id_text",label:"回款状态"}},[t._v("\n                    "+t._s(e.row.status_id_text)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"is_deleted",label:"是否删除"}},[t._v("\n                    "+t._s(e.row.is_deleted)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"摘要"}},[e.row.edit?a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.remark,expression:"props.row.remark"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:e.row.remark},on:{input:function(a){a.target.composing||t.$set(e.row,"remark",a.target.value)}}}):a("div",[t._v(t._s(e.row.remark))])]),t._v(" "),a("b-table-column",{attrs:{label:"认领"}},[t.hasPermission("crm_new.finance.pool.renling")?a("a",{staticClass:"button is-link",on:{click:function(a){t.claimHandle(e.row)}}},[t._v("我要认领")]):t._e(),t._v(" "),t.hasPermission("crm_new.finance.pool.mingxi")?a("a",{staticClass:"button is-link",on:{click:function(a){t.showDetail(e.row)}}},[t._v("认领明细")]):t._e()]),t._v(" "),t.permission?a("b-table-column",{attrs:{label:"操作"}},[e.row.edit?a("a",{staticClass:"button is-link",on:{click:function(a){t.submitEdit(e.row.id,e.row,e.index)}}},[t._v("提交")]):[t.hasPermission("crm_new.finance.pool.update")&&1===e.row.can_edit_delete?a("a",{staticClass:"button is-link",on:{click:function(a){t.urlEdit(e.row)}}},[t._v("修改")]):t._e()],t._v(" "),t.hasPermission("crm_new.finance.pool.delete")&&1===e.row.can_edit_delete?a("a",{staticClass:"button is-danger",on:{click:function(a){t.deleteHandle(e.row.id,e.index)}}},[t._v("删除")]):t._e()],2):t._e()]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>1,expression:"total > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("认领明细")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"approve-detail-title"},[a("span",[t._v("交易流水号："+t._s(t.thisNumber))]),t._v(" "),a("span",[t._v("回款时间："+t._s(t.thisDate))]),t._v(" "),a("span",[t._v("回款金额："+t._s(t.thisAmount))]),a("br"),t._v(" "),a("span",[t._v("币种："+t._s(t.currencies["type_"+t.thisCurrency]))]),t._v(" "),a("span",[t._v("可认领金额："+t._s(t.canBeAmount))])]),t._v(" "),a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.isDetailTotal))])]),t._v(" "),a("b-table",{attrs:{data:t.list,columns:t.columns}},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isDetailTotal>1,expression:"isDetailTotal > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.isDetailTotal,current:t.modalCurrPage,"per-page":t.modalPerPage},on:{"update:current":function(e){t.modalCurrPage=e},change:t.modalPageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                    跳转到\n                                    "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.isDetailTotal/t.modalPerPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.modalCurrPage=Number(t.modalJumpPage)}},model:{value:t.modalJumpPage,callback:function(e){t.modalJumpPage=e},expression:"modalJumpPage"}}),t._v("\n                                    页\n                                    "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.modalCurrPage=Number(t.modalJumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)]),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},mGAF:function(t,e,a){var n=a("VU/8")(a("3o4n"),a("0xJ/"),null,null);t.exports=n.exports},mHlE:function(t,e){},mMIa:function(t,e,a){a("YG1J");var n=a("VU/8")(a("xL/t"),a("G39i"),null,null);t.exports=n.exports},mUJv:function(t,e,a){a("CHKI");var n=a("VU/8")(a("GdUM"),a("xwwG"),"data-v-7340b12a",null);t.exports=n.exports},mexl:function(t,e){},mvNO:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-table-edit"},[t.invoce.length?a("b-table",{attrs:{data:t.invoce,bordered:!0,"mobile-cards":!0,loading:t.invoceLoading},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"电话"}},[e.row.isEdit?a("b-field",{attrs:{type:e.row.fieldType,message:e.row.fieldMessage}},[a("b-input",{ref:"invocePhone_"+e.index,attrs:{type:"tel",required:"",expanded:""},model:{value:e.row.tel,callback:function(a){t.$set(e.row,"tel",a)},expression:"props.row.tel"}})],1):[t._v(t._s(e.row.tel))]],2),t._v(" "),a("b-table-column",{attrs:{label:"注册地址"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"invoceRegAddress_"+e.index,attrs:{maxlength:"200",required:"",expanded:""},model:{value:e.row.reg_address,callback:function(a){t.$set(e.row,"reg_address",a)},expression:"props.row.reg_address"}})],1):[t._v(t._s(e.row.reg_address))]],2),t._v(" "),a("b-table-column",{attrs:{label:"纳税人识别号"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"invoceTaxNumber_"+e.index,attrs:{required:"",expanded:""},model:{value:e.row.nsrsbh,callback:function(a){t.$set(e.row,"nsrsbh",a)},expression:"props.row.nsrsbh"}})],1):[t._v(t._s(e.row.nsrsbh))]],2),t._v(" "),a("b-table-column",{attrs:{label:"开户行"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"invoceBank_"+e.index,attrs:{required:"",expanded:""},model:{value:e.row.bank,callback:function(a){t.$set(e.row,"bank",a)},expression:"props.row.bank"}})],1):[t._v(t._s(e.row.bank))]],2),t._v(" "),a("b-table-column",{attrs:{label:"开户行账号"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"invoceBankNumber_"+e.index,attrs:{required:"",expanded:""},model:{value:e.row.bank_number,callback:function(a){t.$set(e.row,"bank_number",a)},expression:"props.row.bank_number"}})],1):[t._v(t._s(e.row.bank_number))]],2),t._v(" "),a("b-table-column",{attrs:{label:"审核状态"}},[t._v("\n                "+t._s(e.row.approved_status_text)+"\n            ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"130"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveInvoce(e.index,!1)}}},[t._v("保存")]):t._e(),t._v(" "),e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveInvoce(e.index,!0)}}},[t._v("保存并提交审核")]):0===e.row.approved_status_id||3===e.row.approved_status_id||4===e.row.approved_status_id?a("button",{staticClass:"button is-link",on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")]):t._e(),t._v(" "),1===e.row.approved_status_id?[a("button",{staticClass:"button is-link",on:{click:function(a){t.passInvoice(e.row)}}},[t._v("通过")]),t._v(" "),a("button",{staticClass:"button is-link",on:{click:function(a){t.rejectInvoice(e.row)}}},[t._v("驳回")])]:t._e(),t._v(" "),2===e.row.approved_status_id?[a("button",{staticClass:"button is-link",on:{click:function(a){t.reclaimInvoice(e.row)}}},[t._v("再驳回")])]:t._e(),t._v(" "),e.row.id&&0!==e.row.approved_status_id?t._e():a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteInvoce(e.index)}}},[t._v("删除")])],2)]}}])},[t.totalPage>1?a("template",{slot:"footer"},[a("div",{staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalInvoce,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                    跳转到\n                    "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                    页\n                    "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)]):t._e()],2):t._e(),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.addInvoce}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1)],1)},staticRenderFns:[]}},n4ni:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=n(i),r=a("lHA8"),o=n(r),c=a("c/Tr"),l=n(c),d=a("LZT1"),u=n(d),_=a("Km5v"),p=n(_),m=a("uzIf"),h=n(m),f=a("O4Lo"),v=n(f);e.default={props:{page:{type:Number,default:null}},data:function(){return{companies:[],signingCompany:"",signingCompanyId:"",companyName:"",isFetching:!1,companyList:[],clientList:[],clientId:"",clientName:"",departments:[],contractDirector:[],create:!1,table_label:[],total:[],user_id:"",user_name:"",department_id:621,business_id:"",BUSINESS:[],el:null,ifserch:!1,clickBtn:!1,start_time:null,end_time:null,search_time_by:"month",client_type_id:null,show:2,party_b_name:"",rebate:!0,contract_cost:!1,contract_cost1:!1,contract_cost2:!1,release:[],isPaginated:!0,isPaginationSimple:!1,currentPage:1,defaultSortDirection:"asc",totalRelease:0,loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,forSearch:!0,cooperation_type:"",cooperation_obj:null,hard_wide_detail_type:null,levelData:[],level:null,contract_brand_id:"",contract_second_brand_id:"",mediaData:[],useMediaData:[],positionData:[],usePositionData:[],search_media_id:"",search_media_name:"",search_position_id:"",search_position_name:"",mediaSelectList:[],departmentReadonly:!1,isHeader:!1,userReadonly:!1,departmentName:null,clickGet:0,clickReset:0}},components:{SelectDate:h.default,CooperationSelect:p.default},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.user_name.toLowerCase())>=0})},filteredMediaDataArray:function(){var t=this;return this.search_media_name?this.mediaData.filter(function(e){return e.a_name.indexOf(t.search_media_name)>=0}):this.mediaData},filteredPositionDataArray:function(){var t=this;return this.search_position_name?this.usePositionData.filter(function(e){return e.z_name.indexOf(t.search_position_name)>=0}):this.usePositionData},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},watch:{currPage:function(t){var e=!1;e=!(this.clickReset>this.clickGet),"2"!==this.show&&(this.el=1,this.ifserch=e,this.clickBtn=this.clickBtn,this.getRelease(1,e))},page:function(t){this.currPage=t||1},department_id:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.user_id=null,this.user_name="",this.getDirector({department_id:t}))}},mounted:function(){console.log(this.isHeader,!this.isShangwu()),this.getDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getRelease(null,!1);var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},created:function(){this.getCompany(),this.getLevel(),this.getMediaPosition(),this.getAllDepartment()},methods:{getAllDepartment:function(){var t=this;return this.ajax({url:"/business/index",params:{level:2}}).then(function(e){var a=(0,u.default)(e.data);t.BUSINESS=a,t.BUSINESS.unshift("")})},getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name)},searchCompany:(0,v.default)(function(){this.isFetching=!0,this.getCompanies()},500),getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.signingCompany}}).then(function(e){t.companies=e.data.lists,t.isFetching=!1})},onCompanySelected:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},onUserSelected:function(t){t&&(this.user_id=t.id)},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},onDelPosition:function(t){this.mediaSelectList.splice(t,1)},onAddPosition:function(){this.search_media_id?(this.mediaSelectList.push({mediaId:this.search_media_id,mediaName:this.search_media_name,positionId:this.search_position_id?this.search_position_id:this.getPositionWithMediaId(this.search_media_id),positionName:this.search_position_name}),this.search_media_id=null,this.search_media_name=null,this.search_position_id=null,this.search_position_name=null,this.usePositionData=[]):alert("媒体不能为空")},getPositionWithMediaId:function(t){for(var e=0;e<this.mediaData.length;e++)if(this.mediaData[e].a_id===t)return this.mediaData[e].zone.map(function(t){return t.z_id}).join(",");return""},onMediaSelected:function(t){if(t){this.search_media_id=t.a_id,this.search_media_name=t.a_name;for(var e=0;e<this.mediaData.length;e++)this.mediaData[e].a_id===t.a_id&&(this.mediaData[e].zone&&this.mediaData[e].zone.length>0?this.usePositionData=this.mediaData[e].zone:this.usePositionData=[]);this.search_position_name=null,this.search_position_id=null}},onPositionSelected:function(t){t&&(this.search_position_id=t.z_id,this.search_position_name=t.z_name)},getMediaPosition:function(){var t=this;return this.ajax({url:"/api/contract_ad/get_media_position_lists"}).then(function(e){t.mediaData=e.data,t.useMediaData=t.mediaData})},getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")},onSelectCooperationType:function(){this.hard_wide_detail_type=""},getRelease:function(t,e){var a=this;this.create=!1,this.loading=!0,this.el=t,console.log(t,"check",this.start_time,this.end_time);var n="";n=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";for(var i=[],r=0;r<this.mediaSelectList.length;r++)i=i.concat(this.mediaSelectList[r].positionId.split(","));i=(0,l.default)(new o.default(i));var c={client_name:this.clientName,company_name:this.signingCompany,department_id:this.department_id,business_id:this.business_id,user_id:this.user_id,start_time:this.start_time,end_time:this.end_time,search_time_by:this.search_time_by,show:this.show.toString(),party_b_name:this.party_b_name,contract_cost:Number(this.contract_cost),contract_cost1:Number(this.contract_cost1),contract_cost2:Number(this.contract_cost2),cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type,contract_brand_id:n,group_name:this.companyName,page:this.currPage,size:this.perPage,rebate:Number(this.rebate),position_ids:i,client_type_id:this.client_type_id};c=this.delNullParam(c),new s.default(function(t,n){a.isShangwu()?e?t():(a.contractDirector=[],1===a.$root.crmUser.is_headman?(a.isHeader=!0,t()):(a.isHeader=!1,a.departmentReadonly=!0,a.userReadonly=!0,a.contractDirector=[{name:a.$root.crmUser.username,id:a.$root.crmUser.id}],a.userName=a.$root.crmUser.name,a.user_id=a.$root.crmUser.id,c.user_id=a.$root.crmUser.id,a.departmentId=a.$root.crmUser.department_id,c.departmentId=a.$root.crmUser.department_id,a.departmentName=a.$root.crmUser.department_name,t())):t()}).then(function(){a.ajax({url:"/contract_release_search/index",loading:a.$loading.open(),method:"post",data:c}).then(function(t){a.table_label=[],a.release=[],a.processData(t),a.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})})},delNullParam:function(t){for(var e in t)null!==t[e]&&void 0!==t[e]||delete t[e];return t},exportAll:function(){var t=this;this.clickBtn=!this.clickBtn;var e="";e=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";for(var a=[],n=0;n<this.mediaSelectList.length;n++)a=a.concat(this.mediaSelectList[n].positionId.split(","));a=(0,l.default)(new o.default(a));var i={client_name:this.clientName,company_name:this.signingCompany,department_id:this.department_id,business_id:this.business_id,user_id:this.user_id,start_time:this.start_time,end_time:this.end_time,search_time_by:this.search_time_by,show:this.show.toString(),party_b_name:this.party_b_name,contract_cost:Number(this.contract_cost),contract_cost1:Number(this.contract_cost1),contract_cost2:Number(this.contract_cost2),page:this.currPage,size:this.perPage,rebate:Number(this.rebate),cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type,contract_brand_id:e,position_ids:a,group_name:this.companyName,client_type_id:this.client_type_id};i=this.delNullParam(i),this.ajax({url:"/contract_release_search/export",method:"post",data:i}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:1===a.error_code&&e.exportLive(t)})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/get_children_by_pid",params:{pid:"629,621,1499"}}).then(function(e){if(0===e.error_code){var a=(0,u.default)(e.data);t.departments=a,!t.isHeader&&t.isShangwu()||t.getDirector({department_id:621})}})},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id",method:"post",data:t}).then(function(t){0===t.error_code&&t.data&&t.data.rows?e.contractDirector=t.data.rows:e.contractDirector=[]})},resetParams:function(){this.contractDirector.length>1&&(this.user_id=null),!this.isHeader&&this.isShangwu()||(this.department_id="",this.user_id="",this.user_name=""),this.clientId=null,this.clientName=null,this.signingCompany="",this.signingCompanyId="",this.start_time=null,this.end_time=null,this.search_time_by="month",this.show=2,this.party_b_name="",this.rebate=!0,this.contract_cost=!1,this.contract_cost1=!1,this.contract_cost2=!1,this.cooperation_type="",this.hard_wide_detail_type="",this.contract_brand_id="",this.contract_second_brand_id="",this.usePositionData=[],this.level=null,this.search_media_id="",this.search_media_name="",this.search_position_id="",this.search_position_name="",this.mediaSelectList=[],this.clickReset=this.clickGet,this.clickReset+=1,this.el=null,this.client_type_id=null,this.companyName="",this.business_id=""},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?(this.el=1,this.ifserch=t,this.clickBtn=!this.clickBtn):this.currPage=1,this.clickGet+=1},processData:function(t){this.loading=!0;var e=[],a={},n=[],i=void 0,s=void 0,r=void 0;if("1"===this.show.toString()){for(i in t.data)a=t.data[i],"guonei"===i?a["业务线"]="国内":"haiwai"===i?a["业务线"]="海外":"qiche"===i?a["业务线"]="汽车":"oumei"===i?a["业务线"]="欧美":"合计"===i?a["业务线"]="合计":"taoxi"===i?a["业务线"]="淘系":"domestic_expansion"===i&&(a["业务线"]="新业务-国际拓展部"),"合计"===i?e.unshift(a):e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var o=n.pop();n.unshift(o),r=e.length}else if("2"===this.show.toString()){this.isPaginated=!1;for(i in t.data)a=t.data[i].department_compute,a["部门名称"]=t.data[i].name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var c=n.pop();n.unshift(c),r=e.length}else if("3"===this.show.toString()){if(t.data.counts>0){for(var l=0;l<t.data.lists.length;l++)a=t.data.lists[l].user_compute,a["部门名称"]=t.data.lists[l].user_info_department.department_name,a["负责人"]=t.data.lists[l].user_info.name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var d=n.pop();n.unshift(d),d=n.pop(),n.unshift(d)}r=t.data.counts}else if("4"===this.show.toString()){if(t.data.counts>0){for(var u=0;u<t.data.lists.length;u++)a=t.data.lists[u].company_compute,a["签约公司"]=t.data.lists[u].company_name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var _=n.pop();n.unshift(_)}r=t.data.counts}else if("5"===this.show.toString()){if(t.data.counts>0){for(var p=0;p<t.data.lists.length;p++)a=t.data.lists[p].brand_compute,a["品牌名称"]=t.data.lists[p].brand_name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var m=n.pop();n.unshift(m)}r=t.data.counts}else if("6"===this.show.toString()){if(t.data.counts>0){for(var h=0;h<t.data.lists.length;h++)a=t.data.lists[h].business_compute,a["事业部名称"]=t.data.lists[h].business_name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var f=n.pop();n.unshift(f)}r=t.data.counts}else if("7"===this.show.toString()){if(t.data.counts>0){for(var v=0;v<t.data.lists.length;v++)a=t.data.lists[v].business_compute,a["事业部"]=t.data.lists[v].business_name,a["软性合作方式"]=t.data.lists[v].detail_cooperation_name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var b=n.pop();n.unshift(b),b=n.pop(),n.unshift(b)}r=t.data.counts}else if("8"===this.show.toString()){if(t.data.counts>0){for(var g=0;g<t.data.lists.length;g++)a=t.data.lists[g].contract_brand_compute,a["行业名称"]=t.data.lists[g].contract_brand_name,e.push(a);for(s in e[0])"合计"===s?n.unshift({name:s}):n.push({name:s});var y=n.pop();n.unshift(y)}r=t.data.counts}this.totalRelease=r,this.totalPage=Math.ceil(r/this.perPage),0===this.totalPage&&(this.totalPage=1),1!==this.currPage&&this.currPage!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+this.currPage):1===this.currPage&&this.$router.push(this.$router.currentRoute.path),"2"!==this.show.toString()&&(this.isPaginated=!0),this.release=e,this.table_label=n,this.create=!0},getCooperation:function(t,e){if(this.cooperation_obj=t,this.cooperation_type=this.cooperation_obj.cooperation_type,e)this.hard_wide_detail_type=e;else{var a=[];this.cooperation_obj.level&&this.cooperation_obj.level.length?(this.cooperation_obj.level.map(function(t){a.push(t.id)}),this.hard_wide_detail_type=a.join(",")):this.hard_wide_detail_type=e}},getDate:function(t,e,a,n){this.start_time=t,this.end_time=e,this.search_time_by=n,console.log("selectDate",t,e,a,n),1===this.el&&this.getRelease(this.el,this.ifserch)}}}},nISF:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"客户列表"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门"}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"我方负责人"}},[t.userReadonly?a("b-input",{attrs:{disabled:t.userReadonly},model:{value:t.currUserName,callback:function(e){t.currUserName=e},expression:"currUserName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称"}},[a("b-autocomplete",{attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title"},on:{select:t.onBrandSelected},model:{value:t.brandName,callback:function(e){t.brandName=e},expression:"brandName"}})],1),t._v(" "),a("b-field",{attrs:{label:"产品线"}},[a("b-select",{model:{value:t.productLineId,callback:function(e){t.productLineId=e},expression:"productLineId"}},t._l(t.productLines,function(e){return a("option",{domProps:{value:e.product_line_id}},[t._v(t._s(e.product_line_name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"产品线类型"}},[a("b-select",{model:{value:t.brand_product_type,callback:function(e){t.brand_product_type=e},expression:"brand_product_type"}},t._l(t.levelData,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.val))])}))],1),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClientsList,focus:t.getClientsList,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团名称"}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanySelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户编号"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.numberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"client_number"},on:{input:t.getNumberList,focus:t.getNumberList,select:t.onNumberSelected},model:{value:t.clientNumber,callback:function(e){t.clientNumber=e},expression:"clientNumber"}})],1),t._v(" "),a("referrer-name",{attrs:{isReferrer:t.is_referrer,referrerName:t.referrer_name},on:{getReferrer:t.getReferrer,getReferrerType:t.getReferrerType}}),t._v(" "),a("b-field",{attrs:{label:"接入商家中心"}},[a("b-select",{model:{value:t.accessSJZX,callback:function(e){t.accessSJZX=e},expression:"accessSJZX"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])])],1),t._v(" "),a("b-field",{attrs:{label:"接入星罗"}},[a("b-select",{model:{value:t.accessXLSM,callback:function(e){t.accessXLSM=e},expression:"accessXLSM"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])])],1),t._v(" "),a("b-field",{attrs:{label:"客户等级"}},[a("b-select",{model:{value:t.clientLevelId,callback:function(e){t.clientLevelId=e},expression:"clientLevelId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("A")]),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("B")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("C")])])],1),t._v(" "),a("b-field",{attrs:{label:"客户信誉等级"}},[a("b-select",{model:{value:t.newest_degree,callback:function(e){t.newest_degree=e},expression:"newest_degree"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("待评级")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("1星")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("2星")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("3星")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("4星")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("5星")])])],1),t._v(" "),a("b-field",{attrs:{label:"KA客户"}},[a("b-select",{model:{value:t.is_ka,callback:function(e){t.is_ka=e},expression:"is_ka"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("KA客户")])])],1),t._v(" "),a("b-field",{attrs:{label:"流失客户"}},[a("b-select",{model:{value:t.is_wastage,callback:function(e){t.is_wastage=e},expression:"is_wastage"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("流失客户")])])],1),t._v(" "),a("b-field",{attrs:{label:"审核状态"}},[a("b-select",{model:{value:t.approveStatusId,callback:function(e){t.approveStatusId=e},expression:"approveStatusId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("未提交")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("待审核")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("审核通过")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("驳回待修改")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("再驳回待修改")])])],1),t._v(" "),a("b-field",{attrs:{label:"登记日期",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{"min-date":t.enteredDateStart},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportALL}},[t._v("导出")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.totalClients))]),t._v(" "),a("router-link",{staticClass:"button is-primary",attrs:{to:"/clients/add",permission:"aaa"}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("添加客户")])],1)],1),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.clients,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"客户编号",field:"number",sortable:""}},[t._v("\n                    "+t._s(e.row.number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name",sortable:""}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户类型"}},[t._v("\n                    "+t._s(e.row.client_type)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户等级",field:"client_level_id",sortable:""}},[t._v("\n                    "+t._s(e.row.level)+"级客户\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户信誉等级",field:"newest_degree",sortable:""}},[t._v("\n                    "+t._s(e.row.newest_degree?e.row.newest_degree+"星":"待评级")+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"品牌名称",field:"brand_id",sortable:""}},[t._v("\n                    "+t._s(e.row.brand)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"产品线",field:"product_line_id",sortable:""}},[t._v("\n                    "+t._s(e.row.product_line_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"产品线类型",field:"brand_product_type"}},[t._v("\n                    "+t._s(e.row.brand_product_type)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"流失客户",field:"is_wastage",sortable:""}},[t._v("\n                    "+t._s(e.row.is_wastage)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"KA客户",field:"is_ka",sortable:""}},[t._v("\n                    "+t._s(e.row.is_ka)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"地址",field:"address",sortable:""}},[t._v("\n                    "+t._s(e.row.address)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"我方负责人",field:"user_id",sortable:""}},[t._v("\n                    "+t._s(e.row.principal_user)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"更新时间",field:"updated_date",sortable:""}},[t._v("\n                    "+t._s(e.row.updated_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"登记时间",field:"entered_date",sortable:""}},[t._v("\n                    "+t._s(e.row.entered_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态"}},[t._v("\n                    "+t._s(e.row.approve_status)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[t.hasPermission("crm_new.kehu.list.update")&&(0===e.row.approve_status_id||3===e.row.approve_status_id||4===e.row.approve_status_id||2===e.row.approve_status_id&&2===e.row.client_level_id)?a("router-link",{staticClass:"button is-link",attrs:{to:"/clients/"+e.row.client_id+"/edit"}},[t._v("编辑")]):t._e(),t._v(" "),!t.hasPermission("crm_new.kehu.list.jiangji")||2===e.row.client_level_id||2!==e.row.approve_status_id&&3!==e.row.approve_status_id?t._e():a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.degradeC(e.row.client_id,e.row)}}},[t._v("降C")]),t._v(" "),t.hasPermission("crm_new.kehu.list.read")?a("router-link",{staticClass:"button is-link",attrs:{to:"/clients/"+e.row.client_id}},[t._v("查看")]):t._e(),t._v(" "),t.hasPermission("crm_new.kehu.list.zaibohui")&&2===e.row.approve_status_id?a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.recallClient(e.row.client_id,e.row)}}},[t._v("再驳回")]):t._e(),t._v(" "),t.hasPermission("crm_new.kehu.list.delete")&&"C"===e.row.level&&0===e.row.is_contract?a("a",{staticClass:"button is-danger",attrs:{href:"javascript:;"},on:{click:function(a){t.deleteClient(e.row.client_id,e.index)}}},[t._v("删除")]):t._e()],1),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("a",{staticClass:"button is-link",attrs:{href:"javascript:;"},on:{click:function(a){t.showClientLog(e.row.client_id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalClients,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1)])])],1)},staticRenderFns:[]}},nSoy:function(t,e){},"nZL+":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:t.form.id?"编辑返点框架信息":"新增返点框架信息"}},[a("div",{staticClass:"z-block reuireDisable"},[a("HeaderName",{attrs:{name:"基础信息"},on:{edit:function(e){t.edit("baseInfo")}}}),t._v(" "),this.form.id?[a("div",{staticClass:"searchName titleSeatch"},[a("p",[t._v("框架号："+t._s(t.baseInfo.frame_number))]),t._v(" "),a("p",[t._v("框架发布额："+t._s(t.baseInfo.release_amount))]),t._v(" "),a("p",[t._v("框架名称："+t._s(t.baseInfo.frame_name))]),t._v(" "),a("p",[t._v("框架负责人："+t._s(t.baseInfo.frame_leader))]),t._v(" "),a("p",[t._v("生效时间："+t._s(t.baseInfo.start_date)+" 至 "+t._s(t.baseInfo.end_date))])]),t._v(" "),a("div",{staticClass:"PartyA"},[a("HeaderName",{attrs:{name:"甲方签约公司"},on:{edit:function(e){t.edit("PartyA")}}}),t._v(" "),t.PartyA.length?a("div",{staticClass:"flex wrap margin20"},t._l(t.PartyA,function(e){return a("div",{key:e.id,staticClass:"space companyName"},[t._v("\n                        "+t._s(e.data_type_name)+"\n                    ")])})):t._e()],1),t._v(" "),a("div",{staticClass:"PartyB"},[a("HeaderName",{attrs:{name:"乙方签约公司"},on:{edit:function(e){t.edit("PartyB")}}}),t._v(" "),t.PartyB.length?a("div",{staticClass:"flex wrap margin20"},t._l(t.PartyB,function(e){return a("div",{key:e.id,staticClass:"space companyName"},[t._v("\n                        "+t._s(e.data_type_name)+"\n                    ")])})):t._e()],1),t._v(" "),a("div",{staticClass:"nonIndependentCustomers width800"},[a("HeaderName",{attrs:{showCount:!!+t.baseInfo.release_amount,amount:t.baseInfo.release_amount1,name:"非自主客户"},on:{edit:function(e){t.edit("nonIndependentCustomers")}}}),t._v(" "),t.nonIndependentCustomers.length?a("b-table",{staticClass:"margin20",attrs:{bordered:"",data:t.nonIndependentCustomers,columns:t.commonColumns}}):t._e()],1),t._v(" "),a("div",{staticClass:"independentCustomers width800"},[a("HeaderName",{attrs:{showCount:!!+t.baseInfo.release_amount,amount:t.baseInfo.release_amount2,name:"普通自主客户"},on:{edit:function(e){t.edit("independentCustomers")}}}),t._v(" "),t.independentCustomers.length?a("b-table",{staticClass:"margin20",attrs:{bordered:"",data:t.independentCustomers,columns:t.commonColumns}}):a("div",{staticClass:"margin20"})],1),t._v(" "),a("div",{staticClass:"specialBrandClient width800"},[a("HeaderName",{attrs:{name:"特殊品牌客户"},on:{edit:function(e){t.edit("specialBrandClient")}}}),t._v(" "),t.specialBrandClient.length?a("div",{staticClass:"margin20"},t._l(t.specialBrandClient,function(e){return a("b-collapse",{key:e.id,staticClass:"card",attrs:{animation:"slide"},scopedSlots:t._u([{key:"trigger",fn:function(n){return a("div",{staticClass:"card-header",attrs:{role:"button"}},[a("a",{staticClass:"card-header-icon"},[a("b-icon",{attrs:{icon:n.open?"menu-down":"menu-up"}})],1),t._v(" "),a("div",{staticClass:"card-header-title"},[a("div",[t._v(t._s(e.data_type_name))]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!+t.baseInfo.release_amount,expression:"!!+baseInfo.release_amount"}]},[t._v("返点对应发布额："+t._s(e.release_amount)+"（元）")])])])}}])},[a("div",{staticClass:"card-content"},[a("b-table",{attrs:{bordered:"",data:e.rule,columns:t.commonColumns}})],1)])})):t._e()],1),t._v(" "),a("div",{staticClass:"specialCategoryClient width800"},[a("HeaderName",{attrs:{name:"特殊品类客户"},on:{edit:function(e){t.edit("specialCategoryClient")}}}),t._v(" "),t.specialCategoryClient.length?a("div",{staticClass:"margin20"},t._l(t.specialCategoryClient,function(e){return a("b-collapse",{key:e.id,staticClass:"card",attrs:{animation:"slide"},scopedSlots:t._u([{key:"trigger",fn:function(n){return a("div",{staticClass:"card-header",attrs:{role:"button"}},[a("a",{staticClass:"card-header-icon"},[a("b-icon",{attrs:{icon:n.open?"menu-down":"menu-up"}})],1),t._v(" "),a("div",{staticClass:"card-header-title"},[a("div",[t._v(t._s(e.data_type_name))]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!!+t.baseInfo.release_amount,expression:"!!+baseInfo.release_amount"}]},[t._v("返点对应发布额："+t._s(e.release_amount)+"（元）")])])])}}])},[a("div",{staticClass:"card-content"},[a("b-table",{attrs:{bordered:"",data:e.rule,columns:t.commonColumns}})],1)])})):t._e()],1),t._v(" "),a("div",{staticClass:"rebateRevise w100"},[a("HeaderName",{attrs:{name:"返点修订值",add:""},on:{edit:function(e){t.add("rebateRevise")}}}),t._v(" "),t.rebateRevise.data&&t.rebateRevise.data.length?a("b-table",{staticClass:"margin20",attrs:{data:t.rebateRevise.data,bordered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?[a("b-table-column",{attrs:{field:"data_type",label:"修订类别"}},[a("b-select",{model:{value:t.rebateReviseMap.get(e.row).data_type,callback:function(a){t.$set(t.rebateReviseMap.get(e.row),"data_type",a)},expression:"rebateReviseMap.get(props.row).data_type"}},t._l(t.reviseType,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.data_type))])}))],1),t._v(" "),a("b-table-column",{attrs:{field:"data_type_id",label:"修订目标"}},[3!==t.rebateReviseMap.get(e.row).data_type&&4!==t.rebateReviseMap.get(e.row).data_type?a("b-select",{model:{value:t.rebateReviseMap.get(e.row).data_type_id,callback:function(a){t.$set(t.rebateReviseMap.get(e.row),"data_type_id",a)},expression:"rebateReviseMap.get(props.row).data_type_id"}},t._l(t.selectOption(t.rebateReviseMap.get(e.row)),function(e){return a("option",{key:e.data_type_id,domProps:{value:e.data_type_id}},[t._v(t._s(e.data_type_name))])})):3===t.rebateReviseMap.get(e.row).data_type?a("div",[t._v("非自主客户")]):a("div",[t._v("普通自主客户")])],1),t._v(" "),a("b-table-column",{attrs:{field:"value",label:"修订值"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.rebateReviseMap.get(e.row).revise_amount,expression:"rebateReviseMap.get(props.row).revise_amount"}],staticClass:"h27",attrs:{type:"number"},domProps:{value:t.rebateReviseMap.get(e.row).revise_amount},on:{input:function(a){a.target.composing||t.$set(t.rebateReviseMap.get(e.row),"revise_amount",a.target.value)}}})]),t._v(" "),a("b-table-column",{attrs:{field:"revise_date",label:"修订值所在月份"}},[a("b-datepicker",{attrs:{"min-date":t.minDate,type:"month"},model:{value:t.rebateReviseMap.get(e.row).revise_date,callback:function(a){t.$set(t.rebateReviseMap.get(e.row),"revise_date",a)},expression:"rebateReviseMap.get(props.row).revise_date"}})],1),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.rebateReviseMap.get(e.row).remark,expression:"rebateReviseMap.get(props.row).remark"}],staticClass:"h27",domProps:{value:t.rebateReviseMap.get(e.row).remark},on:{input:function(a){a.target.composing||t.$set(t.rebateReviseMap.get(e.row),"remark",a.target.value)}}})]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("button",{staticClass:"button is-primary btn-search",on:{click:function(a){t.saveRebateRevise(e.row)}}},[t._v("\n                                    保存\n                                ")]),t._v(" "),a("button",{staticClass:"button btn-search",on:{click:function(a){t.cancelEdit(e.row,e.index)}}},[t._v("\n                                    取消\n                                ")])])]:[a("b-table-column",{attrs:{field:"data_type",label:"修订类别"}},[t._v("\n                                "+t._s(t.reviseTypeForId[e.row.data_type])+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{field:"data_type_id",label:"修订目标"}},[t._v("\n                                "+t._s(e.row.data_type_name)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{field:"revise_amount",label:"修订值"}},[t._v("\n                                "+t._s(e.row.revise_amount)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{field:"revise_date",label:"修订值所在月份"}},[t._v("\n                                "+t._s(t.changeMonth(e.row.revise_date))+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[t._v("\n                                "+t._s(e.row.remark)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[parseInt(e.row.is_update)?t._e():[a("button",{staticClass:"button is-primary btn-search",on:{click:function(a){t.reviseEdit(e.row)}}},[t._v("\n                                        编辑\n                                    ")]),t._v(" "),a("button",{staticClass:"button btn-search",on:{click:function(a){t.deleteRebateRevise(e.row,e.index)}}},[t._v("\n                                        删除\n                                    ")])]],2)]]}}])}):t._e()],1)]:t._e(),t._v(" "),a("button",{staticClass:"mt20 button btn-search is-primary",on:{click:t.returnOldPath}},[t._v("\n            返回\n        ")]),t._v(" "),a(t.componentName,{ref:"component",tag:"component",attrs:{title:t.title},on:{reload:t.rebateFrameShowAll}})],2)])},staticRenderFns:[]}},"nm+Z":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-root"},[a("header",{staticClass:"z-header"},[a("nav",{staticClass:"navbar"},[a("div",{staticClass:"navbar-brand z-logo"},[a("button",{staticClass:"z-button-menu",on:{click:function(e){t.menuExpanded=!t.menuExpanded}}},[a("b-icon",{attrs:{icon:"menu",size:"is-medium"}})],1),t._v(" "),a("router-link",{staticClass:"navbar-item",attrs:{to:"/"}},[a("img",{attrs:{src:"//res.smzdm.com/admin_crm/dist/assets/logo.png",alt:"什么值得买BMS"}}),t._v(" BMS\n                ")])],1),t._v(" "),a("div",{staticClass:"navbar-menu"},[a("div",{staticClass:"navbar-end"},[t.crmUser&&t.crmUser.name?[a("span",{staticClass:"navbar-item"},[t._v(t._s(t.crmUser.name))]),t._v(" "),a("span",{staticClass:"navbar-item",on:{click:t.deleteCookie}},[a("b-icon",{attrs:{icon:"logout",title:"退出"}})],1)]:a("a",{staticClass:"navbar-item",attrs:{href:"http://sso-bgm.smzdm.com/uas-sso/root/login.jsp"}},[t._v("登录")])],2)])])]),t._v(" "),t.user?a("section",{staticClass:"section z-wrapper"},[a("aside",{directives:[{name:"show",rawName:"v-show",value:t.menuExpanded,expression:"menuExpanded"}],staticClass:"menu z-sidebar"},[a("ul",{staticClass:"menu-list"},t._l(t.leftMenu,function(e,n){return t.hasPermission(e.permission)?a("li",[a("b-collapse",{key:n,ref:"menuGroup_"+n,refInFor:!0,attrs:{open:e.open},scopedSlots:t._u([{key:"trigger",fn:function(n){return a("a",{staticClass:"menu-top"},[a("b-icon",{attrs:{size:"is-small",icon:n.open?"chevron-down":"chevron-right"}}),t._v(t._s(e.title))],1)}}])},[a("ul",{staticClass:"menu-list"},t._l(e.menus,function(e){return t.hasPermission(e.permission)?a("li",[e.url?a("a",{attrs:{href:e.url}},[t._v(t._s(e.name))]):a("router-link",{attrs:{to:e.path}},[t._v(t._s(e.name))])],1):t._e()}))])],1):t._e()}))]),t._v(" "),a("div",{staticClass:"z-main"},[a("router-view",{key:t.$route.path})],1)]):t._e()])},staticRenderFns:[]}},oG4N:function(t,e){},"oTy+":function(t,e,a){var n=a("VU/8")(a("iRk6"),a("xsuV"),null,null);t.exports=n.exports},offo:function(t,e){},"or/w":function(t,e,a){a("kZm+");var n=a("VU/8")(a("TQye"),a("esL9"),"data-v-989ca4e0",null);t.exports=n.exports},p0lq:function(t,e,a){var n=a("VU/8")(a("Gp+1"),a("s/7J"),null,null);t.exports=n.exports},p9VJ:function(t,e,a){a("sx4i");var n=a("VU/8")(a("rXFu"),a("/gM6"),"data-v-0722875f",null);t.exports=n.exports},pHXc:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合同变更"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门",horizontal:""}},[a("b-select",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[1===t.contractDirector.length?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly"},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-input",{staticClass:"z-width-input",model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"变更时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{"max-date":t.contractDateEnd},model:{value:t.contractDateStart,callback:function(e){t.contractDateStart=e},expression:"contractDateStart"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{"min-date":t.contractDateStart},model:{value:t.contractDateEnd,callback:function(e){t.contractDateEnd=e},expression:"contractDateEnd"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companiesNew,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"company_name"},on:{input:function(e){t.searchCompany("New")},focus:function(e){t.searchCompany("New")},select:t.onCompanySelected},model:{value:t.partyANew,callback:function(e){t.partyANew=e},expression:"partyANew"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方签约公司",horizontal:""}},[a("b-select",{model:{value:t.partyBNew,callback:function(e){t.partyBNew=e},expression:"partyBNew"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"变更信息"}},[a("b-select",{on:{input:t.changeCompany},model:{value:t.contract_company_id,callback:function(e){t.contract_company_id=e},expression:"contract_company_id"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("甲方签约公司")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("乙方签约公司")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("合同负责人")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("合同延期")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("币种变更")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("签订状态")])])],1),t._v(" "),a("b-field",{attrs:{label:"原甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.companiesOld,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_1,disabled:!t.click_a,field:"company_name"},on:{input:function(e){t.searchCompany("Old")},focus:function(e){t.searchCompany("Old")},select:t.onCompanySelected2},model:{value:t.partyAOld,callback:function(e){t.partyAOld=e},expression:"partyAOld"}})],1),t._v(" "),a("b-field",{attrs:{label:"原乙方签约公司",horizontal:""}},[a("b-select",{attrs:{disabled:!t.click_b},model:{value:t.partyBOld,callback:function(e){t.partyBOld=e},expression:"partyBOld"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportALL}},[t._v("导出")])])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalContracts},[t._v("总数："+t._s(t.totalContracts))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-date-td",attrs:{label:"变更时间",field:"changed_time",sortable:""}},[t._v("\n                    "+t._s(e.row.changed_time)+"\n                ")]),t._v(" "),a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[a("router-link",{attrs:{to:"/contracts/"+e.row.contract_id+"?isRe=true"}},[t._v(t._s(e.row.contract_number))])],1),t._v(" "),a("b-table-column",{attrs:{label:"合同名称",field:"contract_name"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同币种"}},[t._v("\n                    "+t._s(e.row.contract_currency_type_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"原币金额",field:"contract_currency_amount"}},[t._v("\n                    "+t._s(e.row.contract_currency_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同负责人",field:"name"}},[t._v("\n                    "+t._s(3===e.row.change_type?e.row.new_description:e.row.name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"甲方签约公司",field:"signing_company_name"}},[t._v("\n                    "+t._s(e.row.signing_company_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"乙方签约公司",field:"party_b_name"}},[t._v("\n                    "+t._s(e.row.party_b_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[a("router-link",{staticClass:"button is-link",attrs:{to:"/contract_change/"+e.row.contract_number+"?change_id="+e.row.id+"&isCharge="+(3===e.row.change_type||4===e.row.change_type?1:0)+"&isCurrency="+(5===e.row.change_type?1:0)}},[t._v("查看")])],1)]),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},pKxK:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"商务支持权限配置"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-space-between"},[a("b",[t._v("总数："+t._s(t.totalUsers))])]),t._v(" "),a("div",{staticClass:"z-block-content"},[t.usersData&&t.usersData.length?a("b-table",{attrs:{data:t.usersData,bordered:"","mobile-cards":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"登录名"}},[a("b-field",[a("div",{staticClass:"z-field-text"},[t._v("\n                                "+t._s(e.row.username)+"\n                            ")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"姓名"}},[a("b-field",[a("div",{staticClass:"z-field-text"},[t._v("\n                                "+t._s(e.row.name)+"\n                            ")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"权限范围"}},[a("b-field",{ref:"department_ids_"+e.index,attrs:{type:e.row.departmentFieldType,message:e.row.departmentFieldMsg}},[e.row.isEdit?a("ul",t._l(t.departments,function(n){return a("li",{key:n.id},[a("b-checkbox",{attrs:{"native-value":n.id},on:{input:function(a){t.onDepartmentChange(e.row,n)}},model:{value:e.row.selDepartments,callback:function(a){t.$set(e.row,"selDepartments",a)},expression:"props.row.selDepartments"}},[t._v(t._s(n.name))])],1)})):a("div",{staticClass:"z-field-text"},[t._v("\n                                "+t._s(e.row.selDepartmentNames)+"\n                            ")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("b-field",[e.row.isEdit?a("a",{staticClass:"button is-primary",on:{click:function(a){t.saveUser(e.row,e.index)}}},[t._v("保存")]):a("a",{staticClass:"button is-link",on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")])])],1)]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalUsers,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("\n                                GO\n                            ")])],1)],1)])],2):t._e()],1)])])},staticRenderFns:[]}},pNMl:function(t,e,a){var n=a("VU/8")(a("KKfj"),a("Jgwl"),null,null);t.exports=n.exports},pVxV:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"财务账期提醒"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"合同名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractsName,callback:function(e){t.contractsName=e},expression:"contractsName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.contractsNumber,expression:"contractsNumber"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.contractsNumber},on:{input:function(e){e.target.composing||(t.contractsNumber=e.target.value)}}})]),t._v(" "),a("b-field",{attrs:{label:"合同类型"}},[a("b-select",{model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},t._l(t.contractTypeList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"商务姓名"}},[a("b-autocomplete",{attrs:{data:t.filterContractCharges,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:function(e){return t.contractChargeSelected=e?e.id:""}},model:{value:t.contractChargeId,callback:function(e){t.contractChargeId=e},expression:"contractChargeId"}})],1),t._v(" "),a("b-field",{attrs:{label:"乙方单位"}},[a("b-select",{model:{value:t.partyName,callback:function(e){t.partyName=e},expression:"partyName"}},[a("option",{attrs:{value:"0"}}),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司"}},[t._v("北京值得买科技股份有限公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司上海分公司"}},[t._v("北京值得买科技股份有限公司上海分公司")]),t._v(" "),a("option",{attrs:{value:"北京值得买科技股份有限公司青岛分公司"}},[t._v("北京值得买科技股份有限公司青岛分公司")]),t._v(" "),a("option",{attrs:{value:"青岛无忧直购网络科技有限公司"}},[t._v("青岛无忧直购网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛星罗创想网络科技有限公司"}},[t._v("青岛星罗创想网络科技有限公司")]),t._v(" "),a("option",{attrs:{value:"青岛优讯创想信息技术有限公司"}},[t._v("青岛优讯创想信息技术有限公司")])])],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onSelectedCompany},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"超期状态"}},[a("b-select",{model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[a("option",{attrs:{value:"-1"}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("超期")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("未超期")])])],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.Export}},[t._v("账期导出")])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.list},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{width:"300",field:"contract_name",label:"合同名称"}},[t._v("\n                            "+t._s(e.row.contract_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_number",label:"合同编号"}},[t._v("\n                            "+t._s(e.row.contract_number)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_type_id",label:"合同类型"}},[t._v("\n                            "+t._s(e.row.contract_type_id)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"name",label:"商务姓名"}},[t._v("\n                            "+t._s(e.row.name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"signing_company_type_id",label:"签约公司类型"}},[t._v("\n                            "+t._s(e.row.signing_company_type_id)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"company_name",label:"甲方签约公司"}},[t._v("\n                            "+t._s(e.row.company_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"party_b_name",label:"乙方单位"}},[t._v("\n                            "+t._s(e.row.party_b_name)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"amount",label:"合同总金额"}},[t._v("\n                            "+t._s(e.row.amount)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"receivable_balance",label:"应收账款余额"}},[t._v("\n                            "+t._s(e.row.receivable_balance)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{width:"120",field:"receivable_balance",label:"合同开始日期"}},[t._v("\n                            "+t._s(e.row.start_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{width:"120",field:"receivable_balance",label:"合同结束日期"}},[t._v("\n                            "+t._s(e.row.end_date)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{width:"100",field:"account_period",label:"合同账期"}},[t._v("\n                            "+t._s(e.row.account_period)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"status",label:"超期状态"}},[t._v("\n                            "+t._s(e.row.status)+"\n                        ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.PageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                                跳转到\n                                "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                                页\n                                "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])])])},staticRenderFns:[]}},pnrk:function(t,e,a){a("kCnZ");var n=a("VU/8")(a("lB5T"),a("eHLS"),"data-v-e0825f18",null);t.exports=n.exports},prM2:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{staticClass:"approveWrap",attrs:{pageTitle:"审核金额配置"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{horizontal:"",label:"合同类型"}},[a("b-select",{model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},t._l(t.CONTRACT_TYPES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])}))],1),t._v(" "),a("b-field",{attrs:{horizontal:""}},[a("a",{staticClass:"button is-primary",on:{click:t.addLineFn}},[t._v("增加")])])],1)],1)]),t._v(" "),a("div",{staticClass:"z-block"}),t._v(" "),a("div",{staticClass:"z-block"},[a("table",[a("thead",[a("tr",[a("td",[t._v("合同类型")]),t._v(" "),a("td",[t._v("部门")]),t._v(" "),a("td",[t._v("等级")]),t._v(" "),a("td",[t._v("商务审核人")]),t._v(" "),a("td",[t._v("审核金额")]),t._v(" "),a("td",[t._v("财务审核人")]),t._v(" "),a("td",[t._v("法务审核人")]),t._v(" "),a("td",[t._v("操作")])])]),t._v(" "),t.getapproval?a("tbody",[t._l(t.currentData,function(e,n){return t._l(e,function(i,s){return a("tr",[0===t.department.indexOf(n.toString())&&0===s?a("td",{attrs:{rowspan:e.length*t.depart_length+t.addLine}},[t._v(t._s(t.approveStatusName))]):t._e(),t._v(" "),0===s&&"-1"!==t.departmentList[t.contractTypeId][n]?a("td",{attrs:{rowspan:e.length}},[a("b-select",{model:{value:i.biz_type_id,callback:function(e){t.$set(i,"biz_type_id",e)},expression:"level.biz_type_id"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1):0===s&&"-1"===t.departmentList[t.contractTypeId][n]?a("td",{attrs:{rowspan:e.length}},[a("b-select",{model:{value:t.department_id,callback:function(e){t.department_id=e},expression:"department_id"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1):t._e(),t._v(" "),a("td",{attrs:{data:t.department}},[t._v(t._s(s+1)+"级")]),t._v(" "),a("td",[a("b-select",{attrs:{expanded:""},model:{value:i.user_id,callback:function(e){t.$set(i,"user_id",e)},expression:"level.user_id"}},t._l(t.shangwuList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("td",[a("b-input",{attrs:{placeholder:"最小审批金额",type:"number"},model:{value:i.start_amount,callback:function(e){t.$set(i,"start_amount",e)},expression:"level.start_amount"}}),t._v(" "),a("b-input",{attrs:{placeholder:"最大审批金额",type:"number"},model:{value:i.end_amount,callback:function(e){t.$set(i,"end_amount",e)},expression:"level.end_amount"}})],1),t._v(" "),0===s?a("td",{attrs:{rowspan:e.length}},[a("b-select",{attrs:{expanded:""},model:{value:i.finance_user_id,callback:function(e){t.$set(i,"finance_user_id",e)},expression:"level.finance_user_id"}},t._l(t.caiwuList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1):t._e(),t._v(" "),0===s?a("td",{attrs:{rowspan:e.length}},[a("b-select",{attrs:{expanded:""},model:{value:i.law_user_id,callback:function(e){t.$set(i,"law_user_id",e)},expression:"level.law_user_id"}},t._l(t.fawuList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1):t._e(),t._v(" "),0===s?a("td",{attrs:{rowspan:e.length}},[a("button",{staticClass:"button is-primary",on:{click:function(a){t.updateApproval(e,n,i)}}},[t._v("保存")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(a){t.checkDelete(e,n)}}},[t._v("删除")])]):t._e()])})})],2):t._e()])])])},staticRenderFns:[]}},q37w:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=n(i),r=a("woOf"),o=n(r),c=a("O4Lo"),l=n(c),d=a("lHK6"),u=n(d),_=a("LZT1"),p=n(_),m=a("Km5v"),h=n(m);e.default={props:{page:{type:Number,default:null},isInvoice:{type:Boolean,default:!1},isChecked:{type:Boolean,default:!1},isCoop:{type:Boolean,default:!1}},data:function(){return{brand_product_type:"",companyName:"",companyList:[],isHeader:!1,defaultSortDirection:"asc",departmentId:"",departmentName:null,departmentReadonly:!1,userId:"",userName:"",signingCompany:"",signingCompanyId:"",approveStatusId:null,contractNumber:"",contractNumberList:[],contractName:"",startDate:null,endDate:null,startExecuteDate:null,endExecuteDate:null,invoiceStatusId:null,client_relationship:null,is_first_contract:0,client_type_id:0,cooperation_type:"",cooperation_obj:null,hard_wide_detail_type:null,contractDateStart:null,contractDateEnd:null,confirmDateStart:null,confirmDateEnd:null,enteredUserName:"",enteredUserId:null,bizTypeId:[],partyName:null,contractCostStart:"",contractCostEnd:"",contractBrandId:"",contractTypeId:[],selectedContractStatus:[],contractCollectionStatus:[],removedContractStatus:[],startTranslationDate:null,endTranslationDate:null,remark:"",showLogModal:!1,logData:[],logColumns:[{field:"updated_user",label:"审核人"},{field:"approve_type",label:"审核类型"},{field:"approve_status",label:"审核状态"},{field:"approve_step",label:"审核步骤"},{field:"updated_date",label:"审核时间"},{field:"reason",label:"驳回原因"}],departments:[],contractDirector:[],clientList:[],clientId:"",clientName:"",brandId:"",brands:[],brand_title:"",companies:[],contractNames:[],users:[],isFetching:!1,isFetching_2:!1,isFetching_3:!1,amounts:[],file_name:"",file_path:"",userReadonly:!1,totalContracts:0,contracts:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"swzc_approved_time",sortOrder:"desc",urlParams:{},userInfoId:this.$root.crmUser.id,forSearch:!0,levelData:[],level:null,contract_brand_id:"",contract_second_brand_id:"",clickGet:0,clickReset:0,checkedRows:[],status_id:-1}},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},components:{CooperationSelect:h.default},watch:{currPage:function(t){var e=!1;e=!(this.clickReset>this.clickGet),this.getContract(e)},page:function(t){this.currPage=t||1},departmentId:function(t){""===t||!this.isHeader&&this.isShangwu()||(this.userId=null,this.userName="",this.getDirector({department_id:t,is_contract_list:1}))},urlParams:function(t){var e=(0,o.default)({},t),a=[];e.page=1===this.currPage?null:this.currPage;for(var n in e){var i=e[n];if(i){var s=encodeURIComponent(n)+"="+encodeURIComponent(i);a.push(s)}}var r=this.$router.currentRoute.path+"?"+a.join("&");this.$router.replace(r)}},mounted:function(){},created:function(){var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()},this.initQueryData(),this.isInvoice&&(this.invoiceStatusId=2),this.getDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getContract(!1);var e=this.$root.user.roleCodes.split(",");this.$root.user.roleCodes.indexOf("shangwu")&&e.length,this.getLevel(),this.getCompany(),this.isShangwu()},methods:{getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list",params:{is_contract_list:1}}).then(function(e){t.companyList=e.data})},onCompanysSelected:function(t){t&&(this.companyName=t.name)},onUserSelected:function(t){t&&(this.userId=t.id)},isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},getLevel:function(){var t=this;return this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:"",level:[]};t.levelData.unshift(a)})},onSelectLevel:function(t){(t=Number(t))>=0&&(this.level=this.levelData[t],this.contract_second_brand_id="")},onSelectCooperationType:function(){this.hard_wide_detail_type=""},initQueryData:function(){var t=this;console.log("----initQuery----");var e={department_id:"departmentId",user_id:"userId",client_id:"clientId",brand_id:"brandId",signing_company_id:"signingCompanyId",approve_status_id:"approveStatusId",contract_number:"contractNumber",contract_name:"contractName",entered_date_start:"startDate",entered_date_end:"endDate",start_execute_date:"startExecuteDate",end_execute_date:"endExecuteDate",contract_invoice_status_id:"invoiceStatusId",hard_wide_detail_type:"hard_wide_detail_type",cooperation_type:"cooperation_type",contract_date_start:"contractDateStart",contract_date_end:"contractDateEnd",confirm_date_start:"confirmDateStart",confirm_date_end:"confirmDateEnd",entered_user_id:"enteredUserId",biz_type_id:"bizTypeId",party_b_name:"partyName",contract_cost_start:"contractCostStart",contract_cost_end:"contractCostEnd",contract_brand_id:"contractBrandId",contract_type_id:"contractTypeId",selected_contract_status:"selectedContractStatus",contract_collection_status:"contractCollectionStatus",removed_contract_status:"removedContractStatus",start_translation_date:"startTranslationDate",end_translation_date:"endTranslationDate",remark:"remark",order:"sortOrder",order_by:"swzc_approved_time",page:"currPage",page_size:"perPage"},a=this.$route.query,n=["biz_type_id","contract_type_id","selected_contract_status","removed_contract_status","contract_collection_status"];if(!(0,u.default)(a)){for(var i in a)!function(i){var s=a[i],r=e[i];switch("Invalid Date"!==s.toString()&&"invalid"!==s.toString()||(s=""),n.indexOf(i)>-1?t[r]="contractDateStart"===r||"contractDateEnd"===r||"startDate"===r||"endDate"===r||"startTranslationDate"===r||"endTranslationDate"===r||"confirmDateStart"===r||"confirmDateEnd"===r||"startExecuteDate"===r||"endExecuteDate"===r?new Date(decodeURI(s.split(","))):s.split(","):t[r]="contractDateStart"===r||"contractDateEnd"===r||"startDate"===r||"endDate"===r||"startTranslationDate"===r||"endTranslationDate"===r||"confirmDateStart"===r||"confirmDateEnd"===r||"startExecuteDate"===r||"endExecuteDate"===r?new Date(decodeURI(s.split(","))):s,i){case"client_id":t.clientId=s,t.getClients().then(function(){t.clientList.forEach(function(e){e.id===+s&&(t.clientName=e.name)})});break;case"client_name":t.clientName=s;break;case"brand_id":t.brandId=s,t.getBrands().then(function(){t.brands.forEach(function(e){e.brand_id===+s&&(t.brand_title=e.title)})});break;case"brand_name":t.brand_title=s;break;case"signing_company_id":t.signingCompanyId=s,t.getCompanies().then(function(){t.companies.forEach(function(e){e.id===+s&&(t.signingCompany=e.company_name)})});break;case"company_name":t.signingCompany=s;break;case"party_b_name":t.partyName=s;break;case"contract_name":t.contractName=s;break;case"contract_number":t.contractNumber=s;break;case"confirm_date_start":t.confirmDateStart=new Date(s);break;case"confirm_date_end":t.confirmDateEnd=new Date(s);break;case"cooperation_type":t.cooperation_type=+s;break;case"hard_wide_detail_type":t.hard_wide_detail_type=+s?+s:s;break;case"contract_brand_id":t.contract_brand_id=+s.split("_")[0],t.contract_second_brand_id=s,t.getLevel().then(function(){t.levelData.forEach(function(e){e.id===+s.split("_")[0]&&(t.level=e)})});break;case"contract_invoice_status_id":t.invoiceStatusId=s;break;case"client_relationship":t.client_relationship=s;break;case"is_first_contract":t.is_first_contract=s;break;case"client_type_id":t.client_type_id=s;break;case"group_name":t.companyName=s;break;case"brand_product_type":t.brand_product_type=s}}(i)}},getContract:function(t){var e=this;this.loading=!0;var a="";a=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";var n={client_relationship:this.client_relationship,is_first_contract:Number(this.is_first_contract),client_type_id:Number(this.client_type_id),department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,approve_status_id:this.approveStatusId,contract_number:this.contractNumber,contract_name:this.contractName,contract_invoice_status_id:this.invoiceStatusId,cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type,entered_user_id:this.enteredUserId,party_b_name:null===this.partyName||""===this.partyName?"":this.partyName,contract_cost_start:this.contractCostStart,contract_cost_end:this.contractCostEnd,contract_brand_id:a,contract_type_id:this.contractTypeId.join(","),selected_contract_status:this.selectedContractStatus.join(","),contract_collection_status:this.contractCollectionStatus.join(","),removed_contract_status:this.removedContractStatus.join(","),start_translation_date:this.makeStringDate(this.startTranslationDate),end_translation_date:this.makeStringDate(this.endTranslationDate),remark:this.remark,confirm_date_start:this.makeStringDate(this.confirmDateStart),confirm_date_end:this.makeStringDate(this.confirmDateEnd),start_execute_date:this.makeStringDate(this.startExecuteDate),end_execute_date:this.makeStringDate(this.endExecuteDate),group_name:this.companyName,brand_product_type:this.brand_product_type,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage};new s.default(function(a,n){e.isShangwu()?t?a():(e.contractDirector=[],1===e.$root.crmUser.is_headman?(console.log("是商务组长"),e.isHeader=!0,a()):(e.isRole(e.ROLE.shangwuzhichi)?console.log("shangwuzhichi"):(e.isHeader=!1,e.departmentReadonly=!0,e.userReadonly=!0,e.contractDirector=[{name:e.$root.crmUser.username,id:e.$root.crmUser.id}],e.userName=e.$root.crmUser.name,e.userId=e.$root.crmUser.id,e.departmentId=e.$root.crmUser.department_id,e.departmentName=e.$root.crmUser.department_name),a())):a()}).then(function(){e.urlParams=(0,o.default)({},n),e.ajax({url:"/contract/getContractLists",params:n}).then(function(t){e.checkedRows=[],e.totalContracts=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1),e.contracts=t.data.lists;for(var a=0;a<e.contracts.length;a++)!function(t){e.contracts[t].chakan=function(){return e.hasPermission("crm_new.contract.list.chakan")||!1},e.contracts[t].zaibohui=function(){return!!e.hasPermission("crm_new.contract.list.zaibohui")&&((2===e.contracts[t].approve_status_id||1===e.contracts[t].approve_status_id)&&e.userInfoId===e.contracts[t].entered_user_id)},e.contracts[t].bianji=function(){return!!e.hasPermission("crm_new.contract.list.bianji")&&(e.contracts[t].entered_user_name?!(0!==e.contracts[t].approve_status_id&&3!==e.contracts[t].approve_status_id&&4!==e.contracts[t].approve_status_id||e.userInfoId!==e.contracts[t].entered_user_id&&!e.isRole(e.ROLE.shangwuzhichi)):(0===e.contracts[t].approve_status_id||3===e.contracts[t].approve_status_id||4===e.contracts[t].approve_status_id)&&!!(0===e.contracts[t].approve_status_id&&e.isRole(e.ROLE.shangwuzhichi)&&[0,2,8].indexOf(e.contracts[t].contract_type_id)>-1))},e.contracts[t].delete=function(){return!!e.hasPermission("crm_new.contract.list.delete")&&(e.userInfoId===e.contracts[t].entered_user_id&&0===e.contracts[t].approve_status_id)},e.contracts[t].kaipiao=function(){return!!(2===e.contracts[t].approve_status_id&&e.userInfoId===e.contracts[t].user_id&&e.isRole(e.ROLE.shangwu)||2===e.contracts[t].approve_status_id&&e.isRole(e.ROLE.fapiao))}}(a);e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0}),e.ajax({url:"/contract/statistics_amount",params:n}).then(function(t){e.amounts=t.data})})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,p.default)(e.data);t.departments=a})},doContract:function(){var t=[];return this.checkedRows.forEach(function(e){t.push(e.id)}),t.join(",")},exportALL:function(t){var e=this,a="";a=this.contract_second_brand_id?(""+this.contract_second_brand_id).indexOf("_")>-1?this.contract_second_brand_id:this.contract_brand_id+"_"+this.contract_second_brand_id:this.contract_brand_id?this.contract_brand_id+"_0":"";var n={client_relationship:this.client_relationship,is_first_contract:Number(this.is_first_contract),client_type_id:Number(this.client_type_id),department_id:this.departmentId,user_id:this.userId,client_name:this.clientName,brand_name:this.brand_title,company_name:this.signingCompany,approve_status_id:this.approveStatusId,contract_number:this.contractNumber,contract_name:this.contractName,contract_invoice_status_id:this.invoiceStatusId,cooperation_type:this.cooperation_type,hard_wide_detail_type:this.hard_wide_detail_type,entered_user_id:this.enteredUserId,party_b_name:this.partyName,contract_cost_start:this.contractCostStart,contract_cost_end:this.contractCostEnd,contract_brand_id:a,contract_type_id:this.contractTypeId.join(","),selected_contract_status:this.selectedContractStatus.join(","),contract_collection_status:this.contractCollectionStatus.join(","),removed_contract_status:this.removedContractStatus.join(","),start_translation_date:this.makeStringDate(this.startTranslationDate),end_translation_date:this.makeStringDate(this.endTranslationDate),remark:this.remark,confirm_date_start:this.makeStringDate(this.confirmDateStart),confirm_date_end:this.makeStringDate(this.confirmDateEnd),start_execute_date:this.makeStringDate(this.startExecuteDate),end_execute_date:this.makeStringDate(this.endExecuteDate),group_name:this.companyName,brand_product_type:this.brand_product_type,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage,contract_ids:this.doContract()};"current_detail"!==this.sortField&&"current_receivable"!==this.sortField||delete n.order_by;var i="/contract/export_contract_lists";1===t?i="/contract/export_contract_details":2===t&&(i="/contract/export_contract_hard_details"),this.ajax({url:i,params:n}).then(function(t){e.exportLive({file_name:t.data.file_name,file_path:t.data.file_path})})},moreChange:function(){var t="";this.checkedRows.length||(this.checkedRows=this.contracts),t=this.doContract(),console.log(t),this.$router.push("/contract_change/"+t+"/more/")},makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:t}).then(function(t){0===t.error_code&&t.data&&t.data.rows?e.contractDirector=t.data.rows:e.contractDirector=[]})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients_v2",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list",params:{title:this.brand_title,user_id:Number(this.userId),is_contract_list:1}}).then(function(e){t.brands=e.data})},searchCompany:(0,l.default)(function(){this.isFetching=!0,this.getCompanies()},500),searchContract:(0,l.default)(function(){this.isFetching_2=!0,this.getContracts()},500),searchContractList:(0,l.default)(function(){this.isFetching_3=!0,this.getContractList()},500),getCompanies:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{like_company_name:this.signingCompany,is_contract_list:1}}).then(function(e){t.companies=e.data.lists,t.isFetching=!1})},getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},getContractList:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_number:this.contractNumber}}).then(function(e){t.contractNumberList=e.data.lists,t.isFetching_3=!1})},getUsers:function(){var t=this;return this.ajax({url:"/user/index",method:"post",data:{name:this.enteredUserName}}).then(function(e){t.users=e.data.rows,t.isFetching_3=!1})},resetParams:function(){this.checkedRows=[],this.contractDirector.length>1&&(this.userId=null),(this.isHeader||!this.isShangwu()||this.isRole(this.ROLE.shangwuzhichi))&&(this.departmentId="",this.userId="",this.userName=""),this.defaultSortDirection="asc",this.clientId=null,this.clientName=null,this.brands=[],this.brand_title="",this.brandId="",this.signingCompany="",this.signingCompanyId="",this.approveStatusId=null,this.contractNumber="",this.contractName="",this.startDate=null,this.endDate=null,this.startExecuteDate=null,this.endExecuteDate=null,this.invoiceStatusId=null,this.cooperation_type=null,this.hard_wide_detail_type=null,this.contractDateStart=null,this.contractDateEnd=null,this.confirmDateStart=null,this.confirmDateEnd=null,this.enteredUserName="",this.enteredUserId=null,this.bizTypeId=[],this.partyName=null,this.contractCostStart="",this.contractCostEnd="",this.contractBrandId="",this.level=null,this.contract_brand_id="",this.contract_second_brand_id="",this.contractTypeId=[],this.selectedContractStatus=[],this.is_first_contract=0,this.client_type_id=0,this.client_relationship=null,this.removedContractStatus=[],this.startTranslationDate=null,this.endTranslationDate=null,this.remark="",this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1,this.sortField="swzc_approved_time",this.sortOrder="desc",this.isInvoice&&(this.invoiceStatusId=2),this.clickReset=this.clickGet,this.clickReset+=1,this.companyName="",this.brand_product_type=""},onQueryClick:function(){var t=!1;t=!(this.clickReset>this.clickGet),1===this.currPage?this.getContract(t):this.currPage=1,this.clickGet+=1},deleteClient:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此合同么？",onConfirm:function(){a.ajax({url:"/contract/delete_contract",params:{contract_id:t}}).then(function(t){0===t.error_code&&(a.contracts.splice(e,1),a.getContract())})}})},recallClient:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要再驳回此合同么？",onConfirm:function(){a.ajax({url:"/contract_approval_options/contract_approved_recall",method:"post",data:{contract_id:t}}).then(function(t){0===t.error_code&&a.getContract(!0)})}})},onCompanySelected:function(t){t&&(this.signingCompanyId=t.id,this.signingCompany=t.company_name)},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.brand_title=t.title)},onUsersSelected:function(t){t&&(this.enteredUserId=t.id)},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getContract(!0)},showClientLog:function(t){var e=this;this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/contract/get_contract_approve_log",params:{contract_id:t}}).then(function(t){0===t.error_code&&(e.logData=t.data)})},getCooperation:function(t,e){if(console.log("-----cooperation_obj-----",t),this.cooperation_obj=t,this.cooperation_type=this.cooperation_obj.cooperation_type,e)this.hard_wide_detail_type=e;else{var a=[];this.cooperation_obj.level&&this.cooperation_obj.level.length?(this.cooperation_obj.level.map(function(t){a.push(t.id)}),this.hard_wide_detail_type=a.join(",")):this.hard_wide_detail_type=e}}}}},qBya:function(t,e){},qNRk:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"待审批客户"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门"}},[a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"我方负责人"}},[t.userReadonly?a("b-input",{attrs:{disabled:t.userReadonly},model:{value:t.currUserName,callback:function(e){t.currUserName=e},expression:"currUserName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"品牌名称"}},[a("b-autocomplete",{attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title"},on:{select:t.onBrandSelected},model:{value:t.brandName,callback:function(e){t.brandName=e},expression:"brandName"}})],1),t._v(" "),a("b-field",{attrs:{label:"产品线"}},[a("b-select",{model:{value:t.productLineId,callback:function(e){t.productLineId=e},expression:"productLineId"}},t._l(t.productLines,function(e){return a("option",{domProps:{value:e.product_line_id}},[t._v(t._s(e.product_line_name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"客户名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getClientsList,focus:t.getClientsList,select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"接入商家中心"}},[a("b-select",{model:{value:t.accessSJZX,callback:function(e){t.accessSJZX=e},expression:"accessSJZX"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])])],1),t._v(" "),a("b-field",{attrs:{label:"接入星罗"}},[a("b-select",{model:{value:t.accessXLSM,callback:function(e){t.accessXLSM=e},expression:"accessXLSM"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])])],1),t._v(" "),a("b-field",{attrs:{label:"客户等级"}},[a("b-select",{model:{value:t.clientLevelId,callback:function(e){t.clientLevelId=e},expression:"clientLevelId"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("A")]),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("B")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("C")])])],1),t._v(" "),a("b-field",{attrs:{label:"登记日期开始时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.enteredDateEnd},model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"登记日期结束时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"min-date":t.enteredDateStart},model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalClients},[t._v("总数："+t._s(t.totalClients))]),t._v(" "),a("router-link",{staticClass:"button is-primary",attrs:{to:"/clients/add"}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("添加客户")])],1)],1),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.clients,striped:!0,loading:t.loading},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"编号"}},[t._v("\n                    "+t._s(e.row.number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户类型"}},[t._v("\n                    "+t._s(e.row.client_type)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户等级"}},[t._v("\n                    "+t._s(e.row.level)+"级客户\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"品牌名称"}},[t._v("\n                    "+t._s(e.row.brand)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"产品线"}},[t._v("\n                    "+t._s(e.row.product_line_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"地址"}},[t._v("\n                    "+t._s(e.row.address)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"我方负责人"}},[t._v("\n                    "+t._s(e.row.principal_user)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"更新时间"}},[t._v("\n                    "+t._s(e.row.updated_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态"}},[t._v("\n                    "+t._s(e.row.approve_status)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("router-link",{staticClass:"button is-link",attrs:{to:"/clients/"+e.row.client_id}},[t._v("查看")])],1)]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalClients,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},qZcH:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("O4Lo"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={props:["page"],data:function(){return{log_type:"",action:"",section_in:"",status:"",type:0,users:[],userName:"",editor_id:null,logs:[],isFetching_3:!1,description:"",module:"",handle_time_start:null,handle_time_end:null,clientList:[],clientId:"",clientName:"",contract_id:"",totalLogs:0,perPage:20,currPage:1,jumpPage:1,SEARCH_TYPES:{0:"",1:"用户名",2:"模块代码",3:"操作内容"},LOG_TYPES:{0:"",1:"操作日志",2:"错误日志",3:"调用外部API结果日志",4:"登录日志",5:"手动处理线上数据"},ACTION_TYPES:{0:"",1:"添加",2:"修改",3:"软删除",4:"硬删除",5:"查看"},SECTION_TYPES:[{id:"",value:""},{id:"0",value:"不属于任何"},{id:"1",value:"用户"},{id:"2",value:"客户"},{id:"3",value:"签约公司"},{id:"4",value:"合同"},{id:"5",value:"合同明细"},{id:"6",value:"合同回款"},{id:"7",value:"合同发票"},{id:"8",value:"合作方式"}],STATUS_TYPES:{0:"","-1":"失败",1:"成功"}}},computed:{totalPage:function(){return Math.ceil(this.totalLogs/this.perPage)}},created:function(){this.getLogs()},watch:{currPage:function(t){t&&(1!==t&&t!==this.page?this.$router.push(this.$router.currentRoute.path+"?page="+t):1===t&&this.$router.push(this.$router.currentRoute.path),this.getLogs())},page:function(t){this.currPage=t||1}},methods:{formatLogData:function(t){return t.map(function(t,e){return t.description=JSON.parse(t.description),t})},resetData:function(){this.editor_id=null,this.userName="",this.module="",this.description="",this.clientId="",this.log_type="",this.userName="",this.section_in="",this.status=""},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id)},searchUsers:(0,i.default)(function(){this.isFetching_3=!0,this.getUsers(),console.log(111)},500),onUsersSelected:function(t){t&&(console.log(3333),this.editor_id=t.id)},getUsers:function(){var t=this;return this.ajax({url:"/user/index",method:"post",data:{name:this.userName}}).then(function(e){t.users=e.data.rows,t.isFetching_3=!1})},makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},getLogs:function(){var t=this;return this.ajax({url:"/log/index",method:"post",loading:this.$loading.open(),data:{log_type:this.log_type,action:this.action,section_in:this.section_in,status:this.status,editor_id:this.editor_id,module:this.module,description:this.description,handle_time_start:this.makeStringDate(this.handle_time_start),handle_time_end:this.makeStringDate(this.handle_time_end),client_id:this.clientId,contract_id:this.contract_id,page:this.currPage,limit:this.perPage}}).then(function(e){0===e.error_code&&(e.data&&e.data.total?(t.logs=t.formatLogData(e.data.rows),t.totalLogs=e.data.total):(t.logs=[],t.totalLogs=0))})},resetParams:function(){console.log("------重置-------"),this.log_type="",this.action="",this.status="",this.section_in="",this.editor_id=null,this.userName="",this.handle_time_end=null,this.handle_time_start=null,this.clientId="",this.module="",this.description="",this.contract_id=""}}}},qsSC:function(t,e,a){a("7SBc");var n=a("VU/8")(a("AXyB"),a("vqQj"),null,null);t.exports=n.exports},"r8+A":function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),s=n(i),r=a("7bRm"),o=n(r),c=function t(e,a){var n=a||0,i=!0,r=!1,o=void 0;try{for(var c,l=(0,s.default)(e);!(i=(c=l.next()).done);i=!0){var d=c.value;d.isEdit=!1,d.expanded=!1,d.level=n++,d.child?d.child=t(d.child,n):d.child=[]}}catch(t){r=!0,o=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw o}}return e};e.default={data:function(){return{departments:[]}},created:function(){this.getDepartments()},components:{MenuList:o.default},methods:{getDepartments:function(){var t=this;return this.ajax({loading:this.$loading.open(),url:"/department/index/"}).then(function(e){if(0===e.error_code){var a=c(e.data);console.log(a),t.departments=a}})}}}},r8Ms:function(t,e){},r9vc:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("//Fk"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={data:function(){return{files:[],resultString:"",data:[],isLoading:!0,defaultStatus:null,isStatus:[{name:"",id:0},{name:"认领中",id:1},{name:"已完成",id:2}],number:"",defaultDelete:0,isDelete:[{name:"未删除",id:0},{name:"已删除",id:1}],defaultClaimType:null,claimType:[{name:"",id:-1},{name:"现金回款",id:0},{name:"返点发票",id:1},{name:"资源置换",id:2}],enteredDateStart:null,enteredDateEnd:null,approveDateStart:null,approveDateEnd:null,signCompany:"",total:0,totalAmount:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,list:[],thisNumber:null,thisDate:null,thisAmount:null,thisCurrency:null,canBeAmount:null,isDetailLoading:!1,isDetailTotal:null,columns:[{field:"detail_username",label:"认领人"},{field:"detail_amount",label:"认领金额"},{field:"remark",label:"备注"}],currencies:{type_0:"人民币",type_1:"美元",type_2:"日元",type_3:"欧元",type_4:"英镑",type_5:"韩国元",type_6:"加拿大元",type_7:"澳元"},showLogModal:!1,modalCurrPage:1,modalPerPage:10,modalJumpPage:1,cacheProps:[],permission:null,forSearch:!0,IfCaiwu:!1,IfShangwu:!1}},watch:{currPage:function(t){this.questFn(t)},modalCurrPage:function(t){this.modalQuest()(t)}},created:function(){this.questFn(),this.isRole(this.ROLE.shangwu)&&!this.isRole(this.ROLE.admin)?this.permission=!1:this.permission=!0,console.log("permission",this.permission),console.log("crm_new.finance.pool.update",this.hasPermission("crm_new.finance.pool.update")),console.log("crm_new.finance.pool.delete",this.hasPermission("crm_new.finance.pool.delete"));var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()},(this.isRole(this.ROLE.caiwushenhe)||this.isRole(this.ROLE.caiwuguanli)||this.isRole(this.ROLE.caiwuweihu))&&(this.IfCaiwu=!0),this.isRole(this.ROLE.shangwuzhichi)&&(this.IfShangwu=!0),this.IfShangwu&&!this.IfCaiwu&&(this.isStatus.splice(2,1),this.isDelete.splice(1,1))},methods:{uploadForm:function(){var t=this;if(this.files.length<1)return this.$toast.open({duration:5e3,message:"请选择文件！",position:"is-top",type:"is-danger"}),!1;var e={loading:this.$loading.open(),url:"/contract_cash_collection_pool/import_received_payments",method:"post",data:{filename:this.files},successTip:!0};this.ajax(e).then(function(e){0===e.error_code?(t.resultString=e.data.export_response_html,t.onQueryClick()):t.resultString=e.error_msg})},resetForm:function(){this.files=[],this.resultString=null},questFn:function(t){var e=this;Number(t)||(t=1);var a={loading:this.$loading.open(),url:"/contract_cash_collection_pool/get_list",params:{page:t,size:this.perPage,is_deleted:this.defaultDelete}};this.number&&(a.params.like_transaction_number=this.number),this.defaultStatus&&(a.params.status_id=this.defaultStatus),-1!==this.defaultClaimType&&(a.params.cash_type=this.defaultClaimType),this.enteredDateStart&&(a.params.cash_collection_date_start_date=this.zDateFormatter(this.enteredDateStart)),this.enteredDateEnd&&(a.params.cash_collection_date_end_date=this.zDateFormatter(this.enteredDateEnd)),this.approveDateStart&&(a.params.approved_time_start=this.zDateFormatter(this.approveDateStart)),this.approveDateEnd&&(a.params.approved_time_end=this.zDateFormatter(this.approveDateEnd)),this.signCompany&&(a.params.sign_company_name=this.signCompany),this.isLoading=!0,this.ajax(a).then(function(t){if(0===t.error_code){var a=t.data.lists;e.total=t.data.counts,e.totalAmount=t.data.amount,e.totalPage=Math.ceil(t.data.counts/e.perPage),0===e.totalPage&&(e.totalPage=1);for(var n=0;n<a.length;n++)a[n].edit=!1,0===a[n].is_deleted?a[n].is_deleted="未删除":a[n].is_deleted="删除",a[n].defaultCurrency=a[n].currency_id,a[n].currencyList=[{name:"人民币",id:0},{name:"美元",id:1},{name:"日元",id:2},{name:"欧元",id:3},{name:"英镑",id:4},{name:"韩国元",id:5},{name:"加拿大元",id:6},{name:"澳元",id:7}],a[n].use_amount=e.toDecimalTwo(a[n].use_amount),a[n].default_date=new Date(a[n].cash_collection_date);e.data=a,e.isLoading=!1}})},onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},resetParams:function(){this.defaultStatus=null,this.number="",this.defaultDelete=0,this.defaultClaimType=null,this.enteredDateStart=null,this.enteredDateEnd=null,this.approveDateEnd=null,this.approveDateStart=null,this.signCompany="",this.currPage=1},exportHandle:function(){var t=this,e=(new Date).getTime(),a=function a(n){return new i.default(function(i,s){t.ajax({url:"/export/is_live",method:"post",data:{file_path:n.data.file_path,file_name:n.data.file_name},export:!0}).then(function(i){if(0===i.error_code){var s=document.createElement("a");s.style="display: none",s.download=n.data.file_name+".xlsx",s.href=n.data.file_path,document.body.appendChild(s),s.click(),s.remove()}else{if(!((new Date).getTime()-e<1e4))return console.log("失败"),t.$toast.open({duration:5e3,message:"生成文件失败，请重新操作！",position:"is-top",type:"is-danger"}),!1;setTimeout(a(n),2e3)}})})};(function(){return new i.default(function(e,a){var n={is_deleted:t.defaultDelete};t.number&&(n.like_transaction_number=t.number),t.defaultStatus&&(n.status_id=t.defaultStatus),-1!==t.defaultClaimType&&(n.cash_type=t.defaultClaimType),t.enteredDateStart&&(n.cash_collection_date_start_date=t.zDateFormatter(t.enteredDateStart)),t.enteredDateEnd&&(n.cash_collection_date_end_date=t.zDateFormatter(t.enteredDateEnd)),t.approveDateStart&&(n.approved_time_start=t.zDateFormatter(t.approveDateStart)),t.approveDateEnd&&(n.approved_time_end=t.zDateFormatter(t.approveDateEnd)),t.signCompany&&(n.sign_company_name=t.signCompany),t.ajax({url:"/contract_cash_collection_pool/export_get_list",params:n}).then(function(t){e(t)})})})().then(function(t){a(t)})},toDecimalTwo:function(t){var e=parseFloat(t);if(isNaN(e))return!1;e=Math.round(100*t)/100;var a=e.toString(),n=a.indexOf(".");for(n<0&&(n=a.length,a+=".");a.length<=n+2;)a+="0";return a},pageHandle:function(t){this.currPage=t,this.onQueryClick()},modalPageHandle:function(t){this.modalCurrPage=t},modalQuest:function(t){var e=this;return t&&(this.cacheProps=t),function(t){Number(t)||(t=1);var a=new i.default(function(a,n){e.ajax({loading:e.$loading.open(),url:"/contract_cash_collection_pool_detail/contract_cash_collection_pool_claim_list",params:{page:t,pagesize:10,pool_id:e.cacheProps.id}}).then(function(t){a(t)})}),n=new i.default(function(t,a){e.ajax({loading:e.$loading.open(),url:"/contract_cash_collection_pool_detail/have_claim_amount",method:"post",data:{pool_id:e.cacheProps.id}}).then(function(e){t(e)})});e.isDetailLoading=!0,a.then(function(t){0===t.error_code&&(e.list=t.data.lists,e.isDetailTotal=t.data.counts.count,e.isDetailLoading=!1)}).then(function(){return n}).then(function(t){if(0===t.error_code){var a=t.data;return e.canBeAmount=e.toDecimalTwo(e.cacheProps.currency_amount-a),e.canBeAmount}}).then(function(t){t&&(e.showLogModal=!0)})}},showDetail:function(t){this.thisNumber=t.transaction_number,this.thisDate=t.cash_collection_date,this.thisAmount=t.currency_amount,this.thisCurrency=t.currency_id,this.modalQuest(t)(1)},urlEdit:function(t){t.edit=!0},submitEdit:function(t,e){var a=this,n={id:t,transaction_number:e.transaction_number,sign_company_name:e.sign_company_name,currency_amount:e.currency_amount,currency_id:e.defaultCurrency,cash_collection_date:this.zDateFormatter(e.default_date),remark:e.remark};this.ajax({loading:this.$loading.open(),url:"/contract_cash_collection_pool/update",method:"post",data:n,successTip:!0}).then(function(t){0===t.error_code&&(e.transaction_number=e.transaction_number,e.sign_company_name=e.sign_company_name,e.currency_amount=e.currency_amount,e.currency_id=e.defaultCurrency,e.cash_collection_date=a.zDateFormatter(e.default_date),e.remark=e.remark,e.edit=!1)})},deleteHandle:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此条信息吗？",onConfirm:function(){a.ajax({loading:a.$loading.open(),url:"/contract_cash_collection_pool/delete",method:"post",data:{id:t},successTip:!0}).then(function(t){0===t.error_code&&(a.data.splice(e,1),a.questFn())})}})},claimHandle:function(t){this.$router.push({path:"/payments/"+t.id+"/contracts",query:{id:t.id,CashType:t.cash_type_text,Number:t.transaction_number,Time:t.cash_collection_date,CurrencyAmount:t.currency_amount,Currency:t.currency_id,UseAmount:t.suse_amount,CompanyName:t.sign_company_name}})},fileIsOk:function(t){var e=t.name.split("."),a=e[e.length-1];if("xls"!==a&&"xlsx"!==a)return this.$toast.open({duration:5e3,message:"您选择的文件格式不符合要求，请重新选择！",position:"is-top",type:"is-danger"}),this.files=[],this.resultString=null,!1}}}},rJoM:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"formWrapper",staticClass:"z-client-info"},[a("div",{ref:"clientForm",staticClass:"z-form",on:{change:t.onChange}},[a("b-field",{attrs:{horizontal:"",label:"品牌"}},[t.isEdit?a("b-autocomplete",{ref:"brandName",attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"title",required:""},on:{blur:t.onBrandBlur,select:t.onBrandSelected},model:{value:t.client.brand,callback:function(e){t.$set(t.client,"brand",e)},expression:"client.brand"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.brand))]),t._v(" "),t.isEdit?a("a",{staticClass:"button is-primary",attrs:{href:"#/brands"}},[t._v("新增品牌")]):a("a",{staticClass:"button is-primary",attrs:{href:"#/brands/"+t.clientId+"/"+t.client.brand}},[t._v("查看品牌")])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"产品线"}},[t.isEdit?a("b-select",{ref:"productLineId",attrs:{required:""},on:{input:t.selectLine},model:{value:t.productLineId,callback:function(e){t.productLineId=e},expression:"productLineId"}},t._l(t.productLines,function(e){return a("option",{key:e.product_line_id,domProps:{value:e.product_line_id}},[t._v(t._s(e.product_line_name))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.product_line_name))])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"产品线类型"}},[t.isEdit?a("div",{staticClass:"z-field-text"},[t._v(t._s(t.brand_product_type))]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.brand_product_type))])]),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"客户名称",type:t.client.clientNameStatus,message:t.client.clientNameMsg}},[t.isEdit?a("div",{staticClass:"z-field-text"},[t._v(t._s(t.brandName)+"-"+t._s(t.productLineName))]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.brand)+"-"+t._s(t.client.product_line_name))])]),t._v(" "),a("b-field",{attrs:{horizontal:""}},[a("a",{staticClass:"button is-primary",on:{click:t.checkDuplicate}},[t._v("查重")])]),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"客户类型"}},[t.isEdit?a("div",{staticClass:"z-field-text"},[t._v(t._s(t.CLIENT_TYPES[""+t.client_type_id]))]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.CLIENT_TYPES[""+t.client.client_type_id]))])]),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"是否自主客户"}},[t.isEdit?a("b-select",{ref:"accessMerchant",attrs:{expanded:"",requried:""},model:{value:t.client.is_auto,callback:function(e){t.$set(t.client,"is_auto",e)},expression:"client.is_auto"}},[a("option",{attrs:{value:"2"}},[t._v("非自主客户")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("自主客户")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(1===t.client.is_auto?"自主客户":"非自主客户"))])],1),t._v(" "),t.isEdit||t.client.principal_user?a("b-field",{attrs:{horizontal:"",label:"我方负责人"}},[t.isEdit?a("b-input",{ref:"userName",attrs:{disabled:""},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.userName))])],1):t._e(),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"客户推荐人",type:t.showReg?"is-danger":"",message:t.showReg?"不能输入空格和符号":""}},[t.isEdit?a("b-input",{ref:"referrer_name",attrs:{placeholder:"不能输入空格和符号"},on:{blur:function(e){t.checkReg()}},model:{value:t.client.referrer_name,callback:function(e){t.$set(t.client,"referrer_name",e)},expression:"client.referrer_name"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.referrer_name))])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"KA客户"}},[t.isEdit?a("b-select",{ref:"accessMerchant",attrs:{expanded:"",requried:""},model:{value:t.client.is_ka,callback:function(e){t.$set(t.client,"is_ka",e)},expression:"client.is_ka"}},[a("option",{attrs:{value:"2"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("KA客户")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(1===t.client.is_ka?"KA客户":"否"))])],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:""}},[a("div",{staticClass:"z-field-text z-red-text"},[t._v("KA客户为核心电商及品牌全年投入预期不低于200万的客户。")])]),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"客户信誉等级"}},[a("div",[0===t.client.newest_degree?a("span",[t._v("待评级")]):t._l(t.client.newest_degree,function(t){return a("span",{key:"icon_"+t,staticClass:"icon"})})],2)]),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"是否接入商家中心"}},[t.isEdit?a("b-select",{ref:"accessMerchant",attrs:{expanded:""},model:{value:t.client.is_sjzx,callback:function(e){t.$set(t.client,"is_sjzx",e)},expression:"client.is_sjzx"}},[a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.is_sjzx?"是":"否"))])],1),t._v(" "),Number(t.client.is_sjzx)?a("b-field",{attrs:{horizontal:"",label:"商家中心编号"}},[t.isEdit?a("b-input",{ref:"merchantNumber",attrs:{required:Number(t.client.is_sjzx)},model:{value:t.client.sjzx_number,callback:function(e){t.$set(t.client,"sjzx_number",e)},expression:"client.sjzx_number"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.sjzx_number))])],1):t._e(),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"是否接入星罗商盟"}},[t.isEdit?a("b-select",{ref:"accessLinkstar",attrs:{expanded:""},model:{value:t.client.is_xlsm,callback:function(e){t.$set(t.client,"is_xlsm",e)},expression:"client.is_xlsm"}},[a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])]):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.is_xlsm?"是":"否"))])],1),t._v(" "),Number(t.client.is_xlsm)?a("b-field",{attrs:{horizontal:"",label:"星罗商盟编号"}},[t.isEdit?a("b-input",{ref:"linkstarNumber",attrs:{required:Number(t.client.is_xlsm)},model:{value:t.client.xlsm_number,callback:function(e){t.$set(t.client,"xlsm_number",e)},expression:"client.xlsm_number"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.xlsm_number))])],1):t._e(),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"国家和地区"}},[t.isEdit?a("b-select",{ref:"countryId",attrs:{expanded:"",required:""},model:{value:t.client.country_id,callback:function(e){t.$set(t.client,"country_id",e)},expression:"client.country_id"}},t._l(t.countries,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])})):a("div",{staticClass:"z-field-text"},[t._v(t._s(t._f("countryName")(t.client.country_id)))])],1),t._v(" "),0===t.client.country_id?a("b-field",{attrs:{horizontal:"",label:"省市区",grouped:""}},[t.isEdit?[a("b-select",{ref:"provinceId",attrs:{expanded:"",required:0===t.client.country_id},model:{value:t.provinceId,callback:function(e){t.provinceId=e},expression:"provinceId"}},t._l(t.provinces,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])})),t._v(" "),a("b-select",{ref:"cityId",attrs:{expanded:"",required:0===t.client.country_id},model:{value:t.cityId,callback:function(e){t.cityId=e},expression:"cityId"}},t._l(t.cities,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])})),t._v(" "),t.areas.length>0?a("b-select",{ref:"areaId",attrs:{expanded:"",required:0===t.client.country_id},model:{value:t.areaId,callback:function(e){t.areaId=e},expression:"areaId"}},t._l(t.areas,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])})):t._e()]:a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.province_name)+" "+t._s(t.client.city_name)+" "+t._s(t.client.district_name))])],2):t._e(),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"地址"}},[t.isEdit?a("b-input",{ref:"address",attrs:{maxlength:"200",required:""},on:{blur:function(e){t.client.address=t.client.address.trim()}},model:{value:t.client.address,callback:function(e){t.$set(t.client,"address",e)},expression:"client.address"}}):a("div",{staticClass:"z-field-text"},[t._v(t._s(t.client.address))])],1)],1),t._v(" "),t.isEdit?[(t.isAdd,a("a",{staticClass:"button is-primary",on:{click:function(e){t.saveClientData(!1)}}},[t._v("下一步")]))]:t.clientId&&1===t.client.approve_status_id?[t.hasPermission("crm_new.kehu.list.tongguo")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.approvePass()}}},[t._v("通过")]):t._e(),t._v(" "),t.hasPermission("crm_new.kehu.list.bohui")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("驳回")]):t._e(),t._v(" "),a("b-modal",{attrs:{active:t.ifReject,"has-modal-card":""},on:{"update:active":function(e){t.ifReject=e}}},[a("div",{staticClass:"modal-card",staticStyle:{width:"500px"}},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("驳回原因")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-input",{ref:"rejectReason_ref",staticClass:"z-block",attrs:{required:"",type:"textarea"},model:{value:t.rejectReason,callback:function(e){t.rejectReason=e},expression:"rejectReason"}}),t._v(" "),a("div",{staticClass:"z-block z-block-reject"},[a("button",{staticClass:"button is-primary",on:{click:function(e){t.approveReject()}}},[t._v("确定")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.toReject()}}},[t._v("取消")])])],1)])])]:t._e(),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")]),t._v(" "),a("b-modal",{attrs:{active:t.showCheckDuplicate,"has-modal-card":""},on:{"update:active":function(e){t.showCheckDuplicate=e}}},[a("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("客户名查重")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-field",{attrs:{horizontal:"",label:"客户名称"}},[a("b-input",{attrs:{expanded:""},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.checkDuplicate}},[t._v("查询")]),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:function(e){t.clientName="",t.checkClientsResult=[]}}},[t._v("重置")])],1),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("b",[t._v("总数："+t._s(t.checkClientsResult.length))])]),t._v(" "),a("b-table",{attrs:{data:t.checkClientsResult},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"客户名称"}},[t._v("\n                                "+t._s(e.row.client_name)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"我方负责人"}},[t._v("\n                                "+t._s(e.row.principal_user)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户类型"}},[t._v("\n                             "+t._s(e.row.client_type)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户等级"}},[t._v("\n                                "+t._s(e.row.client_level)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"KA客户"}},[t._v("\n                                "+t._s(e.row.is_ka)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态"}},[t._v("\n                                "+t._s(e.row.approve_status)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"更新时间"}},[t._v("\n                                "+t._s(e.row.updated_date)+"\n                            ")]),t._v(" "),a("b-table-column",{attrs:{label:"联系人信息",visible:t.hasPermission("crm_new.kehu.list.lxr")}},[a("a",{staticClass:"button is-danger",staticStyle:{margin:"0 .7rem"},attrs:{href:"/#/clients/"+e.row.client_id+"?activeTab=1",target:"_blank"}},[t._v("查看")])])]}}])})],1)],1)])])],2)},staticRenderFns:[]}},rMhv:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:t.isSplitURL?"待审批业绩拆分":"业绩拆分列表"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.loadingList.isFetching1,field:"contract_number"},on:{focus:t.searchContracNumbertList,input:t.searchContracNumbertList},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"项目经理：",horizontal:""}},[a("b-autocomplete",{ref:"contractCharge",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.getCodeList,fouce:t.getCodeList,select:t.onChargenameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.charge_userName,callback:function(e){t.charge_userName=e},expression:"charge_userName"}})],1),t._v(" "),t.isSplitURL?t._e():[a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.loadingList.isFetching3,field:"name"},on:{focus:t.searchContractName,input:t.searchContractName},model:{value:t.form.contract_name,callback:function(e){t.$set(t.form,"contract_name",e)},expression:"form.contract_name"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[a("b-autocomplete",{attrs:{data:t.contractDirector,"max-results":10,"keep-first":!0,loading:t.loadingList.isFetching4,"open-on-focus":!0,field:"name"},on:{input:t.searchSplitUser,focus:t.searchSplitUser,select:function(e){return t.selectAutoOption(e,"user_id")}},model:{value:t.selectName.user_id,callback:function(e){t.$set(t.selectName,"user_id",e)},expression:"selectName.user_id"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{loading:t.loadingList.isFetching5,data:t.clientList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{input:t.searchGetClients,focus:t.searchGetClients,select:function(e){return t.selectAutoOption(e,"client_id")}},model:{value:t.selectName.client_id,callback:function(e){t.$set(t.selectName,"client_id",e)},expression:"selectName.client_id"}})],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"事业部"}},[a("b-select",{model:{value:t.business_id,callback:function(e){t.business_id=e},expression:"business_id"}},t._l(t.DEPARTMENT,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"审核状态",horizontal:""}},[a("b-select",{model:{value:t.form.split_status_id,callback:function(e){t.$set(t.form,"split_status_id",e)},expression:"form.split_status_id"}},[a("option",{attrs:{value:""}}),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("未提交")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("待审核")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("审核通过")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("驳回待修改")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("再驳回待修改")])])],1)]],2),t._v(" "),a("div",{staticClass:"z-buttons"},[t.hasPermission("crm_new.yeji.list.cx")?a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]):t._e(),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),t.hasPermission("crm_new.yeji.list.dc")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL()}}},[t._v("导出")]):t._e(),t._v(" "),t.hasPermission("crm_new.yeji.list.exportdetail")?a("a",{staticClass:"button is-primary",on:{click:function(e){t.exportALL("list")}}},[t._v("导出明细")]):t._e()])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalContracts},[t._v("总数："+t._s(t.totalContracts))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{checkable:t.isChecked,"checked-rows":t.checkedRows,data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{"update:checkedRows":function(e){t.checkedRows=e},sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同名称",field:"contract_name"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同负责人"}},[t._v("\n                    "+t._s(e.row.contract_charge_name)+"\n                ")]),t._v(" "),a("b-table-column",{staticClass:"z-date-td",attrs:{label:"起止时间",field:"start_date",sortable:""}},[t._v("\n                    "+t._s(e.row.start_date)+" - "+t._s(e.row.end_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"业绩（已过审）",field:"split_amount"}},[t._v("\n                    "+t._s(e.row.split_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"拆分方式",field:"approve_status_id"}},[t._v("\n                    "+t._s(1===Number(e.row.is_split)?"系统":"手动")+"\n                ")]),t._v(" "),t.isSplitURL?t._e():[2===Number(e.row.is_split)?a("b-table-column",{attrs:{label:"状态",field:"approve_status_id"}},[t._v("\n                        "+t._s(t.splitStatus[e.row.split_status_id])+"\n                    ")]):a("b-table-column",{attrs:{label:"状态",field:"approve_status_id"}},[t._v("\n                        无需审核\n                    ")])],t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[e.row.chakan()&&t.isSplitURL?a("router-link",{staticClass:"button is-link",attrs:{to:"/pending_achievement/"+e.row.id}},[t._v("查看业绩")]):t._e(),t._v(" "),e.row.chakan()&&!t.isSplitURL?a("router-link",{staticClass:"button is-link",attrs:{to:"/achievement/"+e.row.id}},[t._v("查看业绩")]):t._e(),t._v(" "),e.row.bianji()&&!t.isSplitURL?a("router-link",{staticClass:"button is-link",attrs:{to:"/achievement/"+e.row.id+"/edit"}},[t._v("编辑业绩")]):t._e()],1)])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},rVDs:function(t,e){},rXFu:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="/contract_cash_collection_pool_detail/have_claim_amount";e.default={data:function(){return{data:[],isLoading:!1,contractsName:null,signingCompanyName:this.$route.query.CompanyName,contractNumber:null,cashType:!1,transactionNumber:this.$route.query.Number,cashCollectionDate:this.$route.query.Time,currencyAmount:this.toDecimalTwo(this.$route.query.CurrencyAmount),currency:this.$route.query.Currency,canBeAmount:null,total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,currencies:{type_0:"人民币",type_1:"美元",type_2:"日元",type_3:"欧元",type_4:"英镑",type_5:"韩国元",type_6:"加拿大元",type_7:"澳元"},shangWu:!1,forSearch:!0}},watch:{currPage:function(t){this.questFn(t)}},created:function(){var t=this;"回款"===this.$route.query.CashType?this.cashType=!0:this.cashType=!1,console.log("商务？",this.ROLE.shangwu,this.isRole(this.ROLE.shangwu)),console.log("财务？",this.ROLE.caiwuweihu,this.isRole(this.ROLE.caiwuweihu)),this.isRole(this.ROLE.shangwu)?(this.shangWu=!0,console.log("是商务，隐藏")):(this.shangWu=!1,console.log("不是商务，可见")),this.ajax({url:n,method:"post",data:{pool_id:this.$route.query.id}}).then(function(e){if(0===e.error_code){var a=e.data;t.canBeAmount=t.toDecimalTwo(t.$route.query.CurrencyAmount-a)}}),this.questFn();var e=this;document.onkeydown=function(t){e.ifEnter(t)&&e.forSearch&&e.onQueryClick()}},methods:{onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},questFn:function(t){var e=this;Number(t)||(t=1);var a={page:t,size:this.perPage,pool_id:this.$route.query.id};this.contractsName&&(a.contract_name=this.contractsName),this.signingCompanyName&&(a.signing_company_name=this.signingCompanyName),this.contractNumber&&(a.contract_number=this.contractNumber),this.ajax({loading:this.$loading.open(),url:"/contract_cash_collection_pool_detail/contract_cash_collection_pool_claim_with_contract",params:a}).then(function(t){if(0===t.error_code)if(t&&t.data&&t.data.lists&&t.data.lists.length>0){for(var a=t.data,n=0;n<a.lists.length;n++)a.lists[n].defaultDeductible=1,a.lists[n].deductible=[{name:"是",id:1},{name:"否",id:0}];e.data=a.lists,e.total=a.total,e.totalPage=Math.ceil(a.total/e.perPage),0===e.totalPage&&(e.totalPage=1)}else e.data=[],e.total=0})},toDecimalTwo:function(t){var e=parseFloat(t);if(isNaN(e))return!1;e=Math.round(100*t)/100;var a=e.toString(),n=a.indexOf(".");for(n<0&&(n=a.length,a+=".");a.length<=n+2;)a+="0";return a},pageHandle:function(t){this.currPage=t,this.onQueryClick()},backUrl:function(){this.$router.go(-1)},claimHandle:function(t){var e=this;this.ajax({loading:this.$loading.open(),url:"/contract_cash_collection_pool_detail/claim",method:"post",successTip:!0,data:{pool_id:this.$route.query.id,amount:t.claim_amount,contract_id:t.contract_id,remark:t.remark,is_deduct_money:t.defaultDeductible}}).then(function(t){0===t.error_code&&(e.ajax({url:n,method:"post",data:{pool_id:e.$route.query.id}}).then(function(t){if(0===t.error_code){var a=t.data;e.canBeAmount=e.toDecimalTwo(e.$route.query.CurrencyAmount-a)}}),e.questFn())})}}}},rlxa:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header"},[a("div",{staticClass:"flex"},[a("p",{staticClass:"title"},[t._v(t._s(t.name))]),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:function(e){t.$emit("edit")}}},[t._v("\n            "+t._s(t.add?"添加":"编辑")+"\n        ")])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCount,expression:"showCount"}],staticClass:"amount"},[t._v("返点对应发布额："+t._s(t.amount||"0.00")+"（元）")])])},staticRenderFns:[]}},rqCR:function(t,e){},"s/7J":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"预占合同列表"}},[a("div",{staticClass:"z-block z-scaling"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门",horizontal:""}},[a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人",horizontal:""}},[a("b-autocomplete",{attrs:{data:t.filterContractCharges,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:function(e){return t.contractChargeSelected=e?e.id:""}},model:{value:t.contractChargeId,callback:function(e){t.contractChargeId=e},expression:"contractChargeId"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",horizontal:""}},[a("b-autocomplete",{attrs:{data:t.filterClientLists,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"client_name"},on:{select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团名称",horizontal:""}},[a("b-autocomplete",{ref:"companyName",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onCompanySelected},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同名称",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号",horizontal:""}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filtercontractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"排期时间",addons:!1,horizontal:""}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{model:{value:t.enteredDateStart,callback:function(e){t.enteredDateStart=e},expression:"enteredDateStart"}}),t._v("\n                      -\n                      "),a("b-datepicker",{model:{value:t.enteredDateEnd,callback:function(e){t.enteredDateEnd=e},expression:"enteredDateEnd"}})],1)]),t._v(" "),a("cooperation-select",{attrs:{isCoop:t.isCoop,cooperationType:t.cooperation_type,hardWideDetailType:t.hard_wide_detail_type},on:{hasCooperation:t.getCooperation}}),t._v(" "),a("b-field",{attrs:{label:"签约公司类型",horizontal:""}},[a("b-select",{model:{value:t.signingCompanySortId,callback:function(e){t.signingCompanySortId=e},expression:"signingCompanySortId"}},t._l(t.signingCompanySortList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"乙方单位",horizontal:""}},[a("b-select",{model:{value:t.opposingCompanyId,callback:function(e){t.opposingCompanyId=e},expression:"opposingCompanyId"}},t._l(t.opposingCompanyList,function(e){return a("option",{domProps:{value:e.name}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同品类",horizontal:""}},[a("b-select",{on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                            "+t._s(e.val)+"\n                        ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                            "+t._s(e.val)+"\n                        ")])})):t._e()],1),t._v(" "),t.lone?a("b-field",{attrs:{label:"申请人",horizontal:""}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.applyPeopleIdLone,expression:"applyPeopleIdLone"}],staticClass:"input",attrs:{type:"text",autocomplete:"off",disabled:""},domProps:{value:t.applyPeopleIdLone},on:{input:function(e){e.target.composing||(t.applyPeopleIdLone=e.target.value)}}})]):a("b-field",{attrs:{label:"申请人",horizontal:""}},[a("b-autocomplete",{attrs:{data:t.filterapplyPeople,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:function(e){return t.applyPeopleSelected=e?e.id:""}},model:{value:t.applyPeopleId,callback:function(e){t.applyPeopleId=e},expression:"applyPeopleId"}})],1),t._v(" "),a("b-field",{attrs:{label:"审核状态",horizontal:""}},[a("b-select",{model:{value:t.reviewStatusId,callback:function(e){t.reviewStatusId=e},expression:"reviewStatusId"}},t._l(t.reviewStatusList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同类型",horizontal:""}},[a("b-select",{model:{value:t.contractTypeId,callback:function(e){t.contractTypeId=e},expression:"contractTypeId"}},t._l(t.contractTypeList,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"客户类型",horizontal:""}},[a("b-select",{model:{value:t.client_type_id,callback:function(e){t.client_type_id=e},expression:"client_type_id"}},t._l(t.CLIENT_TYPES,function(e,n){return a("option",{key:+n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block z-listbox z-listbox-contracts"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))]),t._v(" "),t._l(10,function(t){return a("b",{key:"b_"+t})}),t._v(" "),a("button",{staticClass:"button is-primary",on:{click:t.getAdUrl}},[t._v("批量添加素材")]),t._v(" "),t.hasPermission("crm_new.ad.yuzhan.add")?a("router-link",{staticClass:"button is-primary",attrs:{to:"/pre_contracts/add"}},[t._v("添加申请合同")]):t._e()],2),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{checkable:t.isChecked,"checked-rows":t.checkedRows,data:t.data,loading:t.isLoading,striped:""},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{field:"contract_number",label:"合同编号"}},[a("router-link",{attrs:{to:"/pre_contracts/"+e.row.id}},[t._v(t._s(e.row.contract_number))])],1),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"apply_user_name",label:"申请人"}},[t._v("\n                    "+t._s(e.row.apply_user_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"amount",label:"合同金额（RMB）"}},[t._v("\n                    "+t._s(e.row.amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_type_name",label:"合同类型"}},[t._v("\n                    "+t._s(e.row.contract_type_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"entered_date",label:"排期时间"}},[t._v("\n                    "+t._s(e.row.start_date)+" - "+t._s(e.row.end_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"applied_approved_status_name",label:"审核状态"}},[t._v("\n                    "+t._s(e.row.applied_approved_status_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"id",label:"修改排期",visible:!t.waibumeijie}},[a("auth",{attrs:{permission:"crm_new.ad.yuzhan.paiqi"}},[0!==e.row.applied_approved_status&&3!==e.row.applied_approved_status&&4!==e.row.applied_approved_status||t.userInfoId!==e.row.apply_user_id&&!t.meiJieZuZhang?t._e():a("a",{staticClass:"button is-link",attrs:{target:"_blank",href:e.row.schdule_detail_url}},[t._v("排期")])])],1),t._v(" "),a("b-table-column",{attrs:{field:"id",label:"上传素材",visible:!t.waibumeijie}},[a("auth",{attrs:{permission:"crm_new.ad.yuzhan.sucai"}},[2!==e.row.applied_approved_status||t.userInfoId!==e.row.apply_user_id&&!t.meiJieZuZhang?t._e():a("a",{staticClass:"button is-link",attrs:{target:"_blank",href:e.row.media_url}},[t._v("素材")])])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[t.hasPermission("crm_new.ad.yuzhan.chakan")?a("router-link",{staticClass:"button is-link",attrs:{to:"/pre_contracts/"+e.row.id}},[t._v("查看")]):t._e(),t._v(" "),a("router-link",{staticClass:"button is-link",attrs:{to:"/pre_contracts/add?id="+e.row.id}},[t._v("复制")]),t._v(" "),a("auth",{attrs:{permission:"crm_new.ad.yuzhan.bianji"}},[0!==e.row.applied_approved_status&&3!==e.row.applied_approved_status&&4!==e.row.applied_approved_status||t.userInfoId!==e.row.apply_user_id&&!t.meiJieZuZhang?t._e():a("router-link",{staticClass:"button is-link",attrs:{to:"/pre_contracts/"+e.row.id+"/edit"}},[t._v("编辑")])],1),t._v(" "),a("auth",{attrs:{permission:"crm_new.ad.yuzhan.delete"}},[0!==e.row.applied_approved_status&&3!==e.row.applied_approved_status||t.userInfoId!==e.row.apply_user_id?t._e():a("a",{staticClass:"button is-danger",on:{click:function(a){t.deleteHandle(e.row,e.index)}}},[t._v("删除")])]),t._v(" "),a("auth",{attrs:{permission:"crm_new.ad.yuzhan.zaibohui"}},[(2===e.row.applied_approved_status&&0===e.row.approve_status_id||1===e.row.applied_approved_status||4===e.row.approve_status_id&&4!==e.row.applied_approved_status)&&(t.userInfoId===e.row.apply_user_id||t.meiJieZuZhang)?a("a",{staticClass:"button is-link",on:{click:function(a){t.rejectHandle(e.row)}}},[t._v("再驳回")]):t._e()])],1),t._v(" "),a("b-table-column",{attrs:{label:"操作日志"}},[a("button",{staticClass:"button is-link",on:{click:function(a){t.showClientLog(e.row.id)}}},[t._v("查看")])])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>1,expression:"total > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1),t._v(" "),a("b-modal",{attrs:{active:t.showLogModal},on:{"update:active":function(e){t.showLogModal=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("操作日志")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.logData,columns:t.logColumns}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},s8ni:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),s=n(i),r=a("O4Lo"),o=n(r),c=a("LZT1"),l=n(c);e.default={props:["id","isEdit"],data:function(){return{forSearch:!0,showLogModal:!1,logData:[],logColumns:[{field:"changed_time",label:"变更时间"},{field:"option_user_name",label:"变更操作人"},{field:"change_type",label:"变更类型"},{field:"old_description",label:"变更前"},{field:"new_description",label:"变更后"}],departments:[],departmentReadonly:!1,departmentId:"",contractDirector:[],userId:"",userName:"",fzrOff:!0,contractNames:[],contractName:"",isFetching_2:!1,isFetching_1:!1,isFetching:!1,partyAOld:null,partyANew:null,partyBOld:"",partyBNew:"",changeType:0,totalContracts:0,contracts:[],currPage:1,perPage:20,totalPage:1,jumpPage:1,sortField:"changed_time",sortOrder:"desc",defaultSortDirection:"asc",bizTypeId:[],contractDateStart:null,contractDateEnd:null,contractNumber:"",signingCompany:"",companiesOld:[],companiesNew:[],contract_company_id:"",click_a:!1,click_b:!1}},created:function(){this.changeCompany(),this.getDepartment(),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getContract(!1)},mounted:function(){var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},watch:{departmentId:function(t){this.userName="",this.userId=null,this.fzrOff&&""!==t&&this.getDirector({department_id:t})},currPage:function(t){this.getContract(!0)}},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.userName.toLowerCase())>=0})}},methods:{changeCompany:function(){"1"===this.contract_company_id?(this.click_a=!0,this.click_b=!1):"2"===this.contract_company_id&&(this.click_b=!0,this.click_a=!1),this.changeType=this.contract_company_id},makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},onCompanySelected:function(t){t&&(this.partyANew=t.id,this.isFetching=!1)},onCompanySelected2:function(t){t&&(this.partyAOld=t.id,this.isFetching_1=!1)},onUserSelected:function(t){t&&(this.userId=t.id)},searchContract:(0,o.default)(function(){this.isFetching_2=!0,this.getContracts()},500),searchCompany:(0,o.default)(function(t){"Old"===t?this.isFetching_1=!0:this.isFetching=!0,this.getCompanies(t)},500),getCompanies:function(t){var e=this,a=void 0,n=void 0;return a="Old"===t?this.partyAOld:this.partyANew,this.ajax({url:"/signing_company/get_list",params:{approve_status_id:2,like_company_name:a}}).then(function(a){n=a.data.lists,"Old"===t?(e.companiesOld=n,e.isFetching_1=!1):(e.companiesNew=n,e.isFetching=!1)})},getContract:function(t){var e=this;this.loading=!0;var a={department_id:this.departmentId,user_id:this.userId,contract_number:this.contractNumber,contract_name:this.contractName,changed_time_start:this.makeStringDate(this.contractDateStart),changed_time_end:this.makeStringDate(this.contractDateEnd),party_a_old:this.partyAOld,party_a_new:this.partyANew,party_b_old:this.partyBOld,party_b_new:this.partyBNew,biz_type_id:this.bizTypeId.join(","),change_type:this.changeType,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage};console.log(a,"paramsparams"),this.urlParams=(0,s.default)({},a),this.ajax({url:"/contract_change/get_contract_change_lists",params:a}).then(function(t){e.totalContracts=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1),e.contracts=t.data.lists;for(var a=0;a<e.contracts.length;a++)e.contracts[a].chakan=function(){return e.hasPermission("crm_new.contract.biangeng.chakan")||!1};e.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},getDepartment:function(){var t=this;return this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,l.default)(e.data);t.departments=a})},getDirector:function(t){var e=this;return this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:t}).then(function(t){t.data.rows.length&&(e.contractDirector=t.data.rows,1===e.contractDirector.length&&(e.userName=e.contractDirector[0].name))})},getContracts:function(){var t=this;return this.ajax({url:"/contract/getContractLists",params:{contract_name:this.contractName}}).then(function(e){t.contractNames=e.data.lists,t.isFetching_2=!1})},onQueryClick:function(){1===this.currPage?this.getContract(!0):this.currPage=1},resetParams:function(){this.departmentId="",this.userId="",this.userName="",this.fzrOff=!0,this.contractNames=[],this.contractName="",this.isFetching_2=!1,this.isFetching=!1,this.isFetching_1=!1,this.partyAOld=null,this.partyANew=null,this.partyBOld="",this.partyBNew="",this.changeType=0,this.totalContracts=0,this.contracts=[],this.currPage=1,this.perPage=20,this.totalPage=1,this.jumpPage=1,this.sortField="changed_time",this.sortOrder="desc",this.bizTypeId=[],this.contractDateStart=null,this.contractDateEnd=null,this.contractNumber="",this.signingCompany="",this.companiesOld=[],this.companiesNew=[],this.contract_company_id="1",this.defaultSortDirection="asc"},exportALL:function(){var t=this,e={department_id:this.departmentId,user_id:this.userId,contract_number:this.contractNumber,contract_name:this.contractName,changed_time_start:this.makeStringDate(this.contractDateStart),changed_time_end:this.makeStringDate(this.contractDateEnd),party_a_old:this.partyAOld,party_a_new:this.partyANew,party_b_old:this.partyBOld,party_b_new:this.partyBNew,biz_type_id:this.bizTypeId.join(","),change_type:this.changeType,order:this.sortOrder,order_by:this.sortField,page:this.currPage,page_size:this.perPage};this.ajax({url:"/contract_change/export_contract_change_lists",params:e}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t),console.log(a)})},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getContract(!0)},showClientLog:function(t){var e=["","甲方签约公司","乙方签约公司","合同负责人","合同延期","币种变更","签订状态"];this.logData=[],this.showLogModal=!0,t.row.change_type=e[t.row.change_type],this.logData.push(t.row)}}}},sJIE:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={props:["id","name"],data:function(){return{showCH:!1,titleCH:"",showEN:!1,titleEN:"",company:1,companyName:"",companyList:[],searchName:this.id?this.name:"",brands:[],brandId:null,isLoading:!1,data:[],total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1,title:null,description:null,showLogModal:!1,logData:[],logColumns:[{field:"creation_time",label:"操作时间"},{field:"editor_name",label:"用户"},{field:"after_info",label:"操作内容"}],showProductsModal:!1,ProductsData:[],ProductsDataTotal:0,add_products_name:null,showAllModal:!1,AllData:[],allColumns:[{field:"group_name",label:"集团"},{field:"title",label:"品牌名称"},{field:"creator_name",label:"创建用户"}],client_type:"",product_line_name:"",brand_product_type:"",levelData:[]}},watch:{currPage:function(t){this.questFn(t)},data:function(t){var e=this;t.length>0&&setTimeout(function(){e.data.forEach(function(t){var a=e.$refs["description_"+t.id].offsetHeight,n=e.$refs["sign_company_"+t.id].offsetHeight;a>60?(e.$refs["description_"+t.id].style.height="60px",t.zk=!0):t.zk=!1,n>60?(e.$refs["sign_company_"+t.id].style.height="60px",t.pk=!0):t.pk=!1,e.$forceUpdate()})},0)}},created:function(){this.getLevel(),this.getCompany(),this.getBrands(),this.questFn()},computed:{filteredBrands:function(){var t=this;return this.brands.filter(function(e){return e.title.toString().toLowerCase().indexOf(t.searchName.toLowerCase())>=0})},filteredCompany:function(){var t=this;return this.companyList.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.companyName.toLowerCase())>=0})}},methods:{checkReg:function(t,e){console.log(e);var a="",n=e?e.titleCH:this.titleCH,i=e?e.titleEN:this.titleEN;return"CH"===t?(a=/^[0-9_&·`~!@#$%*:;°\u4e00-\u9fa5(\u00a0|\u0020|\u3000)]+$/,!a.test(n)&&n?(e?(e.showCH=!0,this.$forceUpdate()):this.showCH=!0,1):(e?(e.showCH=!1,this.$forceUpdate()):this.showCH=!1,0)):(a=/^[a-zA-Z0-9(\u00a0|\u0020)_&·`~!@#$%*:;°]+$/,!a.test(i)&&i?(e?(e.showEN=!0,this.$forceUpdate()):this.showEN=!0,1):(e?(e.showEN=!1,this.$forceUpdate()):this.showEN=!1,0))},clickFn:function(t,e,a){var n=document.getElementById(a+"_"+e),i=document.getElementById("btn_"+a+"_"+e);"收起"===i.innerHTML?(i.innerHTML="展开",n.style.height="60px"):(n.style.height="auto",i.innerHTML="收起")},getLevel:function(){var t=this;this.ajax({url:"/tools/get_cate_list"}).then(function(e){t.levelData=e.data;var a={id:"",val:""};t.levelData.unshift(a)})},getCompany:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/get_data_group_list"}).then(function(e){t.companyList=e.data})},onCompanySelected:function(t){t&&(this.companyName=t.name)},getBrands:function(){var t=this;return this.ajax({url:"/brand/get_brand_list"}).then(function(e){t.brands=e.data})},onBrandSelected:function(t){t&&(this.brandId=t.brand_id,this.searchName=t.title)},onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},questFn:function(t){var e=this;Number(t)||(t=1),this.ajax({loading:this.$loading.open(),url:"/brand/get_brand_list_with_product_line",params:{title:this.searchName,page:t,page_size:this.perPage}}).then(function(t){if(0===t.error_code){for(var a=t.data.list,n=0;n<a.length;n++){a[n].productArray=[];for(var i=0;i<a[n].product_line.length;i++)a[n].productArray.push(a[n].product_line[i].name);a[n].productArray=a[n].productArray.join("；"),a[n].status="over"}e.data=a,e.total=t.data.total,e.totalPage=Math.ceil(t.data.total/e.perPage),0===e.totalPage&&(e.totalPage=1)}})},contractDataValidate:function(t){var e=this,a=[];return t.forEach(function(t){var n=e.$refs[t];n&&n.checkHtml5Validity&&(n.checkHtml5Validity()||a.push(n))}),!a.length||(a[0].focus(),!1)},addHandle:function(){var t=this;if(!this.titleCH&&!this.titleEN)return void this.$dialog.alert("中文名称和英文名称，至少填写一个。");var e="";e=this.titleCH&&this.titleEN?this.titleCH+"-"+this.titleEN:this.titleCH+this.titleEN;var a=["titleCH","titleEN","companyName","searchInput"];if(this.contractDataValidate(a))return this.showCH||this.showEN?void this.$dialog.alert("中文名称或英文名称格式不正确，请修改。"):void this.ajax({loading:this.$loading.open(),url:"/brand/add_brand",method:"post",data:{title:e,group_name:this.companyName,description:this.description},successTip:!0}).then(function(e){0===e.error_code?(t.showEN=!1,t.showCH=!1,t.titleEN="",t.titleCH="",t.company=1,t.companyName="",t.description="",t.questFn()):(t.AllData=e.data,t.showAllModal=!!t.AllData.length)})},editHandle:function(t){t.status="edit",t.titleCH=t.title.split("-")[0]||"",t.titleEN=t.title.split("-")[1]||""},saveHandle:function(t){var e=this;console.log("index-ref",t.id);var a="";a=t.titleCH&&t.titleEN?t.titleCH+"-"+t.titleEN:t.titleCH+t.titleEN;var n=["titleCH_"+t.id,"titleEN_"+t.id];if(this.contractDataValidate(n))return t.showCH||t.showEN?void this.$dialog.alert("中文名称或英文名称格式不正确，请修改。"):void this.ajax({loading:this.$loading.open(),url:"/brand/update_brand",method:"post",data:{id:t.id,title:a,group_name:t.group_name||"",description:t.description},successTip:!0}).then(function(n){0===n.error_code?(t.title=a,t.description=t.description,t.group_name=t.group_name,t.status="over",t.showEN=!1,t.showCH=!1,e.$forceUpdate()):(e.AllData=n.data,e.showAllModal=!!e.AllData.length)})},showProducts:function(t){var e=this;this.cacheId=t.id,this.cacheName=t.title,this.ProductsData=[],this.ProductsDataTotal=0,this.ajax({loading:this.$loading.open(),url:"/brand/get_product_line_by_brand_id",params:{brand_id:t.id}}).then(function(t){if(0===t.error_code){for(var a=t.data,n=0;n<a.length;n++)a[n].status="over";e.ProductsData=a,e.ProductsDataTotal=a.length}}),this.showProductsModal=!0},editProductsHandle:function(t){t.status="edit"},saveProductsHandle:function(t){var e=this;if(t.product_line_name.split("-").length>1)return this.$dialog.alert("产品线名称不能包含-"),0;this.ajax({loading:this.$loading.open(),url:"/brand/update_product_line",method:"post",data:{id:t.product_line_id,product_line_name:t.product_line_name,brand_product_type:t.brand_product_type,client_type:t.client_type_id},successTip:!0}).then(function(a){0===a.error_code&&(t.product_line_name=t.product_line_name,t.status="over",e.$forceUpdate())})},deleteProductsHandle:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此产品线么？",onConfirm:function(){a.ajax({loading:a.$loading.open(),url:"/brand/delete_product_line",method:"post",data:{id:t.product_line_id},successTip:!0}).then(function(t){0===t.error_code&&a.ProductsData.splice(e,1)})}})},addProductsName:function(){var t=this;this.ajax({loading:this.$loading.open(),url:"/brand/add_product_line",method:"post",data:{brand_id:this.cacheId,product_line_name:this.product_line_name,brand_product_type:this.brand_product_type,client_type:this.client_type},successTip:!0}).then(function(e){0===e.error_code&&(t.product_line_name="",t.client_type="",t.brand_product_type="",t.showProducts({id:t.cacheId,title:t.cacheName}),t.questFn())})},deleteHandle:function(t,e){var a=this;this.$dialog.confirm({message:"您确定要删除此品牌么？",onConfirm:function(){a.ajax({loading:a.$loading.open(),url:"/brand/delete_brand",method:"post",data:{id:t.id},successTip:!0}).then(function(t){0===t.error_code&&(a.data.splice(e,1),a.questFn())})}})},showClientLog:function(t){var e=this;this.showLogModal=!0,this.ajax({loading:this.$loading.open(),url:"/brand/get_brand_operation_log",params:{brand_id:t}}).then(function(t){0===t.error_code&&(e.logData=t.data)})},pageHandle:function(t){this.currPage=t},addNewClient:function(){return this.client_type&&this.product_line_name&&this.brand_product_type?this.product_line_name.split("-").length>1?(this.$dialog.alert("产品线名称不能包含-"),0):void this.addProductsName():(this.$dialog.alert("客户类型，产品线类型，产品线名称都是必填，请填写完整。"),0)}}}},sWpo:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"业绩查询"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{horizontal:"",label:"事业部"}},[a("b-select",{model:{value:t.business_id,callback:function(e){t.business_id=e},expression:"business_id"}},t._l(t.DEPARTMENT,function(e,n){return a("option",{key:n,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("cooperation-select",{attrs:{cooperationType:t.cooperation_type,hardWideDetailType:t.hard_wide_detail_type},on:{hasCooperation:t.getCooperation}}),t._v(" "),a("b-field",{attrs:{label:"",horizontal:""}},[a("div")]),t._v(" "),a("b-field",{attrs:{label:"行业",horizontal:""}},[a("b-select",{on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                            "+t._s(e.val)+"\n                        ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                            "+t._s(e.val)+"\n                        ")])})):t._e()],1),t._v(" "),a("select-date",{attrs:{clickReset:t.clickReset,isCheck:t.isCheck,el:t.el,clickBtn:t.clickBtn},on:{selectDate:t.getDate}}),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"展示方式："}},[a("div",{staticClass:"block"},[a("b-radio",{attrs:{"native-value":"1"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            事业部汇总\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"2"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            事业部+软性合作方式汇总\n                        ")]),t._v(" "),a("b-radio",{attrs:{"native-value":"3"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("\n                            行业汇总\n                        ")])],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportAll}},[t._v("导出")])])],1)]),t._v(" "),a("div",{key:t.perPage,staticClass:"z-block z-listbox z-listbox-releases"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.tableDetal,expression:"!tableDetal"}],staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalRelease},[t._v("行数："+t._s(t.totalRelease))])]),t._v(" "),t.create?a("b-table",{directives:[{name:"show",rawName:"v-show",value:t.totalRelease,expression:"totalRelease"}],staticClass:"z-table-clients z-scaling-list z-scaling-releases",attrs:{data:t.release,paginated:!t.isPaginated,"per-page":t.perPage,"current-page":t.currentPage,"pagination-simple":t.isPaginationSimple,"default-sort-direction":t.defaultSortDirection,"default-sort":"user.first_name",detailed:t.tableDetal,"has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},on:{"update:currentPage":function(e){t.currentPage=e}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                    "+t._s(e.row[n.name])+"\n                ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,bordered:"",detailed:t.tableDetal,"has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                            "+t._s(e.row[n.name])+"\n                        ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,bordered:"",detailed:t.tableDetal,"has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                    "+t._s(e.row[n.name])+"\n                                ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,bordered:"","has-detailed-visible":function(t){return!(t.child&&0===t.child.length)}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                            "+t._s(e.row[n.name])+"\n                                        ")])})}}])})]}}])})]}}])})]}}])},[t.isPaginated?a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalRelease,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)]):t._e()],2):t._e()],1)])},staticRenderFns:[]}},spla:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合同变更"}},[a("b-field",{staticClass:"columns z-contracts-top",attrs:{grouped:""}},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同类型"}},[t.contract_type_id?a("b-select",{attrs:{disabled:"true",required:""},model:{value:t.contract_type_id,callback:function(e){t.contract_type_id=e},expression:"contract_type_id"}},[a("option",{attrs:{value:"0"}},[t._v("单笔")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("赠版")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("CPS")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("CPS对账单")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("CPS预估合同")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("CPS结算合同")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("年框")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("平台服务费")]),t._v(" "),a("option",{attrs:{value:"8"}},[t._v("资源置换")]),t._v(" "),a("option",{attrs:{value:"9"}},[t._v("阿里微任务")])]):a("b-input",{attrs:{disabled:"true"},model:{value:t.contract_type_name,callback:function(e){t.contract_type_name=e},expression:"contract_type_name"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"合同编号"}},[a("b-input",{attrs:{disabled:"true",required:""},model:{value:t.contract_number,callback:function(e){t.contract_number=e},expression:"contract_number"}})],1),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),t.isCharge?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更信息"}},[a("b-select",{attrs:{disabled:"true",required:""},model:{value:t.contract_company_id,callback:function(e){t.contract_company_id=e},expression:"contract_company_id"}},[a("option",{attrs:{value:"3"}},[t._v("合同负责人")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("合同延期")])])],1)],1),t._v(" "),3===Number(t.contract_company_id)?a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同负责人"}},[a("b-input",{staticClass:"old_company",attrs:{disabled:t.isEdit,required:""},model:{value:t.old_description,callback:function(e){t.old_description=e},expression:"old_description"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"现合同负责人"}},[a("b-autocomplete",{ref:"user_id",attrs:{disabled:!t.isEdit,data:t.contractUsers,"max-results":10,"keep-first":!0,"open-on-focus":!0,loading:t.fetchingUsers,field:"name",required:""},on:{input:t.getUsers,focus:t.getUsers,select:t.onUserSelect},model:{value:t.new_charge_name,callback:function(e){t.new_charge_name=e},expression:"new_charge_name"}})],1)],1):a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同有效期"}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{disabled:""},model:{value:t.old_description,callback:function(e){t.old_description=e},expression:"old_description"}}),t._v("\n                        -\n                        "),a("b-datepicker",{staticClass:"z-dateinput",attrs:{disabled:""},model:{value:t.old_part_b,callback:function(e){t.old_part_b=e},expression:"old_part_b"}})],1)]),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"现合同有效期",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{ref:"startDate",staticClass:"z-dateinput",attrs:{required:"","max-date":t.new_part_b},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}}),t._v("\n                        -\n                        "),a("b-datepicker",{ref:"endDate",staticClass:"z-dateinput",attrs:{required:"","min-date":t.old_part_b},model:{value:t.new_part_b,callback:function(e){t.new_part_b=e},expression:"new_part_b"}})],1)])],1)])]):t.isCurrency?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更信息"}},[t._v("\n                币种\n                ")])],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原币种"}},[a("b-input",{attrs:{disabled:"true"},model:{value:t.contract_currency_type_name,callback:function(e){t.contract_currency_type_name=e},expression:"contract_currency_type_name"}})],1),t._v(" "),a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后币种"}},[t.isEdit?a("b-select",{ref:"currencyId",attrs:{required:""},model:{value:t.currency_id,callback:function(e){t.currency_id=e},expression:"currency_id"}},t._l(t.CURRENCIES,function(e,n){return a("option",{domProps:{value:n}},[t._v(t._s(e))])})):a("b-input",{attrs:{disabled:"true"},model:{value:t.new_contract_currency_type_name,callback:function(e){t.new_contract_currency_type_name=e},expression:"new_contract_currency_type_name"}})],1)],1)])]):a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更信息"}},[a("b-select",{attrs:{disabled:!t.isEdit,required:""},on:{input:t.changeCompany},model:{value:t.contract_company_id,callback:function(e){t.contract_company_id=e},expression:"contract_company_id"}},[a("option",{attrs:{value:"1"}},[t._v("甲方签约公司")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("乙方签约公司")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("签订状态")])])],1)],1),t._v(" "),a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"原合同信息"}},[(t.isEdit,a("b-input",{staticClass:"old_company",attrs:{disabled:"true",required:""},model:{value:t.old_description,callback:function(e){t.old_description=e},expression:"old_description"}}))],1),t._v(" "),t.isEdit?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后信息"}},[1==t.contract_company_id?a("b-autocomplete",{ref:"company",attrs:{data:t.companyList,"max-results":10,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching2,field:"company_name",required:""},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}}):a("b-select",{ref:"company",attrs:{required:""},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}},t._l(t.companyList,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])}))],1):a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后信息"}},[a("b-input",{attrs:{disabled:"true",required:""},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}})],1)],1)])]),t._v(" "),6!==Number(t.contract_company_id)?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("变更文件")])]),t._v(" "),a("div",{staticClass:"z-block-content z-textWarp"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"审批邮件",message:t.msg,type:t.status}},[t.isEdit?a("b-upload",{ref:"file_url",attrs:{required:!t.file_url.length},on:{input:function(e){t.fileUpload("spyj")}},model:{value:t.spyjFiles,callback:function(e){t.spyjFiles=e},expression:"spyjFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.file_url.length?a("a",{staticClass:"file-name",attrs:{href:t.file_url,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.file_url.length,expression:"!file_url.length"}],staticClass:"nofiles"})])],1)],1)]),t._v(" "),4===Number(t.contract_company_id)?a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"是否需要重新审批原合同："}},[a("b-select",{attrs:{disabled:!t.isEdit,required:""},model:{value:t.is_reset,callback:function(e){t.is_reset=e},expression:"is_reset"}},[a("option",{attrs:{value:"0"}},[t._v("否")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("是")])])],1)],1)]):t._e()]):t._e(),t._v(" "),t.isEdit?[0!=t.isCurrency?a("a",{staticClass:"button is-primary",on:{click:function(e){t.saveCurrency(1)}}},[t._v("保存并提交")]):a("a",{key:3,staticClass:"button is-primary",on:{click:function(e){t.saveContract(1)}}},[t._v("保存并提交")])]:t._e(),t._v(" "),a("a",{key:t.id,staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")])],2)},staticRenderFns:[]}},svzf:function(t,e){},sx4i:function(t,e){},szXn:function(t,e,a){a("aAl0");var n=a("VU/8")(a("661+"),a("prM2"),null,null);t.exports=n.exports},"t+9J":function(t,e){},tDUV:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("Gu7T"),s=n(i),r=a("Xxa5"),o=n(r),c=a("exGp"),l=n(c),d=a("Dd8w"),u=n(d),_=a("mvHQ"),p=n(_),m=a("O4Lo"),h=n(m),f=a("jwvx"),v=n(f),b=a("AwEB"),g=a("LZT1"),y=n(g),C={edit:!1,user_id:"",department_id:"",brand_id:"",kpi_id:"",assessment_date:"",amount:"",mapping:{department_name:"",brand_name:""}};e.default={name:"SuperManage",components:{Modal:v.default},created:function(){this.getDepartment(),this.getKpiList(),this.getBrandList(),this.getBusinessList()},computed:{filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.mapping.user_id.toLowerCase())>=0})}},data:function(){return{tableKey:(new Date).getTime(),editList:{},loadingList:{director:!1},dateList:[],businessList:[],contractDirector:[],departmentList:[],dataList:[],brandList:[],eidtBrandList:[],file:{},pagination:{page:1,page_size:10,order:"desc",total:0},page:1,total_amount:"",isLoading:!0,mapping:{user_id:"",brand_id:""},form:{start_assessment_date:new Date((0,b.preMonth)()),end_assessment_date:new Date((0,b.nextMonth)()),department_id:"",user_id:"",brand_id:""}}},methods:{enterCancel:function(t,e){if("number"==typeof t.id)return void(t.editObj.edit=!1);this.dataList.splice(e,1)},changeNumber:function(t){var e=this.dateList.map(function(e){return t.editObj.mapping[e].amount}).reduce(function(t,e){return t+=Number(e)},0);t.editObj.amount=e},downLoad:function(){window.location.href="https://crm-bgm.smzdm.com/file_template/kpi_template.xlsx"},resetData:function(){this.form={start_assessment_date:new Date((0,b.preMonth)()),end_assessment_date:new Date((0,b.nextMonth)()),department_id:"",user_id:"",brand_id:""},this.mapping={user_id:"",brand_id:""},this.contractDirector=[]},editKpiData:function(t){var e=this,a=t.id,n=t.editObj,i=n.user_id,s=n.department_id,r=n.brand_id,o=n.mapping,c=[],l=[],d=[];for(var _ in o)_.includes("-")&&(c.push(_),l.push(o[_].amount),d.push(o[_].id||0));return this.ajax({url:"/kpi_config/update_kpi/",method:"post",data:{id:a,user_id:i,department_id:s,brand_id:r,assessment_date:c,amount:l,kpi_id:d}}).then(function(a){var n=a.error_code,i=a.data;if(0===n){var s=JSON.parse((0,p.default)(C)),r=e.dateList.reduce(function(t,e){var a=i.child.filter(function(t){return t.date===e})[0]||{amount:0};return a=(0,u.default)({},a),a.amount=parseFloat(a.amount),t[e]=a,t},{});s.mapping=(0,u.default)({},s.mapping,r,{department_name:i.dname,brand_name:i.title});var o=(0,u.default)({},s,{brand_id:i.brand_id,department_id:i.department_id,user_id:i.user_id}),c=(0,u.default)({},i,{editObj:o}),l=e.dataList.findIndex(function(t){return t.id===c.id});e.dataList.splice(l,1,c),t.editObj.edit=!1}})},addKpiObj:function(t){var e=t.editObj,a=e.user_id,n=e.brand_id,i=e.department_id;return a||0===a?n||0===n?this.ajax({url:"/kpi_config/add_kpi",method:"post",data:{user_id:a,brand_id:n,department_id:i}}).then(function(e){var a=e.error_code,n=(e.error_msg,e.data.id);return!a&&(t.id=n,!0)}):(this.$dialog.alert("负责品牌不能为空"),!1):(this.$dialog.alert("商务名称不能为空"),!1)},saveData:function(t){var e=this;return(0,l.default)(o.default.mark(function a(){var n,i,s,r;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n=e.dataList[t],i=n.editObj.mapping,a.t0=o.default.keys(i);case 3:if((a.t1=a.t0()).done){a.next=10;break}if(s=a.t1.value,!(e.dateList.includes(s)&&i[s].amount<0)){a.next=8;break}return e.$dialog.alert(s+"数字不能小于0"),a.abrupt("return");case 8:a.next=3;break;case 10:if("string"!=typeof n.id){a.next=16;break}return a.next=13,e.addKpiObj(n);case 13:if(r=a.sent){a.next=16;break}return a.abrupt("return");case 16:e.editKpiData(n);case 17:case"end":return a.stop()}},a,e)}))()},editBrand:function(t,e){var a=t.brand_id;e.brand_id=a},selectData:function(t,e){var a=this;return(0,l.default)(o.default.mark(function n(){var i,s,r;return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(-1!==t){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,a.getDepartmentFromBusiness(t);case 4:if(i=n.sent){n.next=7;break}return n.abrupt("return");case 7:s=i.department_name,r=i.department_id,e.mapping.department_name=s,e.department_id=r;case 10:case"end":return n.stop()}},n,a)}))()},getDepartmentFromBusiness:function(t){return this.ajax({url:"/user/info/"+t+"/",params:{with_department:1}}).then(function(t){var e=t.error_code,a=t.data;if(0!==e)return!1;var n=a.department_list;return n.length?n[0]:{department_id:0,department_name:"部门不存在或已被删除"}})},editKpi:function(t){t.editObj.edit=!0},deleteKpi:function(t){var e=this;this.$dialog.confirm({message:"您确定要删除此条KPI么？",onConfirm:function(){e.ajax({url:"/kpi_config/delete_kpi",data:{id:t.id},method:"post"}).then(function(t){0===t.error_code&&e.getKpiList()})}})},addKpiData:function(){var t=this.dateList.reduce(function(t,e,a){return t[e]={amount:0},t},{}),e=JSON.parse((0,p.default)(C));e.mapping=(0,u.default)({},e.mapping,t);var a={id:(new Date).getTime().toString(),child:[],department_id:"",dname:"",editObj:(0,u.default)({},e,{edit:!0}),title:"",total_amount:0,uname:"",user_id:""};this.dataList.unshift(a)},autoSelect:function(t,e,a){t&&(this.form[e]=t,this.mapping[e]=a)},getBrandList:function(t,e){var a=this;return(0,l.default)(o.default.mark(function n(){var i;return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=void 0,i=e?t:a.mapping.brand_id,n.abrupt("return",a.ajax({url:"/brand/get_brand_list",params:{title:i,is_contract_list:0}}).then(function(t){a.brandList=t.data}));case 3:case"end":return n.stop()}},n,a)}))()},searchDirectorList:(0,h.default)(function(){this.loadingList.director=!0,this.getDirector()},500),getDirector:function(t){var e=this;this.ajax({url:"/user/get_list_by_department_id/",method:"post",data:t}).then(function(t){if(e.loadingList.director=!1,0!==t.error_code||!t.data||!t.data.rows.length)return void(e.contractDirector=[]);e.contractDirector=t.data.rows})},getDepartment:function(){var t=this;this.loading=!0,this.ajax({url:"/department/index/"}).then(function(e){var a=(0,y.default)(e.data);t.departmentList=a})},fileIsOk:function(t){var e=t.name;if(!e.endsWith("xls")&&!e.endsWith("xlsx"))return this.$toast.open({message:"您选择的文件格式不符合要求，请重新选择！",queue:!1,position:"is-top",type:"is-danger"}),this.file={},!1;this.importKpiList()},importKpiList:function(){var t=this;this.ajax({method:"post",url:"/kpi_config/kpi_excel",data:{filename:this.file},headers:{"Content-Type":"multipart/form-data"}}).then(function(e){var a=e.error_code,n=e.error_msg,i=e.data;if(0!==a)return void(window.location.href=i.file_path);t.$toast.open({duration:3e3,message:n,position:"is-top",type:"is-success"}),t.getKpiList(!0)})},getKpiList:function(t){var e=this;this.isLoading=!0,t&&(this.pagination.page=1,this.pagination.total=0);var a=(0,u.default)({},this.form,{start_assessment_date:(0,b.changeMonth)(this.form.start_assessment_date),end_assessment_date:(0,b.changeMonth)(this.form.end_assessment_date)});this.ajax({method:"post",url:"/kpi_config/get_kpi_lists",data:(0,u.default)({},this.pagination,a)}).then(function(a){var n=a.error_code,i=a.data;if(e.isLoading=!1,0===n){var s=i.lists,r=i.total,o=i.total_amount,c=i.date;e.dateList=c,e.dataList=s.map(function(t){var a=JSON.parse((0,p.default)(C)),n=e.dateList.reduce(function(e,a){var n=t.child.filter(function(t){return t.date===a})[0]||{amount:0};return n=JSON.parse((0,p.default)(n)),n.amount=parseFloat(n.amount),e[a]=n,e},{});a.mapping=(0,u.default)({},a.mapping,n,{department_name:t.dname,brand_name:t.title});var i=(0,u.default)({},a,{brand_id:t.brand_id,department_id:t.department_id,user_id:t.user_id,amount:t.total_amount});return(0,u.default)({},t,{editObj:i})}),e.pagination.total=r,e.total_amount=o,t&&(e.tableKey=(new Date).getTime())}})},goEnter:function(){this.pagination.page=Number(this.page),this.pageHandle()},pageHandle:function(){var t=this;setTimeout(function(){t.getKpiList()},0)},getBusinessList:function(){var t=this;this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{is_delete:0,role_code:"role-crm-shangwu"}}).then(function(e){var a=e.error_code,n=e.data.rows;0===a&&(t.businessList=[{id:-1,name:"待招"}].concat((0,s.default)(n)))})},exportAll:function(){var t=this,e=(0,u.default)({},this.form,{start_assessment_date:(0,b.changeMonth)(this.form.start_assessment_date),end_assessment_date:(0,b.changeMonth)(this.form.end_assessment_date)});this.ajax({url:"/kpi_config/export_kpi_lists",params:(0,u.default)({},this.pagination,e)}).then(function(e){t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})}},watch:{"mapping.brand_id":{handler:function(t){t||(this.form.brand_id="")}},"mapping.user_id":{handler:function(t){t||(this.form.user_id="")}},"form.department_id":{handler:function(t){t&&this.getDirector({department_id:t,is_contract_list:1})},immediate:!1}}}},tDx6:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),s=n(i),r=a("Xxa5"),o=n(r),c=a("exGp"),l=n(c),d=a("kZBa"),u=a("jELS"),_=a("AwEB"),p=["","进行中","已完成","暂停"].map(function(t,e){return{id:e,value:t}}),m=(0,u.toggleArrToObj)(p);e.default={data:function(){return{amount:{total_amount:0,total_count:0,run_amount:0,run_count:0},pagination:{total:0,page:1,page_size:10,jumpPage:1},form:{user_id:"",manager_id:"",client_id:"",client_type:"",platform_id:"",business_id:"",name:"",cooperation_id:"",run_status:"",start_order_date:new Date((0,_.preMonth)()),end_order_date:new Date((0,_.nextMonth)()),start_date:null,end_date:null,start_run_date:null,end_run_date:null},mapping:{user_id:"",manager_id:"",client_id:"",name:"",cooperation_id:""},STATUS:p,STATUSFORM:m,platfromList:[],orderList:[],businessList:[],client_type_id:"",clientList:[],clientName:"",codeList:[],charge_userName:"",contractDirector:[],isAdmin:!1,projectListData:[],projectList:[],frameList:[],frameLists:[]}},computed:{orderListFilter:function(){var t=this.mapping.cooperation_id;return this.orderList.filter(function(e){return!!e.val.match(t)})},filteredUser:function(){var t=this;return this.contractDirector.filter(function(e){return e.name.toString().toLowerCase().indexOf(t.mapping.user_id.toLowerCase())>=0})}},created:function(){this.postProjectList(),this.postStatisticsAmount(),this.postDirectorList(),this.postCodeList(),this.getClientList(),this.getBusinessList(),this.getPlatfromList(),this.getOrderList(),this.postProjectListData()},methods:{hide:function(t){t.flag=!0,this.$forceUpdate()},toggle:function(t){t.flag=!1,this.$set(t,"hide",!0),this.$forceUpdate()},judge:function(t){return this.$refs[t].offsetHeight>58},changeData:function(t,e,a){t||(this.form[e]=""),a&&this[a]()},changePage:function(t){this.pagination.page=t,this.postProjectList()},editData:function(t){this.$router.push({path:"/workOrder/detail",query:{id:t}})},exportAll:function(){var t=this;return(0,l.default)(o.default.mark(function e(){var a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.postExportProjectList)(t.getParams());case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.exportLive(a);case 6:case"end":return e.stop()}},e,t)}))()},exportLive:function(t){var e=this;return(0,l.default)(o.default.mark(function a(){var n;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,d.exportLive)(t);case 2:if(n=a.sent){a.next=5;break}return a.abrupt("return",e.exportLive(t));case 5:window.location.href=t.file_path;case 6:case"end":return a.stop()}},a,e)}))()},postStatisticsAmount:function(t){var e=this;return(0,l.default)(o.default.mark(function a(){var n;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,d.postStatisticsAmount)(t||e.getParams());case 2:if(n=a.sent){a.next=5;break}return a.abrupt("return");case 5:e.amount=n;case 6:case"end":return a.stop()}},a,e)}))()},jumpToPage:function(){this.pagination.page=Number(this.pagination.jumpPage),this.postProjectList()},getParams:function(){var t=this.pagination,e=t.page,a=t.page_size,n=this.form,i=(0,_.changeMonth)(n.start_order_date,!0),r=(0,_.changeMonth)(n.end_order_date,!0),o=(0,_.changeMonth)(n.start_date,!0),c=(0,_.changeMonth)(n.end_date,!0),l=(0,_.changeMonth)(n.start_run_date,!0),d=(0,_.changeMonth)(n.end_run_date,!0);return(0,s.default)({},this.form,{page:e,page_size:a,start_order_date:i,end_order_date:r,start_date:o,end_date:c,start_run_date:l,end_run_date:d})},postProjectList:function(t){var e=this;return(0,l.default)(o.default.mark(function a(){var n,i,s;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t&&(e.pagination.page=1),a.next=3,(0,d.postProjectList)(e.getParams());case 3:return n=a.sent,i=n.total,s=n.lists,e.pagination.total=i,e.projectList=s,e.postStatisticsAmount(e.getParams()),a.next=11,e.$nextTick();case 11:e.projectList.forEach(function(){var t=(0,l.default)(o.default.mark(function t(a){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a.flag=e.judge(a.id);case 1:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}());case 12:case"end":return a.stop()}},a,e)}))()},postProjectListData:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.postProjectListData)({name:t.mapping.name});case 2:t.projectListData=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},autoSelect:function(t,e,a){console.log(t),console.log(e),console.log(a),t&&(this.form[e]=t,this.mapping[e]=a)},getPlatfromList:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getPlatfromList)();case 2:t.platfromList=e.sent,t.platfromList.unshift({id:0,value:""});case 4:case"end":return e.stop()}},e,t)}))()},onSelectCooperationType:function(){},getOrderList:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getOrderList)();case 2:t.orderList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},getBusinessList:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getBusinessList)();case 2:t.businessList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},getClientList:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getClientList)({keyword:t.mapping.client_id});case 2:t.clientList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},postCodeList:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.postCodeList)({name:t.mapping.charge_userName});case 2:t.codeList=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},postDirectorList:function(){var t=this;return(0,l.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.postDirectorList)();case 2:t.contractDirector=e.sent;case 3:case"end":return e.stop()}},e,t)}))()},resetParams:function(){(0,u.clearData)(this.form),(0,u.clearData)(this.mapping),this.form.start_order_date=new Date((0,_.preMonth)()),this.form.end_order_date=new Date((0,_.nextMonth)())}}}},tiL8:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={1:"电商",2:"品牌商",3:"店铺",4:"联盟"};e.default={name:"ClientDegrees",props:["clientId"],data:function(){return{headInfo:{title:"",product_line_name:"",client_name:"",client_type:1,user_name:"",department_name:"",amount:0,receivable_balance:0,receivabled_balance:0},degreesList:[],CLIENT_TYPES:n}},created:function(){this.getDegrees()},methods:{exportALL:function(){var t=this;this.ajax({url:"/client_degree/export_client_degree",params:{client_id:this.clientId}}).then(function(e){""===e.error_msg&&t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})},getDegrees:function(){var t=this;this.ajax({url:"/client_degree/list",params:{client_id:this.clientId}}).then(function(e){var a=e.data;(a.length||"array"!==Object.prototype.toString.call(a).slice(8,-1).toLowerCase())&&(t.headInfo=a.head_info||t.headInfo,t.degreesList=a.lists)})}}}},tw7b:function(t,e){},uGor:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{active:t.active,"has-modal-card":"","trap-focus":"","destroy-on-hide":!1,"aria-role":"dialog","aria-modal":""},on:{"update:active":function(e){t.active=e}}},[a("div",{staticClass:"container"},[a("div",{staticClass:"container-inner"},[a("p",{staticClass:"title"},[t._v(t._s(t.title))]),t._v(" "),a("div",{},[a("button",{staticClass:"button btn-search is-primary",on:{click:t.addIssuingAmount}},[t._v("\n                    新增\n                ")]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list z-scaling-releases mt20",attrs:{bordered:"",data:t.dataList},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"gender",label:"发布额：X（万元）"}},[a("div",{staticClass:"flex"},[a("div",{staticClass:"flex flex1"},[a("b-input",{attrs:{type:"number"},on:{blur:function(a){return t.changeMin(e.index,e.row,a)}},model:{value:e.row.min,callback:function(a){t.$set(e.row,"min",a)},expression:"props.row.min"}}),t._v(" "),a("p",[t._v("≤ X <")]),t._v(" "),e.index!==t.dataList.length-1?[a("b-input",{attrs:{type:"number"},on:{blur:function(a){return t.changeMax(e.index,e.row,a)}},model:{value:e.row.max,callback:function(a){t.$set(e.row,"max",a)},expression:"props.row.max"}})]:t.infinite?[a("b-input",{attrs:{disabled:""}})]:[a("b-input",{attrs:{type:"number"},model:{value:e.row.max,callback:function(a){t.$set(e.row,"max",a)},expression:"props.row.max"}})]],2),t._v(" "),e.index===t.dataList.length-1?a("p",{staticClass:"infinite",class:["infinite",t.infinite?"red":""],on:{click:function(a){t.changeInfinite(e.row)}}},[t._v("\n                                    ∞\n                                ")]):a("p",{staticClass:"infinite"})])]),t._v(" "),a("b-table-column",{attrs:{field:"date",label:"返点规则"}},[a("div",{staticClass:"flex flex-start"},[a("b-input",{attrs:{type:"number"},model:{value:e.row.rebate,callback:function(a){t.$set(e.row,"rebate",a)},expression:"props.row.rebate"}}),t._v(" "),a("p",[t._v("%")])],1)]),t._v(" "),a("b-table-column",{attrs:{label:"操作",centered:""}},[a("button",{staticClass:"button is-link is-primary",on:{click:function(a){t.deleteRule(e.index)}}},[t._v("\n                                删除\n                            ")])])]}}])})],1),t._v(" "),a("button",{staticClass:"button btn-search is-primary",on:{click:t.saveRule}},[t._v("\n                保存\n            ")])])])])},staticRenderFns:[]}},uMTL:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{active:t.active,"has-modal-card":"","trap-focus":"","destroy-on-hide":!1,"aria-role":"dialog","aria-modal":""},on:{"update:active":function(e){t.active=e}}},[a("div",{staticClass:"container"},[a("p",{staticClass:"title"},[t._v(t._s(t.title))]),t._v(" "),a("div",{staticClass:"top-search"},[5===t.saveForm.data_type?a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brandList,field:"title","max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isLoading},on:{input:t.getBrandList,focus:t.getBrandList,select:t.brandSelect},model:{value:t.brand.title,callback:function(e){t.$set(t.brand,"title",e)},expression:"brand.title"}}):a("b-select",{on:{input:t.changeSelect},model:{value:t.level.id,callback:function(e){t.$set(t.level,"id",e)},expression:"level.id"}},t._l(t.brandList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.val))])})),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:this.resetConfirm}},[t._v("\n                重置\n            ")]),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:t.addBrand}},[t._v("\n                新增"+t._s(this.themeName)+"\n            ")])],1),t._v(" "),a("div",{staticClass:"mt20"},t._l(t.dataList,function(e,n){return a("b-collapse",{key:n,staticClass:"card",attrs:{animation:"slide",open:t.isOpen==n},on:{open:function(e){t.isOpen=n}},scopedSlots:t._u([{key:"trigger",fn:function(i){return a("div",{staticClass:"card-header",attrs:{role:"button"}},[a("a",{staticClass:"card-header-icon"},[a("b-icon",{attrs:{icon:i.open?"menu-down":"menu-up"}})],1),t._v(" "),a("div",{staticClass:"card-header-title"},[a("div",[t._v("\n                            "+t._s(e.data_type_name)+"\n                        ")]),t._v(" "),a("div",{on:{click:function(t){t.stopPropagation()}}},[a("button",{staticClass:"button is-primary btn-search",on:{click:function(a){t.addRule(e.rule,n)}}},[t._v("\n                                新增规则\n                            ")]),t._v(" "),parseInt(e.is_update)?t._e():a("button",{staticClass:"button is-primary btn-search",on:{click:function(a){t.deleteBrand(e,n)}}},[t._v("\n                                删除\n                            ")])])])])}}])},[a("div",{staticClass:"card-content"},[a("b-table",{attrs:{bordered:"",data:e.rule},scopedSlots:t._u([{key:"default",fn:function(i){return[a("b-table-column",{attrs:{field:"issuingAmount",label:"发布额:X（万元）"}},[a("div",{staticClass:"flexs"},[a("div",{staticClass:"flexs flex1"},[a("b-input",{on:{blur:function(e){return t.changeMin(n,i.index,i.row,e)}},model:{value:i.row.min,callback:function(e){t.$set(i.row,"min",e)},expression:"props.row.min"}}),t._v(" "),a("p",[t._v("≤ X <")]),t._v(" "),i.index!==e.rule.length-1?[a("b-input",{on:{blur:function(e){return t.changeMax(n,i.index,i.row,e)}},model:{value:i.row.max,callback:function(e){t.$set(i.row,"max",e)},expression:"props.row.max"}})]:e.infinite?[a("b-input",{attrs:{disabled:""}})]:[a("b-input",{model:{value:i.row.max,callback:function(e){t.$set(i.row,"max",e)},expression:"props.row.max"}})]],2),t._v(" "),i.index===e.rule.length-1?a("p",{staticClass:"infinite",class:["infinite",e.infinite?"red":""],on:{click:function(a){t.changeInfinite(e,i.row)}}},[t._v("\n                                        ∞\n                                    ")]):a("p",{staticClass:"infinite"})])]),t._v(" "),a("b-table-column",{attrs:{field:"issuingAmount",label:"返点规则"}},[a("div",{staticClass:"flex flex-start"},[a("b-input",{attrs:{type:"number"},model:{value:i.row.rebate,callback:function(e){t.$set(i.row,"rebate",e)},expression:"props.row.rebate"}}),t._v(" "),a("p",[t._v("%")])],1)]),t._v(" "),a("b-table-column",{attrs:{field:"issuingAmount",label:"操作"}},[a("button",{staticClass:"button is-primary btn-search",on:{click:function(a){t.deleteRule(e.rule,i.index,n)}}},[t._v("\n                                    删除\n                                ")])])]}}])})],1)])})),t._v(" "),a("button",{staticClass:"button is-primary mt20",on:{click:t.saveData}},[t._v("\n            保存\n        ")])])])},staticRenderFns:[]}},uSYJ:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"回款认领审核"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"回款状态"}},[a("b-select",{model:{value:t.defaultStatus,callback:function(e){t.defaultStatus=e},expression:"defaultStatus"}},t._l(t.isStatus,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"交易流水号"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.number,expression:"number"}],staticClass:"input",attrs:{type:"text",autocomplete:"off"},domProps:{value:t.number},on:{input:function(e){e.target.composing||(t.number=e.target.value)}}})]),t._v(" "),a("b-field",{attrs:{label:"合同编号"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNumberList,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_3,field:"contract_number"},on:{focus:t.searchContractList,input:t.searchContractList},model:{value:t.contractsNumber,callback:function(e){t.contractsNumber=e},expression:"contractsNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同名称"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching_2,field:"contract_name"},on:{focus:t.searchContract,input:t.searchContract},model:{value:t.contractsName,callback:function(e){t.contractsName=e},expression:"contractsName"}})],1),t._v(" "),a("b-field",{attrs:{label:"所属部门"}},[a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人"}},[a("b-select",{model:{value:t.defaultResponsible,callback:function(e){t.defaultResponsible=e},expression:"defaultResponsible"}},t._l(t.responsibleArray,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"甲方签约公司"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filterSigningCompanys,"max-results":50,"keep-first":!1,"open-on-focus":!0,field:"company_name"},on:{select:t.onSelectedCompany},model:{value:t.signingCompany,callback:function(e){t.signingCompany=e},expression:"signingCompany"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("router-link",{staticClass:"button is-primary",attrs:{to:"payments?page=1"}},[t._v("导入")])],1)],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",[t._v("总数："+t._s(t.total))])]),t._v(" "),a("b-table",{staticClass:"z-table",attrs:{data:t.data,striped:"","checked-rows":t.checkedRows,checkable:""},on:{"update:checkedRows":function(e){t.checkedRows=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{field:"id",label:"序号"}},[t._v("\n                    "+t._s(e.row.id)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"transaction_number",label:"交易流水号"}},[t._v("\n                    "+t._s(e.row.transaction_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_number",label:"合同编号"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"contract_name",label:"合同名称"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"signing_company_name",label:"甲方签约公司"}},[t._v("\n                    "+t._s(e.row.signing_company_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_amount",label:"认领金额"}},[t._v("\n                    "+t._s(e.row.detail_amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"currency_id",label:"币种"}},[t._v("\n                    "+t._s(e.row.currency_id)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"is_deduct_money",label:"抵扣应收"}},[t._v("\n                    "+t._s(e.row.is_deduct_money)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"备注"}},[t._v("\n                    "+t._s(e.row.remark)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_username",label:"认领人"}},[t._v("\n                    "+t._s(e.row.detail_username)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"remark",label:"摘要"}},[t._v("\n                    "+t._s(e.row.remark)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{field:"detail_status_text",label:"状态"}},[t._v("\n                    "+t._s(e.row.detail_status_text)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("auth",{attrs:{permission:"crm_new.finance.shenhe.queren"}},[1===e.row.detail_status_id||2===e.row.detail_status_id?a("a",{staticClass:"button is-link",on:{click:function(a){t.determine(e.row)}}},[t._v("确认")]):t._e()]),t._v(" "),a("auth",{attrs:{permission:"crm_new.finance.shenhe.bohui"}},[a("a",{staticClass:"button is-link",on:{click:function(a){t.reject(e.row)}}},[t._v("驳回")])])],1)]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>1,expression:"total > 1"}],staticClass:"z-pagination"},[a("button",{staticClass:"button is-primary allHandle",on:{click:t.allHandle}},[t._v("批量通过")]),t._v(" "),a("b-pagination",{attrs:{total:t.total,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},urYB:function(t,e){},uzIf:function(t,e,a){var n=a("VU/8")(a("VARa"),a("6csG"),null,null);t.exports=n.exports},"v+uL":function(t,e,a){a("Of3N");var n=a("VU/8")(a("AKws"),a("Fqjm"),"data-v-3b616af3",null);t.exports=n.exports},v79A:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-modal",{attrs:{active:t.active,"has-modal-card":"","trap-focus":"","destroy-on-hide":!1,"aria-role":"dialog","aria-modal":""},on:{"update:active":function(e){t.active=e}}},[a("div",{staticClass:"container"},[a("p",{staticClass:"title"},[t._v(t._s(t.title))]),t._v(" "),a("div",{staticClass:"flex"},[this.id?a("b-field",{attrs:{"custom-class":"baseInfoLabel",horizontal:"",label:"框架号:",type:"text"}},[t._v("\n                "+t._s(t.form.frame_number)+"\n            ")]):t._e(),t._v(" "),a("b-field",{attrs:{"custom-class":"baseInfoLabel",horizontal:"",label:"框架名称:",type:"text"}},[a("b-input",{staticClass:"inputs",attrs:{name:"subject",expanded:""},model:{value:t.form.frame_name,callback:function(e){t.$set(t.form,"frame_name",e)},expression:"form.frame_name"}})],1),t._v(" "),a("b-field",{attrs:{"custom-class":"baseInfoLabel",horizontal:"",label:"框架负责人:",type:"text"}},[a("b-input",{staticClass:"inputs",attrs:{name:"subject",expanded:""},model:{value:t.form.frame_leader,callback:function(e){t.$set(t.form,"frame_leader",e)},expression:"form.frame_leader"}})],1),t._v(" "),a("b-field",{attrs:{"custom-class":"baseInfoLabel",horizontal:"",label:"生效时间:",type:"text"}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{disabled:1===t.form.is_frame,type:"month","max-date":t.form.end_date},nativeOn:{click:function(e){1===t.form.is_frame&&t.toastTip()}},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}}),t._v("\n                    -\n                    "),a("b-datepicker",{attrs:{type:"month","min-date":t.minDate},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1)])],1),t._v(" "),a("button",{staticClass:"button btn-search is-primary",on:{click:t.saveBaseInfo}},[t._v("\n            保存\n        ")])])])},staticRenderFns:[]}},vEai:function(t,e){},vTBl:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{name:{type:String,default:""},add:{type:Boolean,default:!1},showCount:Boolean,amount:String}}},vqQj:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"合同变更"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更信息"}},[a("b-select",{attrs:{disabled:!t.isEdit,required:""},model:{value:t.contract_company_id,callback:function(e){t.contract_company_id=e},expression:"contract_company_id"}},[a("option",{attrs:{value:"1"}},[t._v("甲方签约公司")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("乙方签约公司")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("合同负责人")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("签订状态")])])],1),t._v(" "),a("div",{staticClass:"column"})],1),t._v(" "),a("div",{staticClass:"columns"},[t.isEdit&&-1===[3,6].indexOf(Number(t.contract_company_id))?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后信息"}},[1==Number(t.contract_company_id)?a("b-autocomplete",{ref:"new_description",attrs:{data:t.companyList,"max-results":10,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching2,field:"company_name",required:""},on:{input:t.searchCompany,focus:t.searchCompany,select:t.onCompanySelected},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}}):a("b-select",{ref:"new_description",attrs:{required:""},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}},t._l(t.companyList,function(e){return a("option",{domProps:{value:e}},[t._v(t._s(e))])}))],1):3===Number(t.contract_company_id)?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"现合同负责人"}},[a("b-autocomplete",{ref:"new_description",attrs:{disabled:!t.isEdit,data:t.contractUsers,"max-results":10,"keep-first":!0,"open-on-focus":!0,loading:t.fetchingUsers,field:"name",required:""},on:{input:t.getUsers,focus:t.getUsers,select:t.onUserSelect},model:{value:t.new_description,callback:function(e){t.new_description=e},expression:"new_description"}})],1):6===Number(t.contract_company_id)?a("b-field",{staticClass:"column",attrs:{horizontal:"",expanded:"",label:"变更后签订状态"}},[a("b-select",{ref:"new_id",attrs:{disabled:!t.isEdit,required:""},model:{value:t.new_id,callback:function(e){t.new_id=e},expression:"new_id"}},[a("option",{attrs:{value:"-1"}},[t._v("默认")]),t._v(" "),a("option",{attrs:{value:"0"}},[t._v("我方已签")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("对方已签")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("双方已签")]),t._v(" "),a("option",{attrs:{value:"9"}},[t._v("双方未签")]),t._v(" "),a("option",{attrs:{value:"10"}},[t._v("无需合同")])])],1):t._e(),t._v(" "),a("div",{staticClass:"column"}),t._v(" "),a("div",{staticClass:"column"})],1)])]),t._v(" "),6!==Number(t.contract_company_id)?a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("变更文件")])]),t._v(" "),a("div",{staticClass:"z-block-content z-textWarp"},[a("div",{staticClass:"columns"},[a("b-field",{staticClass:"column z-upload",attrs:{horizontal:"",expanded:"",label:"审批邮件",message:t.msg,type:t.status}},[t.isEdit?a("b-upload",{ref:"spyjFiles",attrs:{required:!t.file_url.length},on:{input:function(e){t.fileUpload("spyj")}},model:{value:t.spyjFiles,callback:function(e){t.spyjFiles=e},expression:"spyjFiles"}},[a("a",{staticClass:"button is-primary"},[a("b-icon",{attrs:{icon:"upload"}}),t._v(" "),a("span",[t._v("上传")])],1)]):t._e(),t._v(" "),a("div",[t.file_url.length?a("a",{staticClass:"file-name",attrs:{href:t.file_url,target:"_blank"}},[t._v("预览")]):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.file_url.length,expression:"!file_url.length"}],staticClass:"nofiles"})])],1)],1)])]):t._e(),t._v(" "),t.isEdit?[a("a",{key:3,staticClass:"button is-primary",on:{click:function(e){t.saveContract(1)}}},[t._v("保存并提交")])]:t._e(),t._v(" "),a("a",{key:t.ids,staticClass:"button is-primary",on:{click:function(e){t.$router.go(-1)}}},[t._v("返回")]),t._v(" "),a("div",{staticClass:"z-block",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"z-block-title"},[a("h2",[t._v("批量变更合同列表")])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同编号",field:"contract_number"}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同名称",field:"contract_name"}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"品牌名称",field:"brand_name"}},[t._v("\n                    "+t._s(e.row.brand_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"负责人"}},[t._v("\n                    "+t._s(e.row.contract_charge_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"甲方签约公司"}},[t._v("\n                    "+t._s(e.row.signing_company_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"乙方签约公司"}},[t._v("\n                    "+t._s(e.row.party_b_name)+"\n                ")]),t._v(" "),a("b-table-column",{staticClass:"z-date-td",attrs:{label:"起止时间",field:"start_date",sortable:""}},[t._v("\n                    "+t._s(e.row.start_date)+" - "+t._s(e.row.end_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态",field:"approve_status_id"}},[t._v("\n                    "+t._s(e.row.approve_status_name)+"\n                ")])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)],2)},staticRenderFns:[]}},wUtP:function(t,e){},wclT:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"KPI查询页面"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("select-date",{attrs:{year:2019,title:t.dateTitle,isCheck:t.isCheck,clickReset:t.clickReset,el:t.el,clickBtn:t.clickBtn},on:{selectDate:t.getDate}}),t._v(" "),a("b-field",{attrs:{label:"部门",horizontal:""}},[t.departmentReadonly?a("b-input",{attrs:{disabled:t.departmentReadonly},model:{value:t.departmentName,callback:function(e){t.departmentName=e},expression:"departmentName"}}):a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departmentList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"商务名称",horizontal:""}},[1===t.contractDirector.length&&t.userReadonly?a("b-input",{staticClass:"z-fuze-input",attrs:{readonly:"readonly",disabled:t.userReadonly},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{horizontal:"",label:"品牌"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filteredBrands,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onBrandSelected},model:{value:t.brandName,callback:function(e){t.brandName=e},expression:"brandName"}})],1),t._v(" "),a("b-field",{attrs:{label:"集团",horizontal:""}},[a("b-autocomplete",{ref:"companyName",staticClass:"z-width-input",attrs:{data:t.filteredCompany,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onCompanysSelected},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}})],1)],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",attrs:{oldNum:t.clickGet,newNum:t.clickReset},on:{click:t.resetParams}},[t._v("重置")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.exportAll}},[t._v("导出")])])],1)]),t._v(" "),a("div",{key:t.perPage,staticClass:"z-block z-listbox z-listbox-releases"},[a("div",{staticClass:"z-block-title z-table-head"},[a("div",{staticClass:"block"},[a("b-radio",{attrs:{"native-value":"1"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("占比图")]),t._v(" "),a("b-radio",{attrs:{"native-value":"2"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._v("详情列表")])],1)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.show,expression:"show == 1"}],staticClass:"z-block-content z-block-echarts"},[a("div",{staticClass:"z-echarts-title"},[a("div",{staticClass:"flex-top-title"},[a("div",[t._v("整体完成情况")]),t._v(" "),a("div",{staticClass:"subTitle"},[t._v(" "+t._s(this.start_time+"至"+this.end_time))])])]),t._v(" "),a("div",{staticClass:"percent",staticStyle:{float:"right"}},[a("p",[t._v("单位：发布额（万元）")])]),t._v(" "),a("b-field",{staticClass:"z-field z-echarts-box"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.pieShow,expression:"pieShow"}],staticClass:"z-block",staticStyle:{width:"800px",height:"400px",margin:"0 auto"},attrs:{id:"pie"}})])],1),t._v(" "),2==t.show?a("div",{staticClass:"z-block-content z-block-echarts"},[a("div",{staticClass:"z-echarts-title"},[a("div",{staticClass:"flex-top-title"},[a("div",[t._v("完成详情")]),t._v(" "),a("div",{staticClass:"subTitle"},[t._v(" "+t._s(this.start_time+"至"+this.end_time))])])]),t._v(" "),a("b-field",{staticClass:"z-field z-show",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"展示方式",horizontal:""}},[a("b-select",{on:{input:t.onSelectedShow},model:{value:t.showType[0],callback:function(e){t.$set(t.showType,0,e)},expression:"showType[0]"}},t._l(t.optionOne,function(e,n){return a("option",{key:n,domProps:{value:n}},[t._v(t._s(e))])}))],1),t._v(" "),a("b-field",{attrs:{label:"数据分类",horizontal:""}},[a("b-select",{on:{input:t.onSelectedShow},model:{value:t.showType[1],callback:function(e){t.$set(t.showType,1,e)},expression:"showType[1]"}},t._l(t.optionTwo,function(e,n){return a("option",{key:n,domProps:{value:n}},[t._v(t._s(e))])}))],1)],1),t._v(" "),a("div",{staticClass:"percent",staticStyle:{float:"right"}},[a("p",[t._v("单位：发布额（万元）")]),t._v(" "),a("b-tooltip",{directives:[{name:"show",rawName:"v-show",value:3!==Number(t.showType[1]),expression:"Number(showType[1]) !== 3 "}],attrs:{type:"is-light",label:"%：比率",position:"is-bottom"}},[a("label",{class:t.picShow?"is-gray":"is-primary",on:{click:function(e){t.picShow=!t.picShow}}},[t._v("%")])]),t._v(" "),3!==Number(t.showType[1])?a("b-tooltip",{attrs:{type:"is-light",label:"#：数值",position:"is-bottom"}},[a("label",{class:t.picShow?"is-primary":"is-gray",on:{click:function(e){t.picShow=!t.picShow}}},[t._v("#")])]):a("b-tooltip",{attrs:{type:"is-light",label:"#：数值",position:"is-bottom"}},[a("label",{class:t.picShow?"is-primary":"is-gray"},[t._v("#")])])],1),t._v(" "),t.totalKPI?a("b-table",{key:Math.random(),staticClass:"z-table-clients z-scaling-list z-scaling-releases",attrs:{data:t.KPILIST,detailed:1===Number(t.showType[0]),"has-detailed-visible":function(t){return t.child&&0!==t.child.length}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{sortable:"合计"===n.name,label:n.name,field:"field_"+n.name}},[t._v("\n                        "+t._s(Number(e.row[n.name])?Number(e.row[n.name])>0?e.row[n.name]:0:e.row[n.name])+t._s(t.picShow?"":Number(e.row[n.name])?"%":"")+"\n                    ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,detailed:"",bordered:"","has-detailed-visible":function(t){return t.child&&0!==t.child.length}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                "+t._s(Number(e.row[n.name])?Number(e.row[n.name])>0?e.row[n.name]:0:e.row[n.name])+t._s(t.picShow?"":Number(e.row[n.name])?"%":"")+"\n                            ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,detailed:"",bordered:"","has-detailed-visible":function(t){return t.child&&0!==t.child.length}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                        "+t._s(Number(e.row[n.name])?Number(e.row[n.name])>0?e.row[n.name]:0:e.row[n.name])+t._s(t.picShow?"":Number(e.row[n.name])?"%":"")+"\n                                    ")])})}},{key:"detail",fn:function(e){return[a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:e.row.child,bordered:"","has-detailed-visible":function(t){return t.child&&0!==t.child.length}},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.table_label,function(n,i){return a("b-table-column",{key:i,attrs:{label:n.name}},[t._v("\n                                                "+t._s(Number(e.row[n.name])?Number(e.row[n.name])>0?e.row[n.name]:0:e.row[n.name])+t._s(t.picShow?"":Number(e.row[n.name])?"%":"")+"\n                                            ")])})}}])})]}}])})]}}])})]}}])},[t.isPaginated?a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalKPI,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                            跳转到\n                            "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                            页\n                            "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)]):t._e()],2):t._e()],1):t._e()])])},staticRenderFns:[]}},xIO6:function(t,e,a){var n=a("VU/8")(a("PWFT"),a("pKxK"),null,null);t.exports=n.exports},"xL/t":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("LZT1"),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default={data:function(){return{isHeader:!1,userInfo:this.$parent,fzrOff:!0,data:[],isLoading:!1,defaultStatus:null,user_id:null,department_id:null,departmentName:null,departments:[],userReadonly:!1,departmentReadonly:!1,departmentUsers:[],currUserName:"",isStatus:[{name:"",id:4},{name:"待确认",id:1},{name:"已驳回",id:2},{name:"已确认",id:3}],enteredDateStart:null,enteredDateEnd:null,startCashCollectionDate:null,endCashCollectionDate:null,signingCompanys:[],signingCompanyId:"",signingCompany:"",signingCompanySelected:null,contractsNumber:"",clientList:[],clientId:"",clientName:"",currencies:{type_0:"人民币",type_1:"美元",type_2:"日元",type_3:"欧元",type_4:"英镑",type_5:"韩国元",type_6:"加拿大元",type_7:"澳元"},isDeductMoney:["否","是"],total:0,currPage:1,perPage:20,totalPage:1,jumpPage:1}},watch:{department_id:function(t){console.log(t),this.fzrOff&&t&&(this.user_id=null,this.getUsersByDepartment(t))},currPage:function(t){0!==t&&this.questFn(t)}},computed:{filterSigningCompanys:function(){var t=this;return this.signingCompanys.filter(function(e){return e.company_name.toString().toLowerCase().indexOf(t.signingCompany.toLowerCase())>=0})}},created:function(){this.getClients(),this.getDepartments(),this.getSigningCompanys(),this.initUserData(),this.onQueryClick()},methods:{isShangwu:function(){return this.$root.user.roleCodes.split(", ").indexOf("role-crm-shangwu")>-1?(console.log("是 shangwu ？",!0),!0):(console.log("是 shangwu ？",!1),!1)},initUserData:function(){this.userInfo.user&&this.userInfo.crmUser&&this.isShangwu()&&(1===this.$root.crmUser.is_headman?(console.log("是商务组长"),this.isHeader=!0,this.getUsersByRole(this.ROLE.zuzhang)):(console.log("不是商务组长"),this.isHeader=!1,this.currUserName=this.userInfo.crmUser.name,this.departmentName=this.$root.crmUser.department_name,this.userReadonly=!0,this.departmentReadonly=!0))},getClients:function(){var t=this;return this.ajax({url:"/contract/get_contract_clients",params:{client_name:this.clientName}}).then(function(e){if(!e.data.length)return void(t.clientList=[]);t.clientList=e.data})},onClientSelected:function(t){t&&(this.clientId=t.id,this.clientName=t.name)},getUsersByRole:function(t){var e=this;return this.ajax({method:"post",url:"/user/get_list_by_role_code/",data:{role_code:t}}).then(function(t){e.departmentUsers=t.data.rows||[]})},getUsersByDepartment:function(t){var e=this;return this.ajax({method:"post",url:"/user/get_list_by_department_id",data:{department_id:t}}).then(function(t){if(e.departmentUsers=t.data.rows||[],e.departmentUsers.length){var a={id:"",name:""};e.departmentUsers.unshift(a)}})},getDepartments:function(){var t=this;return this.ajax({url:"/department/index"}).then(function(e){var a=(0,i.default)(e.data);t.departments=a})},getSigningCompanys:function(){var t=this;return this.ajax({url:"/signing_company/get_list",params:{no_limit:1}}).then(function(e){0===e.error_code&&(t.signingCompanys=e.data.lists)})},onSelectedCompany:function(t){t&&(this.signingCompanySelected=t.id,this.signingCompany=t.company_name)},onQueryClick:function(){1===this.currPage?this.questFn():this.currPage=1},questFn:function(t){var e=this;Number(t)||(t=1);var a={page:t,pagesize:20},n=this.handleOption;this.user_id&&(a.user_id=this.user_id),this.department_id&&(a.department_id=this.department_id),4!==this.defaultStatus&&(a.status_id=this.defaultStatus),this.enteredDateStart&&(a.entered_date_start=this.zDateFormatter(this.enteredDateStart)),this.enteredDateEnd&&(a.entered_date_end=this.zDateFormatter(this.enteredDateEnd)),this.startCashCollectionDate&&(a.start_cash_collection_date=this.zDateFormatter(this.startCashCollectionDate)),this.endCashCollectionDate&&(a.end_cash_collection_date=this.zDateFormatter(this.endCashCollectionDate)),a.client_name=this.clientName,this.contractsNumber&&(a.contract_number=this.contractsNumber),n(this.signingCompany)&&(a.company_name=this.signingCompany),this.ajax({loading:this.$loading.open(),url:"/contract_cash_collection_pool_detail/get_my_cash_collection",params:a}).then(function(t){0===t.error_code&&(e.data=t.data.lists,e.total=t.data.counts.count,e.totalPage=Math.ceil(t.data.counts.count/e.perPage),0===e.totalPage&&(e.totalPage=1))})},handleOption:function(t){return null!==t&&""!==t&&"undefined"!==t},resetParams:function(){!this.isHeader&&this.isShangwu()||(this.user_id=null,this.department_id=null),this.defaultStatus=null,this.enteredDateStart=null,this.enteredDateEnd=null,this.startCashCollectionDate=null,this.endCashCollectionDate=null,this.clientId="",this.clientList=[],this.clientName="",this.signingCompanyId="",this.signingCompany="",this.signingCompanySelected="",this.contractsNumber=""},pageHandle:function(t){this.currPage=t,this.onQueryClick()},exportALL:function(){var t=this,e={},a=this.handleOption;this.user_id&&(e.user_id=this.user_id),this.department_id&&(e.department_id=this.department_id),4!==this.defaultStatus&&(e.status_id=this.defaultStatus),this.enteredDateStart&&(e.entered_date_start=this.zDateFormatter(this.enteredDateStart)),this.enteredDateEnd&&(e.entered_date_end=this.zDateFormatter(this.enteredDateEnd)),this.startCashCollectionDate&&(e.start_cash_collection_date=this.zDateFormatter(this.startCashCollectionDate)),this.endCashCollectionDate&&(e.end_cash_collection_date=this.zDateFormatter(this.endCashCollectionDate)),e.client_name=this.clientName,this.contractsNumber&&(e.contract_number=this.contractsNumber),a(this.signingCompany)&&(e.company_name=this.signingCompany),this.ajax({url:"/contract_cash_collection_pool_detail/export_collection",params:e}).then(function(e){""===e.error_msg&&t.exportLive({file_name:e.data.file_name,file_path:e.data.file_path})})},exportLive:function(t){var e=this;this.ajax({method:"post",url:"/export/is_live",loading:this.$loading.open(),data:t}).then(function(a){0===a.error_code?window.location.href=t.file_path:e.exportLive(t)})}}}},xWhA:function(t,e,a){a("KjVe");var n=a("VU/8")(a("/vDq"),a("A70A"),"data-v-139f72f4",null);t.exports=n.exports},xeBw:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["visitedDate","visitedUsers"];e.default={props:["clientId"],data:function(){return{visitList:[],defaultOpenedDetails:[],crm_auth:!1,isBorder:!0}},watch:{visitList:function(t){var e=this;t.length>0&&setTimeout(function(){e.visitList.forEach(function(t){var a=e.$refs["result_"+t.id].offsetHeight,n=e.$refs["core_problem_"+t.id].offsetHeight,i=e.$refs["conclusion_"+t.id].offsetHeight;a>60?(e.$refs["result_"+t.id].style.height="60px",t.zk=!0):t.zk=!1,n>60?(e.$refs["core_problem_"+t.id].style.height="60px",t.pk=!0):t.pk=!1,i>60?(e.$refs["conclusion_"+t.id].style.height="60px",t.ck=!0):t.ck=!1,e.$forceUpdate()})},0)}},created:function(){this.clientId&&this.getVisitData(),this.getAuth()},methods:{clickFn:function(t,e,a){var n=document.getElementById(a+"_"+e),i=document.getElementById("btn_"+a+"_"+e);"收起"===i.innerHTML?(i.innerHTML="展开",n.style.height="60px"):(n.style.height="auto",i.innerHTML="收起")},getAuth:function(){(this.isRole("role-crm-admin")||this.isRole("role-crm-kehushenhe")||this.isRole("role-crm-shangwushenhe")||this.isRole("role-crm-yiji")||this.isRole("role-crm-erji")||this.isRole("role-crm-sanji"))&&(this.crm_auth=!0)},requestFn:function(t){this.$forceUpdate(),this.$set(t,"isRequest",!0)},requestCancle:function(t){this.$forceUpdate(),this.$set(t,"isRequest",!1)},clickComment:function(t){t.isShow=!0,this.getComments(t,1)},getVisitData:function(){var t=this;return this.ajax({url:"/client_visited_log/get_client_visited_log",params:{client_id:this.clientId}}).then(function(e){if(0===e.error_code){var a=t;a.visitList=t.formatVisitData(e.data),a.visitList.forEach(function(t,e){a.getComments(a.visitList[e])})}})},formatVisitData:function(t){return t.map(function(t){return t.isEdit=!1,t.isShow=!1,t.visited_date=t.visited_date&&new Date(t.visited_date),t.comments=[],t})},formatRequestData:function(t){return t.map(function(t){return t.isRequest=!1,t})},visitDataValidate:function(t){var e=this,a=[],i=this.visitList[t].visited_client_users_new;return n=i?n:n.concat(["clientVisitedUsers"]),n.forEach(function(n){var i=e.$refs[n+"_"+t];i.checkHtml5Validity&&(i.checkHtml5Validity()||a.push(i))}),i&&i.forEach(function(n,i){if(!n.name&&!n.position||n.name&&n.position)return!0;if(!n.name){var s=e.$refs["clientVisitedUsers_name_"+t][i];s.checkHtml5Validity&&(s.checkHtml5Validity()||a.push(s))}if(!n.position){var r=e.$refs["clientVisitedUsers_position_"+t][i];r.checkHtml5Validity&&(r.checkHtml5Validity()||a.push(r))}}),!a.length||(a[0].focus(),!1)},stringVisited:function(t){var e=t.visited_client_users_new,a=[];return e.forEach(function(t){if(!t.name||!t.position)return!0;t.name=t.name.replace(/-|&/g,"`"),t.position=t.position.replace(/-|&/g,"`"),a.push(t.name+"-"+t.position)}),a.join("&")},stringConclusion:function(t){var e=[];t.forEach(function(t){if(!t.content)return!0;t.content=t.content.replace(/-|&/g,"`"),e.push(t.content)});var a=e.join("^");return console.log(a),a},saveVisit:function(t){var e=this;if(this.visitDataValidate(t)){var a=this.visitList[t],n=void 0!==a.id,i=this.stringVisited(a),s=this.stringConclusion(a.conclusion),r=this.stringConclusion(a.problem_action),o={visited_date:a.visited_date&&this.zDateFormatter(a.visited_date),visit_type:a.visit_type,address:a.address,visit_users:a.visit_users,problem_action:r,conclusion:s,visited_client_users:i,meeting_plan:a.meeting_plan,client_id:this.clientId},c="/client_visited_log/add_client_visited_log";return n&&(c="/client_visited_log/update_client_visited_log",o.id=a.id),this.ajax({method:"post",url:c,data:o}).then(function(i){0===i.error_code&&(a.isEdit=!1,n||(a.id=i.data.client_visited_log_id),e.$toast.open({duration:5e3,message:"保存成功",position:"is-top",type:"is-success"}),e.visitList[t].isNew=!1)})}},addVisit:function(){this.visitList.unshift({isEdit:!0,isShow:!1,visited_date:new Date,visit_type:1,address:"",visit_users:"",visited_client_users:"",visited_client_users_new:[],meeting_plan:"",conclusion:[{content:""}],problem_action:[{content:""}],entered_date:null,updated_date:null,isNew:!0})},deleteVisit:function(t){this.visitList.splice(t,1)},addVisitUser:function(t){console.log(2222222),t.push({name:"",position:""})},addConclusion:function(t){t.push({content:""})},addProblem:function(t){t.push({content:""})},getComments:function(t,e){var a=this;return this.ajax({url:"/client_visited_log_postil/get_postil_list",loading:this.$loading.open(),params:{client_visited_log_id:t.id}}).then(function(n){0===n.error_code&&(t.comments=n.data.list,(t.comments.length||e)&&a.defaultOpenedDetails.push(t.id),a.formatRequestData(t.comments))})},saveComment:function(t,e){var a=this;if(this.$refs["newComment_"+e].checkHtml5Validity())return this.ajax({url:"/client_visited_log_postil/add_postil",method:"post",loading:this.$loading.open(),successTip:!0,data:{client_id:this.clientId,client_visited_log_id:t.id,content:t.newComment,user_id:this.$root.crmUser.id}}).then(function(e){0===e.error_code&&(t.comments.unshift({id:e.data.postil_id,number:"",name:a.$root.crmUser.name,content:t.newComment,create_time:"刚刚",reply:""}),t.newComment="",t.isShow=!1)})},requestComment:function(t,e){var a=this;if(this.$refs["reqComment_"+e][0].checkHtml5Validity())return this.ajax({url:"/client_visited_log_postil/add_apply",method:"post",loading:this.$loading.open(),successTip:!0,data:{id:t.id,reply:t.reqComment}}).then(function(e){0===e.error_code&&(t.reply=t.reqComment,t.reply_time="刚刚",t.reply_name=a.$root.crmUser.name,a.requestCancle(t))})}}}},xsuV:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"z-contact-list"},[t.contacts.length?a("b-table",{attrs:{data:t.contacts,bordered:!0,"mobile-cards":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{attrs:{label:"姓名"}},[e.row.isEdit?a("b-field",[a("b-input",{ref:"contactName_"+e.index,attrs:{expanded:"",required:"",maxlength:"10"},model:{value:e.row.contact_name,callback:function(a){t.$set(e.row,"contact_name",a)},expression:"props.row.contact_name"}})],1):[t._v("\n                    "+t._s(e.row.contact_name)+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"岗位"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{expanded:"",maxlength:"30"},model:{value:e.row.job_position,callback:function(a){t.$set(e.row,"job_position",a)},expression:"props.row.job_position"}})],1):[t._v("\n                    "+t._s(e.row.job_position)+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"等级"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{type:"number",min:"1",expanded:""},model:{value:e.row.level,callback:function(a){t.$set(e.row,"level",a)},expression:"props.row.level"}})],1):[t._v("\n                    "+t._s(e.row.level)+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"手机号码"}},[e.row.isEdit?a("b-field",{attrs:{type:e.row.fieldType,message:e.row.fieldMessage}},[a("b-input",{ref:"contactMobilePhone_"+e.index,attrs:{expanded:""},on:{blur:function(a){t.checkContactDuplicate(e.row,e.index)}},model:{value:e.row.mobile_phone,callback:function(a){t.$set(e.row,"mobile_phone",a)},expression:"props.row.mobile_phone"}})],1):[t._v("\n                    "+t._s(e.row.mobile_phone)+"\n                ")]],2),t._v(" "),a("b-table-column",{attrs:{label:"电话号码"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{type:"tel",expanded:""},model:{value:e.row.tel,callback:function(a){t.$set(e.row,"tel",a)},expression:"props.row.tel"}})],1):[t._v(t._s(e.row.tel))]],2),t._v(" "),a("b-table-column",{attrs:{label:"微信号"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{type:"text",expanded:""},model:{value:e.row.wechat,callback:function(a){t.$set(e.row,"wechat",a)},expression:"props.row.wechat"}})],1):[t._v(t._s(e.row.wechat))]],2),t._v(" "),a("b-table-column",{attrs:{label:"QQ号"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{type:"text",expanded:""},model:{value:e.row.qq,callback:function(a){t.$set(e.row,"qq",a)},expression:"props.row.qq"}})],1):[t._v(t._s(e.row.qq))]],2),t._v(" "),a("b-table-column",{attrs:{label:"传真"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{type:"tel",expanded:""},model:{value:e.row.fax,callback:function(a){t.$set(e.row,"fax",a)},expression:"props.row.fax"}})],1):[t._v(t._s(e.row.fax))]],2),t._v(" "),a("b-table-column",{attrs:{label:"生日"}},[e.row.isEdit?a("b-field",[a("b-datepicker",{attrs:{"max-date":new Date,icon:"calendar-today"},model:{value:e.row.birthday,callback:function(a){t.$set(e.row,"birthday",a)},expression:"props.row.birthday"}})],1):[t._v(t._s(e.row.birthday&&t.zDateFormatter(e.row.birthday)))]],2),t._v(" "),a("b-table-column",{attrs:{label:"兴趣爱好"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{maxlength:"200",expanded:""},model:{value:e.row.hobbies,callback:function(a){t.$set(e.row,"hobbies",a)},expression:"props.row.hobbies"}})],1):[t._v(t._s(e.row.hobbies))]],2),t._v(" "),a("b-table-column",{attrs:{label:"备注"}},[e.row.isEdit?a("b-field",[a("b-input",{attrs:{maxlength:"200",expanded:""},model:{value:e.row.remarks,callback:function(a){t.$set(e.row,"remarks",a)},expression:"props.row.remarks"}})],1):[t._v(t._s(e.row.remarks))]],2),t._v(" "),a("b-table-column",{attrs:{label:"操作",width:"130"}},[e.row.isEdit?a("button",{staticClass:"button is-primary",on:{click:function(a){t.saveContact(e.index)}}},[t._v("保存")]):a("button",{staticClass:"button is-link",on:{click:function(t){e.row.isEdit=!0}}},[t._v("编辑")]),t._v(" "),a("button",{staticClass:"button is-danger",on:{click:function(a){t.deleteContact(e.index,e.row)}}},[t._v("删除")])])]}}])}):t._e(),t._v(" "),1!=t.clientStatus?a("button",{staticClass:"button is-primary",on:{click:t.addContact}},[a("b-icon",{attrs:{icon:"plus"}}),t._v(" "),a("span",[t._v("新增")])],1):t._e(),t._v(" "),1!=t.clientStatus&&t.isEdit?a("button",{staticClass:"button is-primary",on:{click:t.saveSubmit}},[t._v("保存并提交审核")]):t._e()],1)},staticRenderFns:[]}},xtsl:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),s=n(i),r=a("+6Bu"),o=n(r),c=a("mvHQ"),l=n(c),d=a("Xxa5"),u=n(d),_=a("exGp"),p=n(_),m=a("XFB5"),h=n(m),f=a("u2KI"),v=n(f),b=a("AUzt"),g=n(b),y=a("08t6"),C=n(y),k=a("XxnQ"),w=n(k),x=a("2Aho"),P=n(x),z=a("Ev7r"),N=n(z),D=a("z93h"),S=a("jELS"),L=a("AwEB"),j=[{name:"PartyA",componentName:"PartCompany",title:"甲方签约公司",data_type:1},{name:"PartyB",componentName:"PartCompany",title:"乙方签约公司",data_type:2},{name:"nonIndependentCustomers",componentName:"AutonomyCustomers",title:"非自主客户",data_type:3},{name:"independentCustomers",componentName:"AutonomyCustomers",title:"普通自主客户",data_type:4},{name:"specialBrandClient",componentName:"SpecialCustomers",title:"特殊品牌客户",data_type:5},{name:"specialCategoryClient",componentName:"SpecialCustomers",title:"特殊品类客户",data_type:6},{name:"baseInfo",componentName:"BaseInfo",title:"基础信息"},{name:"rebateRevise"}],E=["甲方签约公司","乙方签约公司","非自主客户","普通自主客户","特殊品牌客户","特殊品类客户"].map(function(t,e){return{data_type:t,id:e+1}}),I=E.reduce(function(t,e){return t[e.id]=e.data_type,t},{});e.default={components:{HeaderName:g.default,PartCompany:C.default,BaseInfo:w.default,AutonomyCustomers:P.default,SpecialCustomers:N.default},data:function(){return{reviseType:(0,v.default)(E),reviseTypeForId:(0,v.default)(I),minDate:new Date((0,L.changeMonth)(new Date)+"-1"),commonColumns:[{field:"rule",label:"发布额:X（万元）"},{field:"rebate",label:"返点规则"}],componentName:"",title:"",editObj:{},baseInfo:{frame_number:"",frame_name:"",frame_leader:"",start_date:"",end_date:"",is_frame:2,release_amount:"",release_amount1:"",release_amount2:""},form:{frameworkName:"",start_date:new Date,end_date:new Date,id:0},PartyA:[],PartyB:[],nonIndependentCustomers:[],independentCustomers:[],specialBrandClient:[],specialCategoryClient:[],rebateRevise:{},rebateReviseMap:new h.default}},computed:{selectOption:function(){var t=this;return function(e){var a=e.data_type,n=e.data_type_id;if(!a)return[];var i=j.filter(function(t){return t.data_type===a})[0].name,s=t[i];return s.find(function(t){return t.data_type_id===n})||(e.data_type_id=""),s}}},created:function(){var t=this,e=j.reduce(function(e,a){return e[a.name]=function(){return t.componentShow(a.componentName,a.title,a.data_type)},e},{});this.editObj=(0,v.default)(e);var a=this.$route.query.id;if(a)return this.rebateFrameShowAll(a);this.editObj.baseInfo()},methods:{changeMonth:L.changeMonth,returnOldPath:function(){this.$router.push("/rebateManagement")},editRebateRevise:function(t){var e=this;return(0,p.default)(u.default.mark(function a(){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,D.editRebateRevise)(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},a,e)}))()},deleteRebateRevise:function(t,e){var a=this;return(0,p.default)(u.default.mark(function n(){var i,s;return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,D.deleteRebateRevise)({revise_id:t.id});case 2:if(i=n.sent){n.next=5;break}return n.abrupt("return");case 5:if(a.rebateRevise.data.splice(e,1),s=a.rebateReviseMap.get(t)){n.next=9;break}return n.abrupt("return");case 9:a.rebateReviseMap.delete(t),a.rebateRevise.editData.splice(a.rebateRevise.editData.find(function(t){return t.id===s.id}),1);case 11:case"end":return n.stop()}},n,a)}))()},addRebateRevise:function(t){var e=this;return(0,p.default)(u.default.mark(function a(){var n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,D.addRebateRevise)(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},a,e)}))()},saveRebateRevise:function(t){var e=this;return(0,p.default)(u.default.mark(function a(){var n,i,s,r;return u.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.rebateReviseMap.get(t),n.data_type){a.next=3;break}return a.abrupt("return",e.$toast.error("请选择修订类别"));case 3:if(3!==n.data_type&&4!==n.data_type){a.next=7;break}n.data_type_id=0,a.next=9;break;case 7:if(n.data_type_id){a.next=9;break}return a.abrupt("return",e.$toast.error("请选择修订目标"));case 9:if(n.revise_amount.toString()){a.next=11;break}return a.abrupt("return",e.$toast.error("请填写修订值"));case 11:if(i=(0,L.changeMonth)(n.revise_date.toString()),!t.new){a.next=20;break}return a.next=15,e.addRebateRevise({frame_id:e.form.id,revise_amount:parseFloat(n.revise_amount),revise_date:i,data_type:n.data_type,data_type_id:n.data_type_id,remark:n.remark});case 15:if(s=a.sent){a.next=18;break}return a.abrupt("return");case 18:return e.rebateFrameShowAll(),a.abrupt("return");case 20:return a.next=22,e.editRebateRevise({revise_amount:n.revise_amount,revise_date:i,revise_id:t.id,data_type:n.data_type,data_type_id:n.data_type_id,remark:n.remark});case 22:if(r=a.sent){a.next=25;break}return a.abrupt("return");case 25:e.rebateFrameShowAll(),t.edit=!1;case 27:case"end":return a.stop()}},a,e)}))()},cancelEdit:function(t,e){if(!t.new)return void(t.edit=!1);this.rebateRevise.data.splice(e,1);var a=this.rebateReviseMap.get(t);this.rebateReviseMap.delete(t),this.rebateRevise.editData.splice(this.rebateRevise.editData.find(function(t){return t.id===a.id}),1)},createRebateEditData:function(){this.rebateRevise.editData||this.$set(this.rebateRevise,"editData",[])},add:function(){this.createRebateEditData();var t={id:""+(new Date).getTime(),revise_amount:0,revise_date:new Date,edit:!0,new:!0,data_type:"",data_type_id:"",remark:"",data_type_name:""};this.rebateRevise.data.unshift(t),this.rebateRevise.editData.push(t),this.rebateReviseMap.set(t,t)},reviseEdit:function(t){if(this.createRebateEditData(),!this.rebateReviseMap.get(t)){var e=JSON.parse((0,l.default)(t));e.revise_date=new Date(e.revise_date+"-1"),this.rebateRevise.editData.push(e),this.rebateReviseMap.set(t,e)}var a=this.rebateReviseMap.get(t);"string"==typeof a.revise_date&&(a.revise_date=new Date(a.revise_date+"-1")),t.edit=!0},rebateFrameShowAll:function(t){var e=this;return(0,p.default)(u.default.mark(function a(){var n,i,r,c;return u.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t&&(e.form.id=t),a.next=3,(0,D.rebateFrameShowAll)({id:e.form.id});case 3:if(n=a.sent){a.next=6;break}return a.abrupt("return");case 6:i=n.content,r=(0,o.default)(n,["content"]),(0,S.mergeObject)(e.baseInfo,(0,s.default)({},r)),c=i.pop(),i.forEach(function(t,a){var n=j[a].name;e[n]=t}),e.$set(e.rebateRevise,"data",c);case 11:case"end":return a.stop()}},a,e)}))()},componentShow:function(t,e,a){var n=this;return(0,p.default)(u.default.mark(function i(){return u.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n.componentName=t,n.title=e,i.next=4,n.$nextTick();case 4:if("BaseInfo"!==t){i.next=7;break}return n.$refs.component.open(n.form.id,n.baseInfo),i.abrupt("return");case 7:n.$refs.component.open(n.form.id,a,{start_date:n.baseInfo.start_date,end_date:n.baseInfo.end_date});case 8:case"end":return i.stop()}},i,n)}))()},edit:function(t){this.editObj[t]()}}}},xwwG:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"超级管理员"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content super-content-box"},[a("div",{staticClass:"field z-field is-grouped is-grouped-multiline"},[a("label",{staticClass:"label"},[t._v("合同编号")]),t._v(" "),a("b-field",[a("b-input",{staticClass:"search-input",attrs:{required:""},model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:t.searchContract}},[t._v("查询")]),t._v(" "),a("label",{staticClass:"label"},[t._v("合同名称")]),t._v(" "),a("b-field",[a("b-input",{staticClass:"search-input",attrs:{disabled:""},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1)],1)])]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content super-content-box"},[a("div",{staticClass:"field z-field is-grouped is-grouped-multiline"},[a("label",{staticClass:"label"},[t._v("变更字段")]),t._v(" "),a("b-select",{staticClass:"search-input",attrs:{required:""},on:{input:t.selectContract},model:{value:t.change_field,callback:function(e){t.change_field=e},expression:"change_field"}},t._l(t.contract,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("div",{staticClass:"field z-field is-grouped is-grouped-multiline"},[a("label",{staticClass:"label"},[t._v("原合同内容")]),t._v(" "),a("b-field",[a("b-input",{staticClass:"search-input",attrs:{disabled:""},model:{value:t.old_contract,callback:function(e){t.old_contract=e},expression:"old_contract"}})],1),t._v(" "),a("label",{staticClass:"label"},[t._v("变更后内容")]),t._v(" "),a("b-field",[3!==t.saveType&&4!==t.saveType?a("b-input",{staticClass:"search-input",attrs:{required:""},model:{value:t.new_contract,callback:function(e){t.new_contract=e},expression:"new_contract"}}):3===t.saveType?a("b-autocomplete",{ref:"contractCharge",staticClass:"search-input",attrs:{data:t.codeList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name",required:""},on:{input:t.getCodeList,select:t.onChargenameSelected},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.option.name))]}}]),model:{value:t.charge_userName,callback:function(e){t.charge_userName=e},expression:"charge_userName"}}):4===t.saveType?a("div",{staticClass:"z-datepickers search-input"},[a("b-datepicker",{staticClass:"z-dateinput",attrs:{required:""},model:{value:t.new_contract,callback:function(e){t.new_contract=e},expression:"new_contract"}})],1):t._e()],1)],1),t._v(" "),a("button",{staticClass:"button is-primary btn-submit",on:{click:t.saveContract}},[t._v("提交")])])]),t._v(" "),a("b-modal",{attrs:{active:t.showContract},on:{"update:active":function(e){t.showContract=e}}},[a("div",{staticClass:"modal-card"},[a("header",{staticClass:"modal-card-head"},[a("p",{staticClass:"modal-card-title"},[t._v("合同数据")])]),t._v(" "),a("section",{staticClass:"modal-card-body"},[a("b-table",{attrs:{data:t.contractList,columns:t.contractColumns,selected:t.selected,focusable:""},on:{"update:selected":function(e){t.selected=e}}})],1),t._v(" "),a("section",{staticClass:"modal-card-foot"})])])],1)},staticRenderFns:[]}},y8EQ:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"KPI管理"}},[a("div",[a("div",{staticClass:"z-block"},[a("div",{staticClass:"title"},[t._v("KPI管理")]),t._v(" "),a("div",{staticClass:"z-block-content super-content-box pt0"},[a("div",{staticClass:"flex-layout"},[a("div",{staticClass:"width100"},[a("label",{staticClass:"label"},[t._v("部门:")]),t._v(" "),a("b-select",{staticClass:"select-height",model:{value:t.form.department_id,callback:function(e){t.$set(t.form,"department_id",e)},expression:"form.department_id"}},t._l(t.departmentList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("div",{staticClass:"width100"},[a("label",{staticClass:"label"},[t._v("商务名称:")]),t._v(" "),a("b-autocomplete",{staticClass:"z-width-input",attrs:{loading:t.loadingList.director,data:t.filteredUser,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:function(e){return t.autoSelect(e&&e.id,"user_id",e&&e.name)}},model:{value:t.mapping.user_id,callback:function(e){t.$set(t.mapping,"user_id",e)},expression:"mapping.user_id"}})],1),t._v(" "),a("div",{staticClass:"width100"},[a("label",{staticClass:"label"},[t._v("负责品牌:")]),t._v(" "),a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brandList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"title"},on:{input:t.getBrandList,focus:t.getBrandList,select:function(e){return t.autoSelect(e&&e.brand_id,"brand_id",e&&e.title)}},model:{value:t.mapping.brand_id,callback:function(e){t.$set(t.mapping,"brand_id",e)},expression:"mapping.brand_id"}})],1)]),t._v(" "),a("div",{staticClass:"flex-top"},[a("label",{staticClass:"label"},[t._v("考核时间:")]),t._v(" "),a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{type:"month","max-date":t.form.end_assessment_date},model:{value:t.form.start_assessment_date,callback:function(e){t.$set(t.form,"start_assessment_date",e)},expression:"form.start_assessment_date"}}),t._v("\n                        -\n                        "),a("b-datepicker",{attrs:{type:"month","min-date":t.form.start_assessment_date},model:{value:t.form.end_assessment_date,callback:function(e){t.$set(t.form,"end_assessment_date",e)},expression:"form.end_assessment_date"}})],1)]),t._v(" "),a("div",{staticClass:"mt10"},[a("button",{staticClass:"button is-primary btn-search",on:{click:function(e){t.getKpiList(!0)}}},[t._v("\n                        查询\n                    ")]),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:t.resetData}},[t._v("\n                        重置\n                    ")]),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:t.addKpiData}},[t._v("\n                        新增\n                    ")]),t._v(" "),a("b-upload",{on:{input:t.fileIsOk},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}},[a("a",{staticClass:"button is-primary btn-search",staticStyle:{top:"-2px"}},[a("span",[t._v("导入")])])]),t._v(" "),a("button",{staticClass:"button is-primary btn-search",on:{click:function(e){t.exportAll(!0)}}},[t._v("\n                        导出\n                    ")]),t._v(" "),a("button",{staticClass:"button is-primary ",on:{click:t.downLoad}},[t._v("\n                        下载模板\n                    ")])],1)])]),t._v(" "),a("div",{staticClass:"z-block z-listbox"},[a("div",{staticClass:"z-block-title z-table-head flex-between flex-layout mb10"},[a("h1",{},[t._v("合计："+t._s(t.total_amount)+"（万）")]),t._v(" "),a("h1",{},[t._v("单位：发布额（万元）")])]),t._v(" "),a("b-table",{key:t.tableKey,staticClass:"table",attrs:{data:t.dataList,loading:t.isLoading,striped:""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.editObj.edit?[a("b-table-column",{attrs:{field:"uname",label:"商务名称"}},[a("b-select",{on:{input:function(a){return t.selectData(a,e.row.editObj)}},model:{value:e.row.editObj.user_id,callback:function(a){t.$set(e.row.editObj,"user_id",a)},expression:"props.row.editObj.user_id"}},t._l(t.businessList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-table-column",{attrs:{field:"dname",label:"所属部门"}},[-1===e.row.editObj.user_id?[a("b-select",{model:{value:e.row.editObj.department_id,callback:function(a){t.$set(e.row.editObj,"department_id",a)},expression:"props.row.editObj.department_id"}},t._l(t.departmentList,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))]:[t._v("\n                                "+t._s(e.row.editObj.mapping.department_name)+"\n                            ")]],2),t._v(" "),a("b-table-column",{attrs:{field:"title",label:"负责品牌"}},[a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.brandList,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"title"},on:{input:function(){return t.getBrandList(e.row.editObj.mapping.brand_name,!0)},focus:function(){return t.getBrandList(e.row.editObj.mapping.brand_name,!0)},select:function(a){return t.editBrand(a,e.row.editObj)}},model:{value:e.row.editObj.mapping.brand_name,callback:function(a){t.$set(e.row.editObj.mapping,"brand_name",a)},expression:"props.row.editObj.mapping.brand_name"}})],1),t._v(" "),a("b-table-column",{attrs:{field:"total_amount",label:"合计"}},[t._v("\n                            "+t._s(e.row.editObj.amount&&Number(e.row.editObj.amount).toFixed(2)||0)+"\n                        ")]),t._v(" "),t._l(t.dateList,function(n){return[a("b-table-column",{key:n,attrs:{field:n,label:n}},[a("b-input",{attrs:{type:"number"},on:{input:function(a){return t.changeNumber(e.row)}},model:{value:e.row.editObj.mapping[n].amount,callback:function(a){t.$set(e.row.editObj.mapping[n],"amount",a)},expression:"props.row.editObj.mapping[item].amount"}})],1)]}),t._v(" "),a("b-table-column",{attrs:{field:"first_name",label:"操作",centered:""}},[a("button",{staticClass:"button  is-link",on:{click:function(a){t.saveData(e.index)}}},[t._v("\n                                保存\n                            ")]),t._v(" "),a("button",{staticClass:"button is-link",on:{click:function(a){t.enterCancel(e.row,e.index)}}},[t._v("\n                                取消\n                            ")])])]:[a("b-table-column",{attrs:{field:"uname",label:"商务名称"}},[t._v("\n                            "+t._s(e.row.uname)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"dname",label:"所属部门"}},[t._v("\n                            "+t._s(e.row.dname)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"title",label:"负责品牌"}},[t._v("\n                            "+t._s(e.row.title)+"\n                        ")]),t._v(" "),a("b-table-column",{attrs:{field:"total_amount",label:"合计"}},[t._v("\n                            "+t._s(e.row.total_amount.toFixed(2))+"\n                        ")]),t._v(" "),t._l(t.dateList,function(n){return[a("b-table-column",{key:n,attrs:{field:n,label:n}},[t._v("\n                                "+t._s(e.row.child.length&&e.row.child.filter(function(t){return t.date===n})[0]&&parseFloat(e.row.child.filter(function(t){return t.date===n})[0].amount).toFixed(2)||0)+"\n                            ")])]}),t._v(" "),a("b-table-column",{attrs:{field:"first_name",label:"操作",centered:""}},[a("button",{staticClass:"button  is-link",on:{click:function(a){t.editKpi(e.row)}}},[t._v("\n                                编辑\n                            ")]),t._v(" "),a("button",{staticClass:"button  is-link",on:{click:function(a){t.deleteKpi(e.row)}}},[t._v("\n                                删除\n                            ")])])]]}}])}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.pagination.total>1,expression:"pagination.total > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.pagination.total,current:t.pagination.page,"per-page":t.pagination.page_size},on:{"update:current":function(e){t.$set(t.pagination,"page",e)},change:t.pageHandle}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                    跳转到\n                    "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:Math.ceil(t.pagination.total/t.pagination.page_size)},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.goEnter(e)}},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}}),t._v("\n                    页\n                    "),a("button",{staticClass:"button is-primary is-small",on:{click:t.goEnter}},[t._v("\n                        GO\n                    ")])],1)],1)],1)])])},staticRenderFns:[]}},yBI8:function(t,e,a){a("hJOm");var n=a("VU/8")(a("ghZm"),a("2DHO"),"data-v-bc946486",null);t.exports=n.exports},yNGt:function(t,e,a){var n=a("VU/8")(a("zsBy"),a("YjCD"),null,null);t.exports=n.exports},yoR7:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={created:function(){this.isRole(this.ROLE.shangwu)?this.$router.push("/pending_commerce"):this.isRole(this.ROLE.mejie,this.ROLE.meijiezuzhang,this.ROLE.meijierenyuan)?this.$router.push("/pre_contracts"):this.$router.push("/contracts")}}},yqmW:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-container",{attrs:{pageTitle:"待审批合同"}},[a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-content"},[a("b-field",{staticClass:"z-field",attrs:{grouped:"","group-multiline":""}},[a("b-field",{attrs:{label:"所属部门"}},[a("b-select",{model:{value:t.departmentId,callback:function(e){t.departmentId=e},expression:"departmentId"}},t._l(t.departments,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("b-field",{attrs:{label:"合同负责人"}},[1===t.contractDirector.length?a("b-input",{attrs:{readonly:"readonly"},model:{value:t.userId,callback:function(e){t.userId=e},expression:"userId"}}):a("b-autocomplete",{attrs:{data:t.filteredUser,"max-results":10,"keep-first":!0,"open-on-focus":!0,field:"name"},on:{select:t.onUserSelected},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),a("b-field",{attrs:{label:"客户名称",addons:!1}},[t.clients.length<=1?a("b-input",{attrs:{readonly:"readonly"},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}}):a("b-autocomplete",{staticClass:"z-width-input",attrs:{data:t.filteredClients,"max-results":100,"keep-first":!1,"open-on-focus":!0,field:"name"},on:{select:t.onClientSelected},model:{value:t.clientName,callback:function(e){t.clientName=e},expression:"clientName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同编号"}},[a("b-input",{model:{value:t.contractNumber,callback:function(e){t.contractNumber=e},expression:"contractNumber"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同名称"}},[a("b-autocomplete",{attrs:{data:t.contractNames,"max-results":100,"keep-first":!1,"open-on-focus":!0,loading:t.isFetching,field:"contract_name"},on:{input:t.searchContract,focus:t.searchContract},model:{value:t.contractName,callback:function(e){t.contractName=e},expression:"contractName"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同签订开始时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"max-date":t.endDate},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"合同签订结束时间",addons:!1}},[a("div",{staticClass:"z-datepickers"},[a("b-datepicker",{attrs:{"min-date":t.startDate},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1)]),t._v(" "),a("b-field",{attrs:{label:"合同成本最小值"}},[a("b-input",{attrs:{type:"number"},model:{value:t.contract_cost_start,callback:function(e){t.contract_cost_start=e},expression:"contract_cost_start"}})],1),t._v(" "),a("b-field",{attrs:{label:"合同成本最大值"}},[a("b-input",{attrs:{type:"number"},model:{value:t.contract_cost_end,callback:function(e){t.contract_cost_end=e},expression:"contract_cost_end"}})],1),t._v(" "),a("b-field",{attrs:{expanded:"",label:"合同品类"}},[a("div",{staticClass:"z-level"},[a("b-select",{staticClass:"select-inline",on:{input:t.onSelectLevel},model:{value:t.contract_brand_id,callback:function(e){t.contract_brand_id=e},expression:"contract_brand_id"}},t._l(t.levelData,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})),t._v(" "),t.level&&t.level.level.length?a("b-select",{staticClass:"select-inline",model:{value:t.contract_second_brand_id,callback:function(e){t.contract_second_brand_id=e},expression:"contract_second_brand_id"}},t._l(t.level.level,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                                "+t._s(e.val)+"\n                            ")])})):t._e()],1)]),t._v(" "),a("b-field",{staticClass:"checkwrap",attrs:{label:"可选签订状态"}},[a("div",{staticClass:"block"},[a("b-checkbox",{attrs:{"native-value":"9"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                            双方未签\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"1"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                            对方已签\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"0"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                            我方已签\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"2"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                            双方已签\n                        ")]),t._v(" "),a("b-checkbox",{attrs:{"native-value":"10"},model:{value:t.selectedContractStatus,callback:function(e){t.selectedContractStatus=e},expression:"selectedContractStatus"}},[t._v("\n                            无需合同\n                        ")])],1)])],1),t._v(" "),a("div",{staticClass:"z-buttons"},[a("a",{staticClass:"button is-primary",on:{click:t.onQueryClick}},[t._v("查询")]),t._v(" "),a("a",{staticClass:"button is-primary",on:{click:t.resetParams}},[t._v("重置")])])],1)]),t._v(" "),a("div",{staticClass:"z-block"},[a("div",{staticClass:"z-block-title z-table-head"},[a("b",{key:t.totalContracts},[t._v("总数："+t._s(t.totalContracts))])]),t._v(" "),a("b-table",{staticClass:"z-table-clients z-scaling-list",attrs:{data:t.contracts,striped:!0,loading:t.loading,"backend-sorting":"","default-sort-direction":t.defaultSortDirection,"default-sort":[t.sortField,t.sortOrder]},on:{sort:t.onSort},scopedSlots:t._u([{key:"default",fn:function(e){return[a("b-table-column",{staticClass:"z-number-td",attrs:{label:"合同名称",field:"contract_name",sortable:""}},[t._v("\n                    "+t._s(e.row.contract_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同编号",field:"contract_number",sortable:""}},[t._v("\n                    "+t._s(e.row.contract_number)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同负责人",field:"contract_charge_name"}},[t._v("\n                    "+t._s(e.row.contract_charge_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"录入人",field:"entered_user_name"}},[t._v("\n                    "+t._s(e.row.entered_user_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"客户名称",field:"client_name"}},[t._v("\n                    "+t._s(e.row.client_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同金额(RMB)",field:"amount",sortable:""}},[t._v("\n                    "+t._s(e.row.amount)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"应收账款余额(RMB)",field:"receivable_balance",sortable:""}},[t._v("\n                    "+t._s(e.row.receivable_balance)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同类型",field:"contract_type_name"}},[t._v("\n                    "+t._s(e.row.contract_type_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"合同有效期",field:"start_date"}},[t._v("\n                    "+t._s(e.row.start_date)+"-\n                    "+t._s(e.row.end_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"录入时间",field:"emstimate_date",sortable:""}},[t._v("\n                    "+t._s(e.row.emstimate_date)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"审核状态",field:"approve_status_name",sortable:""}},[t._v("\n                    "+t._s(e.row.approve_status_name)+"\n                ")]),t._v(" "),a("b-table-column",{attrs:{label:"操作"}},[a("span",[a("router-link",{staticClass:"button is-link",attrs:{to:"/contracts/"+e.row.id}},[t._v("查看")])],1)])]}}])},[a("template",{slot:"footer"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.totalPage>1,expression:"totalPage > 1"}],staticClass:"z-pagination"},[a("b-pagination",{attrs:{total:t.totalContracts,current:t.currPage,"per-page":t.perPage},on:{"update:current":function(e){t.currPage=e}}}),t._v(" "),a("div",{staticClass:"z-pagination-direct"},[t._v("\n                        跳转到\n                        "),a("b-input",{attrs:{type:"number",size:"is-small",min:"1",max:t.totalPage},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.currPage=Number(t.jumpPage)}},model:{value:t.jumpPage,callback:function(e){t.jumpPage=e},expression:"jumpPage"}}),t._v("\n                        页\n                        "),a("button",{staticClass:"button is-primary is-small",on:{click:function(e){t.currPage=Number(t.jumpPage)}}},[t._v("GO")])],1)],1)])],2)],1)])},staticRenderFns:[]}},z5JF:function(t,e,a){a("PRl+");var n=a("VU/8")(a("n4ni"),a("ev1a"),null,null);t.exports=n.exports},zMiP:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("L6A2"),s=n(i),r=a("oTy+"),o=n(r),c=a("4xX0"),l=n(c),d=a("d3xs"),u=n(d);e.default={props:{id:{default:null},isEdit:{type:Boolean,default:!1},isAdd:{type:Boolean,default:!1}},data:function(){return{activeTab:parseInt(this.$route.query.activeTab)||0,newClientId:null,client:{},logData:[],logColumns:[{field:"creation_time",label:"操作时间"},{field:"user_name",label:"用户"},{field:"info",label:"操作内容"}]}},created:function(){console.log("clientId",this.id),(this.id||this.newClientId)&&this.getClientLog()},computed:{clientId:function(){return this.id?this.id:this.newClientId?this.newClientId:null},pageTitle:function(){return this.isEdit?this.id?"编辑客户信息":"添加客户":"客户详情"}},components:{ClientInfo:s.default,ClientContactsList:o.default,ClientVisitsList:l.default,ClientDegrees:u.default},methods:{getClientInfo:function(t){this.client=t},onClientSaved:function(t){this.newClientId=t},getClientLog:function(){var t=this;return this.ajax({url:"/client/get_client_log_union",loading:this.$loading.open(),params:{client_id:this.id||this.newClientId}}).then(function(e){0===e.error_code&&(console.log("logData: ",e.data),t.logData=e.data.list)})}}}},zsBy:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=n(i),r=a("O4Lo"),o=n(r),c=a("NDNc");e.default={props:{page:{type:Number,default:null}},data:function(){return{defaultSortDirection:"asc",provinceName:"",likeCompany:"",totalCompanies:0,companies:[],loading:!1,currPage:1,perPage:20,totalPage:1,jumpPage:1,provinces:JSON.parse((0,s.default)(c.province)),disableProvince:!1,sortField:"number",sortOrder:"asc",enteredDateStart:null,enteredDateEnd:null,likeFrdb:"",companiesName:[],isFetching:!1,forSearch:!0}},computed:{},watch:{currPage:function(t){this.getCompanies()},page:function(t){this.currPage=t||1}},mounted:function(){this.provinces.unshift({name:"",id:""}),this.page&&this.page!==this.currPage?this.currPage=this.page:this.getCompanies();var t=this;document.onkeydown=function(e){t.ifEnter(e)&&t.forSearch&&t.onQueryClick()}},methods:{makeStringDate:function(t){return null===t||""===t?"":this.zDateFormatter(t)},getCompanies:function(){var t=this;return this.loading=!0,this.ajax({url:"/backlog/get_signing_company_backlog",params:{order_name:this.sortField,order_asc_desc:this.sortOrder,like_company_name:this.likeCompany,province_name:this.provinceName,page:this.currPage,size:this.perPage,start_time:this.makeStringDate(this.enteredDateStart),end_time:this.makeStringDate(this.enteredDateEnd),like_frdb:this.likeFrdb}}).then(function(e){console.log(e),t.totalCompanies=e.data.counts,t.totalPage=Math.ceil(e.data.counts/t.perPage),0===t.totalPage&&(t.totalPage=1),t.companies=e.data.lists,1!==t.currPage&&t.currPage!==t.page?t.$router.push(t.$router.currentRoute.path+"?page="+t.currPage):1===t.currPage&&t.$router.push(t.$router.currentRoute.path),t.loading=!1,document.documentElement.scrollTop=0,document.body.scrollTop=0})},resetParams:function(){this.provinceName="",this.likeCompany="",this.enteredDateStart=new Date,this.enteredDateEnd=new Date,this.likeFrdb="",this.companiesName=[]},onQueryClick:function(){1===this.currPage?this.getCompanies():this.currPage=1},searchCompany:(0,o.default)(function(){this.isFetching=!0,this.getcompaniesName()},500),getcompaniesName:function(){var t=this;return this.ajax({url:"/backlog/get_signing_company_backlog",params:{like_company_name:this.likeCompany}}).then(function(e){t.companiesName=e.data.lists,t.isFetching=!1})},onSort:function(t,e){this.sortField=t.toString(),this.sortOrder=e.toString(),this.getCompanies()}}}}},["lVK7"]);